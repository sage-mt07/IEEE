---
conversation_id: "b50cb70f-4a81-4132-a506-ea1936d732bf"
title: "Azure Entra ID 認証フロー"
create_time: 1708752340.153934
update_time: 1708755218.102961
language_guess: "en"
num_messages: 6
part_index: 1
part_count: 1
---

### system — 2024-02-24T05:25:40.153934+00:00

_(empty)_

### user — 2024-02-24T05:25:40.155210+00:00

Azure Entra IDにApplicationを登録した場合の、ユーザー認証の流れを示せ

### assistant — 2024-02-24T05:26:18.838838+00:00

Azure Entra ID (以前のAzure Active DirectoryまたはAzure AD)にアプリケーションを登録すると、ユーザー認証のためにOAuth 2.0やOpenID Connectなどのプロトコルを利用する一般的なフローがあります。以下に、ユーザー認証の基本的な流れを示します。

### ステップ 1: アプリケーションの登録

1. **Azureポータル**にログインし、**Azure Active Directory** サービスを開きます。
2. **[アプリの登録]** セクションに移動し、新しいアプリケーションを登録します。
3. アプリケーションに名前を付け、サポートするアカウントの種類を選択し、リダイレクトURI (アプリケーションが認証レスポンスを受け取る場所) を指定します。

### ステップ 2: 認証フローの選択

OAuth 2.0やOpenID Connectプロトコルを使用する際、アプリケーションの種類やユーザーの認証に求められるレベルに応じて、以下のような認証フローから選択します。

- **認可コードフロー**: Webアプリケーション向け。認証とコード交換のステップを経てアクセストークンを取得します。
- **暗黙フロー**: SPA (シングルページアプリケーション) 向け。直接ブラウザからアクセストークンを取得します。
- **クライアント資格情報フロー**: サーバー間認証向け。アプリケーション自体の認証に使用します。
- **デバイスコードフロー**: デバイスやコンソールアプリケーション向け。デバイスが直接認証情報を入力できない場合に使用します。

### ステップ 3: ユーザー認証の実施

1. **認証リクエスト**: アプリケーションはAzure ADの認証エンドポイントに対して認証リクエストを送信します。このリクエストには、リダイレクトURI、選択した認証フローに応じたレスポンスタイプ、アプリケーションIDなどが含まれます。
2. **ユーザーのログイン**: ユーザーはAzure ADのログインページで認証情報を入力します。
3. **認証と承認**: Azure ADはユーザーの認証を行い、アプリケーションへのアクセス承認を求めます。
4. **トークンの取得**: アプリケーションはAzure ADから認証コード、アクセストークン、IDトークンなどを受け取ります（選択したフローによります）。
5. **リソースアクセス**: アプリケーションは受け取ったアクセストークンを使用して、保護されたリソースにアクセスします。

### ステップ 4: アプリケーションでのトークンの使用

アプリケーションは受け取ったトークンを使用して、ユーザーがアクセスを許可したリソースに対するリクエストを行います。ID

### user — 2024-02-24T06:13:01.141137+00:00

OAuth 2.0 暗黙的な許可とは

### assistant — 2024-02-24T06:13:38.011612+00:00

OAuth 2.0の暗黙的な許可（Implicit Grant）フローは、以前はシングルページアプリケーション（SPA）などのクライアントサイドアプリケーションでアクセストークンを直接取得するために使用されていました。このフローでは、ブラウザを介して直接アクセストークンが返され、認証サーバーとの間でクライアントシークレットを交換する必要がありません。これにより、クライアントアプリケーションがリソースサーバーに対してリソースへのアクセスを直ちに要求できるようになります。

### 暗黙的な許可フローの基本的なステップ

1. **認証リクエスト**: アプリケーションはユーザーエージェント（ブラウザ）を使用して、認証サーバーの認証エンドポイントにリダイレクトします。このリクエストには、レスポンスタイプとして`token`を指定し、クライアントID、リダイレクトURI、スコープなどのパラメータが含まれます。
2. **ユーザー認証**: ユーザーは認証サーバーでログインし、アプリケーションへのアクセス許可を与えます。
3. **アクセストークンの発行**: ユーザーが認証され、アクセス許可を与えると、認証サーバーはユーザーエージェントにリダイレクトURIとともにアクセストークンをフラグメント（URLの`#`以降）として直接返します。
4. **トークンの利用**: アプリケーションはリダイレクトURIからアクセストークンを抽出し、そのトークンを使用してリソースサーバーに対するリクエストを行います。

### 注意点

暗黙的な許可フローは、アクセストークンがクライアントサイドで直接取得・扱われるため、セキュリティ上のリスクが高いとされています。特にトークンの漏洩やXSS攻撃に対する脆弱性が指摘されています。そのため、OAuth 2.0の最新のベストプラクティスでは、認可コードフローにPKCE（Proof Key for Code Exchange）を組み合わせたフローの使用が推奨されています。PKCEを使用した認可コードフローは、クライアントシークレットを保持できない公開クライアントにおいても、高いセキュリティを提供します。
