---
conversation_id: "6863a9b1-b460-8007-ba8d-7d4693cd09a4"
title: "ADO Server 2019から2022"
create_time: 1751361970.067288
update_time: 1752821878.099034
language_guess: "en"
num_messages: 358
part_index: 3
part_count: 3
---

### ✅ 状況確認ポイント

1. **NuGet push コマンドで "Already exists" が出ていた → フィードには存在するはず**
2. **UI に表示されていない理由として以下の可能性：**

---

## 🧩 考えられる原因と対応
### ① **プロジェクトレベル vs コレクションレベルのフィード混同**

- 画像では `project1` 配下の Artifacts を見ています
- しかし、先ほどの push の URL：
  ```
  http://ads2019/DefaultCollection/_packaging/6be0c93f.../nuget/v2/
  ```
  は「**コレクションレベルのフィード**」に対して push しています。

🔧 **対応策：**
- 左メニューのプロジェクトからではなく、**サーバールート（DefaultCollection）＞ Artifacts** でフィードを確認してください。

---
### ② **権限不足 or 表示権限の遅延**

- `project1` 側に権限継承がないと、UIにパッケージが表示されないことがあります。
- 特に **Feed visibility（可視性）** がプロジェクト単位で制限されていると非表示になります。

🔧 **対応策：**
- Azure DevOps Server 管理コンソールまたは Web UI から「フィードの設定」→ 「パーミッション」→ 「このプロジェクトのメンバーが参照可能か」確認。

---
### ③ **フィルター条件（事前に選択されたビュー）**

- 表示対象が `.nupkg` 以外（例：npmなど）になっている可能性があります。

🔧 **対応策：**
- UI上部の「フィード名」の横にある▼から、`vs2019artifacts` を明示的に選び直してください。

---

## 🛠 補足確認

以下のコマンドでフィード一覧を表示し、対象フィードが存在するか確認可能：

```bash
nuget sources list -ConfigFile "%appdata%\NuGet\NuGet.config"
```

---

必要であれば、`nuget.config` の内容や、projectレベル・collectionレベルでの feed URL の整合性も確認しましょう。  
引き続き調査・手順の支援可能です。
### user — 2025-07-15T00:52:14.571000+00:00

elastic search serviceを削除する方法
### assistant — 2025-07-15T00:52:15.629193+00:00

🕘 **送信日時：2025年7月15日（月）20:36 JST**

---

了解です。**ElasticSearch の Windows サービスを削除する方法**は以下の通りです。

---

## ✅ ElasticSearch サービスの削除方法（Windows）
### 方法①: **コマンドラインからサービス削除**

ElasticSearch がサービス登録されている場合、以下のコマンドで削除できます。

#### 1. 管理者権限でコマンドプロンプトを起動

#### 2. サービス名を確認（一般的には `elasticsearch-service-x64` など）

```cmd
sc query state= all | findstr /i elastic
```

#### 3. サービス削除

```cmd
sc delete elasticsearch-service-x64
```

※上記 `elasticsearch-service-x64` は実際のサービス名に合わせてください。

---
### 方法②: **ElasticSearch に同梱の削除用スクリプト使用（旧バージョン用）**

インストールディレクトリ（例：`C:\Program Files\Elastic\Elasticsearch\bin`）に以下のようなバッチファイルがあります：

```cmd
elasticsearch-service.bat remove
```

このコマンドでもサービスが削除できます（PowerShell または CMD 管理者で実行）。

---

## 🔄 削除後に確認すべきこと

1. **サービス一覧に残っていないか**
   ```cmd
   services.msc
   ```

2. **ポート（9200, 9300など）でLISTENしていないか**
   ```cmd
   netstat -ano | findstr :9200
   ```

3. **インストールフォルダが残っている場合、手動で削除可能**

---

ご希望であれば、`TFS/Azure DevOps Server` の ElasticSearch 連携設定が残っていないかもあわせて確認します。必要あればお知らせください。
### user — 2025-07-15T04:25:48.325606+00:00

ビルドパイプライン　ビルドエージェント　artifactsの移行を確認した
エージェントプールの構成が移行前の状態
エージェントは手で構成し直し、?
### assistant — 2025-07-15T04:25:48.495961+00:00

🕘 **送信日時：2025年7月15日（月）20:41 JST**

---

はい、**正しい理解です。Azure DevOps Server におけるエージェントプールとビルドエージェントの移行**は以下のようになります：

---

## ✅ エージェントプールとエージェントの移行仕様
### ◼️ **移行対象になるもの**
| 項目                         | 移行されるか | 備考 |
|------------------------------|--------------|------|
| パイプライン（ビルド定義）   | ✅ 移行される | YAML/Classic両方OK |
| Artifacts フィード           | ✅ 移行される | DBに含まれていれば |
| Test Plans / Boardsなど     | ✅ 移行される | DBに含まれていれば |
| エージェントプール定義       | ✅ 移行される | ただしエージェントは含まれない |
| **ビルドエージェント本体** | ❌ 手動構成必要 | 再登録が必要 |

---

## 🔧 なぜエージェントは移行されないのか？

ビルドエージェントは**各ホストマシンにローカルインストール**されるため、DB移行では含まれません。

エージェントの構成はサーバと連携した上で、

```bash
config.cmd
```

を使って再登録（再設定）する必要があります。

---

## 🔁 再構成手順の概要

1. 対象マシンで DevOps Agent をダウンロード  
   例：https://dev.azure.com/{org}/_admin/_AgentPool

2. `config.cmd` を実行してエージェント再登録  
   例：
   ```cmd
   config.cmd --url http://ads2022/DefaultCollection --auth integrated --pool Default --agent MyAgent01
   ```

3. サービスとして登録（オプション）  
   ```cmd
   svc install
   svc start
   ```

---

## 📌 注意点

- エージェント名が以前と異なるとパイプラインが動作しないことがあります（タグ条件等に依存する場合）。
- プール名が同じでも、サーバURLが変わると `config.cmd` で再設定が必須です。
- サービス起動ユーザー権限やフォルダパスに注意（CIで使用するリソースにアクセスできる必要あり）。

---

必要なら構成スクリプト例や、CIトリガー付きでテストする方法も提示できますよ。
### user — 2025-07-15T04:26:54.280585+00:00

パイプラインから参照するのはエージェントプールでは？
### assistant — 2025-07-15T04:26:54.410780+00:00

🕘 **送信日時：2025年7月15日（月）20:43 JST**

---

はい、そのとおりです。  
**パイプライン（YAML または Classic）は「エージェントプール」を参照**します。

---

## 🔁 パイプラインとエージェントプールの関係
### 🧩 構造イメージ

```
パイプライン ──参照──▶ エージェントプール ──紐付け──▶ ビルドエージェント（物理/仮想マシン）
```

---

## 🔧 移行後に必要な作業まとめ

| 項目                    | 状態 | 補足 |
|-------------------------|------|------|
| パイプライン定義        | ✅ 移行済み | YAMLファイル、Classic構成ともにDB内にあるため移行される |
| エージェントプール名    | ✅ 移行済み | ただしプール名と設定だけ。実体（エージェント）は含まれない |
| ビルドエージェント本体  | ❌ 手動再構成 | 各エージェントに `config.cmd` で再登録が必要 |

---

## 🧭 重要ポイント

- **パイプラインは「プール名」で参照**しているため、  
  **同名のプールが移行されていればパイプライン上は正常に見える**。
  
- しかしそのプールに紐づく**実体のエージェントが登録されていないとジョブが失敗**します。  
  → `No agent could be found for pool "Default"` のようなエラーが出る。

---

## 💡確認方法

1. Azure DevOps Server の Webポータルで  
   **[プロジェクト設定] → [エージェントプール]** を開く  
2. プールに**エージェントが「オンライン」状態で登録されているか**確認  
3. なければ、該当マシンでエージェントを `config.cmd` で再設定

---

必要であれば `config.cmd` の正しい引数付きテンプレートを作成できます。お気軽にどうぞ。
### user — 2025-07-18T04:54:56.506000+00:00

Azure DevOps Server 2019から2022で変更点と新機能の説明を
### user — 2025-07-18T04:55:16.878000+00:00

Azure DevOps Server 2019から2022で変更点と新機能の説明を
### system — 2025-07-18T04:55:23.567768+00:00

_(empty)_
### assistant — 2025-07-18T04:55:23.729659+00:00

_(empty)_
### assistant — 2025-07-18T04:55:23.756519+00:00

🕘 **送信日時：2025年7月18日（木）13:18 JST**

---

やあ、いらっしゃい！  
**Azure DevOps Server 2019 → 2022** の移行に際し、主な変更点・新機能を以下に整理します。  
特に **Server 環境での構成・運用観点** を重視した構成です。

---

## ✅ **主な変更点と新機能一覧**

| カテゴリ               | 2019 → 2022 の主な変更点（Server Update 2 含む） |
|------------------------|---------------------------------------------------|
| **プラットフォーム**    | - Windows Server 2022 をサポート（IIS含む）<br>- SQL Server 2022 をサポート（2022 Update 2） |
| **アーキテクチャ**     | - Elasticsearch 依存の削減（2020年以降は内部利用限定）<br>- 新UI（Webインタフェースの改善） |
| **パイプライン**       | - YAML パイプラインの UX 改善<br>- Classic Pipeline の最終形（将来的には非推奨）<br>- 新しいトークン（OIDC対応など）に対応 |
| **Artifacts**         | - **Universal Packages** サポート改善<br>- HTTPS 必須の警告・制限が強化（`nuget push` に影響） |
| **セキュリティ**       | - PAT（Personal Access Token）の有効期限制御強化<br>- IP制限、TLS構成に関するガイダンス更新 |
| **Boards（作業項目）** | - タグ/フィールドでのフィルタ機能の向上<br>- 作業項目間のリンクUI改善 |
| **レポート機能**       | - SQL Server Reporting Services（SSRS）統合は維持<br>- ただし新機能は限定的（Power BI 推奨の流れ） |
| **Service Hooks**     | - Webhooks に対する安定性と詳細ログの追加<br>- Azure Functions 連携がやや容易に |
| **GitHub連携**         | - GitHub Enterprise Serverとの統合が改善（条件あり） |

---

## 🆕 特筆すべき新機能（開発・運用者向け）
### 1. **YAML パイプライン編集体験の改善**
- IntelliSense 対応強化
- `dependsOn` でのステージ間依存関係明示が見やすく
- `resources:` セクションでの外部接続が整理され直感的に
### 2. **Artifacts 関連の変更**
- HTTP → HTTPS への移行を **強制的に促す仕様**
- `allowInsecureConnections` を `nuget.config` に記述しないと push できない
### 3. **APIバージョンの更新**
- REST API エンドポイントの構成が更新
- 特に認証・トークン関連のAPIが刷新され、Azure DevOps CLIへの依存が減少

---

## 🔄 移行時の注意点（2019→2022）

| 項目 | 注意点 |
|------|--------|
| URL構成 | URLの書き換えが必要な場合、**TfsConfig ChangeServerId** を実施 |
| パイプライン | YAML/Classic の設定は引き継がれるが、**ビルドエージェントの再登録は必要** |
| Artifacts | パッケージは移行されるが、**再接続設定**が必要なことがある |
| Elasticsearch | ElasticSearch サービスは不要になった場合、手動でサービス削除が必要 |
| Agent Pool | 名前・構成は移行されるが、**実体の再登録（`config.cmd`）は手動** |

---

## 📌 参考ドキュメント（公式）

- [Azure DevOps Server 2022 Release Notes (MS公式)](https://learn.microsoft.com/en-us/azure/devops/server/release-notes)
- [NuGet HTTPS Everywhere](https://aka.ms/nuget-https-everywhere)

---

もし「リリースノートの差分だけ比較形式でほしい」「移行チェックリストを出して」などの希望があれば、すぐに対応できますよ！
### system — 2025-07-18T04:56:03.007236+00:00

_(empty)_
### assistant — 2025-07-18T04:56:03.621315+00:00

_(empty)_
### assistant — 2025-07-18T04:56:28.739380+00:00

🕘 **送信日時：2025年7月15日（月）20:46 JST**

---

## Azure DevOps Server 2019 → 2022 の**主な変更点と新機能**

**Microsoft公式リリースノートや各種ドキュメントを元にまとめています。現場感覚で「移行で差が出やすい」「注意すべき」ポイントもコメントします。**

---
### 1. **UIの刷新と使い勝手の向上**
- **Web UIがさらにモダン化**  
  操作感やレスポンスが向上し、全体的にGitHub/Azure DevOps Servicesのデザイン思想が強く反映。
- **ダークモード対応**（一部）

---
### 2. **Pipeline（ビルド/リリース）機能の強化**
- **YAML Pipelineの機能拡充**  
  - 2022ではYAML記法で「マルチステージ」「テンプレート化」「条件分岐」などクラウド同等の機能が追加。
  - Classic Pipeline（GUIビルド）は引き続き利用可能だが、新機能はYAMLのみで追加。
- **Self-hosted Agent のバージョン要件引き上げ**  
  - 最新のAgent（2.196以降など）が必須。古いバージョンの再利用は非推奨。

---
### 3. **Git機能・リポジトリ関連**
- **大規模リポジトリのパフォーマンス改善**  
  - GitのGCやクローン処理の効率化。
- **Git LFS（Large File Storage）完全対応**
- **セキュリティ強化（PAT・SSH鍵管理の改善）**

---
### 4. **Boards/Work Item 関連**
- **BoardsのUI・パフォーマンス向上**
- **親子階層、関連付けのUI操作性改善**
- **Analytics機能の拡充**  
  - レポートやダッシュボードの精度・速度アップ

---
### 5. **Artifacts（NuGet等）**
- **NuGet v3 Feed/Protocol対応**
- **脆弱性スキャンのUI通知（クラウド同等機能の一部バックポート）**

---
### 6. **管理/運用まわり**
- **SQL Server 2022サポート**
- **ElasticSearchは引き続きサポート（廃止予定案内あり）**
- **より柔軟な監査ログ出力**
- **SSO（シングルサインオン）系の改善**
- **バックアップツール・リストアツールの強化**

---
### 7. **その他**
- **Azure DevOps Services（クラウド版）との差分が縮小**  
  → 2022ではより「クラウドと同じワークフロー」が目指されている。  
  例：YAMLベースの構成、拡張の導入方法など

---

## 🎯 **現場目線での注意点・Tips**
- **Pipelineまわりの移行テストは必須**  
  YAML/Classicどちらでも、エージェント周辺やパラメータ記法で「動かない」ケースあり。
- **NuGet v3エンドポイントへのURL置き換え**が推奨される。
- **管理コンソールの操作性・構成項目も一部見直しあり**（サービスフック、権限管理など）。
- **Self-hosted Agentの再インストール・アップデート**を忘れずに。
- **ElasticSearchは将来的な廃止が示唆されている**（今後のサーチ機能移行も要ウォッチ）。

---
### 🔗 [公式アップグレードガイド（英語）](https://learn.microsoft.com/en-us/azure/devops/server/whats-new?view=azure-devops-2022)

---

その他、気になる差分や検証したいポイントがあれば個別に深掘りもできます。  
現場での移行トラブル事例や「ここは注意！」などもフィードバック可能です☕
### system — 2025-07-18T04:56:40.366822+00:00

_(empty)_
### assistant — 2025-07-18T04:56:40.366951+00:00

_(empty)_
### user — 2025-07-18T06:57:30.276000+00:00

TFVCを使い続けることに関する問題、運用上きをつけることは？
### assistant — 2025-07-18T06:57:30.355720+00:00

🕘 **送信日時：2025年7月15日（月）20:49 JST**

---

## TFVC（Team Foundation Version Control）を使い続ける場合の**問題点・運用上の注意**

---
### 1. **開発トレンドからの取り残され感**
- **新規開発やOSSではGitが主流**。  
  サードパーティ連携、DevOpsツール、CI/CD環境など「Git前提」のものが増え、**TFVC対応は縮小傾向**。

---
### 2. **Microsoft公式の機能改善がストップ**
- **TFVC自体への新機能追加は基本停止**。  
  Azure DevOps Server 2022 でも**メンテナンスのみ**で、  
  *YAMLパイプラインのフル連携*や*拡張機能*の恩恵はGitのみが対象。

---
### 3. **CI/CDパイプラインとの統合で制限**
- **Classic BuildはTFVC対応だが**  
  YAML PipelineやGitOps/Trunk Based系のDevOpsパターンはTFVC未対応。
- **外部サービス連携やクラウド化も非推奨**。

---
### 4. **運用上の具体的な注意点**

| 項目 | 注意点 |
|------|--------|
| **クライアントバインド** | Visual Studio の「.tf」バインド情報を常に管理。**クライアント移行・VM環境の使いまわしでは手作業で再取得が必要**。 |
| **パフォーマンス** | 大規模リポジトリでは「ラベル取得」や「ヒストリー検索」が遅くなる傾向。 |
| **アクセス権管理** | フォルダごとのアクセス権が複雑化しやすい。Gitに比べて誤設定がバグを生みやすい。 |
| **バックアップ運用** | SQL DBのフルバックアップで一括管理できるが、細粒度のリカバリーは困難。 |
| **マージ戦略** | TFVC独特の「ブランチ管理」や「マージパターン」は習熟が必要。Gitより操作ミスによるロストリスクが高い。 |
| **新規ユーザー教育** | 新人・若手にTFVC文化を教えるのは現場で手間とストレスが増えている（大半がGit世代）。 |

---
### 5. **長期運用のリスク**

- **製品サポートが突然終了する可能性**（2025年時点で長期的なロードマップは出ていない）
- **人材採用・教育コスト増**（TFVC経験者は減少傾向）
- **移行検討時のコスト増加**（履歴・ラベル・属性移行の難しさ）

---

## 🟠 **現場での「やむを得ない事情」がある場合の運用Tips**

- バインド情報やマッピングスクリプトの自動化（PowerShell等でプロファイル復元）
- **定期的な履歴エクスポート（例：`tf history`コマンドによるCSV化）**
- 移行判断が必要になった時に備え、「**ブランチ戦略と権限構成図を必ずドキュメント化**」
- Gitとの併用が必要な場合は、サブリポジトリや `git-tfs` などのツール検証も

---

ご希望あれば、「**TFVC→Git移行時の落とし穴とベストプラクティス**」も整理できます。  
他に気になる観点があればご指示ください。
