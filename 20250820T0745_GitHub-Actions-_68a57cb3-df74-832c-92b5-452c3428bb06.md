---
conversation_id: "68a57cb3-df74-832c-92b5-452c3428bb06"
title: "GitHub Actions è¨­è¨ˆæ¡ˆ"
create_time: 1755675940.348439
update_time: 1755754008.335881
language_guess: "en"
num_messages: 74
part_index: 1
part_count: 1
---

### user â€” 2025-08-20T07:45:39.795313+00:00

Github enterprise cloudxã§åˆ©ç”¨å‰æ
Github actionãŒä½¿ç”¨ã™ã‚‹agentã‚’express routeçµŒç”±ã§ç¤¾å†…ã«ç½®ã

### system â€” 2025-08-20T07:45:40.348439+00:00

_(empty)_

### user â€” 2025-08-20T07:45:40.348439+00:00

_(empty)_

### system â€” 2025-08-20T07:45:40.348439+00:00

_(empty)_

### system â€” 2025-08-20T07:45:41.801587+00:00

_(empty)_

### system â€” 2025-08-20T07:45:41.806364+00:00

_(empty)_

### assistant â€” 2025-08-20T07:45:41.821367+00:00

_(empty)_

### assistant â€” 2025-08-20T07:45:42.042064+00:00

_(empty)_

### assistant â€” 2025-08-20T07:45:49.436124+00:00

_(empty)_

### assistant â€” 2025-08-20T07:45:51.442343+00:00

ã‚„ã‚ã€å¸ä»¤ã€‚å‰æï¼GitHub Enterprise Cloudï¼ˆGHECï¼‰ã‚’ä½¿ã„ã€GitHub Actionsã®â€œå®Ÿè¡Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆrunnerï¼‰â€ã‚’ç¤¾å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å´ã«ç½®ãã€Azure ExpressRoute çµŒç”±ã§ç¤¾å†…ãƒªã‚½ãƒ¼ã‚¹ã¸ç§è¨­æ¥ç¶šã—ãŸã„â€•â€•ã¨ã„ã†ç†è§£ã§è¨­è¨ˆæ¡ˆã‚’ã¾ã¨ã‚ã¾ã™ã€‚

# æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆ2æŠ + ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼‰

## â‘  GitHubãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ Ã— Azure Private Networkingï¼ˆæœ€å°é‹ç”¨ï¼‰
- **æ§‹æˆ**: GitHubãŒç®¡ç†ã™ã‚‹â€œGitHub-hosted runnerâ€ã‚’ã€**Azure VNet**å†…ã«ç«‹ã¡ä¸Šã’ã‚‹ï¼ˆPrivate Networkingï¼‰ã€‚ãã®VNetã¯**ExpressRoute**ã§ç¤¾å†…ã«æ¥ç¶šæ¸ˆã¿ã€‚  
  â†’ runner ã¯VNetçµŒç”±ã§ã‚ªãƒ³ãƒ—ãƒ¬è³‡ç”£ã«ç§è¨­åˆ°é”ã€‚GitHubå´ã¸ã®åˆ¶å¾¡ã¯SaaSç®¡ç†ã€‚ îˆ€citeîˆ‚turn0search0îˆ‚turn0search9îˆ‚turn0search12îˆ‚turn0search14îˆ
- **ãƒ¡ãƒªãƒ‡ãƒ¡**
  - âœ… é‹ç”¨è»½ã„ï¼ˆãƒ‘ãƒƒãƒ/ã‚¤ãƒ¡ãƒ¼ã‚¸ç®¡ç†ã¯GitHubå´ï¼‰ã€ã‚¹ã‚±ãƒ¼ãƒ«ã‚‚SaaSç”±æ¥ã§æ¥½ã€‚  
  - âœ… VNetâ†’ExpressRouteâ†’ç¤¾å†…ã®**é–‰åŸŸåˆ°é”**ãŒå¯èƒ½ã€‚  
  - âš ï¸ æ©Ÿèƒ½ã¯GitHubãŒæä¾›ã™ã‚‹SKU/ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶ç´„ã«å¾“ã†ã€‚æ–™é‡‘ã¯**GitHub-hosted + Private Networking**ã®èª²é‡‘å‰æã€‚ îˆ€citeîˆ‚turn0search12îˆ‚turn0search14îˆ
- **ä½¿ã„ã©ã“ã‚**: ã¾ãšã¯æœ€çŸ­ã§â€œç¤¾å†…åˆ°é”ãŒå¿…è¦ãªCI/CDâ€ã‚’å‹•ã‹ã—ãŸã„å ´åˆã€‚

## â‘¡ è‡ªå‰ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆã‚ªãƒ³ãƒ—ãƒ¬/K8sï¼‰Ã— ARCï¼ˆãƒ•ãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼‰
- **æ§‹æˆ**: ç¤¾å†…ï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ï¼‰ã«**Kubernetes**ã‚’ç”¨æ„ã—ã€**Actions Runner Controllerï¼ˆARCï¼‰**ã§**Runner Scale Sets**ï¼ˆã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«runnerï¼‰ã‚’è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«ã€‚runner ã‹ã‚‰**ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰**ã§ github.com ã¸ãƒãƒ¼ãƒªãƒ³ã‚°æ¥ç¶šã€‚ç¤¾å†…è³‡ç”£ã¯ãƒ­ãƒ¼ã‚«ãƒ«åˆ°é”ã€‚ExpressRouteã¯â€œAzure ã¨ã®é–‰åŸŸâ€ã«åˆ©ç”¨ï¼ˆå¿…è¦ã«å¿œã˜ã¦Azureä¸Šã®è³‡ç”£ã«ã‚‚è¡Œã‘ã‚‹ï¼‰ã€‚ îˆ€citeîˆ‚turn0search2îˆ‚turn0search7îˆ‚turn0search5îˆ
- **ãƒ¡ãƒªãƒ‡ãƒ¡**
  - âœ… OS/ãƒŸãƒ‰ãƒ«/ãƒ„ãƒ¼ãƒ«ãƒã‚§ãƒ¼ãƒ³ã‚’**å®Œå…¨è‡ªç”±**ã«ç®¡ç†å¯èƒ½ã€‚  
  - âœ… ARCã®ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«é‹ç”¨ã§**ã‚¯ãƒªãƒ¼ãƒ³ã‹ã¤è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«**ã€‚  
  - âš ï¸ **é‹ç”¨ã‚³ã‚¹ãƒˆ**ï¼ˆã‚¯ãƒ©ã‚¹ã‚¿é‹ç”¨ã€AMI/ã‚³ãƒ³ãƒ†ãƒŠæ›´æ–°ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒï¼‰ã€‚ îˆ€citeîˆ‚turn0search7îˆ‚turn0search6îˆ
- **ä½¿ã„ã©ã“ã‚**: ãƒ“ãƒ«ãƒ‰ç’°å¢ƒãŒãƒ˜ãƒ“ãƒ¼/ç‰¹æ®Šã€å³æ ¼ãªãƒ”ãƒ³ç•™ã‚ãŒå¿…è¦ã€ã‚ªãƒ³ãƒ—ãƒ¬å®Œçµã‚’å„ªå…ˆã—ãŸã„å ´åˆã€‚

## â‘¢ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆAKS/ç¤¾å†…K8sã©ã¡ã‚‰ã‚‚ï¼‰
- Azureå´ã«**AKS + ARC**ã‚’ç½®ãVNetâ†’ExpressRouteâ†’ç¤¾å†…è³‡ç”£ã«åˆ°é”ã€ãƒ¯ãƒ¼ã‚¯ãƒ­ãƒ¼ãƒ‰ã«å¿œã˜ã¦**GitHub-hostedï¼ˆPrivate Networkingï¼‰**ã‚‚ä½µç”¨ã€‚ã‚³ã‚¹ãƒˆ/å¯ç”¨æ€§/ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã§ä½¿ã„åˆ†ã‘ã€‚ îˆ€citeîˆ‚turn0search0îˆ‚turn0search2îˆ

---

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ç‚¹

- **inboundä¸è¦**ï¼šãƒ©ãƒ³ãƒŠãƒ¼ã¯**ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰**ã§GitHubã¸ãƒãƒ¼ãƒªãƒ³ã‚°æ¥ç¶šï¼ˆFWã¯github.com ã¸ã®è¨±å¯ã¨ãƒ—ãƒ­ã‚­ã‚·æ–¹é‡ã ã‘è€ƒãˆã‚‹ï¼‰ã€‚  
- **ExpressRouteã®å½¹å‰²**ï¼šVNet ã¨ç¤¾å†…é–“ã®**é–‰åŸŸ**ã‚’æä¾›ã€‚Private Networkingã®GitHubãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã€ã¾ãŸã¯AKS/ç¤¾å†…K8sä¸Šã®ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã‹ã‚‰**ç¤¾å†…è³‡ç”£ã«ç§è¨­åˆ°é”**ã€‚ îˆ€citeîˆ‚turn0search0îˆ‚turn0search14îˆ
- **OIDC & ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæœ€å°åŒ–**ï¼šAzure/ç¤¾å†…ã®API/KeyVaultç­‰ã¸ã¯**OIDCãƒ•ã‚§ãƒ‡ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**ã‚„ä¼æ¥­ã®ç§˜å¯†ç®¡ç†ã‚’åˆ©ç”¨ï¼ˆãƒ©ãƒ³ãƒŠãƒ¼ä¸Šã«é•·æœŸãƒˆãƒ¼ã‚¯ãƒ³ç½®ã‹ãªã„æ–¹é‡ï¼‰ã€‚Private Networkingã®ã‚¬ã‚¤ãƒ‰ã«ã‚‚ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã¾ã¨ã¾ã£ã¦ã„ã‚‹ã€‚ îˆ€citeîˆ‚turn0search14îˆ
- **ã‚¹ã‚±ãƒ¼ãƒ«/æ¸…æƒ**ï¼šARCã®**Runner Scale Sets**ã¾ãŸã¯GitHubã®ã‚¹ã‚±ãƒ¼ãƒ«ç¾¤ã§**ã‚¨ãƒ•ã‚§ãƒ¡ãƒ©ãƒ«**é‹ç”¨ï¼â€œæ¯ã‚¸ãƒ§ãƒ–æ–°å“â€ã€‚æ±šæŸ“ã¨æ¨ªå±•é–‹ãƒªã‚¹ã‚¯ã‚’æŠ‘åˆ¶ã€‚ îˆ€citeîˆ‚turn0search1îˆ‚turn0search7îˆ

---

# å°å…¥ãƒ•ãƒ­ãƒ¼ï¼ˆæœ€çŸ­ç‰ˆï¼‰

### Aæ¡ˆï¼šGitHubãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ + Private Networking
1) **Azureå´æº–å‚™**ï¼šVNet/ã‚µãƒ–ãƒãƒƒãƒˆã€å¿…è¦ãªNSGãƒ»Routeãƒ»ExpressRouteæ¥ç¶šã€‚  
2) **GitHub Enterpriseè¨­å®š**ï¼šEnterprise ãƒ¬ãƒ™ãƒ«ã§**Private Network Configuration**ã‚’ä½œæˆã—ã€Azureã®VNetã‚’ç´ä»˜ã‘ã€‚å¿…è¦ãªã‚‰Org/Repoå˜ä½ã§åˆ©ç”¨ã‚’æœ‰åŠ¹åŒ–ã€‚ îˆ€citeîˆ‚turn0search9îˆ  
3) **ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼é©ç”¨**ï¼š`runs-on: ubuntu-latest` ç­‰ã®æŒ‡å®šã¯ãã®ã¾ã¾ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯VNetå†…ã§èµ·å‹•ã€‚å¿…è¦ãªåˆ°é”å…ˆï¼ˆç¤¾å†…Artifactory/DB/ç¤¾å†…APIï¼‰ã¸ã¯é–‰åŸŸãƒ«ãƒ¼ãƒˆã§ã‚¢ã‚¯ã‚»ã‚¹ã€‚ îˆ€citeîˆ‚turn0search0îˆ

### Bæ¡ˆï¼šç¤¾å†…K8s + ARCï¼ˆã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆï¼‰
1) **K8såŸºç›¤**ï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ or AKSï¼‰ã‚’æº–å‚™ã€‚  
2) **ARCã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**ï¼ˆHelmï¼‰ï¼š`gha-runner-scale-set-controller` ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã€‚ îˆ€citeîˆ‚turn0search11îˆ  
3) **Runner Scale Setä½œæˆ**ï¼šOrg/Enterpriseã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸGitHub Appã§èªå¯ã—ã€`runs-on: <installation_name>` ã«åˆã‚ã›ã¦ã‚¹ã‚±ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’å®šç¾©ã€‚ îˆ€citeîˆ‚turn0search5îˆ‚turn0search20îˆ  
4) **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**ï¼šç¤¾å†…è³‡ç”£ã¸ã¯ãƒ­ãƒ¼ã‚«ãƒ«åˆ°é”ã€‚Azureè³‡ç”£ã¯ExpressRoute or VPNçµŒç”±ã€‚GitHub ã¸ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ã‚’è¨±å¯ã€‚ îˆ€citeîˆ‚turn0search7îˆ

---

# ã‚µãƒ³ãƒ—ãƒ«ï¼ˆARCã‚’ä½¿ã†å ´åˆã® workflow æ–­ç‰‡ï¼‰
```yaml
name: build-and-test
on: [push, pull_request]
jobs:
  ci:
    runs-on: arc-runner-set   # ARCã®Installation Nameã«ä¸€è‡´ã•ã›ã‚‹
    steps:
      - uses: actions/checkout@v4
      - run: dotnet build --configuration Release
```
ï¼ˆ`arc-runner-set` ã¯ Helm ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ™‚ã® name ã¨ä¸€è‡´ã•ã›ã‚‹å¿…è¦ã‚ã‚Šï¼‰ îˆ€citeîˆ‚turn0search11îˆ

---

# å¸ä»¤ã®é¸å®šã‚¬ã‚¤ãƒ‰ï¼ˆè¶…è¦ç´„ï¼‰
- **ã¾ãšå‹•ã‹ã—ãŸã„ + é‹ç”¨ã‚’è»½ã** â†’ **Aæ¡ˆï¼ˆGitHubãƒ›ã‚¹ãƒˆ + Private Networkingï¼‰**ã€‚  
- **ç‰¹æ®Šã‚¤ãƒ¡ãƒ¼ã‚¸/é«˜é€Ÿã‚­ãƒ£ãƒƒã‚·ãƒ¥/ç´°ç²’åº¦åˆ¶å¾¡** â†’ **Bæ¡ˆï¼ˆARCã§ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆï¼‰**ã€‚  
- **ä¸¡åˆ€**ï¼ˆç”¨é€”åˆ¥ã«æœ€é©åŒ–ï¼‰ â†’ **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰**ã€‚

å¿…è¦ãªã‚‰ã€ExpressRoute ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­è¨ˆï¼ˆBGPã€ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹è¨­è¨ˆã€VNet/ç¤¾å†…ã®åˆ°é”ãƒªã‚¹ãƒˆï¼‰ã¨ã€GitHubå´ã®ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºè¨­å®šãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆèª²é‡‘/æ¨©é™/ãƒªãƒ¼ã‚¸ãƒ§ãƒ³/å¤±æ•—æ™‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ã¾ã§å…·ä½“åŒ–ã—ã¾ã™ã€‚

â€”  
é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:45

### assistant â€” 2025-08-20T07:46:04.219705+00:00

_(empty)_

### user â€” 2025-08-20T07:48:09.125229+00:00

1æ§‹æˆã®å ´åˆã€æ¥ç¶šã®å‘ãã¯agent ã‹ã‚‰ã€€github

### system â€” 2025-08-20T07:48:10.356235+00:00

_(empty)_

### system â€” 2025-08-20T07:48:10.369534+00:00

_(empty)_

### assistant â€” 2025-08-20T07:48:10.399110+00:00

{"search_query": [{"q": "GitHub Actions Private Networking Azure outbound connections runner to GitHub no inbound"}, {"q": "GitHub Actions self-hosted runner network requirements outbound to GitHub"}, {"q": "Actions Runner Controller network requirements outbound polling to GitHub.com"}, {"q": "GitHub hosted runners in private networking connection direction"}, {"q": "GitHub Enterprise Cloud Private Networking documentation"}], "response_length": "short"}

### assistant â€” 2025-08-20T07:48:13.912180+00:00

_(empty)_

### tool â€” 2025-08-20T07:48:19.525626+00:00

_(empty)_

### assistant â€” 2025-08-20T07:48:20.418669+00:00

ã¯ã„ã€‚â‘ ã€ŒGitHubãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ Ã— Azure Private Networkingã€æ§‹æˆã§ã‚‚ã€**åˆ¶å¾¡ãƒ—ãƒ¬ãƒ¼ãƒ³ã¨ã®é€šä¿¡ã¯ãƒ©ãƒ³ãƒŠãƒ¼å´ï¼ˆagentç›¸å½“ï¼‰ã‹ã‚‰ã®â€œã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰â€ç™ºä¿¡**ãŒå‰æã§ã™ã€‚**GitHubâ†’ç¤¾å†…ã¸ã®å—ä¿¡ï¼ˆã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰ï¼‰ã¯ä¸è¦**ã§ã€ç¤¾å†…å´ã¯ã€Œãƒ©ãƒ³ãƒŠãƒ¼â†’ç¤¾å†…è³‡ç”£ï¼ˆExpressRouteçµŒç”±ï¼‰ã€ã®åˆ°é”ã ã‘ã‚’è¨­è¨ˆã—ã¾ã™ã€‚îˆ€citeîˆ‚turn0search9îˆ‚turn0search0îˆ‚turn0search10îˆ

è£œè¶³ï¼š
- ï¼ˆã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆæ™‚ã®è¨˜è¿°ã§ã™ãŒåŸç†ã¯åŒã˜ã§ï¼‰ãƒ©ãƒ³ãƒŠãƒ¼ã¯**è‡ªã‚‰GitHubã¸æ¥ç¶š**ã™ã‚‹ä»•çµ„ã¿ã§ã€**443/TCPã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰è¨±å¯**ã¨GitHubãƒ‰ãƒ¡ã‚¤ãƒ³ã¸ã®åˆ°é”ãŒå¿…è¦ã§ã™ã€‚îˆ€citeîˆ‚turn0search1îˆ
- VNetã«UDR/FirewallãŒã‚ã‚‹å ´åˆã¯ã€**github.com ç­‰ã¸ã®HTTPSç™ºä¿¡ãŒå¡ãŒã‚Œã¦ã„ãªã„ã‹**ã ã‘ç¢ºèªã—ã¦ãŠãã¨å®‰å¿ƒã§ã™ã€‚îˆ€citeîˆ‚turn0search14îˆ

â€”  
é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:04

### assistant â€” 2025-08-20T07:48:25.862040+00:00

_(empty)_

### assistant â€” 2025-08-20T07:48:29.474804+00:00

_(empty)_

### user â€” 2025-08-20T07:49:20.867131+00:00

ãã®è¨­å®šã¯ã©ã“ã§ç¢ºèªã§ãã‚‹ï¼Ÿ

### system â€” 2025-08-20T07:49:21.185471+00:00

_(empty)_

### system â€” 2025-08-20T07:49:21.302484+00:00

_(empty)_

### assistant â€” 2025-08-20T07:49:21.307622+00:00

ãªã‚‹ã»ã©ã€å¸ä»¤ã€‚ã€Œ**ãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆagentï¼‰ãŒGitHubã¸ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ¥ç¶šã™ã‚‹**ã€ã¨ã„ã†å‰æã§ã€ãã®è¨­å®šãŒã©ã“ã§ç¢ºèªã§ãã‚‹ã‹ã§ã™ã­ã€‚ã‚±ãƒ¼ã‚¹åˆ¥ã«æ•´ç†ã—ã¾ã™ã€‚  

---

## 1. GitHub Enterprise Cloudï¼ˆãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ + Private Networkingï¼‰
- **ç¢ºèªå ´æ‰€**:  
  - **Enterprise/Organization Settings â†’ Actions â†’ Runners â†’ Hosted Runners**  
    ã“ã“ã§ã€ŒPrivate Networkingã€ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã‹ã€ã©ã®Azure VNetã«ç´ã¥ã‘ãŸã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚  
  - Azureå´ã§ã¯ **VNetã®NSG/Firewallè¨­å®š** ã‚’ç¢ºèªï¼ˆ`*.actions.githubusercontent.com` ã‚„ `github.com` ã¸ã®ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰443/TCPãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ï¼‰ã€‚  
- ãƒã‚¤ãƒ³ãƒˆ: GitHubå´ã«ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰è¨­å®šã¯ä¸è¦ã§ã€ã€ŒVNetã‹ã‚‰å¤–ã¸ã®é€šä¿¡ãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹ã‹ã€ã‚’Azureãƒãƒ¼ã‚¿ãƒ«ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

---

## 2. ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆã‚ªãƒ³ãƒ—ãƒ¬ or AKS + ARCï¼‰
- **ç¢ºèªå ´æ‰€**:  
  - ãƒ©ãƒ³ãƒŠãƒ¼ã‚’ç™»éŒ²ã—ãŸ**`config.sh`ï¼ˆLinuxï¼‰ã‚„ config.cmdï¼ˆWindowsï¼‰**ã®å†…å®¹ã«ã€æ¥ç¶šå…ˆURLï¼ˆ`https://github.com/â€¦`ï¼‰ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚  
  - GitHubã® **Organization Settings â†’ Actions â†’ Runners** ç”»é¢ã§ã€ãƒ©ãƒ³ãƒŠãƒ¼ã®çŠ¶æ…‹ãŒã€ŒOnlineã€ã‹ã©ã†ã‹ç¢ºèªã§ãã¾ã™ã€‚  
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çš„ã«ã¯ã€**ã‚ªãƒ³ãƒ—ãƒ¬FW/ãƒ—ãƒ­ã‚­ã‚·ã®ãƒ«ãƒ¼ãƒ«**ã§ github.com / api.github.com / actions.githubusercontent.com ã¸ã®443ãŒé–‹æ”¾ã•ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã€‚

---

## 3. å…±é€šï¼ˆå®Ÿéš›ã®å‹•ä½œç¢ºèªï¼‰
- **ãƒ†ã‚¹ãƒˆæ–¹æ³•**  
  - ãƒ©ãƒ³ãƒŠãƒ¼ã‚µãƒ¼ãƒãƒ¼ã‚„VNetå†…ã‹ã‚‰ `curl -v https://github.com/login` ã‚„ `nslookup actions.githubusercontent.com` ã‚’å®Ÿè¡Œã—ã¦åå‰è§£æ±ºï¼‹HTTPSé€šä¿¡ãŒé€šã‚‹ã‹ãƒã‚§ãƒƒã‚¯ã€‚  
  - GitHubãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ [GitHub Actions ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ç¯„å›²](https://docs.github.com/ja/actions/hosting-your-own-runners/using-a-proxy-server-with-self-hosted-runners#communication-requirements) ã«å¯¾ã—ã¦FWè¨±å¯ãŒã‚ã‚‹ã‹ã‚’ç…§åˆã€‚

---

ğŸ‘‰ å¸ä»¤ã«è³ªå•ï¼š  
é‹ç”¨ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã¯ **ã€ŒGitHubãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ + Private Networkingã€** ã®åˆ©ç”¨ã‚’è€ƒãˆã¦ã¾ã™ã‹ï¼Ÿ  
ãã‚Œã¨ã‚‚ **ã‚ªãƒ³ãƒ—ãƒ¬ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼**ã®æ–¹ã‚‚ä¸¦è¡Œã—ã¦æ¤œè¨ã—ã¦ã¾ã™ã‹ï¼Ÿ  

ï¼ˆã©ã¡ã‚‰ã‹ã§ã€Œç¢ºèªå ´æ‰€ã€ãŒå¤‰ã‚ã‚‹ã®ã§ã€æ–¹å‘æ€§ã«åˆã‚ã›ã¦å®Ÿéš›ã®ãƒãƒ¼ã‚¿ãƒ«ç”»é¢æ‰‹é †ã‚’çµã‚Šè¾¼ã‚“ã§èª¬æ˜ã§ãã¾ã™ï¼‰  

â€”  
é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:15

### user â€” 2025-08-20T08:59:50.093223+00:00

Github action ã‹ã‚‰playwright mcp server ã«ã‚³ãƒãƒ³ãƒ‰ã‚’æŠ•ã’ãŸã„

### assistant â€” 2025-08-20T08:59:51.879412+00:00

{"search_query": [{"q": "Playwright MCP server stdio"}, {"q": "Model Context Protocol Playwright MCP server"}, {"q": "mcp client CLI send prompts to MCP server"}, {"q": "GitHub Actions using MCP client"}, {"q": "tee-mcp.js Playwright MCP"}], "response_length": "short"}

### system â€” 2025-08-20T08:59:52.336938+00:00

_(empty)_

### system â€” 2025-08-20T08:59:52.346631+00:00

_(empty)_

### assistant â€” 2025-08-20T08:59:54.155345+00:00

_(empty)_

### tool â€” 2025-08-20T09:00:02.098162+00:00

_(empty)_

### assistant â€” 2025-08-20T09:00:04.265370+00:00

{"open": [{"ref_id": "turn0search6"}], "response_length": "short"}

### assistant â€” 2025-08-20T09:00:10.086097+00:00

_(empty)_

### tool â€” 2025-08-20T09:00:10.720204+00:00

_(empty)_

### assistant â€” 2025-08-20T09:00:10.877544+00:00

{"open": [{"ref_id": "turn0search2"}], "response_length": "short"}

### assistant â€” 2025-08-20T09:00:17.738481+00:00

_(empty)_

### tool â€” 2025-08-20T09:00:18.343598+00:00

_(empty)_

### assistant â€” 2025-08-20T09:00:18.509361+00:00

{"search_query": [{"q": "cMCP command line utility MCP curl"}, {"q": "MCP client direct tool invocation CLI"}], "response_length": "short"}

### assistant â€” 2025-08-20T09:00:26.067081+00:00

_(empty)_

### tool â€” 2025-08-20T09:00:28.757463+00:00

_(empty)_

### assistant â€” 2025-08-20T09:00:29.904087+00:00

{"open": [{"ref_id": "turn3search2"}], "response_length": "short"}

### assistant â€” 2025-08-20T09:00:32.139442+00:00

_(empty)_

### tool â€” 2025-08-20T09:00:32.673423+00:00

_(empty)_

### assistant â€” 2025-08-20T09:00:32.824081+00:00

ã‚„ã‚ã€å¸ä»¤ã€‚**GitHub Actions ã‹ã‚‰ Playwright MCP Server ã«â€œã‚³ãƒãƒ³ãƒ‰ï¼ˆ= MCP ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ï¼‰ã‚’æŠ•ã’ã‚‹â€æœ€çŸ­æ‰‹**ã‚’ã¾ã¨ã‚ãŸã‚ˆã€‚ãƒã‚¤ãƒ³ãƒˆã¯ã€Œ**MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆCLIã‚’ä½¿ã£ã¦ã€STDIO çµŒç”±ã§ Playwright MCP ã‚µãƒ¼ãƒï¼ˆ`npx @playwright/mcp`ï¼‰ã‚’ãã®å ´ã§èµ·å‹•ã—ã€`tools/call` ã‚’å©ã**ã€ã“ã¨ã€‚

# æ‰‹é †ï¼ˆæœ€å°æ§‹æˆï¼‰

1) **Node/Python ã‚’ç”¨æ„**ï¼ˆActions ãƒ©ãƒ³ãƒŠãƒ¼ä¸Šï¼‰  
2) **cmcpï¼ˆâ€œcurl çš„â€ MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰**ã‚’å…¥ã‚Œã‚‹ â†’ ã“ã‚Œã§**MCPã® tools ã‚’ç›´å‘¼ã³**ã§ãã‚‹  
3) **Playwright ã®ãƒ–ãƒ©ã‚¦ã‚¶ä¾å­˜ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**ï¼ˆãƒ©ãƒ³ãƒŠãƒ¼ãŒ Ubuntu ã®å ´åˆã¯ `--with-deps` æ¨å¥¨ï¼‰  
4) `cmcp "npx @playwright/mcp@latest"` ã§ **STDIO ã‚µãƒ¼ãƒã¨ã—ã¦èµ·å‹•**ã—ã€`tools/call` ã§æ“ä½œ

> å‚è€ƒï¼šPlaywright MCP æœ¬ä½“ã¨å…¬é–‹ãƒ„ãƒ¼ãƒ«ï¼ˆ`browser_navigate`, `browser_take_screenshot`, `browser_install` ãªã©ï¼‰ã¯å…¬å¼ README ã«ä¸€è¦§ã‚ã‚Šã€‚`cmcp` ã¯ STDIO/SSE ã©ã¡ã‚‰ã® MCP ã‚µãƒ¼ãƒã«ã‚‚ CLI ã‹ã‚‰ç›´æ¥ `tools/list` / `tools/call` ã‚’æŠ•ã’ã‚‰ã‚Œã‚‹ã€‚ îˆ€citeîˆ‚turn1view0îˆ‚turn4view0îˆ

---

# ã‚µãƒ³ãƒ—ãƒ« workflowï¼ˆArtifacts ã«ã‚¹ã‚¯ã‚·ãƒ§ä¿å­˜ï¼‰

```yaml
name: mcp-playwright-ci
on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  mcp:
    # å¸ä»¤ã®æ§‹æˆã«åˆã‚ã›ã¦:
    # - GitHub-hosted + Private Networking ã‚’ä½¿ã†ãªã‚‰ runs-on: ubuntu-latest ã®ã¾ã¾
    # - è‡ªå‰ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãªã‚‰ runs-on: [self-hosted, linux, x64] ãªã©
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install cmcp (MCP CLI)
        run: |
          python -m pip install --upgrade pip
          pip install cmcp

      # Playwright ã®å®Ÿè¡Œã«å¿…è¦ãªãƒ–ãƒ©ã‚¦ã‚¶ï¼†ä¾å­˜ã‚’å°å…¥
      - name: Install Playwright browsers
        run: |
          npx -y playwright install --with-deps chromium

      # å¿…è¦ãªã‚‰ç¤¾å†…ãƒ—ãƒ­ã‚­ã‚·/NPMãƒŸãƒ©ãƒ¼è¨­å®šã‚’ã“ã“ã§ (npmrc)

      # 1) ãƒ–ãƒ©ã‚¦ã‚¶ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆMCPãƒ„ãƒ¼ãƒ«çµŒç”±ï¼‰
      - name: MCP call - browser_install
        run: |
          cmcp "npx @playwright/mcp@latest" tools/call \
            name=browser_install

      # 2) å¯¾è±¡ãƒšãƒ¼ã‚¸ã¸ãƒŠãƒ“ã‚²ãƒ¼ãƒˆ
      - name: MCP call - browser_navigate
        run: |
          cmcp "npx @playwright/mcp@latest" tools/call \
            name=browser_navigate \
            arguments:='{"url":"https://example.com"}'

      # 3) ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–å¾—ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜ï¼‰
      - name: MCP call - browser_take_screenshot
        run: |
          cmcp "npx @playwright/mcp@latest" tools/call \
            name=browser_take_screenshot \
            arguments:='{"filename":"page.png"}'

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: mcp-screenshots
          path: page.png
```

- `cmcp "npx @playwright/mcp@latest"` â€¦ **ã‚³ãƒãƒ³ãƒ‰æ–‡å­—åˆ—**ã¨ã—ã¦ MCP ã‚µãƒ¼ãƒï¼ˆSTDIOï¼‰ã‚’èµ·å‹• â†’ **åŒä¸€ãƒ—ãƒ­ã‚»ã‚¹ã®æ¨™æº–å…¥å‡ºåŠ›ã§ MCP é€šä¿¡** â†’ `tools/call` ã‚’ç›´å©ãã€‚  
- ã¾ãš `browser_install` ã‚’å©ãã®ã¯ã€**ãƒ–ãƒ©ã‚¦ã‚¶æœªå°å…¥ã‚¨ãƒ©ãƒ¼ã‚’é¿ã‘ã‚‹**ãŸã‚ï¼ˆREADMEã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹å…¬å¼ãƒ„ãƒ¼ãƒ«ï¼‰ã€‚ îˆ€citeîˆ‚turn1view0îˆ

---

# ä½¿ãˆã‚‹ä»£è¡¨ãƒ„ãƒ¼ãƒ«ï¼ˆæŠœç²‹ï¼‰
- `browser_navigate`ï¼ˆURL ã¸ç§»å‹•ï¼‰
- `browser_take_screenshot`ï¼ˆPNG/JPEGã«ä¿å­˜ã€`filename` æŒ‡å®šå¯ï¼‰
- `browser_type`, `browser_click`, `browser_hover`, `browser_console_messages`, `browser_network_requests` ç­‰  
  â†’ **ä¸€è¦§ã¯ `cmcp "npx @playwright/mcp@latest" tools/list`** ã§å–å¾—å¯èƒ½ã€‚ îˆ€citeîˆ‚turn1view0îˆ

---

# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/é‹ç”¨ã®æ³¨æ„
- **GitHub â†’ï¼ˆã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰ï¼‰npm** ã¸ã®åˆ°é”ï¼ˆ`registry.npmjs.org`ï¼‰ãŒå¿…è¦ã€‚Private Networking/ç¤¾å†…FWã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèªã€‚  
- **STDIO æ–¹å¼**ãªã®ã§**ã‚¤ãƒ³ãƒã‚¦ãƒ³ãƒ‰é–‹æ”¾ã¯ä¸è¦**ã€‚Actions ãƒ©ãƒ³ãƒŠãƒ¼å†…ã ã‘ã§å®Œçµï¼ˆMCP ã‚µãƒ¼ãƒã‚’å¤–éƒ¨å…¬é–‹ã™ã‚‹å¿…è¦ãªã—ï¼‰ã€‚ îˆ€citeîˆ‚turn1view0îˆ
- Ubuntu ãƒ©ãƒ³ãƒŠãƒ¼ã§**Playwright ã® OS ä¾å­˜**ãŒè¶³ã‚Šãªã„å ´åˆã¯ã€ä¸Šè¨˜ `--with-deps` ã§æº€ãŸã™ã®ãŒãƒ©ã‚¯ã€‚  
- **ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹**ã§å‹•ãã¾ã™ã€‚å‹•ç”»ã‚„ PDF ãŒæ¬²ã—ã‘ã‚Œã° `--caps=pdf` ç­‰ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚‚ README ã«è¨˜è¼‰ã‚ã‚Šï¼ˆ`npx @playwright/mcp@latest --caps=pdf` ã®ã‚ˆã†ã« args è¿½åŠ ï¼‰ã€‚ îˆ€citeîˆ‚turn1view0îˆ

---

# ä»£æ›¿ï¼šSSE/HTTP ã§å©ãå ´åˆ
- ã©ã†ã—ã¦ã‚‚**ã‚µãƒ¼ãƒå¸¸é§**ã•ã›ãŸã„ãªã‚‰ã€ã‚µãƒ³ãƒ—ãƒ«ã®ã‚ˆã†ã« **SSE/HTTP ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆ**ã§ Playwright MCP ã‚’ãƒ›ã‚¹ãƒˆã—ã€`cmcp http://host:port tools/call ...` ã§å‘¼ã³å‡ºã™ã€‚  
  ãŸã ã— **Actions å†…å®Œçµãªã‚‰ STDIO ãŒã‚·ãƒ³ãƒ—ãƒ« & å®‰å…¨**ã€‚ îˆ€citeîˆ‚turn1view0îˆ‚turn4view0îˆ

å¿…è¦ãªã‚‰ã€**`browser_click` ãªã©è¦ç´ å‚ç…§ï¼ˆ`ref`ï¼‰ã‚’è¦ã™ã‚‹æ“ä½œ**ã®å…·ä½“ä¾‹ï¼ˆ`browser_snapshot`â†’è©²å½“è¦ç´ æŠ½å‡ºâ†’`ref` æŒ‡å®šâ†’æ“ä½œï¼‰ã¾ã§ã‚µãƒ³ãƒ—ãƒ«åŒ–ã™ã‚‹ã‚ˆã€‚

â€”  
é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:39

### assistant â€” 2025-08-20T09:00:41.129118+00:00

_(empty)_

### assistant â€” 2025-08-20T09:00:56.731046+00:00

_(empty)_

### user â€” 2025-08-20T09:03:01.374077+00:00

Sse http ã§å‘¼ã³å‡ºã™
ã‚³ãƒãƒ³ãƒ‰ã¯ãƒªãƒã‚¸ãƒˆãƒªã«ã‚·ãƒŠãƒªã‚ªåˆ¥ã«ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã™ã‚‹å‰æ

### assistant â€” 2025-08-20T09:03:02.603559+00:00

{"search_query": [{"q": "Playwright MCP server @playwright/mcp README tools list browser_navigate SSE HTTP"}, {"q": "Model Context Protocol cmcp CLI tools/call documentation"}, {"q": "GitHub Actions Runner call MCP over HTTP SSE cmcp http mode"}, {"q": "Playwright MCP server command line options --caps pdf SSE server http port"}, {"q": "OpenAI Model Context Protocol cmcp GitHub"}], "response_length": "short"}

### system â€” 2025-08-20T09:03:03.026930+00:00

_(empty)_

### system â€” 2025-08-20T09:03:03.034271+00:00

_(empty)_

### assistant â€” 2025-08-20T09:03:03.364324+00:00

_(empty)_

### tool â€” 2025-08-20T09:03:07.550708+00:00

_(empty)_

### assistant â€” 2025-08-20T09:03:08.887718+00:00

{"open": [{"ref_id": "turn0search0"}], "response_length": "short"}

### tool â€” 2025-08-20T09:03:12.475165+00:00

_(empty)_

### assistant â€” 2025-08-20T09:03:12.659981+00:00

{"search_query": [{"q": "cmcp CLI MCP HTTP SSE client tools/call documentation"}, {"q": "pip cmcp model context protocol cli"}], "response_length": "short"}

### assistant â€” 2025-08-20T09:03:23.982849+00:00

_(empty)_

### tool â€” 2025-08-20T09:03:27.666168+00:00

_(empty)_

### assistant â€” 2025-08-20T09:03:28.668841+00:00

ã‚„ã‚ã€å¸ä»¤ã€‚**SSE/HTTP ã§ Playwright MCP Server ã‚’å¸¸é§ã•ã›ã€GitHub Actions ã‹ã‚‰â€œã‚·ãƒŠãƒªã‚ªãƒ•ã‚¡ã‚¤ãƒ«â€ã‚’é †æ¬¡å®Ÿè¡Œã™ã‚‹**æ§‹æˆã‚’ã€æœ€çŸ­ã§å‹•ãå½¢ã§ã¾ã¨ã‚ã¾ã™ã€‚

# å…¨ä½“åƒ
- **MCPã‚µãƒ¼ãƒ**ï¼š`@playwright/mcp` ã‚’ **SSE/HTTP** ã§å…¬é–‹ï¼ˆNode ã®å°ã•ãªãƒ©ãƒƒãƒ‘ãƒ¼ã§OKï¼‰ îˆ€citeîˆ‚turn1view0îˆ  
- **ã‚·ãƒŠãƒªã‚ª**ï¼š`mcp_scenarios/*.jsonl`ï¼ˆ1è¡Œ=1ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ï¼‰ã§ç®¡ç†  
- **å®Ÿè¡Œãƒ©ãƒ³ãƒŠãƒ¼**ï¼šè»½é‡Nodeã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ **SSEã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**ã¨ã—ã¦æ¥ç¶šâ†’é †ã« `tools/call` å®Ÿè¡Œï¼ˆMCPå…¬å¼SDKã®SSEã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ç”¨ï¼‰ îˆ€citeîˆ‚turn2search7îˆ‚turn2search4îˆ  
- **Actions**ï¼šã‚µãƒ¼ãƒèµ·å‹• â†’ ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œ â†’ æˆæœç‰©ï¼ˆã‚¹ã‚¯ã‚·ãƒ§ç­‰ï¼‰ã‚’ Artifact ã¸

---

# 1) MCPã‚µãƒ¼ãƒï¼ˆSSE/HTTPï¼‰ã‚’ç«‹ã¦ã‚‹

`server.mjs`ï¼ˆæœ€å°ãƒ©ãƒƒãƒ‘ãƒ¼ï¼‰ï¼š
```js
import http from 'node:http';
import { createConnection } from '@playwright/mcp';
import { SSEServerTransport } from '@modelcontextprotocol/sdk/server/sse.js';

const PORT = process.env.PORT || 3333;
const CAPS = (process.env.CAPS || '').split(',').filter(Boolean); // ä¾‹: "pdf,vision"

const server = http.createServer(async (req, res) => {
  if (req.url?.startsWith('/mcp')) {
    // Playwright MCP ã‚’ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ã§ç«‹ã¡ä¸Šã’ã€SSEãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ãƒˆã§å…¬é–‹
    const connection = await createConnection({
      browser: { launchOptions: { headless: true } },
      caps: CAPS,
    });
    const transport = new SSEServerTransport('/mcp', res);
    await connection.server.connect(transport); // READMEã®SSEä¾‹ã«æº–æ‹ 
    return;
  }
  res.statusCode = 404; res.end('Not Found');
});

server.listen(PORT, () =>
  console.log(`MCP (Playwright) SSE listening on http://0.0.0.0:${PORT}/mcp`)
);
```
- ä¸Šã¯ **å…¬å¼READMEã®SSEæ¥ç¶šä¾‹**ã¨åŒã˜æµã‚Œï¼ˆ`SSEServerTransport`ï¼‰ã§ã™ã€‚`--caps=pdf` ç­‰ã®æ©Ÿèƒ½ã‚‚ README ã«è¨˜è¼‰ã‚ã‚Šã€‚ îˆ€citeîˆ‚turn1view0îˆ  
- ä»£æ›¿ã¨ã—ã¦ã€**stdioã‚µãƒ¼ãƒã‚’SSE/WSåŒ–ã™ã‚‹ãƒ—ãƒ­ã‚­ã‚·**ï¼ˆsupergatewayï¼‰ã‚’ä½¿ã†æ‰‹ã‚‚ã‚ã‚Šã¾ã™ï¼ˆ`npx supergateway --cmd "npx @playwright/mcp@latest" --port 3333`ï¼‰ã€‚ îˆ€citeîˆ‚turn0search2îˆ

> è£œè¶³ï¼šMCPã® **SSE/Streamable HTTP ã®ä»•æ§˜**ã¯ãƒ—ãƒ­ãƒˆã‚³ãƒ«å…¬å¼ã«æ˜è¨˜ã€‚ îˆ€citeîˆ‚turn2search4îˆ

---

# 2) ã‚·ãƒŠãƒªã‚ªï¼ˆãƒªãƒã‚¸ãƒˆãƒªç®¡ç†ï¼‰

```
repo-root/
  mcp_scenarios/
    smoke.jsonl
    login.jsonl
    pdf_export.jsonl
```

`mcp_scenarios/smoke.jsonl`ï¼ˆ1è¡Œ=1ã‚³ãƒãƒ³ãƒ‰ï¼‰ï¼š
```json
{"tool":"browser_install","args":{}}
{"tool":"browser_navigate","args":{"url":"https://example.com"}}
{"tool":"browser_take_screenshot","args":{"filename":"page.png"}}
{"tool":"browser_pdf_save","args":{"filename":"page.pdf"}}
```
- åˆ©ç”¨å¯èƒ½ãƒ„ãƒ¼ãƒ«ã¯ README ã®ãƒ„ãƒ¼ãƒ«ä¸€è¦§ã§ç¢ºèªã§ãã¾ã™ï¼ˆ`browser_navigate`, `browser_click`, `browser_type`, `browser_snapshot`, `browser_take_screenshot`, `browser_pdf_save` ã»ã‹ï¼‰ã€‚ îˆ€citeîˆ‚turn1view0îˆ

---

# 3) ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆSSEã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰

`run-scenario.mjs`ï¼š
```js
import fs from 'node:fs';
import readline from 'node:readline';
import { SSEClientTransport } from '@modelcontextprotocol/sdk/client/sse.js';
import { connect } from '@modelcontextprotocol/sdk/client/index.js';

const endpoint = process.env.MCP_URL || 'http://127.0.0.1:3333/mcp';
const scenario = process.argv[2]; // jsonl ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹

if (!scenario) { console.error('usage: node run-scenario.mjs <jsonl>'); process.exit(1); }

const rl = readline.createInterface({ input: fs.createReadStream(scenario) });

const transport = new SSEClientTransport(endpoint);
const client = await connect(transport); // tools.list / tools.call ãŒä½¿ãˆã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«æ¥ç¶š

for await (const line of rl) {
  const { tool, args } = JSON.parse(line);
  console.log(`[MCP] calling ${tool} ${JSON.stringify(args||{})}`);
  const result = await client.tools.call({ name: tool, arguments: args || {} });
  // å¿…è¦ãªã‚‰ result ã‚’ãƒ­ã‚°/ãƒ•ã‚¡ã‚¤ãƒ«åŒ–
  if (result?.error) {
    console.error(`âœ– ${tool} failed:`, result.error);
    process.exitCode = 1;
    break;
  }
}

await client.close();
```
- **å…¬å¼ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ**ã«ã‚‚ã€SSEã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®çµ„ã¿æ–¹ãŒã‚ã‚Šã¾ã™ã€‚ä¸Šã¯ãã®è¶£æ—¨ã«æ²¿ã£ãŸæœ€å°å®Ÿè£…ã€‚ îˆ€citeîˆ‚turn2search7îˆ

---

# 4) GitHub Actionsï¼ˆSSEã‚µãƒ¼ãƒèµ·å‹• â†’ ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œï¼‰

`.github/workflows/mcp-playwright.yml`ï¼š
```yaml
name: mcp-playwright-scenarios
on:
  workflow_dispatch:
  push: { branches: [ main ] }

jobs:
  run:
    runs-on: ubuntu-latest  # Private Networking or self-hosted ã«åˆ‡æ›¿OK
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with: { node-version: '20' }

      - name: Install deps
        run: |
          npm -y init >/dev/null
          npm i @playwright/mcp @modelcontextprotocol/sdk playwright

      - name: Start MCP server (SSE)
        run: |
          node server.mjs &
          echo $! > mcp.pid
          sleep 3
        env:
          CAPS: pdf  # ä¾‹: PDFå¯¾å¿œã‚’æœ‰åŠ¹åŒ–

      - name: Run scenario (smoke)
        run: node run-scenario.mjs mcp_scenarios/smoke.jsonl
        env:
          MCP_URL: http://127.0.0.1:3333/mcp

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: mcp-output
          path: |
            page.png
            page.pdf

      - name: Stop MCP
        if: always()
        run: kill $(cat mcp.pid) || true
```

---

# é‹ç”¨Tips
- **ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹**ã§å‹•ãã¾ã™ã€‚`CAPS=pdf` ã‚„ `CAPS=vision` ãªã©ã®æ©Ÿèƒ½ãƒ•ãƒ©ã‚°ã¯ README ã® `--caps` ç›¸å½“ã€‚ îˆ€citeîˆ‚turn1view0îˆ
- **ç¤¾å†…NW**ï¼šGitHub Actions ãƒ©ãƒ³ãƒŠãƒ¼ã‹ã‚‰ **SSEã‚µãƒ¼ãƒã®URLã¸ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰**åˆ°é”ã§ãã‚Œã°OKï¼ˆPrivate Networking / ExpressRoute çµŒç”±ãªã©æ§‹æˆã¯è‡ªç”±ï¼‰ã€‚  
- **ä»£æ›¿ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ**ï¼šæ—¢å­˜CLIã§ **SSE/HTTPã‚µãƒ¼ãƒã«å¯¾ã—ã¦ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ**ã§ãã‚‹ã‚‚ã®ã‚‚ã‚ã‚Šã¾ã™ï¼ˆä¾‹ï¼šæœ€å°CLI/å„ç¨®MCP-CLIï¼‰ã€‚ãŸã ã—ãƒãƒ¼ã‚¸ãƒ§ãƒ³å·®ç•°ãŒã‚ã‚‹ãŸã‚ã€**SDKç›´ä½¿ç”¨**ãŒä¸€ç•ªå®‰å®šã€‚ îˆ€citeîˆ‚turn2search5îˆ‚turn2search15îˆ
- **ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹æ±šæŸ“å¯¾ç­–**ï¼šPlaywrightã¯éƒ½åº¦ã‚¯ãƒªãƒ¼ãƒ³ã«ã—ãŸã„å ´åˆã€ã‚·ãƒŠãƒªã‚ªå‰å¾Œã§ `browser_close` å®Ÿè¡Œã‚„ `user-data-dir` åˆ†é›¢ã‚’æ¤œè¨ã€‚ãƒ„ãƒ¼ãƒ«ä¸€è¦§ã« `browser_close` ã‚ã‚Šã€‚ îˆ€citeîˆ‚turn1view0îˆ

---

å¿…è¦ãªã‚‰ã€**ã‚·ãƒŠãƒªã‚ªJSONLã®ã‚¹ã‚­ãƒ¼ãƒ**ï¼ˆãƒªãƒˆãƒ©ã‚¤ã€å¾…æ©Ÿã€è¦ç´ `ref`ã®å–å¾—â†’æ“ä½œãªã©ï¼‰ã‚’æ‹¡å¼µã—ã€`browser_snapshot` â†’ `ref` æŠ½å‡º â†’ `browser_click` ã®**é«˜ä¿¡é ¼ãƒ‘ã‚¿ãƒ¼ãƒ³**ã¾ã§ãƒ†ãƒ³ãƒ—ãƒ¬åŒ–ã—ã¾ã™ã€‚

â€”  
é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:12

### assistant â€” 2025-08-20T09:03:38.571036+00:00

_(empty)_

### assistant â€” 2025-08-20T09:04:01.007412+00:00

_(empty)_

### user â€” 2025-08-20T09:06:40.251936+00:00

Github enterprise cloud ã¯mcp æ¥ç¶šè¨­å®šãŒã‚ã‚‹ï¼Ÿ

### system â€” 2025-08-20T09:06:41.672702+00:00

_(empty)_

### assistant â€” 2025-08-20T09:06:42.132715+00:00

å¸ä»¤ã€ã“ã“ã¯èª¤è§£ã—ã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚  

çµè«–ã‹ã‚‰ã„ã†ã¨ï¼š  
**GitHub Enterprise Cloud (GHEC) ã«ã¯ã€MCP (Model Context Protocol) ã‚µãƒ¼ãƒã‚„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç›´æ¥ã€Œç™»éŒ²ã€ã—ãŸã‚Šã€Œæ¥ç¶šè¨­å®šã€ã™ã‚‹æ©Ÿèƒ½ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**  

---

## ç†ç”±
- **GHEC ã®æ¨™æº–æ©Ÿèƒ½**  
  - ãƒªãƒã‚¸ãƒˆãƒªï¼Actionsï¼Codespacesï¼Copilot ã®çµ±åˆã¯ã‚ã‚Šã¾ã™ã€‚  
  - æ¥ç¶šè¨­å®šã¨ã—ã¦ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€**GitHub Actions ã®ãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆï¼ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ Private Networkingï¼‰** ã‚„ **OIDCé€£æºï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰èªè¨¼ãƒ»ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ¬ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ï¼‰** ã§ã™ã€‚  
  - å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ã‚‚ã€ŒMCPã€ã¨ã„ã†ä»•çµ„ã¿è‡ªä½“ã¯ç™»å ´ã—ã¾ã›ã‚“ã€‚  
- **MCP ã¯åˆ¥ãƒ¬ã‚¤ãƒ¤ãƒ¼**  
  - Model Context Protocol ã¯ã€OpenAI ã‚„ Claude ãŒå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ãƒ»ãƒ‡ãƒ¼ã‚¿ã«æ¥ç¶šã™ã‚‹ãŸã‚ã®æ¨™æº–ä»•æ§˜ã§ã€**GitHub Actions ã¨ã¯ç„¡é–¢ä¿‚**ã€‚  
  - ã‚‚ã— GHEC ä¸Šã§ MCP ã‚’ä½¿ã„ãŸã„å ´åˆã¯ã€ŒActions ã®ã‚¸ãƒ§ãƒ–å†…ã§ MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å‹•ã‹ã™ã€ã‹ã€Œå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSSE/HTTPå…¬é–‹ã•ã‚ŒãŸ MCP ã‚µãƒ¼ãƒï¼‰ã«ã‚¸ãƒ§ãƒ–ã‹ã‚‰æ¥ç¶šã™ã‚‹ã€ã¨ã„ã†è¨­è¨ˆã«ãªã‚Šã¾ã™ã€‚  

---

## å®Ÿå‹™çš„ãªæ„å‘³
- GHEC å´ã«ã¯ **MCPæ¥ç¶šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„å°‚ç”¨ç”»é¢ã¯ãªã„**ã€‚  
- å¸ä»¤ãŒã‚„ã‚ã†ã¨ã—ã¦ã„ã‚‹ã®ã¯ã€ŒActions â†’ MCPã‚µãƒ¼ãƒã¸ã‚³ãƒãƒ³ãƒ‰æŠ•ã’ã‚‹ã€ãªã®ã§ã€  
  - Actions ãƒ©ãƒ³ãƒŠãƒ¼ä¸Šã« **MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆcmcp ã‚„ SDKã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼‰ã‚’å°å…¥ã™ã‚‹**  
  - ã¾ãŸã¯ **MCPã‚µãƒ¼ãƒã‚’HTTPã§å¸¸é§ã•ã›ã¦ãŠãã€ãƒ©ãƒ³ãƒŠãƒ¼ã‹ã‚‰HTTP(S)ã§å©ã**  
  ã“ã®ã©ã¡ã‚‰ã‹ã®æ–¹å¼ã§å®Ÿè£…ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚  

---

ğŸ‘‰ ãªã®ã§ã€ŒGHEC ã§ã®è¨­å®šã€ã§ã¯ãªãã€**ãƒªãƒã‚¸ãƒˆãƒªã«ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ MCPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç½®ã„ã¦ Actions å†…ã§èµ°ã‚‰ã›ã‚‹**ã®ãŒå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆã§ã™ã€‚  

---

é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:21

### user â€” 2025-08-20T09:07:47.138590+00:00

Ok

### assistant â€” 2025-08-20T09:07:47.546144+00:00

äº†è§£ã€å¸ä»¤ ğŸ‘  
æ¬¡ã¯å®Ÿéš›ã« **ã€ŒMCPã‚·ãƒŠãƒªã‚ªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã†æ•´ç†ã™ã‚‹ã‹ã€** ã¨ã‹ **ã€ŒActionså†…ã§ã‚·ãƒŠãƒªã‚ªã”ã¨ã«å®Ÿè¡Œåˆ‡æ›¿ã™ã‚‹ä»•çµ„ã¿ã€** ã‚ãŸã‚Šã‚’è©°ã‚ã¦ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ã€‚  

å¿…è¦ãªã‚‰ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆåŒ–ã—ãŸãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹ï¼ˆä¾‹ï¼š`matrix` ã§ `smoke.jsonl` / `login.jsonl` ã‚’ä¸¦åˆ—å®Ÿè¡Œï¼‰ã‚‚æç¤ºã§ãã¾ã™ã‚ˆã€‚  

â€”  
é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:25

### user â€” 2025-08-20T09:08:52.722629+00:00

Playwright mcpserver ã¯åˆ¥vmã§å¸¸æ™‚èµ·å‹•

### assistant â€” 2025-08-20T09:08:54.861488+00:00

ã‚„ã‚ã€å¸ä»¤ã€‚äº†è§£ã€‚**Playwright MCP Server ã‚’åˆ¥VMã§å¸¸æ™‚èµ·å‹•**ã™ã‚‹å‰æã§ã€å®Ÿé‹ç”¨ã«è€ãˆã‚‹è¨­è¨ˆãƒ»æ‰‹é †ã‚’ä¸€æ°—ã«å›ºã‚ã¾ã™ã€‚

# å…¨ä½“åƒï¼ˆåˆ¥VMå¸¸é§ï¼‰
- **VMï¼ˆç¤¾å†…/ã‚¯ãƒ©ã‚¦ãƒ‰ï¼‰**ã« Playwright MCP Serverï¼ˆSSE/HTTPï¼‰ã‚’**å¸¸é§**ã€‚
- **GitHub Actions ãƒ©ãƒ³ãƒŠãƒ¼**ï¼ˆç¤¾å†… or Private Networkingï¼‰â†’ **ExpressRoute/é–‰åŸŸ** â†’ **MCPã‚µãƒ¼ãƒ**ã¸**ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰æ¥ç¶š**ã—ã¦ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œã€‚
- **èªè¨¼**ã¯ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆãƒ˜ãƒƒãƒ€ï¼‰ or mTLSã€**FW/NSG**ã¯ãƒ©ãƒ³ãƒŠãƒ¼ã®é€ä¿¡å…ƒã‚µãƒ–ãƒãƒƒãƒˆã ã‘è¨±å¯ã€‚

# 1) MCPã‚µãƒ¼ãƒï¼ˆSSE/HTTPï¼‰ã‚’å¸¸é§åŒ–ï¼šNode + systemd
VMä¸Šã§ï¼ˆUbuntuæƒ³å®šï¼‰:

```bash
# 1) ãƒ¦ãƒ¼ã‚¶ä½œæˆã¨ä¾å­˜
sudo useradd -r -s /usr/sbin/nologin mcp
sudo mkdir -p /opt/mcp && sudo chown mcp:mcp /opt/mcp
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs
sudo npx playwright install --with-deps chromium  # OSä¾å­˜ã‚‚ã¾ã¨ã‚ã¦

# 2) ã‚µãƒ¼ãƒé…ç½®
sudo -u mcp bash -lc '
  cd /opt/mcp
  npm init -y >/dev/null
  npm i @playwright/mcp @modelcontextprotocol/sdk
  cat > server.mjs << "EOF"
import http from "node:http";
import { createConnection } from "@playwright/mcp";
import { SSEServerTransport } from "@modelcontextprotocol/sdk/server/sse.js";

const PORT = process.env.PORT || 3333;
const TOKEN = process.env.MCP_TOKEN || ""; // ç°¡æ˜“ãƒˆãƒ¼ã‚¯ãƒ³ (ãƒ˜ãƒƒãƒ€æ¤œè¨¼)
const server = http.createServer(async (req, res) => {
  if (req.url?.startsWith("/health")) { res.writeHead(200); res.end("ok"); return; }
  if (req.url?.startsWith("/mcp")) {
    if (TOKEN && req.headers["x-mcp-token"] !== TOKEN) { res.writeHead(401); res.end("unauthorized"); return; }
    const conn = await createConnection({ browser: { launchOptions: { headless: true } } });
    const transport = new SSEServerTransport("/mcp", res);
    await conn.server.connect(transport);
    return;
  }
  res.statusCode = 404; res.end("Not Found");
});
server.listen(PORT, () => console.log(`MCP SSE on :${PORT}`));
EOF
'

# 3) systemd
sudo tee /etc/systemd/system/mcp.service >/dev/null << 'UNIT'
[Unit]
Description=Playwright MCP Server (SSE/HTTP)
After=network.target

[Service]
User=mcp
Group=mcp
WorkingDirectory=/opt/mcp
Environment=PORT=3333
# ã“ã“ã«å¼·ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚»ãƒƒãƒˆï¼ˆActionså´ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã¨ä¸€è‡´ã•ã›ã‚‹ï¼‰
Environment=MCP_TOKEN=change-me-long-random
ExecStart=/usr/bin/node server.mjs
Restart=always
RestartSec=3
LimitNOFILE=65535

[Install]
WantedBy=multi-user.target
UNIT

sudo systemctl daemon-reload
sudo systemctl enable --now mcp
```

> è¿½åŠ ï¼ˆä»»æ„ï¼‰ï¼šNginx/ALB ã®**TLSçµ‚ç«¯**ã€**mTLS**ã€**åŸºæœ¬èªè¨¼**ã€**é€ä¿¡å…ƒåˆ¶é™**ã‚’å‰æ®µã«ã€‚é–‰åŸŸã®ã¿ãªã‚‰FW/NSGã§**ãƒ©ãƒ³ãƒŠãƒ¼ã®ã‚µãƒ–ãƒãƒƒãƒˆ**ä»¥å¤–ã‚’é®æ–­ã€‚

# 2) ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ & ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¦ç‚¹
- **åˆ°é”æ–¹å‘**ï¼šActions ãƒ©ãƒ³ãƒŠãƒ¼ â†’ MCPã‚µãƒ¼ãƒï¼ˆ**ã‚¢ã‚¦ãƒˆãƒã‚¦ãƒ³ãƒ‰**ï¼‰ã€‚ã‚µãƒ¼ãƒå´ã¯**å—ä¿¡443/3333**ã®ã¿é–‹ã‘ã‚‹ï¼ˆé–‰åŸŸæ¨å¥¨ï¼‰ã€‚
- **èªè¨¼**ï¼š  
  - æœ€å°ï¼š`X-MCP-Token` ãƒ˜ãƒƒãƒ€ï¼ˆä¸Šè¨˜ã‚µãƒ³ãƒ—ãƒ«ï¼‰ã€‚  
  - æ¨å¥¨ï¼š**mTLS**ã¾ãŸã¯**ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆLB + ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—**ã§**é€ä¿¡å…ƒã‚µãƒ–ãƒãƒƒãƒˆå›ºå®š**ã€‚
- **å¯è¦³æ¸¬æ€§**ï¼š`/health` ã‚’ç›£è¦–ã€`journalctl -u mcp` ã§ãƒ­ã‚°å–å¾—ã€‚å¿…è¦ãªã‚‰ `stdout` ã‚’ syslog / Loki / CloudWatch ç­‰ã«é›†ç´„ã€‚
- **ã‚¹ã‚±ãƒ¼ãƒ«**ï¼š1æ¥ç¶š=1ãƒ–ãƒ©ã‚¦ã‚¶ã€‚é«˜ä¸¦åˆ—ã¯**PM2 ã‚¯ãƒ©ã‚¹ã‚¿**ã‚„**è¤‡æ•°VMã®èƒŒå¾Œã«LB**ã€‚ã‚¸ãƒ§ãƒ–ã”ã¨ã«ç‹¬ç«‹æ¥ç¶šã‚’å¼µã‚‹è¨­è¨ˆãŒå®‰å…¨ã€‚

# 3) ãƒªãƒã‚¸ãƒˆãƒªå´ï¼šã‚·ãƒŠãƒªã‚ªã‚’ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ï¼ˆjsonlï¼‰
```
repo/
  mcp_scenarios/
    smoke.jsonl
    login.jsonl
```

`mcp_scenarios/smoke.jsonl` ä¾‹ï¼š
```json
{"tool":"browser_install","args":{}}
{"tool":"browser_navigate","args":{"url":"https://example.com"}}
{"tool":"browser_take_screenshot","args":{"filename":"/var/mcp/artifacts/page.png"}}
```

> **æˆæœç‰©ã®æ‰±ã„**  
> - ã‚µãƒ¼ãƒå´ã§ `/var/mcp/artifacts` ã‚’ **å…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆSMB/NFS/Azure Filesï¼‰**ã«ã—ã¦ãŠãã¨ã€å¾Œæ®µã§å›åã—ã‚„ã™ã„ã€‚  
> - ã‚‚ã—ãã¯ãƒ„ãƒ¼ãƒ«çµæœã®**base64è¿”å´**ã«å¯„ã›ã‚‹ï¼ˆå¿…è¦ãªã‚‰ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ ï¼‰ã€‚

# 4) Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆSSEã«æ¥ç¶šã—ã¦ã‚·ãƒŠãƒªã‚ªå®Ÿè¡Œï¼‰
SDKã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§SSEæ¥ç¶šâ†’è¡Œã”ã¨ã« `tools/call`ã€‚  
`run-scenario.mjs`ï¼ˆãƒªãƒã‚¸ãƒˆãƒªã«ç½®ãï¼‰ï¼š

```js
import fs from "node:fs";
import readline from "node:readline";
import { SSEClientTransport } from "@modelcontextprotocol/sdk/client/sse.js";
import { connect } from "@modelcontextprotocol/sdk/client/index.js";

const endpoint = process.env.MCP_URL;               // ä¾‹: https://mcp.internal/mcp
const token = process.env.MCP_TOKEN || "";

if (!endpoint) { console.error("MCP_URL required"); process.exit(2); }
const scenario = process.argv[2];
if (!scenario) { console.error("usage: node run-scenario.mjs <jsonl>"); process.exit(2); }

const rl = readline.createInterface({ input: fs.createReadStream(scenario) });

const transport = new SSEClientTransport(endpoint, {
  headers: token ? { "x-mcp-token": token } : {},
});
const client = await connect(transport);

for await (const line of rl) {
  if (!line.trim()) continue;
  const { tool, args } = JSON.parse(line);
  console.log(`[MCP] ${tool}`, args || {});
  const out = await client.tools.call({ name: tool, arguments: args || {} });
  if (out?.error) { console.error(out.error); process.exit(1); }
}
await client.close();
```

`.github/workflows/mcp.yml`ï¼š
```yaml
name: run-mcp-scenarios
on:
  workflow_dispatch:
    inputs:
      scenario:
        description: "Scenario file under mcp_scenarios/"
        required: true
        default: "smoke.jsonl"

jobs:
  mcp:
    runs-on: ubuntu-latest   # or self-hosted
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with: { node-version: '20' }

      - name: Install SDK client
        run: |
          npm -y init >/dev/null
          npm i @modelcontextprotocol/sdk

      - name: Run scenario over SSE
        env:
          MCP_URL: ${{ secrets.MCP_URL }}      # ä¾‹: https://mcp.internal/mcp
          MCP_TOKEN: ${{ secrets.MCP_TOKEN }}  # server.mjså´ã¨ä¸€è‡´
        run: |
          node run-scenario.mjs mcp_scenarios/${{ github.event.inputs.scenario }}

      # å…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«æˆæœç‰©ã‚’ç½®ã„ãŸå ´åˆã€SSH/SMB/HTTPã§å›åã™ã‚‹
      # ä¾‹: å†…éƒ¨HTTPå…¬é–‹ãªã‚‰
      # - name: Collect artifacts
      #   run: curl -fLo page.png https://mcp.internal/artifacts/page.png

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: mcp-artifacts
          path: page.png
        if: success() || failure()
```

# 5) å®Ÿé‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**ï¼šãƒ©ãƒ³ãƒŠãƒ¼ â†’ MCPã‚µãƒ¼ãƒURLï¼ˆSSE/HTTPï¼‰ãŒ**é–‰åŸŸã§åˆ°é”**ã€‚DNS/åå‰è§£æ±ºOKã€‚
- **FW/NSG**ï¼š**é€ä¿¡å…ƒã‚µãƒ–ãƒãƒƒãƒˆã ã‘è¨±å¯**ã€å¤–éƒ¨ã‹ã‚‰é®æ–­ã€‚  
- **èªè¨¼**ï¼š`X-MCP-Token`ï¼ˆæœ€ä½é™ï¼‰â†’ mTLS ã¸æ®µéšçš„ã«å¼·åŒ–ã€‚  
- **ç›£è¦–**ï¼š`/health` ã«å¯¾ã™ã‚‹HTTPãƒã‚§ãƒƒã‚¯ã€`systemd`ã®`Restart=always`ã€ãƒ­ã‚°é›†ç´„ã€‚  
- **ä¸¦åˆ—**ï¼šã‚¸ãƒ§ãƒ–ä¸¦åˆ—æ™‚ã¯VMå°æ•°/PM2ã‚¯ãƒ©ã‚¹ã‚¿ã§**æ°´å¹³ã‚¹ã‚±ãƒ¼ãƒ«**ã€‚  
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**ï¼š`/opt/mcp` ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åŒ–ï¼ˆã‚¿ã‚°å›ºå®šãƒ»ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯ï¼‰ã€‚  
- **Playwrightä¾å­˜**ï¼šå®šæœŸçš„ã« `playwright install --with-deps` æ›´æ–°ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£Fixè¿½å¾“ï¼‰ã€‚

å¿…è¦ãªã‚‰ã€**mTLSã¨Nginxã®å…·ä½“è¨­å®šã€PM2ã‚¯ãƒ©ã‚¹ã‚¿åŒ–ã€å…±æœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸è¨­è¨ˆï¼ˆAzure Files/SMB/NFSï¼‰**ã¾ã§è©°ã‚ã¦ã‚µãƒ³ãƒ—ãƒ«å‡ºã›ã¾ã™ã€‚ã©ã“ã‹ã‚‰å›ºã‚ã‚‹ï¼Ÿ  

â€”  
é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:40

### system â€” 2025-08-20T09:08:55.310314+00:00

_(empty)_

### system â€” 2025-08-20T09:08:55.318987+00:00

_(empty)_

### assistant â€” 2025-08-20T09:08:55.717088+00:00

_(empty)_

### assistant â€” 2025-08-20T09:09:26.395543+00:00

_(empty)_

### user â€” 2025-08-21T05:26:26.057614+00:00

Github actionsãŒä½¿ã†ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®è¨­å®šã¯ã©ã“ã‚’ã¿ã‚Œã°ã„ã„?

### system â€” 2025-08-21T05:26:26.246222+00:00

_(empty)_

### assistant â€” 2025-08-21T05:26:26.279509+00:00

å¸ä»¤ã€ã„ã„è³ªå•ã§ã™ã€‚ã€ŒGitHub Actions ãŒä½¿ã†ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆãƒ©ãƒ³ãƒŠãƒ¼ï¼‰ã®è¨­å®šã‚’ã©ã“ã§ç¢ºèªã§ãã‚‹ã‹ï¼Ÿã€ã‚’æ•´ç†ã—ã¾ã™ã­ã€‚  

---

# 1. GitHub ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã®å ´åˆï¼ˆ`runs-on: ubuntu-latest` ãªã©ï¼‰
- **ç¢ºèªå ´æ‰€**  
  - GitHub Enterprise Cloud ç®¡ç†ç”»é¢  
    - **Enterprise â†’ Settings â†’ Actions â†’ Hosted runners**  
    - **Organization â†’ Settings â†’ Actions â†’ Hosted runners**  
    - **Repository â†’ Settings â†’ Actions â†’ Hosted runners**  
  - ã“ã“ã§ã€Œåˆ©ç”¨å¯èƒ½ãªãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ï¼ˆubuntu-latest, windows-latest, macos-latest ãªã©ï¼‰ã€ã¨ã€ã‚‚ã— **Private Networking æœ‰åŠ¹åŒ–**ã—ã¦ã„ã‚‹å ´åˆã¯ã©ã® VNet ã¨æ¥ç¶šã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚  
- **ãƒã‚¤ãƒ³ãƒˆ**  
  - ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯ GitHub ãŒç®¡ç†ã—ã¦ã„ã‚‹ã®ã§ OS/ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¸­èº«è‡ªä½“ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç›´æ¥è§¦ã‚Œã¾ã›ã‚“ã€‚  
  - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚„ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‚½ãƒ•ãƒˆã¯å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€Œ[GitHub-hosted runners ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ä¸€è¦§](https://docs.github.com/ja/actions/using-github-hosted-runners/about-github-hosted-runners)ã€ã§ç¢ºèªã—ã¾ã™ã€‚  

---

# 2. ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã®å ´åˆ
- **ç¢ºèªå ´æ‰€**  
  - **Organization Settings â†’ Actions â†’ Runners â†’ Self-hosted runners**  
  - ã¾ãŸã¯ **Repository Settings â†’ Actions â†’ Runners â†’ Self-hosted runners**  
  - ã“ã“ã§ï¼š
    - ç™»éŒ²ã•ã‚ŒãŸãƒ©ãƒ³ãƒŠãƒ¼ã® **åå‰**  
    - **ãƒ©ãƒ™ãƒ«**ï¼ˆ`self-hosted`, `linux`, `x64` ãªã©ï¼‰  
    - **çŠ¶æ…‹**ï¼ˆOnline/Offline/Busyï¼‰  
    - **ç™»éŒ²æ–¹æ³•ï¼ˆã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå±¥æ­´ï¼‰**  
  - ã‚’ç¢ºèªã§ãã¾ã™ã€‚  
- **VMå†…ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®š**  
  - ãƒ©ãƒ³ãƒŠãƒ¼ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆä¾‹ï¼š`actions-runner/config.sh` å®Ÿè¡Œã—ãŸå ´æ‰€ï¼‰ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚  
    - **Windows**: `config.cmd`  
    - **Linux**: `config.sh` / `svc.sh`  
  - å†…å®¹ã«ã¯ã€æ¥ç¶šå…ˆURLï¼ˆ`https://github.com/org/repo`ï¼‰ã‚„ãƒ©ãƒ³ãƒŠãƒ¼IDãªã©ãŒä¿å­˜ã•ã‚Œã¦ã„ã¾ã™ã€‚  

---

# 3. Actions Runner Controller (ARC) / Kubernetes ã®å ´åˆ
- **ç¢ºèªå ´æ‰€**  
  - GitHub ã® **Organization/Enterprise â†’ Actions â†’ Runners** ã«ã€Œã‚¹ã‚±ãƒ¼ãƒ«ã‚»ãƒƒãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã€ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚  
  - Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿å´ã§ã¯ `kubectl get pods -n actions-runner-system` ãªã©ã§ã€ã©ã® Pod ãŒãƒ©ãƒ³ãƒŠãƒ¼ã¨ã—ã¦å‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèªã§ãã¾ã™ã€‚  
  - è¨­å®šå€¤ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã€ãƒ©ãƒ™ãƒ«ã€ã‚¹ã‚±ãƒ¼ãƒ«æ¡ä»¶ï¼‰ã¯ Helm ã® values.yaml ã‚„ RunnerScaleSet CRD ã«è¨˜éŒ²ã€‚  

---

# ã¾ã¨ã‚
- **GitHub ç®¡ç†ï¼ˆãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ï¼‰** â†’ GitHub ç®¡ç†ç”»é¢ã® **Hosted runners** ãƒšãƒ¼ã‚¸ + å…¬é–‹ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒªã‚¹ãƒˆã§ç¢ºèªã€‚  
- **ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼** â†’ GitHub ç®¡ç†ç”»é¢ã® **Self-hosted runners** ãƒšãƒ¼ã‚¸ + VMå†…ã® `config.sh`/`config.cmd`ã€‚  
- **ARC/K8s** â†’ GitHub ç®¡ç†ç”»é¢ã« RunnerScaleSet ã¨ã—ã¦è¡¨ç¤º + Kubernetes ã® CRD/Pod è¨­å®šã€‚  

---

ğŸ‘‰ å¸ä»¤ã¯ä»Šã®æ§‹æˆã ã¨ã€**Enterprise Cloud + Private Networking ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼**ã‚’è»¸ã«ã—ã¦ã¾ã™ã‹ï¼Ÿ  
ãã‚Œã¨ã‚‚ **ç¤¾å†…ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆ**ï¼ˆã‚‚ã—ãã¯ ARCï¼‰ã‚’ä¸¦è¡Œã—ã¦ä½¿ã†æƒ³å®šã§ã™ã‹ï¼Ÿ  

â€”  
é€ä¿¡æ—¥æ™‚ï¼ˆJSTï¼‰ï¼š[[REDACTED_PHONE]]:07
