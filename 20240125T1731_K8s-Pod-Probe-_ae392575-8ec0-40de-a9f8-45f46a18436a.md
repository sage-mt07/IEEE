---
conversation_id: "ae392575-8ec0-40de-a9f8-45f46a18436a"
title: "K8s Pod Probe ポート制約"
create_time: 1706203869.19494
update_time: 1706203910.617088
language_guess: "en"
num_messages: 4
part_index: 1
part_count: 1
---

### system — 2024-01-25T17:31:09.194940+00:00

_(empty)_

### user — 2024-01-25T17:31:09.196152+00:00

k8sのpodでprobeを使用する際に使えないポート番号はあるのか

### assistant — 2024-01-25T17:31:49.514670+00:00

KubernetesのPodでliveness probe、readiness probe、またはstartup probeを設定する際、特定のポート番号が使えないという制約は基本的にありません。これらのprobeはPod内のコンテナが正常に動作しているかどうかを確認するために用いられ、HTTP、TCP、またはカスタムコマンドを介して実行されます。

ただし、いくつかの注意点があります：

1. **予約済みポート**: 一部のポート番号は特定の用途に予約されており、一般的には使用を避けるべきです。たとえば、ポート番号80はHTTP、443はHTTPS、そして22はSSH用です。また、0〜1023までのポートはウェルノウンポートとして予約されており、特権を持つサービスのみがこれらを使用できます。

2. **セキュリティポリシー**: クラスタのセキュリティポリシーによっては、特定のポートの使用が制限される場合があります。例えば、ネットワークポリシーを使って特定のポートへのアクセスを許可または拒否することができます。

3. **コンテナとの競合**: Pod内の他のコンテナが使用しているポートと競合しないようにする必要があります。Pod内のコンテナ間でポートを共有することはできませんので、それぞれのコンテナで異なるポートを使用する必要があります。

Probe設定時にポート番号を指定するには、probeの設定内で`httpGet`や`tcpSocket`のオプションを使用し、その中で`port`を指定します。ポート番号はコンテナがリッスンしているポートと一致している必要があります。

例えば、liveness probeのHTTP GETリクエストをポート8080で設定する場合は、以下のようになります：

```yaml
livenessProbe:
  httpGet:
    path: /healthz
    port: 8080
```

特定のポートが使用できないかどうかは、クラスタのセキュリティポリシー、ネットワーク設定、および既存のコンテナの設定に依存するため、これらの環境に依存する点を考慮することが重要です。
