---
conversation_id: "0c837e66-8f20-4359-a3a5-80126feb6072"
title: "EF Core クエリ最適化"
create_time: 1701129799.654101
update_time: 1701129812.296324
language_guess: "en"
num_messages: 4
part_index: 1
part_count: 1
---

### system — 2023-11-28T00:03:19.654101+00:00

_(empty)_

### user — 2023-11-28T00:03:19.654565+00:00

entityframeworkcoreの最初のクエリ速度が遅い場合の対処方法

### assistant — 2023-11-28T00:03:31.278506+00:00

Entity Framework Coreの最初のクエリが遅い場合、以下のいくつかの対処方法が考えられます。

1. **Eager Loadingの使用**: 関連するデータを一度のクエリで一緒に取得することで、遅延読み込みによる遅さを回避できます。`Include`メソッドを使用して、関連エンティティを事前に読み込むことができます。

    ```csharp
    var result = dbContext.ParentEntities
                          .Include(p => p.ChildEntities)
                          .FirstOrDefault();
    ```

2. **Explicit Loadingの使用**: データが必要な時点で明示的に読み込むこともできます。これは `Load` メソッドを使用して行います。

    ```csharp
    var parent = dbContext.ParentEntities.FirstOrDefault();
    dbContext.Entry(parent).Collection(p => p.ChildEntities).Load();
    ```

3. **自動トラッキングを無効化**: 自動トラッキングを無効にすることで、Entity Frameworkがオブジェクトの変更をトラッキングするのを防ぎます。これにより、最初のクエリが高速になることがあります。

    ```csharp
    var options = new DbContextOptionsBuilder<YourDbContext>()
                  .UseLazyLoadingProxies(false) // 自動トラッキングを無効にする
                  .Options;

    using (var dbContext = new YourDbContext(options))
    {
        var result = dbContext.ParentEntities.FirstOrDefault();
    }
    ```

4. **クエリの最適化**: LINQクエリが最適でない場合、遅いクエリが生成される可能性があります。クエリを最適化し、遅延読み込みを避けるために、`AsNoTracking` メソッドを使用してトラッキングを無効にすることも検討してください。

    ```csharp
    var result = dbContext.ParentEntities.AsNoTracking().FirstOrDefault();
    ```

これらのアプローチを試してみてください。ただし、データベースのスキーマや実際のデータによっては、最適な方法が異なる場合があります。プロファイリングツールを使用してクエリの実行計画を確認し、ボトルネックがどこにあるかを特定することも役立ちます。
