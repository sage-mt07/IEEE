---
conversation_id: "67164745-c864-8007-a587-fc904fc4b6d1"
title: "Azure Load Testing メトリック"
create_time: 1729513286.09909
update_time: 1729546831.478534
language_guess: "en"
num_messages: 28
part_index: 1
part_count: 1
---

### system — 2024-10-21T12:21:26.099090+00:00

_(empty)_

### user — 2024-10-21T12:21:26.110027+00:00

Azure load testing の要求数画面はjmeterのどのメトリックを利用する

### assistant — 2024-10-21T12:21:35.295660+00:00

_(empty)_

### assistant — 2024-10-21T12:21:35.295836+00:00

Azure Load Testing の要求数（リクエスト数）を確認するためには、JMeterの以下のメトリックを利用します。

1. **Throughput** (スループット): 
   - JMeterのレポートで「Throughput」というメトリックがあります。これは、一定時間あたりのリクエスト数（リクエスト/秒）を表し、どれだけのリクエストが送信されたかを示します。
   - 具体的には、各サンプラが処理されたリクエスト数を合計し、秒単位で平均化したものです。

2. **Hits per Second**:
   - スループットとは異なり、「Hits per Second」はJMeterのリスナー（e.g., Summary Report）で、実際にサーバーが処理したリクエストの数を秒ごとに表示するものです。

3. **Requests per Second**:
   - 「Requests per Second」も、スループットとほぼ同義で、単位時間あたりのリクエストの発生頻度を確認できます。

Azure Load Testingでリクエスト数のパフォーマンスを確認したい場合、これらのJMeterメトリックを基に、リクエストの処理状況やスループットを分析すると良いでしょう。

### user — 2024-10-21T12:22:49.450377+00:00

Entraidの同時処理数

### assistant — 2024-10-21T12:23:09.992600+00:00

Entra ID (旧Azure AD) の同時処理数に関しては、基本的には以下の要素に依存します：

1. **API Rate Limits**:
   - Entra ID にはAPIのレート制限があります。これにより、一定時間内にリクエストできる回数が制限されます。具体的な制限値はAPIの種類によって異なり、Azureの公式ドキュメントで確認できます。
   - たとえば、Microsoft Graph APIを使用している場合、エンドポイントごとに異なる制限が設定されています。通常、リクエストの数が制限を超えると、HTTP 429エラーが返され、一定時間のクールダウンが必要になります。

2. **トークン発行の制限**:
   - Entra ID では、トークンの発行にも制限があります。例えば、トークン発行のリクエスト（`/token`エンドポイント）に対しても、レート制限が適用されるため、短時間に大量のトークンを要求すると制限に達することがあります。
   - 特に、認証フロー（Authorization Code FlowやClient Credentials Flowなど）を大量に行う場合は、この制限を考慮する必要があります。

3. **スループットと同時接続数**:
   - スループットは、リクエストが処理される速度に関係し、同時にどれだけのリクエストを処理できるかを示します。Azureのインフラ自体はスケーラブルな設計となっているため、適切なリソースを確保すれば、かなりの同時リクエストを処理可能です。ただし、Entra IDのAPIに関しては、レート制限がボトルネックになることがあります。

4. **クライアント側の制限**:
   - クライアントアプリケーション（例えば、Blazor WebAssemblyやAPI）がトークンを取得する際に、同時にどれだけのリクエストを送るかも影響します。クライアント側で同時にリクエストを行いすぎると、制限に引っかかる可能性が高くなります。

これらの制限を考慮しながら、必要に応じてリトライロジックを追加したり、リクエストの間隔を調整するなど、適切に設計することが重要です。また、Azureの制限に関しては、Azureポータルや公式ドキュメントで最新の情報を確認することをお勧めします。

### user — 2024-10-21T12:26:09.986532+00:00

Free版を使用する場合の上限

### assistant — 2024-10-21T12:26:30.329094+00:00

Entra ID (旧Azure AD) のFree版を使用する場合、同時処理やAPIの使用についていくつかの上限があります。以下に主な制限をまとめます：

### 1. **API リクエスト制限**
   - **Microsoft Graph API** などのAPIに対しては、レート制限があります。Free版でも基本的な認証・トークン発行の機能を利用できますが、APIのリクエスト回数に制限があります。
   - **制限例**: Microsoft Graph APIの一般的な制限は、10,000リクエスト/10分 (ユーザーまたはアプリケーション単位) となっています。ただし、エンドポイントによって異なる場合があるため、Microsoft Graph APIのドキュメントで具体的なエンドポイントごとのレート制限を確認する必要があります。

### 2. **ディレクトリオブジェクト数**
   - Entra ID Free版では、ディレクトリ内で作成できるオブジェクト数（ユーザー、グループなど）の上限があります。
   - **制限例**: 無料プランでは、1つのEntra IDテナントにつき最大 **50,000** オブジェクトまで作成可能です。

### 3. **認証の同時実行制限**
   - Free版では、同時にトークンを発行できるリクエスト数も制限されます。これは、短時間に大量のログインやトークン発行が発生する場合に影響を及ぼす可能性があります。
   - **具体的な上限**: Microsoftは詳細な数値を公表していませんが、頻繁に `HTTP 429 Too Many Requests` が発生する場合は、APIのリクエスト数が制限を超えたことを意味します。

### 4. **多要素認証 (MFA)**
   - Free版では、基本的な多要素認証 (MFA) を使用できますが、条件付きアクセスなどの高度なセキュリティ機能は有料版 (P1/P2) での提供となります。

### 5. **サポートレベル**
   - Free版では、Azure サポートが提供されないか、コミュニティベースのサポートに限られます。公式のサポートを受けたい場合は、有料プランが必要です。

上記のような制限を考慮する必要があります。特に、開発・テスト目的であればFree版でも多くの基本機能が利用可能ですが、運用環境で負荷が高いシナリオを想定する場合は、有料プランを検討することをおすすめします。

### user — 2024-10-21T12:28:32.683355+00:00

Entraid 認識を利用するapiの同時実行が50に制限される

### assistant — 2024-10-21T12:28:42.734564+00:00

The user mentioned that the API using Entra ID recognition is limited to 50 concurrent executions.

### tool — 2024-10-21T12:28:42.734723+00:00

Model set context updated.

### assistant — 2024-10-21T12:28:42.734861+00:00

Entra ID 認識を利用するAPIの同時実行数が50に制限されるということですね。この制限を超えると、`HTTP 429 Too Many Requests` エラーが発生し、リクエストが制限される可能性があります。このような制限を考慮して、適切なリクエスト制御やリトライロジックの実装が必要です。特に、リクエストをスロットリングする方法や、バックオフ戦略（エクスポネンシャルバックオフ）を使用して負荷を調整すると効果的です。

### user — 2024-10-21T12:29:28.190547+00:00

Http 429はjmeterのログに残るのか

### assistant — 2024-10-21T12:29:38.177359+00:00

_(empty)_

### assistant — 2024-10-21T12:29:38.177487+00:00

はい、`HTTP 429 Too Many Requests` エラーは、JMeterのログに記録されます。JMeterでテストを実行している際に、リクエストがレート制限に達して`HTTP 429`エラーが返された場合、以下の場所で確認できます：

1. **View Results Tree リスナー**:
   - 「View Results Tree」リスナーを使用すると、各リクエストの詳細なレスポンスとステータスコードを確認できます。ここで、`HTTP 429`が返されたリクエストの詳細も確認でき、エラーメッセージも表示されます。

2. **Summary Report / Aggregate Report**:
   - これらのリスナーには、リクエストの成功・失敗数や応答コードごとのカウントが集計されます。`HTTP 429`のようなエラーも失敗としてカウントされ、失敗リクエストの中に含まれます。

3. **JMeterログファイル (jmeter.log)**:
   - `jmeter.log`ファイルにも、実行中に発生したエラーや例外が記録されます。具体的なリクエストやレスポンスの内容は記録されませんが、エラーが発生した場合の概要が残ります。

これらを通じて、JMeterで`HTTP 429`エラーの発生状況を確認することができます。特に「View Results Tree」や「Summary Report」は詳細なエラー内容を把握するのに役立ちます。

### user — 2024-10-21T12:35:31.287165+00:00

App serviceにentraid認証を行うapiを実装前提で回答

### assistant — 2024-10-21T12:35:47.623252+00:00

App ServiceにEntra ID（旧Azure AD）認証を行うAPIを実装する場合の`HTTP 429 Too Many Requests`エラーについて、JMeterでのログ記録方法に関して、以下の内容が関連します：

### 1. **JMeterでの`HTTP 429`エラーの記録方法**
   - **View Results Treeリスナー**:
     - Entra ID認証を使用するAPIがレート制限に達した場合、APIリクエストに対して`HTTP 429`エラーが返されます。JMeterの「View Results Tree」リスナーを設定すると、リクエストごとに返されるステータスコードやレスポンス内容が表示されます。ここで、`HTTP 429`エラーのレスポンスも確認できます。
     - レスポンスメッセージには、通常、レートリミットに関する情報や再試行までの待ち時間（Retry-Afterヘッダー）が含まれます。

   - **Summary Report / Aggregate Report**:
     - JMeterの「Summary Report」や「Aggregate Report」では、各ステータスコード（例えば、`HTTP 200`や`HTTP 429`）のリクエスト数が集計されます。これにより、`HTTP 429`エラーが発生したリクエスト数や割合を簡単に確認できます。
     - これらのレポートでは、エラーレスポンスがどの程度の頻度で発生しているかを全体的に把握するのに役立ちます。

### 2. **Entra ID 認証を利用するAPIのレート制限を考慮したテスト設定**
   - Entra IDを利用したAPIには、特に認証トークンの取得や認証後のAPIリクエストにレートリミットが設けられています。App Service上で運用する場合、これらの制限を超えると、`HTTP

### user — 2024-10-21T12:36:05.443014+00:00

429は発生しない

### assistant — 2024-10-21T12:36:15.082697+00:00

The user mentioned that `HTTP 429` errors do not occur in their context.

### tool — 2024-10-21T12:36:15.082990+00:00

Model set context updated.

### assistant — 2024-10-21T12:36:15.083257+00:00

`HTTP 429`エラーが発生しない前提であれば、JMeterでのテスト中に特にこのエラーを考慮する必要はありません。そのため、負荷テストの設定やレポート分析において、`HTTP 429`に関連する特別な対応は不要です。

代わりに、リクエストが正常に処理されるか（`HTTP 200`などのステータスコード）や、期待される応答時間、スループット、その他のパフォーマンスメトリクスを重点的に確認することに集中すると良いでしょう。これにより、App Service上でのAPIが適切なスケーラビリティとパフォーマンスを持つかを評価できます。

### user — 2024-10-21T21:38:43.960674+00:00

Azure Load TestingのフィルタでP90の集計結果で要求数/秒（平均）の値が100/秒を示す場合どのようなことを指しているのか

### system — 2024-10-21T21:39:06.115053+00:00

_(empty)_

### assistant — 2024-10-21T21:39:06.115205+00:00

_(empty)_

### assistant — 2024-10-21T21:39:06.115355+00:00

Azure Load Testing のフィルタで P90 の集計結果において、要求数/秒（平均）の値が 100/秒を示している場合、次のような意味を持ちます：

### 1. **P90の意味**:
   - **P90 (90th Percentile)** は、全リクエストの中で上位 90% が達成する応答時間やスループットなどのパフォーマンス指標を示します。これは、90% のリクエストがある特定の条件を満たしていることを意味し、性能のばらつきの把握に役立ちます。
   - 例えば、P90の応答時間が特定の時間である場合、リクエストのうち 90% はそれ以下の応答時間で処理されたことを意味します。

### 2. **要求数/秒（平均）の値が 100/秒を示す場合**:
   - この場合、P90 の集計に基づいて、リクエストの上位 90% が平均的に毎秒 100 リクエストを処理できていることを意味します。
   - **具体的には**:
     - 負荷テストの中で、90% の時間帯において、システムが平均して毎秒 100 件のリクエストを処理できている。
     - これはシステムがピーク負荷時も含めて比較的安定して、要求を捌いていることを示します。

### 3. **インパクトの解釈**:
   - **パフォーマンスの安定性**: P90で100リクエスト/秒が達成されている場合、負荷テストのほとんどの時間で高いスループットを維持できていると考えられます。これにより、システムの処理能力が高いことが示唆されます。
   - **ボトルネックの評価**: もし、P90の値が理想のスループットに達しているが、P99や最大値が低い場合、負荷の一部でボトルネックが発生している可能性があります。この場合、特定のリクエストや状況で負荷がかかっている箇所を見極める必要があります。

### 4. **設計とスケーリングの確認**:
   - **要求数/秒**が高い水準を保てるかどうかは、システムの設計やインフラのスケーリングに依存します。P90が100リクエスト/秒を示す場合、それに見合うリソース（例えばApp Serviceのインスタンス数、スケールアウト設定、ネットワーク帯域など）が適切である可能性が高いです。
   - 高負荷に耐えられるようなアーキテクチャ設計（スケールアウトの自動化、負荷分散の設定、キャッシングの活用など）ができていることが裏付けられます。

この結果は、Azure Load Testingを通じて得られたシステムの性能とスループットを表し、実際の運用環境での負荷をシミュレーションし、応答性やスケーラビリティを評価するために役立ちます。

### user — 2024-10-21T21:40:15.424464+00:00

要求数は要求開始数なのか、要求応答数なのか

### assistant — 2024-10-21T21:40:30.665249+00:00

Azure Load Testing の「要求数」について、**要求開始数**なのか、**要求応答数**なのかを判断する場合、通常は **要求応答数** を指します。具体的には次のようになります：

### 1. **要求応答数 (Requests per Second) の解釈**:
   - **要求応答数**とは、サーバーが受け取ったリクエストに対して、実際に応答を返したリクエストの数を示します。これには、成功したリクエストもエラーになったリクエストも含まれます。
   - Azure Load Testing や JMeterで「リクエスト数/秒（スループット）」と表現されるメトリックは、通常この応答数に基づきます。

### 2. **要求開始数と応答数の違い**:
   - **要求開始数**は、クライアント側（JMeterなどのテストツール）から送信を開始したリクエストの数を指します。
   - 一方で、**要求応答数**は、サーバーがそのリクエストを受け付けて応答を返した数です。
   - 通常の負荷テストでは、**応答数**を基準にパフォーマンスを評価するため、要求が開始されてからの応答数が指標になります。

### 3. **Azure Load Testingでの考え方**:
   - Azure Load Testing のレポートやメトリックは、テストの結果として得られるサーバーからの応答を基に集計するのが一般的です。したがって、集計結果で表示される「要求数」は、サーバーが応答を返したリクエスト数、すなわち「要求応答数」を指すと考えて問題ありません。
   - これにより、リクエストがサーバーに対してどれだけ処理され、どの程度のスループットが得られているかを評価することができます。

結論として、Azure Load Testing における「要求数」は、通常 **要求応答数**であり、これによりサーバーの実際の処理能力を測定・評価することができます。
