---
conversation_id: "68a50c93-77a8-832e-8023-a951fa4621db"
title: "ç¯„å›²ã‚«ãƒ©ãƒ ã®ç‰¹å®šæ–¹æ³•"
create_time: 1755647171.25767
update_time: 1755722424.720299
language_guess: "en"
num_messages: 329
part_index: 2
part_count: 2
---

### assistant â€” 2025-08-20T11:51:54.831435+00:00

äº†è§£ã€‚**â€œä½¿ã†å´ãŒ Final/Live ã®ãƒˆãƒ”ãƒƒã‚¯ã¸ç¢ºå®Ÿã«çµã³ä»˜ã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã€POCO è‡ªèº«ã«ã€ã©ã®è¶³ã‹ã€ã®å±æ€§ã‚’æŒãŸã›ã‚‹**ã€â€”â€”ã“ã“ã‚’æœ€å°ã§ã€ã§ã‚‚æ‹¡å¼µã«å¼·ãè¨­è¨ˆã—ã¾ã™ã€‚

# æœ€å°æ¡ˆï¼ˆ1å±æ€§ã§å®Œçµï¼‰
```csharp
[AttributeUsage(AttributeTargets.Class, AllowMultiple = false, Inherited = false)]
public sealed class BarDefinitionAttribute : Attribute
{
    public BarDefinitionAttribute(
        BarKind kind,          // Time / Tick / Volume / Rangeï¼ˆã¾ãšã¯ Time ã ã‘ã§OKï¼‰
        TimeUnit unit,         // m / h / d / Mï¼ˆM=Monthï¼‰
        int size,              // 5 â†’ 5m, 1 â†’ 1h ãªã©
        string topicPattern)   // ä¾‹: "rates.time.{size}{unit}.{stage}"
    {
        Kind = kind;
        Unit = unit;
        Size = size;
        TopicPattern = topicPattern;
    }

    public BarKind Kind { get; }
    public TimeUnit Unit { get; }
    public int Size { get; }
    public string TopicPattern { get; } // {stage}=live|final ã‚’å®Ÿè¡Œæ™‚ã«åŸ‹ã‚ã‚‹
}

public enum BarKind { Time /*, Tick, Volume, Range*/ }
public enum TimeUnit { m, h, d, M } // æœˆã ã‘å¤§æ–‡å­— M
```

## POCO
```csharp
[BarDefinition(
    kind: BarKind.Time,
    unit: TimeUnit.m,
    size: 5,
    topicPattern: "rates.time.{size}{unit}.{stage}" // â†’ rates.time.5m.final / live
)]
public class Rate
{
    public string Broker { get; set; } = "";
    public string Symbol { get; set; } = "";
    public DateTimeOffset BucketStart { get; set; }
    public decimal Open { get; set; }
    public decimal High { get; set; }
    public decimal Low  { get; set; }
    public decimal Close{ get; set; }
}
```

## ä½¿ã„æ–¹ï¼ˆProducer/Consumer å…±é€šã®çµã³ã¤ã‘ï¼‰
```csharp
static (string live, string final) ResolveTopics<T>()
{
    var a = (BarDefinitionAttribute)Attribute.GetCustomAttribute(typeof(T), typeof(BarDefinitionAttribute))!;
    var baseName = a.TopicPattern
        .Replace("{size}", a.Size.ToString())
        .Replace("{unit}", a.Unit.ToString());

    return (live:  baseName.Replace("{stage}", "live"),
            final: baseName.Replace("{stage}", "final"));
}

// Producer
var (liveTopic, finalTopic) = ResolveTopics<Rate>();
// liveTopic  â†’ "rates.time.5m.live"
// finalTopic â†’ "rates.time.5m.final"

// Consumerï¼ˆä½¿ã†å´ï¼‰
var (_, finalT) = ResolveTopics<Rate>();
// ã©ã®PODã§ã‚‚ Rate ã•ãˆçŸ¥ã£ã¦ã„ã‚Œã° final ã®ãƒˆãƒ”ãƒƒã‚¯åã«åˆ°é”ã§ãã‚‹
```

---

# ã“ã‚Œã§æº€ãŸã™è¦ä»¶
- **POCOã«â€œè¶³â€ã®å±æ€§ãŒã‚ã‚‹** â†’ ã€Œã“ã‚Œã¯ 5åˆ†ã®æ™‚é–“è¶³ã€ã¨**å‹ã‹ã‚‰åˆ¤å®š**ã§ãã‚‹ã€‚
- **Final/Live ã®ãƒˆãƒ”ãƒƒã‚¯çµã³ä»˜ã‘** â†’ `topicPattern` ã« `{stage}` ã‚’å«ã‚ã‚‹ã ã‘ã€‚  
  - ç”Ÿæˆå´ï¼šç¯„å›²ç¢ºå®šæ™‚ã¯ `final`ã€ãƒ•ãƒ¬ãƒ¼ãƒ é€”ä¸­ã¯ `live` ã«æµã™  
  - å–å¾—å´ï¼š`ResolveTopics<Rate>()` ä¸€ç™ºã§ä¸¡æ–¹ã®åå‰ã«åˆ°é”
- **æ‹¡å¼µãŒå®¹æ˜“**  
  - 1æ™‚é–“è¶³ãªã‚‰ `unit: TimeUnit.h, size: 1` ã«å·®ã—æ›¿ãˆ  
  - éæ™‚é–“ç³»ï¼ˆå°†æ¥ï¼‰ã‚‚ `BarKind` ã‚’å¢—ã‚„ã™ã ã‘ï¼ˆä¿å­˜ã‚¹ã‚­ãƒ¼ãƒã¯ä¸å¤‰ï¼‰
- **æœ€å°ãƒ»ä¸€è²«**ï¼šå±æ€§ã¯**1å€‹ã ã‘**ã€POCOã‚¹ã‚­ãƒ¼ãƒã¯**ä¸€åˆ‡å¤‰æ›´ãªã—**ã€RocksDBã‚­ãƒ¼ã‚‚ä»¥å‰ã©ãŠã‚Šã€‚

> è£œè¶³ï¼šè¤‡æ•°è¶³ã‚’åŒä¸€ã‚¢ã‚»ãƒ³ãƒ–ãƒªã§æŒã¡ãŸã„å ´åˆã¯ã€**å‹ï¼ˆRate5m/Rate1hâ€¦ï¼‰ã‚’åˆ¥åã‚¿ã‚¤ãƒ—ã§ç”¨æ„**ã—ã¦åŒã˜ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æ§‹æˆï¼ˆ=åŒPOCOå½¢çŠ¶ï¼‰ï¼‹å±æ€§å€¤ã ã‘å¤‰ãˆã‚‹ã®ãŒä¸€ç•ªã‚·ãƒ³ãƒ—ãƒ«ã§ã™ã€‚ã‚¹ã‚­ãƒ¼ãƒã¯åŒã˜ã§ã‚‚ã€**å‹ãŒé•ãˆã°å±æ€§ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œ**ã€PODé–“ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚‚è¿·ã„ã¾ã›ã‚“ã€‚

ã“ã®å½¢ã§ã„ãã¾ã—ã‚‡ã†ã€‚å¿…è¦ãªã‚‰ã€`ResolveTopics<T>()` ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã¨ç°¡å˜ãªå˜ä½“ãƒ†ã‚¹ãƒˆé››å½¢ã‚‚ãã®ã¾ã¾å‡ºã›ã¾ã™ã€‚

â±é€ä¿¡æ—¥æ™‚: [[REDACTED_PHONE]]:10ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰
### user â€” 2025-08-20T11:51:55.206000+00:00

pocoã«ã¯è¶³ã‚’è¡¨ç¾ã™ã‚‹å±æ€§ãŒå¿…è¦
ã“ã‚ŒãŒãªã„ã¨å®Ÿéš›ã«final liveã®ãƒˆãƒ”ãƒƒã‚¯ã¨ã®çµã³ã¤ã‘ãŒã§ããªã„
### system â€” 2025-08-20T11:51:55.765002+00:00

_(empty)_
### system â€” 2025-08-20T11:51:55.812797+00:00

_(empty)_
### assistant â€” 2025-08-20T11:52:00.011567+00:00

_(empty)_
### assistant â€” 2025-08-20T11:52:38.360403+00:00

_(empty)_
### assistant â€” 2025-08-20T11:54:33.996614+00:00

äº†è§£ã€‚ã€Œä»•æ›ã‘ã‚ˆã‚Šåˆ©ç”¨è€…ç›®ç·šã€ã€Œæœ€å°ã®ã—ã‚‹ã—ã ã‘ã€ã‚’è»¸ã«ã—ã¾ã™ã€‚  
çµè«–ï¼š**POCOã« â€œãŸã£ãŸ1ã¤ã®å°ï¼ˆtimeframeã‚³ãƒ¼ãƒ‰ï¼‰â€ ã‚’ç½®ã**ã ã‘ã§ã€Final/Live ã®çµã³ä»˜ã‘ã¾ã§å®Œäº†ã•ã›ã¾ã™ã€‚

# æœ€å°æ¡ˆï¼ˆã‚¼ãƒ­ä»•æ›ã‘ï¼‰
```csharp
public class Rate   // 5åˆ†è¶³
{
    public const string TF = "5m"; // â† æœ€å°ã®ã—ã‚‹ã—ï¼ˆã“ã‚Œã ã‘ï¼‰

    public string Broker { get; set; } = "";
    public string Symbol { get; set; } = "";
    public DateTimeOffset BucketStart { get; set; }
    public decimal Open { get; set; }
    public decimal High { get; set; }
    public decimal Low  { get; set; }
    public decimal Close{ get; set; }
}
```

## ç´ã¥ã‘è¦ç´„ï¼ˆåˆ©ç”¨è€…è¦–ç‚¹ï¼‰
- **ãƒˆãƒ”ãƒƒã‚¯å**ã¯ **è¦ç´„**ã§æ±ºã‚æ‰“ã¡ï¼š`bars.{TF}.{stage}`  
  - ä¾‹ï¼š`bars.5m.final` / `bars.5m.live`
- **ä½¿ã†å´**ã¯ POCOã‹ã‚‰ `TF` ã‚’èª­ã‚€ã ã‘ï¼š
```csharp
var tf    = Rate.TF;                       // "5m"
var live  = $"bars.{tf}.live";
var final = $"bars.{tf}.final";
// -> ã‚ã¨ã¯ ToListAsync(keys)
```
- **ä½œã‚‹å´**ã‚‚åŒã˜è¦ç´„ã§æµã™ã ã‘ï¼ˆè­°è«–ä¸è¦ï¼‰ã€‚

> ã“ã‚Œãªã‚‰ã€Œè¦‹ã‚Œã°åˆ†ã‹ã‚‹ã€ã€Œè¿·ã‚ãªã„ã€ã€‚**ä»•æ›ã‘ã‚¼ãƒ­**ã€**å°ã¯1ã¤**ã€‚

---

# ä»£æ›¿ï¼ˆå°ã¯1ã¤ã€å±æ€§æ´¾ãªã‚‰ï¼‰
ã©ã†ã—ã¦ã‚‚å±æ€§ãŒè‰¯ã‘ã‚Œã°ã€**1å¼•æ•°ã ã‘**ã«çµã‚‹ï¼š
```csharp
[AttributeUsage(AttributeTargets.Class)]
sealed class BarAttribute : Attribute { public string Tf { get; }
  public BarAttribute(string tf) => Tf = tf;
}

[Bar("5m")]  // â† æœ€å°ã®ã—ã‚‹ã—ï¼ˆã“ã‚Œã ã‘ï¼‰
public class Rate { /* åŒä¸Š */ }
```
è§£æ±ºã‚‚1è¡Œï¼š
```csharp
var tf = ((BarAttribute)Attribute.GetCustomAttribute(typeof(Rate), typeof(BarAttribute))!).Tf;
```
â†’ ãƒˆãƒ”ãƒƒã‚¯è¦ç´„ã¯åŒã˜ï¼ˆ`bars.{tf}.{stage}`ï¼‰ã€‚

---

## ãƒã‚¤ãƒ³ãƒˆ
- **åˆ©ç”¨è€…ãŒè¦‹ã‚‹ã®ã¯ `TF` ã ã‘**ã€‚ä½™è¨ˆãªæ¦‚å¿µãªã—ã€‚
- **Final/Live** ã¯ **è¦ç´„æ–‡å­—åˆ—ã® `{stage}`** ã‚’å·®ã—æ›¿ãˆã‚‹ã ã‘ã€‚
- **POCOãŒãƒãƒ£ãƒ¼ãƒˆç”¨ã‹ï¼Ÿ** â†’ TF ãŒã‚ã‚‹ (= Bars)ï¼ãªã‘ã‚Œã° Rawï¼ˆor åˆ¥ç³»ï¼‰ã¨åˆ¤æ–­å¯ã€‚

å¿…è¦ãªã®ã¯ã€Œæœ€å°ã®å°ã€= `TF` ã ã‘ã€ã§ã™ã€‚

â±é€ä¿¡æ—¥æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰: [[REDACTED_PHONE]]:24
### system â€” 2025-08-20T11:54:35.084749+00:00

_(empty)_
### system â€” 2025-08-20T11:54:35.096938+00:00

_(empty)_
### assistant â€” 2025-08-20T11:54:36.322257+00:00

_(empty)_
### user â€” 2025-08-20T11:54:36.646000+00:00

å¤©åŸã¯ä»•æ›ã‘ã‚’é‡è¦–ã—ã™ã
åˆ©ç”¨è€…ç›®ç·šã§è€ƒãˆã‚‹ã€æœ€å°ã®ã—ã‚‹ã—ã‚’å…¥ã‚Œã‚‹
### assistant â€” 2025-08-20T11:54:53.953415+00:00

_(empty)_
### assistant â€” 2025-08-20T11:58:35.034179+00:00

ã¯ã„ã€ãã®ã¨ãŠã‚Šã€‚**Tumbling ãŒå‚ç…§ã™ã‚‹ â€œtimeâ€ ã‚’ç¤ºã™å±æ€§ã ã‘**ã§ååˆ†ã«æ‹…ä¿ã§ãã¾ã™ã€‚ä½™è¨ˆãª TF ãƒ•ãƒ©ã‚°ã‚„åˆ¥å±æ€§ã¯ä¸è¦ã§ã™ã€‚

## æœ€å°è¨­è¨ˆï¼ˆã“ã‚Œã ã‘ï¼‰
```csharp
// 1) ã€Œã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒ Tumbling ã® time ã ã€ã‚’ç¤ºã™å°ã ã‘ç”¨æ„
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
public sealed class TumblingTimeAttribute : Attribute
{
    public TumblingTimeAttribute(string granularity) => Granularity = granularity; // ä¾‹ "5m","1h","1d","1M"
    public string Granularity { get; }
}
```

```csharp
// 2) POCO ã¯ â€œå°â€ ã‚’ä¸€ç®‡æ‰€ã ã‘ä»˜ã‘ã‚‹
public class Rate   // 5åˆ†è¶³
{
    public string Broker { get; set; } = "";
    public string Symbol { get; set; } = "";

    [TumblingTime("5m")]                   // â† æœ€å°ã®ã—ã‚‹ã—ï¼ˆã“ã‚Œã§è¶³ç¨®ã¨ãƒãƒ£ãƒ¼ãƒˆæ€§ã‚’åˆ¤å®šï¼‰
    public DateTimeOffset BucketStart { get; set; }

    public decimal Open  { get; set; }
    public decimal High  { get; set; }
    public decimal Low   { get; set; }
    public decimal Close { get; set; }
}
```

```csharp
// 3) åˆ©ç”¨å´ï¼šå°ã ã‘èª­ã‚“ã§ Live/Final ã‚’ã²ã‚‚ä»˜ã‘
static (string live, string final) ResolveTopics<T>()
{
    var prop = typeof(T).GetProperties()
        .FirstOrDefault(p => Attribute.IsDefined(p, typeof(TumblingTimeAttribute)));
    if (prop is null) throw new InvalidOperationException("No TumblingTime on POCO.");

    var tf = ((TumblingTimeAttribute)Attribute.GetCustomAttribute(prop, typeof(TumblingTimeAttribute))!).Granularity;
    var baseName = $"bars.{tf}";                  // è¦ç´„ï¼šbars.{granularity}.{stage}
    return ($"{baseName}.live", $"{baseName}.final");
}
```

- **ä½œã‚‹å´**ã¯ `[TumblingTime("â€¦")]` ã‚’åŸºã« Tumbling ã‚’è¡Œã„ã€`bars.{tf}.live/final` ã«å‡ºåŠ›ã€‚
- **ä½¿ã†å´**ã¯åŒã˜å°ã‚’èª­ã‚€ã ã‘ã§ **Final/Live ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’è‡ªå‹•è§£æ±º**ã§ãã¾ã™ã€‚
- **ToListAsync(List<string>)** ã¯ãã®ã¾ã¾ã€‚é…åˆ—ã§ TF ã‚’æ¸¡ã•ãªã„ã€é–¢æ•°åã‚‚å¢—ã‚„ã•ãªã„ã€‚

> å°ãŒ**ç„¡ã„**POCOã¯ã€Œãƒãƒ£ãƒ¼ãƒˆç”¨ã§ã¯ãªã„ï¼ˆRawç­‰ï¼‰ã€ã¨åˆ¤å®šå¯èƒ½ãªã®ã§ã€åˆ¤åˆ¥ã‚‚ã“ã‚Œä¸€ã¤ã§æ¸ˆã¿ã¾ã™ã€‚

ã“ã‚Œã§ã€Œä»•æ›ã‘ã¯æœ€å°ï¼åˆ©ç”¨è€…ç›®ç·šï¼æœ€å°ã®ã—ã‚‹ã—ã ã‘ã€ã®è¦ä»¶ã‚’æº€ãŸã›ã¾ã™ã€‚  

â±é€ä¿¡æ—¥æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰: [[REDACTED_PHONE]]:30
### system â€” 2025-08-20T11:58:36.230552+00:00

_(empty)_
### system â€” 2025-08-20T11:58:36.243449+00:00

_(empty)_
### user â€” 2025-08-20T11:58:37.063000+00:00

ãã‚Œã¯Tumblingã§ä½¿ç”¨ã™ã‚‹timeã‚’ç¤ºã™å±æ€§ã§æ‹…ä¿ã§ãã‚‹
### assistant â€” 2025-08-20T11:58:39.302195+00:00

_(empty)_
### assistant â€” 2025-08-20T11:58:54.172228+00:00

_(empty)_
### assistant â€” 2025-08-20T11:59:28.312073+00:00

ãªã‚‹ã»ã©ã€‚åƒ•ã®å‡ºã—æ–¹ãŒã‚ºãƒ¬ã¦ã¾ã—ãŸã€‚  
**æœ€å°ã® â€œã—ã‚‹ã—â€ ã¯ã‚ãã¾ã§ã€Œã©ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒæ™‚é–“è»¸ã‹ã€ã ã‘**ã§ã€**è¶³ã®ç²’åº¦ï¼ˆ5m/1hâ€¦ï¼‰ã¯ POCO ã«åŸ‹ã‚ãªã„**â€”â€”ã§ã™ã‚ˆã­ã€‚ç²’åº¦ã¯ã€Œã©ã®ãƒˆãƒ”ãƒƒã‚¯ï¼ˆseriesï¼‰ã‚’èª­ã‚€ã‹ã€ã§æ±ºã¾ã‚Šã€POCOã¯â€œãƒãƒ£ãƒ¼ãƒˆå¯èƒ½ã‹ã©ã†ã‹â€ã ã‘åˆ¤åˆ¥ã§ãã‚Œã°ååˆ†ã€‚

# âœ… æœ€å°æ§‹æˆï¼ˆç²’åº¦ã¯å¤–ã€POCOã¯è»¸ã ã‘ç¤ºã™ï¼‰
### 1) POCOï¼šæ™‚é–“è»¸ã‚’ä¸€ã¤ã ã‘ãƒãƒ¼ã‚¯ï¼ˆç²’åº¦ã¯æŒãŸãªã„ï¼‰
```csharp
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
sealed class TumblingTimeAttribute : Attribute {}   // å¼•æ•°ãªã—ï¼šç²’åº¦ã‚’æŒãŸã›ãªã„

public class Rate
{
    public string Broker { get; set; } = "";
    public string Symbol { get; set; } = "";

    [TumblingTime]                          // â† ã€Œã“ã®1ã¤ãŒæ™‚é–“è»¸ã€ã ã‘ã‚’ç¤ºã™ï¼ˆçµ¶å¯¾ã«1ã¤ï¼‰
    public DateTimeOffset BucketStart { get; set; }

    public decimal Open  { get; set; }
    public decimal High  { get; set; }
    public decimal Low   { get; set; }
    public decimal Close { get; set; }
}
```

- ãƒ«ãƒ¼ãƒ«ï¼š`[TumblingTime]` ã¯ **å¿…ãš1ã¤**ã€‚ç²’åº¦ãƒ»final/live ãªã©**ä¸€åˆ‡æŒãŸã›ãªã„**ã€‚
### 2) ç²’åº¦ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆfinal/liveï¼‰ã¯ **ãƒˆãƒ”ãƒƒã‚¯å´**ã§è¡¨ç¾
- å‘½åè¦ç´„ï¼ˆä¾‹ï¼‰: `bars.rate.{series}.{stage}`  
  - `{series}` = `"5m" | "1h" | "1d" | "1M"`ï¼ˆæœˆã ã‘å¤§æ–‡å­—Mï¼‰  
  - `{stage}`  = `"live" | "final"`
### 3) ä½¿ã†å´ã®å‘¼ã³æ–¹ï¼ˆPOCOã¯ãã®ã¾ã¾ã€ç²’åº¦ã¯ãƒˆãƒ”ãƒƒã‚¯ã§é¸ã¶ï¼‰
```csharp
var src  = Open("bars.rate.5m.final");           // â† ç²’åº¦ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ãƒˆãƒ”ãƒƒã‚¯ã§æ±ºã‚ã‚‹
var rows = await src.ToListAsync(new(){ "OANDA", "USDJPY" });  // â† å–å¾—ã¯æ—¢å­˜ã©ãŠã‚Š
```

> ã“ã‚Œã§ï¼š  
> - **POCOã¯æœ€å°ã®å°ã ã‘**ï¼ˆãƒãƒ£ãƒ¼ãƒˆå¯èƒ½ã®åˆ¤æ–­ï¼æ™‚é–“è»¸ã®ç‰¹å®šï¼‰ã€‚  
> - **ç²’åº¦ã¯å¤–éƒ¨ã®é¸æŠ**ï¼ˆã©ã® series ã‚’èª­ã‚€ã‹ï¼‰ã€‚  
> - **final/live ã®çµã³ã¤ã‘**ã‚‚ãƒˆãƒ”ãƒƒã‚¯è¦ç´„ã§è§£æ±ºã€‚  
> - `ToListAsync(List<string>)` ã¯**ä¸€åˆ‡å¤‰ãˆãªã„**ï¼é…åˆ—ã§è¶³ã‚’æ¸¡ã•ãªã„ã€‚

---
### è£œåŠ©ï¼ˆä»»æ„ï¼‰ï¼šå°ã®æ¤œè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆãƒ“ãƒ«ãƒ‰æ™‚/èµ·å‹•æ™‚ï¼‰
```csharp
static void EnsureSingleTumblingTime<T>()
{
    var marked = typeof(T).GetProperties()
        .Where(p => Attribute.IsDefined(p, typeof(TumblingTimeAttribute))).ToList();
    if (marked.Count != 1)
        throw new InvalidOperationException($"[{typeof(T).Name}] TumblingTime must be exactly one.");
}
```
- ã€Œçµ¶å¯¾ã«1ã¤ã€ã‚’æ©Ÿæ¢°ã§å®ˆã‚‹ã ã‘ã€‚**ä»•æ›ã‘ã¯ã“ã“ã¾ã§**ã«æŠ‘ãˆã‚‹ã€‚

---

ã“ã®å½¢ãªã‚‰ã€**å¤©åŸãŒä»•æ›ã‘ã‚’ç››ã‚Šã™ãã‚‹å•é¡Œã‚’å›é¿**ã—ã¤ã¤ã€**åˆ©ç”¨è€…ã¯æœ€å°ã®ã—ã‚‹ã—ã ã‘ã§è¿·ã‚ãªã„**ã€‚  
POCOã¯ã€Œæ™‚é–“è»¸ãŒã©ã‚Œã‹ã€ã ã‘ã‚’ä¿è¨¼ã€**è¶³ã®ç²’åº¦ã¨ final/live ã¯ãƒˆãƒ”ãƒƒã‚¯ã§é¸ã¶**â€”â€”ã‚·ãƒ³ãƒ—ãƒ«ã«å‰²ã‚Šåˆ‡ã‚Œã¾ã™ã€‚

â±é€ä¿¡æ—¥æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰: [[REDACTED_PHONE]]:39
### system â€” 2025-08-20T11:59:28.834213+00:00

_(empty)_
### system â€” 2025-08-20T11:59:28.845644+00:00

_(empty)_
### user â€” 2025-08-20T11:59:31.319000+00:00

ã„ã‚„ã€‚ãã‚Œã¯ãŠã‹ã—ã„
### assistant â€” 2025-08-20T11:59:31.563155+00:00

_(empty)_
### assistant â€” 2025-08-20T11:59:58.353546+00:00

_(empty)_
### system â€” 2025-08-20T12:00:52.520733+00:00

_(empty)_
### system â€” 2025-08-20T12:00:52.547371+00:00

_(empty)_
### assistant â€” 2025-08-20T12:00:52.600460+00:00

äº†è§£ã€‚ãƒã‚¤ãƒ³ãƒˆã¯ã€Œ**å°ã¯â€œå…ƒã®POCOâ€ã«ä»˜ã‘ã‚‹**ã€‚**å¾Œæ®µï¼ˆè¶³POCOï¼‰ã«ã¯ä¸€åˆ‡ä»˜ã‘ãªã„**ã€ã§ã™ã­ã€‚æœ€å°ã®ã—ã‚‹ã—ã§ã€ãã‚Œã‚’å³å®ˆã™ã‚‹å½¢ã«æ•´ç†ã—ã¾ã™ã€‚

# æœ€å°ãƒ«ãƒ¼ãƒ«
- å°ã¯ **å…ƒPOCOï¼ˆä¾‹ï¼š`DeDupRates`ï¼‰** ã«ã ã‘ä»˜ã‘ã‚‹ã€‚
- ä»˜ã‘ã‚‹ã®ã¯ **â€œTumblingã§ä½¿ã†æ™‚é–“è»¸ãŒã©ã‚Œã‹â€ ã®å°ã®ã¿**ï¼ˆç²’åº¦ã¯æŒãŸã›ãªã„ï¼‰ã€‚
- è¶³POCOï¼ˆä¾‹ï¼š`Rate`ï¼‰ã¯**ç„¡å°**ã®ã¾ã¾ã€‚å‹åã¨åˆ—ã ã‘ã§ååˆ†ã€‚

# æœ€å°ã®å°ï¼ˆå±æ€§ 1ã¤ã ã‘ï¼‰
```csharp
[AttributeUsage(AttributeTargets.Property, AllowMultiple = false)]
sealed class TumblingTimeAttribute : Attribute {}
```

## å…ƒPOCOã¸ã®ä»˜ä¸ä¾‹ï¼ˆã“ã“ã«ã ã‘ä»˜ã‘ã‚‹ï¼‰
```csharp
public sealed class DeDupRates
{
    public string Broker { get; set; } = "";
    public string Symbol { get; set; } = "";

    [TumblingTime]                         // â† â€œã“ã®1ã¤ãŒæ™‚é–“è»¸â€
    public DateTimeOffset Timestamp { get; set; }

    public decimal Bid { get; set; }
    public decimal Ask { get; set; }
}
```

# ä½¿ã„æ–¹ï¼ˆå‘¼ã³æ–¹ã¯ä»Šã¾ã§ã©ãŠã‚Šï¼‰
```csharp
// time ãƒ©ãƒ ãƒ€ã‚’æ›¸ã‹ãªãã¦ã‚‚ã€[TumblingTime] ã‹ã‚‰è‡ªå‹•è§£æ±ºï¼ˆçµ¶å¯¾1ã¤ï¼‰
// ã‚‚ã¡ã‚ã‚“ã€æ˜ç¤ºãƒ©ãƒ ãƒ€ã‚’æ®‹ã—ã¦ã‚‚OKï¼ˆè¡çªæ™‚ã¯ãƒ“ãƒ«ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ï¼‰
EventSet<Rate>()
  .From<DeDupRates>()
  .ToQuery(q => q
    .Tumbling(/* çœç•¥å¯ï¼šå…ƒPOCOã®[TumblingTime]ã‚’è‡ªå‹•æ¤œå‡º */,
              minutes: new[]{1,5,15,30},
              hours:   new[]{1,4,8},
              days:    new[]{1,7},
              months:  new[]{1,12},
              ensureContinuous: true,
              gap: TimeSpan.FromMinutes(2))
    .BasedOn<MarketSchedule>((r,s) => /* ANDã®ã¿ */)
    .GroupBy(r => new { r.Broker, r.Symbol, BucketStart = Frame.StartOf(r.Timestamp) })
    .Select(/* OHLC */)
  );
```

# Live / Final ã®çµã³ã¤ã‘ï¼ˆç²’åº¦ã¯å¤–ã§æ±ºã‚ã‚‹ï¼‰
- ç²’åº¦ï¼ˆ`"5m"`, `"1h"`â€¦ï¼‰ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ï¼ˆ`live|final`ï¼‰ã¯ **ãƒˆãƒ”ãƒƒã‚¯åã§è¡¨ç¾**ã€‚  
- å…ƒPOCOã‚’æ‰‹æ›ã‹ã‚Šã«çµ„ã¿ç«‹ã¦ã‚Œã°ã€è¶³POCOã«å°ã¯ä¸è¦ã€‚

```csharp
static (string live, string final) TopicsFor<TSource>(string series) // series = "5m","1h","1d","1M"
{
    var hasTime = typeof(TSource).GetProperties()
        .Count(p => Attribute.IsDefined(p, typeof(TumblingTimeAttribute))) == 1
        ? true : throw new InvalidOperationException("TumblingTime must exist exactly once on source POCO.");

    var baseName = $"bars.{typeof(TSource).Name.ToLowerInvariant()}.{series}";
    return ($"{baseName}.live", $"{baseName}.final");
}

// ä½¿ã†å´ï¼ˆPODåˆ†é›¢ã§ã‚‚åŒã˜ï¼‰
var (live, final) = TopicsFor<DeDupRates>("5m");  // â†’ bars.deduprates.5m.live / .final
var rows = await Open(final).ToListAsync(new(){ "OANDA", "USDJPY" });
```

# ã¾ã¨ã‚
- **å°ã¯å…ƒPOCOã«ã ã‘**ï¼ˆ`[TumblingTime]`ï¼‰ã€‚  
- **è¶³POCOã¯ç„¡å°**ã®ã¾ã¾é‹ã¶ã€‚  
- ç²’åº¦/ã‚¹ãƒ†ãƒ¼ã‚¸ã¯ **ãƒˆãƒ”ãƒƒã‚¯å**ã§è¡¨ã—ã€`TopicsFor<å…ƒPOCO>(series)` ã§ä¸€æ„ã«å¾©å…ƒã€‚  
- ã“ã‚Œã§ã€Œå…ƒã®POCOã«è¨­å®šã™ã‚‹ã®ã§ã‚ã£ã¦ã€å…ˆã®POCOã«è¨­å®šã—ãªã„ã€ãŒå³å¯†ã«å®ˆã‚Œã¾ã™ã€‚

â±é€ä¿¡æ—¥æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰: [[REDACTED_PHONE]]:48
### user â€” 2025-08-20T12:00:54.166000+00:00

ãã†ã§ã¯ãªãã€å…ƒã®pocoã«è¨­å®šã™ã‚‹ã®ã§ã‚ã£ã¦ã€å…ˆã®pocoã«ã›ã¦ã„ã—ãªã„ã¨ã„ã†ã“ã¨
### assistant â€” 2025-08-20T12:00:55.800778+00:00

_(empty)_
### assistant â€” 2025-08-20T12:01:14.523307+00:00

_(empty)_
### system â€” 2025-08-20T12:04:24.725932+00:00

_(empty)_
### assistant â€” 2025-08-20T12:04:24.811016+00:00

ãªã‚‹ã»ã©ã€æ•´ç†ã—ã¾ã™ ğŸ‘  

- **å°ï¼ˆ`[TumblingTime]`ï¼‰ã¯å…ƒPOCOï¼ˆä¾‹: `DeDupRates`ï¼‰ã«ä»˜ã‘ã‚‹ã€‚**  
- **å‚ç…§ã™ã‚‹ã¨ãã¯å…ˆã®POCOï¼ˆä¾‹: è¶³`Rate`ï¼‰ã‹ã‚‰è¡Œã†ã€‚**  
- ã¤ã¾ã‚Šï¼šç”Ÿæˆæ™‚ã«ã€Œã“ã®è¶³ã¯ã©ã®å…ƒPOCOç”±æ¥ã‹ï¼Ÿã€ã‚’ **è¶³POCO â†” å…ƒPOCO ã®å¯¾å¿œè¡¨**ã§çµã³ä»˜ã‘ã€å…ˆPOCOã‹ã‚‰é¡ã£ã¦å…ƒPOCOã®å°ã‚’èª­ã‚€ã€ã¨ã„ã†æµã‚Œã€‚

---

# âœ… æœ€å°ã®ä»•çµ„ã¿

## å…ƒPOCO
```csharp
public sealed class DeDupRates
{
    public string Broker { get; set; } = "";
    public string Symbol { get; set; } = "";

    [TumblingTime] // Tumblingã®timeè»¸ã¯ã“ã‚Œã€ã¨æ˜ç¤º
    public DateTimeOffset Timestamp { get; set; }

    public decimal Bid { get; set; }
    public decimal Ask { get; set; }
}
```

## å…ˆPOCOï¼ˆè¶³ï¼‰
```csharp
public sealed class Rate   // 5åˆ†è¶³
{
    public string Broker { get; set; } = "";
    public string Symbol { get; set; } = "";
    public DateTimeOffset BucketStart { get; set; }

    public decimal Open  { get; set; }
    public decimal High  { get; set; }
    public decimal Low   { get; set; }
    public decimal Close { get; set; }
}
```

---

## é–¢é€£ä»˜ã‘ï¼ˆã©ã®å…ƒPOCOç”±æ¥ã‹ï¼‰
ç”Ÿæˆã‚³ãƒ¼ãƒ‰ã®å´ã§ã€Œ`Rate` ã¯ `DeDupRates` ã‹ã‚‰æ¥ã¦ã„ã‚‹ã€ã¨1å›ã ã‘è¨˜éŒ²ã™ã‚Œã°ã‚ˆã„ã€‚  
ä¾‹ï¼šè¾æ›¸ã§ä¿æŒ  

```csharp
static readonly Dictionary<Type, Type> lineage = new()
{
    { typeof(Rate), typeof(DeDupRates) }
};
```

---

## å‚ç…§ã™ã‚‹ã¨ãï¼ˆä½¿ã†å´ï¼‰
```csharp
static PropertyInfo ResolveTumblingTimeProperty<TBar>()
{
    if (!lineage.TryGetValue(typeof(TBar), out var sourceType))
        throw new InvalidOperationException($"No source mapping for {typeof(TBar).Name}");

    var prop = sourceType.GetProperties()
        .FirstOrDefault(p => Attribute.IsDefined(p, typeof(TumblingTimeAttribute)));

    if (prop == null)
        throw new InvalidOperationException($"No TumblingTime property on {sourceType.Name}");

    return prop;
}
```

åˆ©ç”¨ä¾‹ï¼š
```csharp
// å‚ç…§ã™ã‚‹ã®ã¯è¶³ã®POCO (Rate)
var timeProp = ResolveTumblingTimeProperty<Rate>();
Console.WriteLine($"{timeProp.Name} from {timeProp.DeclaringType?.Name}");
// â†’ "Timestamp from DeDupRates"
```

---

# ğŸ¯ ãƒã‚¤ãƒ³ãƒˆ
- **è¨­å®šã™ã‚‹ã®ã¯å…ƒPOCOã®ã¿** â†’ `DeDupRates.Timestamp` ã«ã ã‘ `[TumblingTime]`ã€‚  
- **å‚ç…§ã¯å…ˆPOCOã‹ã‚‰** â†’ åˆ©ç”¨è€…ã¯ `Rate` ã—ã‹æ„è­˜ã—ãªã„ã€‚å†…éƒ¨ã§ lineage ã‹ã‚‰å…ƒPOCOã‚’ãŸã©ã£ã¦è§£æ±ºã€‚  
- **æœ€å°ã®å°ã¯1ã¤ã ã‘**ã€‚è¶³POCOã«ã¯ä½™è¨ˆãªå±æ€§ã‚’ä»˜ã‘ãªã„ã€‚  

---

ğŸ‘‰ å¸ä»¤ã«ç¢ºèªã§ã™ï¼š  
ã“ã®ã€Œ**å°ã¯å…ƒPOCOã«1ã¤ã ã‘ã€åˆ©ç”¨ã¯å¸¸ã«å…ˆPOCOã‹ã‚‰**ã€ã¨ã„ã†åˆ†é›¢ã€ã‚¤ãƒ¡ãƒ¼ã‚¸é€šã‚Šã§ã™ã‹ï¼Ÿ  

â±é€ä¿¡æ—¥æ™‚: [[REDACTED_PHONE]]:00ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰
### user â€” 2025-08-20T12:04:28.393000+00:00

å‚ç…§ã™ã‚‹ã¨ãã¯å…ˆã®pocoã‚’åŸºã«ã™ã‚‹
### assistant â€” 2025-08-20T12:06:17.749980+00:00

äº†è§£ã€‚ãƒã‚¤ãƒ³ãƒˆã¯ã“ã†æ•´ç†ã§ãã¾ã™ã€‚

- **å°ã¯â€œå…ƒPOCOâ€ã«ã ã‘**ä»˜ã‘ã‚‹ï¼ˆTumbling ã§ä½¿ã† time ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ï¼‰ã€‚  
- **å‚ç…§ï¼ˆä½¿ã†å´ï¼‰ã¯â€œå…ˆPOCOâ€ï¼ˆï¼è¶³POCOï¼‰ã‚’èµ·ç‚¹**ã«ã™ã‚‹ã€‚  
- **ä½œã‚‹å´ã¨ä½¿ã†å´ã¯åˆ¥ãƒ—ãƒ­ã‚»ã‚¹**ãªã®ã§ã€**å¯¾å¿œè¡¨ã¯æŒãŸãªã„**ã€‚  
- ãã‚Œã§ã‚‚ **Final/Live ã‚’ä¸€æ„ã«çµã³ã¤ã‘ã‚‰ã‚Œã‚‹**å¿…è¦ãŒã‚ã‚‹ã€‚

# è§£æ±ºï¼šãƒˆãƒ”ãƒƒã‚¯å‘½åã‚’ã€Œå…ˆPOCOåãƒ™ãƒ¼ã‚¹ã€ã«å›ºå®šã™ã‚‹
å¯¾å¿œè¡¨ã‚’è¦ã—ãªã„ã‚ˆã†ã«ã€**ãƒˆãƒ”ãƒƒã‚¯ï¼ˆã‚·ãƒªãƒ¼ã‚ºåï¼‰ã‚’å…ˆPOCOåã§æ±ºã‚æ‰“ã¡**ã—ã¾ã™ã€‚  
ä½œã‚‹å´ãƒ»ä½¿ã†å´ã§â€œåŒã˜è¦ç´„â€ã ã‘å…±æœ‰ã™ã‚Œã°ã€**å…ˆPOCOã ã‘ã§åˆ°é”**ã§ãã¾ã™ã€‚

## è¦ç´„ï¼ˆæœ€å°ãƒ»ååˆ†ï¼‰
```
bars.{barPoco}.{series}.{stage}
```
- `{barPoco}` â€¦ å…ˆPOCOã®å‹åã‚’ lower-kebab ç­‰ã«æ­£è¦åŒ–ï¼ˆä¾‹: `Rate` â†’ `rate`ï¼‰  
- `{series}` â€¦ `"5m" | "1h" | "1d" | "1M"`ï¼ˆæœˆã¯å¤§æ–‡å­— Mï¼‰  
- `{stage}` â€¦ `"live" | "final"`

> ä¾‹  
> `bars.rate.5m.final`  
> `bars.rate.5m.live`  
> `bars.rate.1h.final`
### ä½œã‚‹å´ï¼ˆProducerï¼‰
- **å…ƒPOCO**ã«ã ã‘ä»˜ã„ã¦ã„ã‚‹ `[TumblingTime]` ã‚’è¦‹ã¦ time è»¸ã‚’å–å¾—  
- ã©ã® `{series}` ã‚’ç”Ÿæˆã™ã‚‹ã‹ã¯æ§‹æˆã§æ±ºå®š  
- å‡ºåŠ›ã¯ä¸Šã® **è¦ç´„ã©ãŠã‚Š**ã®ãƒˆãƒ”ãƒƒã‚¯ã¸
### ä½¿ã†å´ï¼ˆConsumerï¼‰
- **å…ˆPOCOå‹**ã ã‘çŸ¥ã£ã¦ã„ã‚Œã° OKï¼ˆå¯¾å¿œè¡¨ä¸è¦ï¼‰  
- å–ã‚ŠãŸã„ `{series}` ã¨ `{stage}` ã‚’é¸ã‚“ã§ã€**è¦ç´„ã§ãƒˆãƒ”ãƒƒã‚¯åã‚’åˆæˆ**

```csharp
static (string live, string final) TopicsForBar<TBar>(string series)
{
    var bar = typeof(TBar).Name;                 // "Rate"
    var barKey = bar.ToLowerInvariant();         // "rate"ï¼ˆæ­£è¦åŒ–ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§çµ±ä¸€ï¼‰
    var baseName = $"bars.{barKey}.{series}";
    return ($"{baseName}.live", $"{baseName}.final");
}

// ä½¿ã†å´ï¼ˆå‚ç…§ã¯å…ˆPOCO = Rate èµ·ç‚¹ï¼‰
var (live, final) = TopicsForBar<Rate>("5m");
// => "bars.rate.5m.live", "bars.rate.5m.final"
var rows = await Open(final).ToListAsync(new() { "OANDA", "USDJPY" });
```

## ã“ã‚Œã§æº€ãŸã™è¦ä»¶
- **å°ã¯å…ƒPOCO**ã«ã®ã¿ï¼ˆTumbling ã® time æŒ‡å®šï¼‰  
- **å‚ç…§ã¯å…ˆPOCO**ã‹ã‚‰ï¼ˆå‹åâ†’è¦ç´„ãƒˆãƒ”ãƒƒã‚¯ã€‚**å¯¾å¿œè¡¨ä¸è¦**ï¼‰  
- **ãƒ—ãƒ­ã‚»ã‚¹åˆ†é›¢OK**ï¼šåˆæ„ã™ã‚‹ã®ã¯â€œå‘½åè¦ç´„â€ã ã‘  
- **åˆ©ç”¨è€…ç›®ç·šã®æœ€å°**ï¼šä½¿ã†å´ã¯ `Rate` ã¨ `"5m"/"final"` ã‚’é¸ã¶ã ã‘

å¿…è¦ãªã‚‰ã€`TypeName â†’ kebab/snake` ã®æ­£è¦åŒ–é–¢æ•°ã¨ã€`series` ã®ãƒãƒªãƒ‡ãƒ¼ã‚¿ï¼ˆ`1m,5m,1h,1d,1M` å—ç†ï¼‰ã‚’æœ€å°ã‚¹ãƒ‹ãƒšãƒƒãƒˆã§ç”¨æ„ã—ã¾ã™ã€‚  

â±é€ä¿¡æ—¥æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰: [[REDACTED_PHONE]]:09
### system â€” 2025-08-20T12:06:18.179170+00:00

_(empty)_
### system â€” 2025-08-20T12:06:18.187483+00:00

_(empty)_
### user â€” 2025-08-20T12:06:20.285000+00:00

ä½œã‚‹å´ã¨ä½¿ã†å´ã¯ç•°ãªã‚‹ãƒ—ãƒ­ã‚»ã‚¹ãŒä¸€èˆ¬ãªã®ã§ã€å¯¾å¿œè¡¨ã¯ä½œã‚Œãªã„
### assistant â€” 2025-08-20T12:06:22.406683+00:00

_(empty)_
### assistant â€” 2025-08-20T12:07:02.194113+00:00

_(empty)_
### system â€” 2025-08-20T20:39:13.792192+00:00

_(empty)_
### assistant â€” 2025-08-20T20:39:13.874409+00:00

ã©ã†ã„ãŸã—ã¾ã—ã¦ï¼  
ã€Œå…ƒPOCOã«å°ã€ã€Œå‚ç…§ã¯å…ˆPOCOã€ã€Œè¦ç´„ã§çµã³ä»˜ã‘ã€â”€â”€ã“ã®æ•´ç†ã§ã ã„ã¶ã‚·ãƒ³ãƒ—ãƒ«ã«è½ã¡ç€ãã¾ã—ãŸã­ ğŸ‘  

ã¾ãŸå…·ä½“çš„ãªã‚³ãƒ¼ãƒ‰æœ€å°åŒ–ã‚„ã€å®Ÿéš›ã®åˆ©ç”¨ã‚µãƒ³ãƒ—ãƒ«ã‚’æ•´ãˆã‚‹ã¨ãã‚‚ãŠæ‰‹ä¼ã„ã§ãã¾ã™ã€‚  

â±é€ä¿¡æ—¥æ™‚: [[REDACTED_PHONE]]:12ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰
### user â€” 2025-08-20T20:39:18.945000+00:00

OK ã‚ã‚ŠãŒã¨ã†ã€‚
### assistant â€” 2025-08-20T20:40:08.572537+00:00

ã„ã„è³ªå•ã§ã™ ğŸ‘  
ã“ã“ã¾ã§ã§ **ã€Œå…ˆPOCOã‹ã‚‰ Final/Live ã‚’è¦ç´„ã§çµã³ä»˜ã‘ã‚‰ã‚Œã‚‹ã€**ã¨ã“ã‚ã¾ã§ã¯å›ºã¾ã‚Šã¾ã—ãŸã€‚  
æ¬¡ã¯ã€Œ**åˆ©ç”¨è€…ãŒã©ã®è¶³ã‚’é¸ã¶ã‹**ã€ã‚’ã©ã†è¡¨ç¾ã™ã‚‹ã‹ã€ã§ã™ã­ã€‚  

---

# âœ… æœ€å°ã®è¶³é¸æŠè¡¨ç¾

## 1) ç›´çƒã‚·ãƒ³ãƒ—ãƒ«ï¼šå¼•æ•°ã§ã‚·ãƒªãƒ¼ã‚ºã‚’æ¸¡ã™
```csharp
var (live, final) = TopicsForBar<Rate>("5m");
var rows = await Open(final).ToListAsync(new(){ "OANDA", "USDJPY" });
```

- **è¶³é¸æŠ = `"5m"` ã¨ã„ã†æ–‡å­—åˆ—**ã ã‘ã€‚  
- ä¸–ç•Œæ¨™æº–ï¼ˆBinance/TradingView ç­‰ï¼‰ã®æ…£ç¿’ã«åˆã‚ã›ã‚‹ï¼š`1m, 5m, 15m, 1h, 1d, 1M`ã€‚  
- é–¢æ•°åã¯å¢—ãˆãªã„ã€‚POCOã‚‚å¤‰ãˆãªã„ã€‚  

---

## 2) ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µé¢¨ï¼ˆç¾ã—ãï¼‰
```csharp
await Rate["5m", "final"].ToListAsync(new(){ "OANDA", "USDJPY" });
```

- `Rate[...]` ã§è¶³ã¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¦ `Open()` ä»£ã‚ã‚Šã«è¿”ã™ã€‚  
- å†…éƒ¨ã¯ãŸã ã®ç³–è¡£ï¼š`TopicsForBar<Rate>("5m").final` ã‚’å‘¼ã¶ã ã‘ã€‚  
- **åˆ©ç”¨è€…ç›®ç·šã§ç›´æ„Ÿçš„**ï¼ˆã€ŒRateã®5åˆ†è¶³Finalã€ï¼‰ã€‚  

---

## 3) æ–‡è„ˆæŒ‡å®šï¼ˆDSLãƒ©ã‚¤ã‚¯ï¼‰
```csharp
await Bars<Rate>.At("5m").Final.ToListAsync(new(){ "OANDA", "USDJPY" });
```

- `Bars<Rate>` ã¨ã„ã†é™çš„å…¥å£ã‚’ç”¨æ„ã€‚  
- `.At("5m")` ã§è¶³ã€`.Final` / `.Live` ã§ã‚¹ãƒ†ãƒ¼ã‚¸ã€‚  
- ã“ã¡ã‚‰ã‚‚å†…éƒ¨ã¯è¦ç´„ååˆæˆã™ã‚‹ã ã‘ã€‚  

---

# ğŸ¯ ã¾ã¨ã‚
- **æœ€å°ã§æ¸ˆã¾ã™ãªã‚‰ #1**ï¼ˆæ–‡å­—åˆ—æ¸¡ã— `"5m"`ï¼‰ã€‚  
- **ç¾ã—ãè¦‹ã›ãŸã„ãªã‚‰ #2**ï¼ˆã‚¤ãƒ³ãƒ‡ã‚¯ã‚µï¼‰ã‚„ #3ï¼ˆDSLãƒ©ã‚¤ã‚¯ï¼‰ã€‚  
- ã„ãšã‚Œã‚‚ã€ŒPOCOåï¼‹seriesï¼‹stage â†’ è¦ç´„ãƒˆãƒ”ãƒƒã‚¯ã€ã®æ çµ„ã¿ã¯åŒã˜ã€‚  

---

ğŸ‘‰ å¸ä»¤ã€åˆ©ç”¨è€…ãŒä¸€ç•ªâ€œç¾ã—ã„â€ã¨æ€ãˆã‚‹ã®ã¯ï¼š  
- ç´ ç›´ãª `"5m"` å¼•æ•°ï¼Ÿ  
- `Rate["5m","final"]` ã®ã‚¤ãƒ³ãƒ‡ã‚¯ã‚µé¢¨ï¼Ÿ  
- ãã‚Œã¨ã‚‚ `Bars<Rate>.At("5m").Final` ã®DSLé¢¨ï¼Ÿ  

â±é€ä¿¡æ—¥æ™‚ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰: [[REDACTED_PHONE]]:20
### user â€” 2025-08-20T20:40:13.628000+00:00

ã§ã€è¶³ã‚’é¸æŠã™ã‚‹è¡¨ç¾ã¯ï¼Ÿ
