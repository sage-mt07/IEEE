---
conversation_id: "6713d2f1-0160-8007-80db-f81aa6c08191"
title: "JMeter DataDog APIテスト"
create_time: 1729352433.214321
update_time: 1729352572.324154
language_guess: "en"
num_messages: 16
part_index: 1
part_count: 1
---

### system — 2024-10-19T15:40:33.214321+00:00

_(empty)_

### user — 2024-10-19T15:40:33.225115+00:00

Azure Load Testingで使用するスクリプトを作成したい
対象はWebAPIを使用するWebアプリで同時10000ユーザーのテストをおこないたい
WebAPIは自作している。DataDog

### assistant — 2024-10-19T15:40:37.880968+00:00

_(empty)_

### assistant — 2024-10-19T15:40:37.881261+00:00

The user wants to create a script for Azure Load Testing, targeting a web application that uses a self-made WebAPI, to test with 10,000 concurrent users.

### tool — 2024-10-19T15:40:37.881377+00:00

Model set context updated.

### assistant — 2024-10-19T15:40:37.881468+00:00

To create a script for Azure Load Testing with a target of 10,000 concurrent users for your web application using a custom WebAPI and logging with DataDog, you can use JMeter to define your load test scenario and then integrate it with Azure Load Testing. Here's a high-level guide to set this up:

### Prerequisites:
- **JMeter**: Set up locally to create and test your scripts.
- **Azure Load Testing Resource**: Provisioned in your Azure account.
- **DataDog Setup**: Already configured for logging from your application.

### Step-by-Step Guide:

1

### user — 2024-10-19T15:40:57.650585+00:00

DataDogは使用できる
おすすめの作成方法は

### assistant — 2024-10-19T15:41:02.789147+00:00

_(empty)_

### assistant — 2024-10-19T15:41:02.789249+00:00

If DataDog is available for logging, you can integrate it seamlessly with Azure Load Testing and JMeter to collect and analyze metrics during the test. Here’s a recommended approach to create your load testing script and integrate it effectively:

### Step 1: Prepare Your JMeter Script
1. **Install JMeter** on your local machine.
2. **Create a JMeter Test Plan**:
   - **Thread Group**: Set the thread group to simulate 10,000 users. You may want to ramp up users gradually to avoid overwhelming your server too quickly. For example:
     - Number of Threads (Users): 10,000
     - Ramp-Up Period (Seconds): 600 (this will gradually add users over 10 minutes).
   - **HTTP Request Sam

### user — 2024-10-19T15:41:05.512403+00:00

日本語で

### assistant — 2024-10-19T15:41:22.173281+00:00

DataDogを使用できる場合、Azure Load TestingとJMeterを組み合わせて、テスト中のメトリクスを収集・分析する方法が効果的です。以下は、おすすめの負荷テストスクリプト作成と統合の手順です。

### 手順1: JMeterスクリプトの準備
1. **JMeterのインストール**:
   - ローカル環境にJMeterをインストールします。
2. **JMeterテストプランの作成**:
   - **スレッドグループ**を設定して、10,000ユーザーをシミュレートします。急激な負荷を避けるために、ユーザーを徐々に増加させるのがおすすめです。たとえば:
     - スレッド数（ユーザー数）: 10,000
     - ランプアップ期間（秒）: 600（10分かけてユーザーを徐々に増やす）
   - **HTTPリクエストサンプラー**:
     - WebAPIに対してリクエストを送る設定を行います。リクエストメソッド（GET/POSTなど）、URL、パラメータなどを指定します。
   - **CSV Data Set Config**:
     - 大量のデータを使用する場合、CSVファイルを使ってパラメータを設定できます。例えば、ユーザーIDや認証トークンをCSVファイルから読み込む設定ができます。
   - **リスナー**（例: View Results Tree、Summary Reportなど）:
     - ローカルでテストを実行し、結果を確認します。

3. **テストスクリプトの検証**:
   - スモールスケール（例えば、10〜50ユーザー）でテストを実行し、スクリプトが正しく動作するか確認します。
   - DataDogでログが適切に収集されていることも確認します。

### 手順2: Azure Load Testingへのスクリプトアップロード
1. **Azure Load Testingリソースの作成**:
   - AzureポータルでAzure Load Testingリソースを作成します。
2. **JMeterスクリプトのアップロード**:
   - 作成したJMeterスクリプトをAzure Load Testingにアップロードします。
   - テストの設定で「並列ユーザー数」を10,000に設定し、テストの実行時間やランプアップ期間を調整します。

### 手順3: DataDogとの連携
1. **ログとメトリクスの送信設定**:
   - DataDogエージェントがWebAPIサーバーにインストールされている場合、カスタムメトリクスやログを収集できます。
   - WebAPIのエラーレート、レスポンスタイムなど

### user — 2024-10-19T15:41:37.688995+00:00

テストプランの作成をサポートしてほしい

### assistant — 2024-10-19T15:41:50.988995+00:00

JMeterでのテストプランの作成をサポートします。以下に、10,000ユーザーを対象としたWebAPIの負荷テストプランの詳細な手順を紹介します。これに従って、効率的にテストプランを作成しましょう。

### JMeterテストプランの作成手順

#### 1. JMeterを起動
- ローカルでJMeterを起動します。
- `bin`フォルダ内の`jmeter.bat`（Windows）または`jmeter`（Mac/Linux）を実行してGUIを立ち上げます。

#### 2. テストプランの作成
- メインメニューから`File` > `New`を選択して、新しいテストプランを作成します。

#### 3. スレッドグループの追加
- テストプランを右クリックして、`Add` > `Threads (Users)` > `Thread Group`を選択します。
- **Thread Group**は、ユーザーの数やリクエストの設定を行う場所です。

  - **Number of Threads (users)**: `10000`（同時にシミュレートするユーザー数）
  - **Ramp-Up Period (in seconds)**: `600`（ユーザーを10分かけて徐々に増やす）
  - **Loop Count**: `1`（各ユーザーが1回リクエストを送信する）

#### 4. HTTPリクエストの設定
- スレッドグループを右クリックして、`Add` > `Sampler` > `HTTP Request`を選択します。
- **HTTP Request**の設定画面で、以下を入力します。

  - **Server Name or IP**: WebAPIのホスト名（例: `api.example.com`）
  - **Path**: APIのパス（例: `/api/data`）
  - **Method**: `GET`または`POST`（APIのメソッドに応じて選択）
  - **Parameters**（POSTリクエストの場合）: 必要なパラメータを追加

#### 5. CSV Data Set Configの設定（

### user — 2024-10-19T15:42:17.337521+00:00

一般的な使用方法ではなく、自作のwebapiとdatadogを使用できる点を考慮して回答を

### assistant — 2024-10-19T15:42:51.147868+00:00

自作のWebAPIとDataDogを利用したJMeterのテストプラン作成について、具体的な手順を紹介します。特にDataDogとの連携を考慮し、APIの負荷テストを行いながらメトリクスをDataDogでモニタリングする方法に焦点を当てます。

### JMeterテストプラン作成手順（DataDog対応）

#### 前提条件
- **自作WebAPI**: ローカルまたはクラウド上にデプロイされていること。
- **DataDogエージェント**: WebAPIが動作しているサーバーにインストール済みであること。
- **DataDog APIキー**: JMeterからカスタムメトリクスを送信する場合に使用します。

#### 1. JMeterのインストールと起動
- JMeterの公式サイトからJMeterをダウンロードし、ローカル環境にインストールします。
- `bin`フォルダ内の`jmeter.bat`（Windows）または`jmeter`（Mac/Linux）を実行してGUIを起動します。

#### 2. テストプランの作成と設定
- JMeterのGUIで、`File` > `New`を選択して、新しいテストプランを作成します。
- テストプランに名前を付けて、以下の設定を追加していきます。

#### 3. スレッドグループの追加と設定
- テストプランを右クリックし、`Add` > `Threads (Users)` > `Thread Group`を選択します。
- **スレッドグループ**で、負荷テストのユーザー数やリクエスト数を設定します。
  
  - **Number of Threads (users)**: `10000`（同時ユーザー数）
  - **Ramp-Up Period (in seconds)**: `600`（10分間でユーザー数を0から10,000に増加）
  - **Loop Count**: `1`（各ユーザーが1回リクエストを送信する）

#### 4. HTTPリクエストの設定
- スレッドグループを右クリックし、`Add` > `Sampler` > `HTTP Request`を選択します。
- **HTTP Request**で、以下の設定を行います。

  - **Server Name or IP**: WebAPIのホスト名（例: `api.example.com`）
  - **Path**: APIのエンドポイントパス（例: `/api/data`）
  - **Method**: `POST`や`GET`（WebAPIに対応するリクエストメソッド）
  - **Parameters**: リクエストに必要なパラメータを追加（例: `userId`、`token`など）
  - **Headers**: 認証トークンが必要な場合、`Authorization`ヘッダーを設定します。

#### 5. DataDogへのカスタムメトリクス送信
- DataDogでWebAPIのパフォーマンスをモニタリングするために、JMeterからカスタムメトリクスを送信する方法を設定します。
- **Backend Listener**を使用して、DataDogへデータを送信する設定を追加します。

  - スレッドグループを右クリックして、`Add` > `Listener` > `Backend Listener`を選択。
  - **Backend Listener Implementation**で`org.apache.jmeter.visualizers.backend.datadog.DatadogBackendListenerClient`を選択（DataDog用のJMeterプラグインが必要な場合があります）。
  - **API Key**にDataDogのAPIキーを入力します。
  - **Custom Metrics**として、JMeterの応答時間やリクエスト数をDataDogに送信します。

#### 6. CSV Data Set Configの利用（認証情報や動的データ）
- 大量のユーザー認証情報やテストデータを扱う場合、**CSV Data Set Config**を利用します。
- スレッドグループを右クリックし、`Add` > `Config Element` > `CSV Data Set Config`を選択します。

  - **Filename**: ユーザー情報を格納したCSVファイルのパスを指定します（例: `user_data.csv`）。
  - **Variable Names**: CSVファイルのカラム名（例: `userId, token`）。
  - これにより、各リクエストで異なるユーザーIDや認証トークンを使用できます。

#### 7. リスナーの追加とローカルでの検証
- テスト結果を確認するため、以下のリスナーを追加します。
  - **View Results Tree**: 詳細なリクエストとレスポンスを確認。
  - **Summary Report**: 応答時間やスループットを確認。
- 少人数（例: 100ユーザー）でテストを実行し、設定やレスポンスを確認します。

#### 8. Azure Load Testingへのアップロード
- 作成したJMeterスクリプト（`.jmx`ファイル）をAzure Load Testingにアップロードします。
- **Test Configuration**で並列ユーザー数を10,000に設定し、ランプアップ期間も適宜設定します。
- テストを実行し、DataDogでAPIのパフォーマンスやエラーレートをリアルタイムでモニタリングします。

#### 9. DataDogでのメトリクスモニタリング
- DataDogで、以下のメトリクスをモニタリングします。
  - **APIの応答時間**: パフォーマンスのボトルネックを検出。
  - **エラーレート**: サーバーが負荷に耐えられない場合のエラーを特定。
  - **リクエスト数の変動**: 同時リクエストの増減に対するAPIの挙動を確認。

#### 10. 調整と最適化
- テスト結果を基に、以下の調整を行います。
  - ランプアップ期間の見直し（急激な負荷を避けるため）。
  - APIのスケールアウト設定（必要に応じてサーバーのリソースを追加）。
  - DataDogのアラート設定（異常な応答時間やエラーレートに対してアラートを設定）。

### まとめ
上記の手順に従うことで、JMeterを使って自作WebAPIの大規模な負荷テストを実施し、DataDogで詳細なメトリクスをモニタリングできます。これにより、パフォーマンスボトルネックの特定やスケーリングの調整が容易になります。必要に応じて、スクリプトや設定の詳細もサポートしますので、お気軽にご相談ください。
