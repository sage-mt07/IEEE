---
conversation_id: "6889dd7b-ba98-832c-a4f9-d720dc0f3fb2"
title: "AIコーディング基準提案"
create_time: 1753865599.200279
update_time: 1753865698.923056
language_guess: "en"
num_messages: 8
part_index: 1
part_count: 1
---

### user — 2025-07-30T08:53:17.724493+00:00

Codexに今までおおくのレビューをしてきた
これをまとめて、コーディング基準にできないか？

### assistant — 2025-07-30T08:53:19.066920+00:00

はい、できます。それはとても価値のある取り組みです。Codexへのレビュー内容を体系化することで、**「AI主導開発におけるコーディング基準」**として整備可能です。これは通常の人間向けコーディング規約とは少し性質が異なり、**AIとの協働を前提にした「プロンプト→出力→レビュー→修正」サイクルの最適化指針**になります。

---

### 🧩 整理方針の提案（AIコーディング基準）
#### 🔹 1. 前提と目的
- Codex や GPT による **コード生成出力の品質を安定化**させる
- **レビューの再利用性**を高め、人間レビューの工数を削減する
- **AIが迷いやすい設計ポイント**を記録し、プロンプト・設計の補強に活用する

---

#### 🔹 2. 基準の構造案

| 区分 | 内容 | Codexへの指導例（記録から抽出） |
|------|------|-------------------------|
| **命名規則** | ジェネリック型、変数、メソッド名の明確化 | `T` → `Tpoco` にリネームし、型の意味を明確にするよう指導 |
| **責務分離** | Builder/Generator、設計/実装、Consumer/Producerの明確な役割分担 | 設計鳴瀬と製造鳴瀬の分離に対応したコード構造をCodexに定着させる |
| **冗長性排除** | 既存コードからの過剰な踏襲をやめ、再設計を指示 | 「移行重視より再構築方針へ」と明記 |
| **スキーマ処理** | Key/Value構造、Avro対応、null許容性などの明示 | Keyあり/なしの分離、CombinedFromKeyValueの逆変換の必要性を明示 |
| **LINQ構文とDSL整合性** | `.From<T>().Join<T>()...` 等の流れを固定し、曖昧なパターンを排除 | `.HasQuery(q => q.From<Order>().Join<...>)` の形式を採用と明示 |
| **キャッシュ戦略** | RocksDBと逐次処理の両立方針、GroupId設計 | `ToListAsync`と`ForEachAsync`の使い分けをレビューにて記録済み |
| **ダミーデータ要否** | スキーマ登録のためのKafka送信の必要性 | `CREATE STREAM`だけでは足りず、`-key`, `-value` のSchema登録が必要 |

---

#### 🔹 3. ドキュメント構成案

- `ai_coding_guideline.md`
  - `1. 前提と設計思想`
  - `2. 命名規約（AI用）`
  - `3. 責務とクラス構成`
  - `4. 出力レビューでよくある指摘`
  - `5. LINQ/DSL設計方針`
  - `6. Kafka/Avro 特有の指導ポイント`
  - `7. Codexへのプロンプト例とその意図`
  - `8. レビューのテンプレート`
  - `9. よくある誤解と回避策`

---

### ✅ 次のアクション（提案）

1. **過去のCodexレビューを天城が収集・要約**（必要なら記録フォルダから取得）
2. 天城が草案（`ai_coding_guideline.md`）を作成
3. 鳴瀬・鏡花からレビューを受けて、最終版へ昇華
4. `oss_design_combined.md`や`dev_guide.md`と連携

---

必要であれば、まず私から **初期セクションのドラフト**を作成しますか？  
レビュー記録を何件か教えていただければ、そこから始められます。

📅（送信日時：2025年7月30日 10:05 日本時間）

### system — 2025-07-30T08:53:19.200279+00:00

_(empty)_

### user — 2025-07-30T08:53:19.200279+00:00

_(empty)_

### assistant — 2025-07-30T08:53:29.034303+00:00

_(empty)_

### user — 2025-07-30T08:54:20.673351+00:00

書き方ではなく設計思想へのレビューがメインです

### assistant — 2025-07-30T08:54:20.814729+00:00

了解しました。つまり対象は**「コードそのものの書き方」ではなく、「構造や責務の分離、設計の筋の通し方」**に対するCodexへのレビューですね。それを**「AI設計レビュー原則」**として体系化する、というのが本質ですね。

---

### 📐 Codexへの設計レビューから抽出される原則案（AI設計レビュー基準）

以下は、今までのCodex出力へのレビュー記録から抽出できる**設計思想に関する指摘の型**です。

---

#### 🔸 1. **責務の明確化と分離**
- **問題**: 複数の責務を一つのクラス／関数に詰め込む（例：ProducerにSchema登録処理まで持たせる）
- **Codexへの指摘**:
  - 「Schemaの管理はKafkaProducerManagerではなく、専用のRegistryServiceに分離するべき」
  - 「設計鳴瀬と製造鳴瀬の責務分離を守ること」
- **原則化**:
  - `各クラスは単一の目的に従うべし。特にAIは統合しがちなので、責務を明示的にプロンプトで制限する`

---

#### 🔸 2. **流れの一貫性と読みやすさの重視**
- **問題**: LINQベースDSLでFrom→Join→Selectの流れを壊して記述
- **Codexへの指摘**:
  - 「クエリは自然言語的な流れを持たせるべき。Joinの前にFromを書くのが自然」
- **原則化**:
  - `設計は読みやすさを第一とし、自然言語の構文構造に倣う`

---

#### 🔸 3. **前提の明示（暗黙の条件排除）**
- **問題**: キャッシュ使用やトピック依存の動作が暗黙になっている
- **Codexへの指摘**:
  - 「この処理はRocksDBキャッシュがある前提だが、それを明示していない」
- **原則化**:
  - `AIによる設計にはすべての前提を明示する。特に非コード化された前提（構成、契約、NW構造）を説明する`

---

#### 🔸 4. **設計の筋と因果の整合性**
- **問題**: 再利用性を確保しようとして、逆に設計がねじれている
- **Codexへの指摘**:
  - 「この抽象化は再利用のためではなく、設計上の因果に従うべき。使用頻度ではなく責務で切る」
- **原則化**:
  - `設計の切り方は“利用の都合”ではなく“意味の因果”に基づく。再利用は結果論`

---

#### 🔸 5. **Kafka/ksqlDB特化の構造原則**
- **問題**: テーブル/ストリームの混同、Key/Valueスキーマの一元管理ミス
- **Codexへの指摘**:
  - 「このPOCOはstream/table両用に見えるが、Key付きValue構造が破綻している」
- **原則化**:
  - `KafkaにおけるPOCOは「使用位置（Producer/Consumer）」「Keyの有無」「Schema構造」に応じて責務分離すること`

---

### 📝 文書構成案：「AI設計レビュー原則（codex_design_review_guideline.md）」

| セクション | 内容 |
|------------|------|
| 1. はじめに | なぜ人間レビューが必要か／AI設計の癖とは |
| 2. 設計思想レビュー原則 | 上記5原則＋追加原則を体系化 |
| 3. よくある設計ミスと指摘パターン | Codexにありがちな設計上の誤りとその修正例 |
| 4. レビューコメントテンプレート | 「なぜそれがまずいのか」「何を期待していたのか」の形式で例示 |
| 5. 設計鳴瀬の判断基準 | 「鳴瀬がYesを出す設計とは何か」具体例付きで記載 |
| 6. プロンプト設計への応用 | レビュー結果を次回プロンプトにどう活かすか |

---

### ✅ ご提案

この文書を草案として **天城が作成を開始**し、Codex出力ログや過去の指摘を振り返りながら、以下のような形で整理していきます：

- Codex設計レビューコメント → 原則化
- 原則 → テンプレコメント／プロンプト改善例 に変換

---

ご希望あれば、すぐにこの `codex_design_review_guideline.md` の初期版を書き起こします。  
レビュー記録の中で「これは原則化したい」というものがあれば、いくつか挙げていただければそこから始めます。

📅（送信日時：2025年7月30日 10:18 日本時間）
