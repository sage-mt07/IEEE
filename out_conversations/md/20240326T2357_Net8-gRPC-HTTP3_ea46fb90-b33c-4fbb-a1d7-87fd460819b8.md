---
conversation_id: "ea46fb90-b33c-4fbb-a1d7-87fd460819b8"
title: "Net8 gRPC HTTP/3サンプル"
create_time: 1711497473.855134
update_time: 1711497524.613977
language_guess: "en"
num_messages: 4
part_index: 1
part_count: 1
---

### system — 2024-03-26T23:57:53.855134+00:00

_(empty)_

### user — 2024-03-26T23:57:53.855797+00:00

.net8でgrpcのhttp3 を使用するサンプル

### assistant — 2024-03-26T23:58:43.566738+00:00

.NET 8でgRPCのHTTP/3を使用するためのサンプルをお探しでしょうか。gRPCは、高性能なリモートプロシージャコール(RPC)フレームワークであり、HTTP/3のサポートを通じて、より効率的な通信を実現することが期待されます。このため、.NET 8環境でgRPCとHTTP/3を使用する例を提供いたします。ただし、実際のプロジェクトや環境に応じて細かい設定やコードの変更が必要になる場合があります。

以下は、.NET 8を使用してgRPCサーバーとクライアントをHTTP/3で動作させる基本的な例です。

### 前提条件

- .NET 8 SDKがインストールされていること。
- HTTP/3をサポートする環境（例えば、適切なネットワーク設定やOSのサポートが必要な場合があります）。

### gRPCサーバーのセットアップ

1. **gRPCサービスプロジェクトの作成**: `dotnet new grpc -n GrpcServiceHttp3`

2. **HTTP/3の有効化**: `appsettings.json`または`Program.cs`でHTTP/3を有効にします。`Program.cs`の例を以下に示します。

   ```csharp
   var builder = WebApplication.CreateBuilder(args);

   // その他の設定...

   builder.Services.AddGrpc();

   var app = builder.Build();

   app.MapGrpcService<GreeterService>();

   app.Run();
   ```

3. **Kestrelサーバーの設定**: `Program.cs`または`appsettings.json`にHTTP/3のサポートを追加します。ここでは`Program.cs`での設定例を示します。

   ```csharp
   builder.WebHost.ConfigureKestrel(options =>
   {
       options.ListenAnyIP(5001, listenOptions =>
       {
           listenOptions.UseHttps();
           listenOptions.Protocols = Microsoft.AspNetCore.Server.Kestrel.Core.HttpProtocols.Http1AndHttp2AndHttp3;
       });
   });
   ```

### gRPCクライアントのセットアップ

1. **gRPCクライアントプロジェクトの作成**: `dotnet new console -n GrpcClientHttp3`

2. **gRPCクライアントでのHTTP/3の使用**: `Program.cs`にgRPCクライアントをセットアップし、HTTP/3を使用して通信するようにします。

   ```csharp
   var httpHandler = new HttpClientHandler();
   // HTTP/3を明示的に指定
   httpHandler.VersionPolicy = HttpVersionPolicy.RequestVersionOrHigher;
   httpHandler.Version = new Version(3, 0);

   var channel = GrpcChannel.ForAddress("https://localhost:5001", new GrpcChannelOptions { HttpHandler = httpHandler });
   var client = new Greeter.GreeterClient(channel);
   ```

3. **サービスの呼び出し**: サーバーに対してgRPCリクエストを実行します。

   ```csharp
   var reply = await client.SayHelloAsync(new HelloRequest { Name = "World" });
   Console.WriteLine($"Greeting: {reply.Message}");
   ```

これらのステップを参考にして、.NET 8でgRPCとHTTP/3を使用する基本的なサンプルを構築することができます。プロジェクトの具体的な要件や設定に応じて、コードや設定を適宜調整してください。
