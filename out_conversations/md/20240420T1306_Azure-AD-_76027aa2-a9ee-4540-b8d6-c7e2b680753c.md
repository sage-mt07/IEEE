---
conversation_id: "76027aa2-a9ee-4540-b8d6-c7e2b680753c"
title: "Azure AD 認証の設定"
create_time: 1713618372.812759
update_time: 1713618614.659289
language_guess: "en"
num_messages: 10
part_index: 1
part_count: 1
---

### system — 2024-04-20T13:06:12.812759+00:00

_(empty)_

### user — 2024-04-20T13:06:12.813935+00:00

Blazor webassemblyをaspnet coreでホストし、認証にAzure Active Directoryを利用する前提で

### assistant — 2024-04-20T13:06:20.460351+00:00

Blazor WebAssembly を ASP.NET Core でホストし、Azure Active Directory (Azure AD) を用いて認証するための手順は以下のようになります。この設定により、安全な Web アプリケーションを作成し、企業環境や他の環境での利用に適した認証メカニズムを提供できます。

### 1. 必要なツールとパッケージのインストール
- **.NET SDK**: 最新

### user — 2024-04-20T13:06:45.740419+00:00

index.htmlのような静的ファイルをaspnet corede

### assistant — 2024-04-20T13:06:49.836681+00:00

ASP.NET Coreで静的ファイル（例えば`index.html`）を扱う方法について解説します。ASP.NET Coreはデフォルトで静的ファ

### user — 2024-04-20T13:07:30.457992+00:00

でblazor webassemblyと同時にホストする場合、認証方法を示せ

### assistant — 2024-04-20T13:08:35.795214+00:00

Blazor WebAssembly アプリケーションを ASP.NET Core と一緒にホストし、Azure Active Directory を使用して認証を実装する場合の手順を以下に示します。この設定では、サーバー側（ASP.NET Core）とクライアント側（Blazor WebAssembly）の両方で認証を扱います。

### プロジェクトのセットアップ
1. **プロジェクトの作成**: Visual Studio または .NET CLI を使用して、Blazor WebAssembly アプリケーションを含む ASP.NET Core プロジェクトを作成します。プロジェクトテンプレートには認証オプションを含めることができます。
   ```bash
   dotnet new blazorwasm --hosted --auth SingleOrg --client-id "Your_Client_ID" --tenant-id "Your_Tenant_ID"
   ```
   ここで `--hosted` オプションは、Blazor アプリケーションを ASP.NET Core アプリケーションでホストすることを意味します。`--auth SingleOrg` は Azure AD を使用するシングルテナントアプリケーションの認証を設定します。

### Azure AD の設定
2. **Azure AD アプリ登録**: Azure ポータルで新しいアプリケーション登録を行います。登録時にはリダイレクトURIを設定し、必要なAPIのアクセス許可（例えば、Microsoft Graph）を設定します。
3. **認証情報の取得**: アプリケーション (クライアント) ID、ディレクトリ (テナント) ID、クライアントシークレットを取得します。

### ASP.NET Core の設定
4. **Startup.cs の設定**:
   - `ConfigureServices` メソッドで、認証サービスを設定します。
     ```csharp
     public void ConfigureServices(IServiceCollection services)
     {
         services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)
                 .AddMicrosoftIdentityWebApi(Configuration.GetSection("AzureAd"));
         
         services.AddControllersWithViews();
         services.AddRazorPages();
     }
     ```
   - `Configure` メソッドで、認証ミドルウェアを有効にします。
     ```csharp
     public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
     {
         app.UseAuthentication();
         app.UseAuthorization();

         app.UseStaticFiles();
         app.UseRouting();

         app.UseEndpoints(endpoints =>
         {
             endpoints.MapRazorPages();
             endpoints.MapControllers();
             endpoints.MapFallbackToFile("index.html");
         });
     }
     ```

### Blazor WebAssembly の設定
5. **appsettings.json**:
   - `appsettings.json` ファイルに、Azure AD 認証の設定を含めます。
     ```json
     {
       "AzureAd": {
         "Authority": "https://login.microsoftonline.com/Your_Tenant_ID",
         "ClientId": "Your_Client_ID",
         "ValidateAuthority": true
       }
     }
     ```

6. **認証サービスの設定**:
   - `Program.cs` で、`Microsoft.AspNetCore.Components.WebAssembly.Authentication` パッケージを利用して認証サービスを設定します。
     ```csharp
     builder.Services.AddMsalAuthentication(options =>
     {
         builder.Configuration.Bind("AzureAd", options.ProviderOptions.Authentication);
         options.ProviderOptions.DefaultAccessTokenScopes.Add("https://graph.microsoft.com/User.Read");
     });
     ```

これで、Blazor WebAssembly アプリケーションと ASP.NET Core バックエンドの両方で Azure AD を使用した認証が設定され、セキュアな方法でリソースへのアクセスが管理されます。

### user — 2024-04-20T13:09:16.358518+00:00

認証にＭＳＡＬを設定する必要性について説明

### assistant — 2024-04-20T13:10:14.227199+00:00

MSAL（Microsoft Authentication Library）を使用することで、Azure Active Directory（Azure AD）やMicrosoftアカウントを通じた認証が容易になります。特に、Webアプリケーションやモバイルアプリケーションでの認証プロセスを簡単かつ安全に実装するためにMSALが推奨されます。以下に、MSALを使用することの主な利点をいくつか挙げます。

### 1. シンプルな認証フローの実装
MSALは、OAuth 2.0 および OpenID Connect (OIDC) プロトコルに基づいた認証フローを提供します。これにより、開発者は複雑な認証ロジックを自分で書く必要がなく、セキュリティが保証された方法で簡単に認証フローを統合できます。

### 2. トークン管理の自動化
MSALは、アクセストークンおよびリフレッシュトークンの取得、保存、更新を自動的に管理します。トークンの有効期限が切れた場合、MSALは自動的にリフレッシュトークンを使用して新しいアクセストークンを取得します。これにより、セッション管理が容易になり、ユーザー体験が向上します。

### 3. マルチプラットフォームサポート
MSALは、.NET、Java、JavaScript、Pythonなど複数のプログラミング言語とプラットフォームで使用可能です。これにより、異なる技術スタックを持つアプリケーション間での認証情報の共有や再利用が容易になります。

### 4. セキュリティの強化
MicrosoftはMSALを通じて、セキュリティ更新や新しい認証機能の提供を続けています。これにより、アプリケーションは常に最新のセキュリティ慣行を取り入れることが可能です。

### 5. 統合されたユーザー体験
MSALを使用することで、Microsoftのエコシステム（例えば、Azure、Office 365、OneDriveなど）との統合が容易になります。ユーザーは一度のログインで複数のサービスにアクセスできるため、煩雑な認証手続きを複数回行う必要がなくなります。

### 6. 条件付きアクセスのサポート
Azure ADと組み合わせることで、MSALは条件付きアクセスポリシーを利用して、アプリケーションへのアクセスをより細かく制御できます。例えば、デバイスのセキュリティステータスやアクセス場所に基づいて、アクセス許可や拒否を動的に決定できます。

これらの利点により、多くの現代的なアプリケーションでMSALの使用が推奨されており、複雑な認証要件にも柔軟に対応することができます。
