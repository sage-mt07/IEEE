---
conversation_id: "67bd2395-4ef4-8007-bd49-27a58ac26de3"
title: "C# Parallel非同期処理"
create_time: 1740448661.756318
update_time: 1740448685.844752
language_guess: "en"
num_messages: 6
part_index: 1
part_count: 1
---

### system — 2025-02-25T01:57:41.756318+00:00

_(empty)_

### system — 2025-02-25T01:57:41.756318+00:00

_(empty)_

### user — 2025-02-25T01:57:41.763452+00:00

C#のparallelで非同期処理を最大10並列で行いたい場合のコードを示せ

### tool — 2025-02-25T01:58:04.265403+00:00

**考慮中**

ユーザーが求めているのは、C#で非同期処理を最大10並列で行いたいということですね。それを実現するためには、Parallel.ForEachを使って、ParallelOptionsを設定し、MaxDegreeOfParallelismに10を指定すれば良さそうです。非同期タスクの並列実行を制限する方法としてはこれが適切だと思います。これで、最大10の並列非同期タスクが実行されますね。

**考慮中**

.NETのParallel.ForEachはデフォルトで同期的で、非同期処理には向いていません。非同期処理を並列で制御する場合、.NET 6で導入されたParallel.ForEachAsyncを使用するのが適切ですね。それにより非同期タスクを並列で実行できます。また、SemaphoreSlimを使って並列数制限をする方法もありますが、可能なら無駄な同期処理を避けたいところです。コードスニペットを作成する際は、Parallel.ForEachAsyncを活用する方向が良さそうです。

### assistant — 2025-02-25T01:58:04.265536+00:00

以下は、.NET 6以降で利用可能な Parallel.ForEachAsync を用いて、非同期処理を最大10並列で実行する例です。各タスクは非同期メソッド DoWorkAsync 内で処理され、ParallelOptions の MaxDegreeOfParallelism プロパティにより並列実行数を10に制限しています。

```csharp
using System;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;

class Program
{
    static async Task Main(string[] args)
    {
        // 処理対象のサンプルデータ
        var items = new List<int> { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 };

        // 最大並列数を10に設定
        var parallelOptions = new ParallelOptions
        {
            MaxDegreeOfParallelism = 10
        };

        // 非同期で各アイテムを処理
        await Parallel.ForEachAsync(items, parallelOptions, async (item, cancellationToken) =>
        {
            await DoWorkAsync(item);
        });
    }

    // 非同期処理の例
    static async Task DoWorkAsync(int item)
    {
        // 例として1秒待機
        await Task.Delay(1000);
        Console.WriteLine($"Item {item} processed on thread {Thread.CurrentThread.ManagedThreadId}");
    }
}
```

このコードでは、Parallel.ForEachAsync により items コレクションの各要素が非同期に処理され、同時に最大10個のタスクが実行されます。これにより、大量の非同期処理を効率的に制御できます。
