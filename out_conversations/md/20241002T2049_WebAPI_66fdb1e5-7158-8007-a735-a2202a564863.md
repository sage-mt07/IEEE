---
conversation_id: "66fdb1e5-7158-8007-a735-a2202a564863"
title: "WebAPI負荷試験計画"
create_time: 1727902181.721004
update_time: 1727902207.830817
language_guess: "en"
num_messages: 5
part_index: 1
part_count: 1
---

### system — 2024-10-02T20:49:41.721004+00:00

_(empty)_

### user — 2024-10-02T20:49:41.728982+00:00

文書の骨子に関する相談
WebAPIの負荷試験を実施する
実施前に設定する事柄を整理する
WebAPIはAppServiceで実装されている
DBはAzure postgresqlを使用している
負荷はAzure Load Testingを使用する
この条件で、事前の設定と目的を整理し、文章にしたい

### assistant — 2024-10-02T20:50:06.842645+00:00

_(empty)_

### assistant — 2024-10-02T20:50:06.843028+00:00

WebAPIの負荷試験を実施するにあたり、事前に設定する事柄と試験の目的を明確に整理します。以下にその骨子をまとめます。

---

## 1. 負荷試験の目的
本負荷試験の目的は、App Service上に実装されたWebAPIと、バックエンドのAzure PostgreSQLのスケーラビリティとパフォーマンスを評価することです。特に以下の点に着目して実施します。
- 同時接続数の増加に対するWebAPIの応答時間の変化
- データベースのクエリ性能とスループット
- システム全体の耐障害性と負荷増加時の挙動
- 必要に応じたリソースのスケールアウト／アップの最適化

## 2. 試験環境
### 2.1 WebAPI
- **ホスティング環境**: Azure App Service
- **構成**: 複数インスタンスによるスケールアウト構成
- **認証・認可**: Entra IDを使用した認証と認可の仕組みを実装

### 2.2 データベース
- **DBMS**: Azure PostgreSQL
- **接続方式**: Dapperを用いたORMによるデータベース接続
- **ストアドプロシージャの使用**: 更新系処理は全てストアドプロシージャ経由で実行

### 2.3 負荷生成ツール
- **ツール**: Azure Load Testing
- **シナリオ**: 複数ユーザが同時にアクセスするシナリオを設計し、段階的に負荷を増加させる
- **負荷パターン**: 一定の負荷増加と、ピーク時の負荷テストを組み合わせて実施

## 3. 事前に設定・確認すべき事項
### 3.1 WebAPI設定
- **スケーリングポリシー**: 負荷増加に応じた自動スケーリングの設定確認
- **エラーログとパフォーマンスログ**: Datadog等の監視サービスにおけるログの有効化
- **APIのタイムアウト設定**: 各エンドポイントのタイムアウト設定を確認、適切に調整
- **リトライポリシー**: DB接続やAPIリクエストの失敗時のリトライ設定の確認

### 3.2 Azure PostgreSQL設定
- **接続プールサイズ**: 同時接続数増加に対応できるよう、接続プールの設定を確認
- **クエリパフォーマンスの監視**: パフォーマンスモニタリングを有効にし、クエリ効率を確認
- **データベースキャパシティ**: スケーリングオプションの設定（例: スケールアップ・スケールアウト）

### 3.3 負荷テスト設定
- **負荷シナリオ設計**: 実際のユーザー利用を想定したシナリオを設計（例: 同時ログイン、データ登録・取得）
- **負荷の増加パターン**: 試験中の負荷増加の方法（段階的、瞬間的）を設定
- **測定項目**: 応答時間、スループット、エラー率等を測定する指標の設定

### 3.4 その他
- **SSL設定**: セキュリティ上の観点から、全ての通信がSSLで暗号化されているかを確認
- **セッション管理**: 負荷下でのセッション管理における問題がないか確認
- **スケジューリング**: 負荷試験の実行時間や、システムへの影響を最小限に抑えるための計画

---

このような構成で負荷試験の目的、試験環境、設定内容を整理し、文章化します。これにより、関係者全員が試験の目的と準備すべき事項を明確に理解できるようにすることが重要です。
