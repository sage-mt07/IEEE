---
conversation_id: "676d34ac-a0dc-8007-8706-6fc99f4a49ef"
title: "ASP.NET Core API一覧取得"
create_time: 1735210156.879571
update_time: 1735210198.088579
language_guess: "en"
num_messages: 5
part_index: 1
part_count: 1
---

### system — 2024-12-26T10:49:16.879571+00:00

_(empty)_

### user — 2024-12-26T10:49:16.882957+00:00

aspnetcore webapi デホストシテルapiの一覧を取得する方法

### assistant — 2024-12-26T10:49:56.719992+00:00

_(empty)_

### assistant — 2024-12-26T10:49:56.720148+00:00

ASP.NET Core WebAPIで、デフォルトでホストしているAPIの一覧を取得するには、以下の手法を使用できます。一般的に、このタスクは **APIドキュメント（Swagger）** を通じて実現するか、 **ASP.NET Coreのエンドポイントをプログラムで取得** することで実現できます。

### 方法 1: **Swagger/OpenAPI を利用する**
1. **Swaggerを設定**  
   プロジェクトで `Swashbuckle.AspNetCore` パッケージをインストールし、Swaggerを有効にします。

   ```bash
   dotnet add package Swashbuckle.AspNetCore
   ```

   **`Program.cs` に以下を追加します:**
   ```csharp
   var builder = WebApplication.CreateBuilder(args);

   // Swagger生成を有効化
   builder.Services.AddEndpointsApiExplorer();
   builder.Services.AddSwaggerGen();

   var app = builder.Build();

   // Swagger UIを有効化
   if (app.Environment.IsDevelopment())
   {
       app.UseSwagger();
       app.UseSwaggerUI();
   }

   app.UseAuthorization();
   app.MapControllers();

   app.Run();
   ```

2. **Swagger UIを確認する**  
   アプリを起動すると、`/swagger/index.html` でAPIの一覧を閲覧できます。

---

### 方法 2: **プログラムでエンドポイントの一覧を取得**
エンドポイントをリストアップするには、`IEndpointRouteBuilder` から情報を取得する方法があります。

**手順:**
1. **`Program.cs`でエンドポイント情報を取得するコードを追加:**
   ```csharp
   var builder = WebApplication.CreateBuilder(args);
   builder.Services.AddControllers();

   var app = builder.Build();

   // エンドポイントを列挙するAPI
   app.MapGet("/endpoints", (IEnumerable<EndpointDataSource> endpointSources) =>
   {
       var endpoints = endpointSources.SelectMany(source => source.Endpoints);
       return endpoints.Select(e => new
       {
           Pattern = e.DisplayName
       });
   });

   app.MapControllers();
   app.Run();
   ```

2. **結果の確認:**
   アプリを起動し、`/endpoints` にアクセスすると登録されているエンドポイント一覧がJSON形式で返されます。

---

### 方法 3: **カスタムコードでControllerとActionを列挙**
プロジェクトの全コントローラーとアクションを列挙する方法です。

**`Program.cs`に以下のコードを追加:**
```csharp
using Microsoft.AspNetCore.Mvc.Controllers;

var builder = WebApplication.CreateBuilder(args);
builder.Services.AddControllers();

var app = builder.Build();

app.MapGet("/controllers", (IServiceProvider serviceProvider) =>
{
    var controllerFeature = new ControllerFeature();
    var applicationPartManager = serviceProvider.GetRequiredService<ApplicationPartManager>();
    applicationPartManager.PopulateFeature(controllerFeature);

    return controllerFeature.Controllers.Select(c => new
    {
        Controller = c.Name,
        Actions = c.DeclaredMethods.Where(m => m.IsPublic && !m.IsStatic).Select(m => m.Name)
    });
});

app.MapControllers();
app.Run();
```

**結果の確認:**
- `/controllers` にアクセスすると、すべてのコントローラーとアクションのリストがJSON形式で返されます。

---

### どの方法を選ぶべき？
- **Swagger/OpenAPI:** 開発者向けにAPIドキュメントを提供したい場合に最適。
- **エンドポイントのプログラム的取得:** カスタム要件や運用で使うためのエンドポイントリストを取得したい場合に便利。
- **コントローラーとアクションの列挙:** 高度なカスタマイズが必要な場合やメタデータが必要な場合に有用。

状況に応じて適切な方法を選んでください。
