---
conversation_id: "67b303ff-ff04-8007-8ba7-40171d779bed"
title: ".NET Framework ルールセット変更"
create_time: 1739785216.917096
update_time: 1740006527.630165
language_guess: "en"
num_messages: 7
part_index: 1
part_count: 1
---

### system — 2025-02-17T09:40:16.917096+00:00

_(empty)_

### user — 2025-02-17T09:40:16.924625+00:00

以下のルールセットを.net framework用に変更して
<?xml version="1.0" encoding="utf-8"?>
<RuleSet Name="Custom Rules" Description="This rule set is Custom Rule." ToolsVersion="10.0">
  <Localization ResourceAssembly="Microsoft.VisualStudio.CodeAnalysis.RuleSets.Strings.dll" ResourceBaseName="Microsoft.VisualStudio.CodeAnalysis.RuleSets.Strings.Localized">
    <Name Resource="SecurityRules_Name" />
    <Description Resource="CustomRules_Description" />
  </Localization>
  <Rules AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis" RuleNamespace="Microsoft.Rules.Managed">
    <Rule Id="CA1802" Action="Warning" />
    <Rule Id="CA1805" Action="Warning" />
    <Rule Id="CA1806" Action="Warning" />
    <Rule Id="CA1810" Action="Warning" />
    <Rule Id="CA1812" Action="Warning" />
    <Rule Id="CA1813" Action="Warning" />
    <Rule Id="CA1814" Action="Warning" />
    <Rule Id="CA1815" Action="Warning" />
    <Rule Id="CA1819" Action="Warning" />
    <Rule Id="CA1820" Action="Warning" />
    <Rule Id="CA1821" Action="Warning" />
    <Rule Id="CA1822" Action="Warning" />
    <Rule Id="CA1823" Action="Warning" />
    <Rule Id="CA1824" Action="Warning" />
    <Rule Id="CA1825" Action="Warning" />
    <Rule Id="CA1826" Action="Warning" />
    <Rule Id="CA1827" Action="Warning" />
    <Rule Id="CA1828" Action="Warning" />
    <Rule Id="CA1829" Action="Warning" />
    <Rule Id="CA1830" Action="Warning" />
    <Rule Id="CA1831" Action="Warning" />
    <Rule Id="CA1832" Action="Warning" />
    <Rule Id="CA1833" Action="Warning" />
    <Rule Id="CA1834" Action="Warning" />
    <Rule Id="CA1835" Action="Warning" />
    <Rule Id="CA1836" Action="Warning" />
    <Rule Id="CA1837" Action="Warning" />
    <Rule Id="CA1838" Action="Warning" />
    <Rule Id="CA1839" Action="Warning" />
    <Rule Id="CA1840" Action="Warning" />
    <Rule Id="CA1841" Action="Warning" />
    <Rule Id="CA1842" Action="Warning" />
    <Rule Id="CA1843" Action="Warning" />
    <Rule Id="CA1844" Action="Warning" />
    <Rule Id="CA1845" Action="Warning" />
    <Rule Id="CA1846" Action="Warning" />
    <Rule Id="CA1847" Action="Warning" />
    <Rule Id="CA1848" Action="Warning" />
    <Rule Id="CA1849" Action="Warning" />
    <Rule Id="CA1850" Action="Warning" />
    <Rule Id="CA1851" Action="Warning" />

    <Rule Id="CA2100" Action="Warning" />
    <Rule Id="CA2213" Action="Warning" />
    <Rule Id="CA2215" Action="Warning" />
    <Rule Id="CA2216" Action="Warning" />

    <Rule Id="CA2000" Action="Warning" />
    <Rule Id="CA2002" Action="Warning" />
    <Rule Id="CA2007" Action="Warning" />
    <Rule Id="CA2008" Action="Warning" />
    <Rule Id="CA2009" Action="Warning" />
    <Rule Id="CA2011" Action="Warning" />
    <Rule Id="CA2012" Action="Warning" />
    <Rule Id="CA2013" Action="Warning" />
    <Rule Id="CA2014" Action="Warning" />
    <Rule Id="CA2015" Action="Warning" />
    <Rule Id="CA2016" Action="Warning" />
    <Rule Id="CA2017" Action="Warning" />
    <Rule Id="CA2018" Action="Warning" />

    <Rule Id="CA1001" Action="Warning" />

  </Rules>
</RuleSet>

### assistant — 2025-02-17T09:41:24.527907+00:00

_(empty)_

### assistant — 2025-02-17T09:41:24.528031+00:00

以下の .NET Framework 用のルールセットに変更しました。 .NET Framework 向けの Code Analysis の `AnalyzerId` を `Microsoft.CodeAnalysis.FxCopAnalyzers` に変更し、ルールの `RuleNamespace` を `Microsoft.Rules.FxCop` に調整しています。

```xml
<?xml version="1.0" encoding="utf-8"?>
<RuleSet Name="Custom Rules" Description="This rule set is Custom Rule." ToolsVersion="10.0">
  <Localization ResourceAssembly="Microsoft.VisualStudio.CodeAnalysis.RuleSets.Strings.dll" ResourceBaseName="Microsoft.VisualStudio.CodeAnalysis.RuleSets.Strings.Localized">
    <Name Resource="SecurityRules_Name" />
    <Description Resource="CustomRules_Description" />
  </Localization>
  <Rules AnalyzerId="Microsoft.CodeAnalysis.FxCopAnalyzers" RuleNamespace="Microsoft.Rules.FxCop">
    <Rule Id="CA1802" Action="Warning" />
    <Rule Id="CA1805" Action="Warning" />
    <Rule Id="CA1806" Action="Warning" />
    <Rule Id="CA1810" Action="Warning" />
    <Rule Id="CA1812" Action="Warning" />
    <Rule Id="CA1813" Action="Warning" />
    <Rule Id="CA1814" Action="Warning" />
    <Rule Id="CA1815" Action="Warning" />
    <Rule Id="CA1819" Action="Warning" />
    <Rule Id="CA1820" Action="Warning" />
    <Rule Id="CA1821" Action="Warning" />
    <Rule Id="CA1822" Action="Warning" />
    <Rule Id="CA1823" Action="Warning" />
    <Rule Id="CA1824" Action="Warning" />
    <Rule Id="CA1825" Action="Warning" />
    <Rule Id="CA1826" Action="Warning" />
    <Rule Id="CA1827" Action="Warning" />
    <Rule Id="CA1828" Action="Warning" />
    <Rule Id="CA1829" Action="Warning" />
    <Rule Id="CA1830" Action="Warning" />
    <Rule Id="CA1831" Action="Warning" />
    <Rule Id="CA1832" Action="Warning" />
    <Rule Id="CA1833" Action="Warning" />
    <Rule Id="CA1834" Action="Warning" />
    <Rule Id="CA1835" Action="Warning" />
    <Rule Id="CA1836" Action="Warning" />
    <Rule Id="CA1837" Action="Warning" />
    <Rule Id="CA1838" Action="Warning" />
    <Rule Id="CA1839" Action="Warning" />
    <Rule Id="CA1840" Action="Warning" />
    <Rule Id="CA1841" Action="Warning" />
    <Rule Id="CA1842" Action="Warning" />
    <Rule Id="CA1843" Action="Warning" />
    <Rule Id="CA1844" Action="Warning" />
    <Rule Id="CA1845" Action="Warning" />
    <Rule Id="CA1846" Action="Warning" />
    <Rule Id="CA1847" Action="Warning" />
    <Rule Id="CA1848" Action="Warning" />
    <Rule Id="CA1849" Action="Warning" />
    <Rule Id="CA1850" Action="Warning" />
    <Rule Id="CA1851" Action="Warning" />

    <Rule Id="CA2100" Action="Warning" />
    <Rule Id="CA2213" Action="Warning" />
    <Rule Id="CA2215" Action="Warning" />
    <Rule Id="CA2216" Action="Warning" />

    <Rule Id="CA2000" Action="Warning" />
    <Rule Id="CA2002" Action="Warning" />
    <Rule Id="CA2007" Action="Warning" />
    <Rule Id="CA2008" Action="Warning" />
    <Rule Id="CA2009" Action="Warning" />
    <Rule Id="CA2011" Action="Warning" />
    <Rule Id="CA2012" Action="Warning" />
    <Rule Id="CA2013" Action="Warning" />
    <Rule Id="CA2014" Action="Warning" />
    <Rule Id="CA2015" Action="Warning" />
    <Rule Id="CA2016" Action="Warning" />
    <Rule Id="CA2017" Action="Warning" />
    <Rule Id="CA2018" Action="Warning" />

    <Rule Id="CA1001" Action="Warning" />
  </Rules>
</RuleSet>
```

この変更で、.NET Framework の `FxCopAnalyzers` に適用できるようになっています。

### user — 2025-02-17T09:43:58.853221+00:00

visual studio 2017で実行するとCA0064が警告される

### assistant — 2025-02-17T09:45:58.369760+00:00

Visual Studio 2017 で `CA0064: Missing analysis assembly` の警告が出る原因は、Code Analysis に必要なアセンブリ (`FxCop` など) が正しく参照されていないことが考えられます。

## **原因と解決策**
### **1. ルールセットの `AnalyzerId` の変更**
現在のルールセットでは `AnalyzerId="Microsoft.CodeAnalysis.FxCopAnalyzers"` を指定していますが、Visual Studio 2017 では `Microsoft.Analyzers.ManagedCodeAnalysis` を使用する必要があります。

#### **修正後の `RuleSet`**
```xml
<?xml version="1.0" encoding="utf-8"?>
<RuleSet Name="Custom Rules" Description="This rule set is Custom Rule." ToolsVersion="10.0">
  <Localization ResourceAssembly="Microsoft.VisualStudio.CodeAnalysis.RuleSets.Strings.dll" ResourceBaseName="Microsoft.VisualStudio.CodeAnalysis.RuleSets.Strings.Localized">
    <Name Resource="SecurityRules_Name" />
    <Description Resource="CustomRules_Description" />
  </Localization>
  <Rules AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis" RuleNamespace="Microsoft.Rules.Managed">
    <Rule Id="CA1802" Action="Warning" />
    <Rule Id="CA1805" Action="Warning" />
    <Rule Id="CA1806" Action="Warning" />
    <Rule Id="CA1810" Action="Warning" />
    <Rule Id="CA1812" Action="Warning" />
    <Rule Id="CA1813" Action="Warning" />
    <Rule Id="CA1814" Action="Warning" />
    <Rule Id="CA1815" Action="Warning" />
    <Rule Id="CA1819" Action="Warning" />
    <Rule Id="CA1820" Action="Warning" />
    <Rule Id="CA1821" Action="Warning" />
    <Rule Id="CA1822" Action="Warning" />
    <Rule Id="CA1823" Action="Warning" />
    <Rule Id="CA1824" Action="Warning" />
    <Rule Id="CA1825" Action="Warning" />
    <Rule Id="CA1826" Action="Warning" />
    <Rule Id="CA1827" Action="Warning" />
    <Rule Id="CA1828" Action="Warning" />
    <Rule Id="CA1829" Action="Warning" />
    <Rule Id="CA1830" Action="Warning" />
    <Rule Id="CA1831" Action="Warning" />
    <Rule Id="CA1832" Action="Warning" />
    <Rule Id="CA1833" Action="Warning" />
    <Rule Id="CA1834" Action="Warning" />
    <Rule Id="CA1835" Action="Warning" />
    <Rule Id="CA1836" Action="Warning" />
    <Rule Id="CA1837" Action="Warning" />
    <Rule Id="CA1838" Action="Warning" />
    <Rule Id="CA1839" Action="Warning" />
    <Rule Id="CA1840" Action="Warning" />
    <Rule Id="CA1841" Action="Warning" />
    <Rule Id="CA1842" Action="Warning" />
    <Rule Id="CA1843" Action="Warning" />
    <Rule Id="CA1844" Action="Warning" />
    <Rule Id="CA1845" Action="Warning" />
    <Rule Id="CA1846" Action="Warning" />
    <Rule Id="CA1847" Action="Warning" />
    <Rule Id="CA1848" Action="Warning" />
    <Rule Id="CA1849" Action="Warning" />
    <Rule Id="CA1850" Action="Warning" />
    <Rule Id="CA1851" Action="Warning" />

    <Rule Id="CA2100" Action="Warning" />
    <Rule Id="CA2213" Action="Warning" />
    <Rule Id="CA2215" Action="Warning" />
    <Rule Id="CA2216" Action="Warning" />

    <Rule Id="CA2000" Action="Warning" />
    <Rule Id="CA2002" Action="Warning" />
    <Rule Id="CA2007" Action="Warning" />
    <Rule Id="CA2008" Action="Warning" />
    <Rule Id="CA2009" Action="Warning" />
    <Rule Id="CA2011" Action="Warning" />
    <Rule Id="CA2012" Action="Warning" />
    <Rule Id="CA2013" Action="Warning" />
    <Rule Id="CA2014" Action="Warning" />
    <Rule Id="CA2015" Action="Warning" />
    <Rule Id="CA2016" Action="Warning" />
    <Rule Id="CA2017" Action="Warning" />
    <Rule Id="CA2018" Action="Warning" />

    <Rule Id="CA1001" Action="Warning" />
  </Rules>
</RuleSet>
```

### **2. FxCop の有効化**
Visual Studio 2017 では、.NET Framework 用の `FxCop` (Code Analysis) はデフォルトでは含まれていないため、手動でインストールする必要があります。

#### **手順**
1. **NuGet パッケージを追加**
   - **プロジェクトのターゲットフレームワークが .NET Framework の場合**
     1. **[ツール] -> [NuGet パッケージ マネージャー] -> [ソリューションの NuGet パッケージの管理] を開く**
     2. **「参照」タブで `Microsoft.CodeAnalysis.FxCopAnalyzers` を検索**
     3. **`Microsoft.CodeAnalysis.FxCopAnalyzers` をインストール**
     4. **`Microsoft.CodeAnalysis.FxCopAnalyzers` のバージョンを `2.9.8` に設定**

   **もしくは、以下のコマンドを `Package Manager Console` で実行**
   ```powershell
   Install-Package Microsoft.CodeAnalysis.FxCopAnalyzers -Version 2.9.8
   ```

2. **プロジェクトの Code Analysis 設定を確認**
   - **Visual Studio のプロジェクト プロパティ (`.csproj` の設定)**
     1. プロジェクトを右クリック -> **[プロパティ]** を開く
     2. **[Code Analysis]** の設定を確認
     3. **「Code Analysis をビルド時に有効にする」** をチェック

3. **Visual Studio の Code Analysis 実行**
   - **手動で Code Analysis を実行**
     1. **[ビルド] -> [Code Analysis の実行]** をクリック
     2. `CA0064` の警告が出ないか確認

### **3. `ruleset` ファイルのパスを確認**
プロジェクト設定で `.ruleset` ファイルのパスが適切に設定されていないと、Code Analysis が正しく動作しません。
- `.csproj` 内で `.ruleset` が適切なパスにあるか確認
- Visual Studio の **[プロジェクトのプロパティ] -> [Code Analysis]** で `.ruleset` ファイルが正しく設定されているか確認

### **4. Visual Studio の修復**
もし問題が解決しない場合、Visual Studio 2017 の修復 (`Visual Studio Installer` で **修復** を実行) も試してみてください。

---

## **まとめ**
### ✅ **解決策**
1. `.ruleset` の `AnalyzerId="Microsoft.Analyzers.ManagedCodeAnalysis"` に修正
2. **NuGet で `Microsoft.CodeAnalysis.FxCopAnalyzers` をインストール**
3. **プロジェクトの Code Analysis 設定を確認し、有効化**
4. **.ruleset のパスを Visual Studio で再確認**
5. **Visual Studio を修復してみる**

これで `.NET Framework` の `FxCopAnalyzers` に適した設定になり、`CA0064` の警告が解消されるはずです。試してみてください！
