---
conversation_id: "6724ce26-f94c-8007-b6ff-833c145c646e"
title: "Blazor WebAssembly ダウンロードメトリック"
create_time: 1730465319.395601
update_time: 1730466167.613349
language_guess: "en"
num_messages: 9
part_index: 1
part_count: 1
---

### system — 2024-11-01T12:48:39.395601+00:00

_(empty)_

### user — 2024-11-01T12:48:39.405945+00:00

Blazor web assembly をapp serviceでホストしたさいのweb assembly をダウンロードするメトリック

### assistant — 2024-11-01T12:48:55.255733+00:00

_(empty)_

### assistant — 2024-11-01T12:48:55.255932+00:00

Blazor WebAssembly アプリを Azure App Service でホストする際、WebAssembly のダウンロードに関連するメトリックを取得するためには、以下のようなポイントを考慮すると良いです。

### 1. Azure Monitor の活用
Azure Monitor を使って、HTTP リクエストやレスポンスに関連するメトリックを確認できます。これにより、以下のような情報を把握できます：
   - **ダウンロード時間**: WebAssembly ファイル (.wasm) のリクエストからレスポンス完了までの時間。
   - **レスポンスサイズ**: ダウンロードされる `.wasm` ファイルのサイズや他のリソース (JS, CSS) のサイズ。
   - **リクエスト数**: 特定の時間における WebAssembly ファイルのダウンロードリクエストの数。

### 2. Application Insights の利用
Azure Application Insights をアプリに統合することで、カスタム イベントやリクエストの監視が可能です。以下のメトリックを収集できます：
   - **Dependency Call Duration**: `.wasm` ファイルのリクエスト時間を計測し、アプリのパフォーマンスボトルネックを発見するのに役立ちます。
   - **Load Time**: WebAssembly ファイルの読み込みにかかる平均時間。
   - **カスタムイベント**: ロード時間を詳細にモニタリングするために、特定のカスタムイベントを設定することができます。

### 3. クライアントサイドの JavaScript での測定
`navigator` オブジェクトの `performance` API を使って、Blazor WebAssembly のダウンロード時間を計測できます。例えば以下のようなコードを Blazor WebAssembly アプリに追加して計測可能です。

```javascript
window.addEventListener('load', function() {
  var loadTime = performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart;
  console.log("Load time in ms:", loadTime);
});
```

### 4. App Service Diagnostic Logs の使用
App Service の診断ログを有効化し、トラフィックの詳細なログを収集することも可能です。このログを利用して、リクエストごとのレスポンス時間、ステータスコード、エラーログなどを追跡できます。

### 5. Azure CDN との併用
もしWebAssemblyのファイルサイズが大きくなる場合、Azure CDN を利用して配信すると、ユーザーの位置に基づいたキャッシュ配信が可能になります。これにより、ダウンロード速度の向上や、パフォーマンスの向上が期待できます。

これらの方法を組み合わせることで、Blazor WebAssembly のダウンロードに関連する詳細なメトリックを取得し、パフォーマンスをモニタリングおよび最適化することができます。

### user — 2024-11-01T13:01:00.477716+00:00

Web assembly ダウンロードリクエスト数はなにをみるのか

### assistant — 2024-11-01T13:01:23.343801+00:00

WebAssembly のダウンロードリクエスト数を把握するには、主に以下のメトリックやログを確認します。

### 1. **Azure Monitor のリクエスト数メトリック**
   - Azure Monitor の「リクエスト数 (Request Count)」メトリックを使うことで、App Service に対する全リクエストの数を確認できます。ここから、`blazor.webassembly.js` や `.wasm` ファイルに対するリクエストをフィルタリングして、WebAssembly のダウンロードリクエスト数を取得できます。

### 2. **Application Insights での依存関係コールの追跡**
   - Application Insights を使って依存関係 (Dependencies) データを収集し、`blazor.webassembly.js` や `.wasm` ファイルのリクエストの数を個別に確認することができます。Application Insights では、特定のファイルへのリクエストを URL やパスでフィルタリングすることで、WebAssembly のファイルがどのくらいの頻度でリクエストされているかを把握できます。

### 3. **クライアントサイドでのメトリクス収集**
   - クライアント側からリクエストをカウントし、サーバーにカスタムイベントとして送信することも可能です。JavaScript を使い、`blazor.webassembly.js` や `.wasm` ファイルへのリクエストが発生するたびにイベントを発行し、Application Insights にカスタムイベントとして保存する方法もあります。

### 4. **App Service 診断ログ**
   - App Service の診断ログ (HTTP ログ) を有効にすることで、すべてのリクエストログが取得できます。これにより、`.wasm` ファイルへのリクエスト数をログから集計することが可能です。

### 5. **Azure CDN のログ (利用時)**
   - Azure CDN を使用している場合、CDN のログにもリクエストの数が記録されます。CDN のログを確認し、WebAssembly (.wasm) ファイルへのリクエスト数をカウントできます。CDN のキャッシュにヒットしたかどうかも確認できるため、実際に App Service に対するダウンロードリクエスト数の削減効果も測定可能です。

これらの方法を使うことで、WebAssembly のダウンロードリクエスト数を把握し、最適化やパフォーマンス向上の指標として役立てることができます。

### user — 2024-11-01T13:02:22.611024+00:00

Kusto式を

### assistant — 2024-11-01T13:02:46.510739+00:00

WebAssembly のダウンロードリクエスト数を確認するための Kusto クエリ (Azure Monitor や Application Insights のログクエリ言語) の例を以下に示します。例えば、`blazor.webassembly.js` や `.wasm` ファイルのリクエストをフィルタリングして取得する場合のクエリです。

### 1. **特定のファイルへのリクエスト数をカウントするクエリ**
   `requests` テーブルを利用して、`blazor.webassembly.js` や `.wasm` ファイルへのリクエスト数をカウントします。

   ```kusto
   requests
   | where url endswith "blazor.webassembly.js" or url endswith ".wasm"
   | summarize RequestCount = count() by url
   ```

### 2. **特定の時間範囲でのリクエスト数の推移を確認するクエリ**
   WebAssembly のファイルリクエスト数を時間別に集計し、トレンドを確認します。

   ```kusto
   requests
   | where timestamp >= ago(1d)  // 過去1日間のデータ
   | where url endswith "blazor.webassembly.js" or url endswith ".wasm"
   | summarize RequestCount = count() by bin(timestamp, 1h), url
   | order by timestamp asc
   ```

### 3. **ステータスコードごとのリクエスト数を確認するクエリ**
   `blazor.webassembly.js` や `.wasm` ファイルのリクエストが成功しているか、または失敗しているかを確認する場合に使用します。

   ```kusto
   requests
   | where url endswith "blazor.webassembly.js" or url endswith ".wasm"
   | summarize RequestCount = count() by url, resultCode
   | order by resultCode asc
   ```

### 4. **特定のファイルの平均ダウンロード時間を確認するクエリ**
   WebAssembly ファイルの平均ダウンロード時間を確認し、パフォーマンスに問題がないかを確認します。

   ```kusto
   requests
   | where url endswith "blazor.webassembly.js" or url endswith ".wasm"
   | summarize AvgDuration = avg(duration) by url
   ```

### 5. **クライアントの IP アドレスごとのリクエスト数を確認するクエリ**
   各クライアントのリクエスト数を確認することで、特定のクライアントからの異常なアクセスパターンを発見できます。

   ```kusto
   requests
   | where url endswith "blazor.webassembly.js" or url endswith ".wasm"
   | summarize RequestCount = count() by client_IP, url
   | order by RequestCount desc
   ```

これらのクエリを使って、Blazor WebAssembly のダウンロードに関するメトリクスを把握し、リクエストの数やパフォーマンスに関連する情報を取得することができます。
