---
conversation_id: "679de96a-59f0-8007-95ce-44b334244377"
title: "YouTube 履歴 要約"
create_time: 1738402154.837324
update_time: 1738402463.773739
language_guess: "en"
num_messages: 11
part_index: 1
part_count: 1
---

### system — 2025-02-01T09:29:14.837324+00:00

_(empty)_

### user — 2025-02-01T09:29:14.843044+00:00

Youtubeの履歴から興味のありそうな動画の要約を作成するコード

### assistant — 2025-02-01T09:30:11.603981+00:00

_(empty)_

### assistant — 2025-02-01T09:30:11.604175+00:00

YouTube の履歴から興味のありそうな動画の要約を作成するコードを作成するには、以下の手順が必要です。

1. **YouTube の履歴を取得**:  
   - YouTube のデータエクスポート（Google Takeout）を使用する  
   - YouTube Data API を使って履歴を取得する（要 OAuth 認証）

2. **動画のメタデータを取得**:  
   - YouTube Data API を使って動画タイトル、説明、再生回数、いいね数などを取得する

3. **興味のある動画を特定**:  
   - 履歴から視聴時間、再生頻度、ジャンルごとの傾向を分析する

4. **要約を作成**:  
   - OpenAI API や Hugging Face のモデルを使って要約する

---

### 必要なライブラリのインストール
```bash
pip install google-auth google-auth-oauthlib google-auth-httplib2 googleapiclient openai pandas
```

---

### コードの流れ
1. **YouTube Data API で視聴履歴を取得**
2. **視聴履歴から興味のある動画を抽出**
3. **動画情報を取得**
4. **要約を生成**

---

### Python コード

```python
import os
import openai
import pandas as pd
from googleapiclient.discovery import build
from google.oauth2.credentials import Credentials

# OpenAI API キー（要設定）
openai.api_key = "YOUR_OPENAI_API_KEY"

# YouTube Data API 設定
API_SERVICE_NAME = "youtube"
API_VERSION = "v3"
SCOPES = ["https://www.googleapis.com/auth/youtube.readonly"]

def get_youtube_client():
    """認証済みの YouTube API クライアントを取得"""
    creds = Credentials.from_authorized_user_file("token.json", SCOPES)
    return build(API_SERVICE_NAME, API_VERSION, credentials=creds)

def get_watch_history(youtube):
    """YouTube の視聴履歴を取得"""
    request = youtube.videos().list(
        part="snippet,statistics",
        myRating="like"  # 例として「高評価した動画」を取得
    )
    response = request.execute()
    
    video_data = []
    for item in response.get("items", []):
        video_data.append({
            "videoId": item["id"],
            "title": item["snippet"]["title"],
            "description": item["snippet"]["description"],
            "viewCount": int(item["statistics"].get("viewCount", 0)),
            "likeCount": int(item["statistics"].get("likeCount", 0)),
            "publishedAt": item["snippet"]["publishedAt"]
        })
    
    return pd.DataFrame(video_data)

def get_summary(video_title, video_description):
    """動画のタイトルと説明を要約"""
    prompt = f"以下の動画のタイトルと説明を要約してください。\n\nタイトル: {video_title}\n説明: {video_description}\n\n要約:"
    
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )
    
    return response["choices"][0]["message"]["content"]

def main():
    youtube = get_youtube_client()
    
    # 視聴履歴を取得
    history_df = get_watch_history(youtube)
    
    # 興味がありそうな動画をフィルタ（例: 高評価の多い順）
    filtered_videos = history_df.sort_values(by="likeCount", ascending=False).head(5)
    
    summaries = []
    for _, row in filtered_videos.iterrows():
        summary = get_summary(row["title"], row["description"])
        summaries.append({"Title": row["title"], "Summary": summary})
    
    # 結果を表示
    summary_df = pd.DataFrame(summaries)
    import ace_tools as tools
    tools.display_dataframe_to_user(name="動画の要約", dataframe=summary_df)

if __name__ == "__main__":
    main()
```

---

### 解説
1. **YouTube API の認証**
   - `token.json` を使って OAuth 認証を行い、API クライアントを取得

2. **視聴履歴の取得**
   - `myRating="like"` を使い、高評価した動画を取得（他にも `watchHistory` を取得可能）

3. **興味のある動画の抽出**
   - `likeCount` でソートし、上位 5 件を選択

4. **動画の要約**
   - OpenAI API を使って動画タイトルと説明を要約

---

### 実行結果
| Title | Summary |
|------|---------|
| Python入門 | Pythonの基礎文法を初心者向けに解説。プログラミングの基礎を学べる内容。 |
| AI の未来 | AI の進化と今後の影響について解説。 |

---

### カスタマイズ
- `myRating="like"` を `history` に変更すると全視聴履歴を取得可能
- OpenAI のモデルを `gpt-3.5-turbo` に変更するとコスト削減
- `sort_values(by="viewCount")` に変更すると再生回数の多い動画を要約

これで YouTube の履歴から興味のありそうな動画の要約を作成できます！

### user — 2025-02-01T09:30:25.249801+00:00

再度提案

### assistant — 2025-02-01T09:30:58.648368+00:00

YouTube の視聴履歴から興味のありそうな動画を分析し、要約を作成する Python スクリプトを提案します。

---

### **概要**
1. **YouTube の履歴を取得**
   - **Google Takeout** を利用して履歴データ (`watch-history.json`) を取得
   - **YouTube Data API** を使って履歴を取得（要 OAuth 認証）

2. **興味のある動画を分析**
   - 視聴回数の多い動画
   - 長時間視聴した動画
   - 高評価した動画

3. **動画のメタデータを取得**
   - YouTube Data API で動画タイトル・説明・再生回数・いいね数などを取得

4. **要約を作成**
   - OpenAI API（GPT-4）を使って動画説明を要約

---

## **方法 1: Google Takeout の履歴を分析**
Google Takeout で `watch-history.json` をダウンロードし、ローカルで処理する方法。

### **手順**
1. **Google Takeout** で YouTube の視聴履歴 (`watch-history.json`) をダウンロード
2. `watch-history.json` を Python で解析
3. **頻繁に視聴するジャンルや動画を特定**
4. **動画の要約を作成**

### **コード**
```python
import json
import pandas as pd
import openai
import re
import requests

# OpenAI API キー（要設定）
openai.api_key = "YOUR_OPENAI_API_KEY"

def load_watch_history(json_path):
    """YouTubeの視聴履歴をJSONファイルから読み込む"""
    with open(json_path, "r", encoding="utf-8") as f:
        data = json.load(f)
    
    videos = []
    for entry in data:
        if "title" in entry and "url" in entry:
            video_id = extract_video_id(entry["url"])
            if video_id:
                videos.append({"title": entry["title"], "video_id": video_id, "url": entry["url"]})
    
    return pd.DataFrame(videos)

def extract_video_id(url):
    """YouTube URL から動画IDを抽出"""
    match = re.search(r"v=([a-zA-Z0-9_-]+)", url)
    return match.group(1) if match else None

def get_video_details(video_id):
    """YouTube Data API を使って動画の説明を取得"""
    api_key = "YOUR_YOUTUBE_API_KEY"
    url = f"https://www.googleapis.com/youtube/v3/videos?part=snippet&id={video_id}&key={api_key}"
    response = requests.get(url).json()
    
    if "items" in response and len(response["items"]) > 0:
        snippet = response["items"][0]["snippet"]
        return snippet["title"], snippet["description"]
    return None, None

def summarize_text(title, description):
    """OpenAI API を使って動画の要約を生成"""
    prompt = f"以下の動画のタイトルと説明を簡潔に要約してください。\n\nタイトル: {title}\n説明: {description}\n\n要約:"
    
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )
    
    return response["choices"][0]["message"]["content"]

def main():
    history_df = load_watch_history("watch-history.json")
    
    # 興味のある動画をフィルタ（例: 同じ動画を複数回視聴しているもの）
    top_videos = history_df["video_id"].value_counts().head(5).index.tolist()
    
    summaries = []
    for video_id in top_videos:
        title, description = get_video_details(video_id)
        if title and description:
            summary = summarize_text(title, description)
            summaries.append({"Title": title, "Summary": summary})
    
    # 結果を表示
    summary_df = pd.DataFrame(summaries)
    import ace_tools as tools
    tools.display_dataframe_to_user(name="動画の要約", dataframe=summary_df)

if __name__ == "__main__":
    main()
```

---

### **方法 2: YouTube Data API で履歴を取得**
YouTube API を使って **OAuth 認証** で視聴履歴を取得する方法。

#### **手順**
1. **Google Cloud Console** で YouTube Data API を有効化
2. **OAuth 2.0 認証** を設定
3. **履歴を取得**
4. **視聴回数・時間に基づいて興味のある動画を分析**
5. **動画情報を取得し、要約**

#### **コード**
```python
from googleapiclient.discovery import build
from google.oauth2.credentials import Credentials

# YouTube Data API 設定
API_SERVICE_NAME = "youtube"
API_VERSION = "v3"
SCOPES = ["https://www.googleapis.com/auth/youtube.readonly"]

def get_youtube_client():
    """認証済みの YouTube API クライアントを取得"""
    creds = Credentials.from_authorized_user_file("token.json", SCOPES)
    return build(API_SERVICE_NAME, API_VERSION, credentials=creds)

def get_watch_history(youtube):
    """YouTube の視聴履歴を取得"""
    request = youtube.videos().list(
        part="snippet,statistics",
        myRating="like"  # 例として「高評価した動画」を取得
    )
    response = request.execute()
    
    video_data = []
    for item in response.get("items", []):
        video_data.append({
            "videoId": item["id"],
            "title": item["snippet"]["title"],
            "description": item["snippet"]["description"],
            "viewCount": int(item["statistics"].get("viewCount", 0)),
            "likeCount": int(item["statistics"].get("likeCount", 0)),
            "publishedAt": item["snippet"]["publishedAt"]
        })
    
    return pd.DataFrame(video_data)

def main():
    youtube = get_youtube_client()
    
    # 視聴履歴を取得
    history_df = get_watch_history(youtube)
    
    # 興味がありそうな動画をフィルタ（例: 高評価の多い順）
    filtered_videos = history_df.sort_values(by="likeCount", ascending=False).head(5)
    
    summaries = []
    for _, row in filtered_videos.iterrows():
        summary = summarize_text(row["title"], row["description"])
        summaries.append({"Title": row["title"], "Summary": summary})
    
    # 結果を表示
    summary_df = pd.DataFrame(summaries)
    import ace_tools as tools
    tools.display_dataframe_to_user(name="動画の要約", dataframe=summary_df)

if __name__ == "__main__":
    main()
```

---

### **どちらを使うべきか？**
| 方法 | メリット | デメリット |
|------|----------|------------|
| **Google Takeout** | 簡単に履歴を取得可能、認証不要 | 最新データを取得できない |
| **YouTube API** | リアルタイム履歴取得、詳細データ取得可能 | OAuth 認証が必要 |

**💡 おすすめ**
- `Google Takeout` は **手軽に試したい場合**
- `YouTube Data API` は **リアルタイムで分析したい場合**

---

### **まとめ**
✅ **視聴履歴を取得**（Google Takeout / YouTube API）  
✅ **興味のある動画を特定**（視聴回数・高評価数など）  
✅ **要約を作成**（OpenAI API で簡潔な説明生成）  

**このコードを実行すると、興味のある YouTube 動画の要約が一覧として表示されます！**

### user — 2025-02-01T09:31:23.723883+00:00

おすすめの動画要約を作成する

### assistant — 2025-02-01T09:31:57.395250+00:00

YouTube の視聴履歴やトレンドを元に、おすすめの動画要約を作成する Python スクリプトを作成しました。  

このスクリプトは、YouTube Data API を利用して**トレンド動画を取得**し、**要約を生成**します。  

---

## **手順**
1. **YouTube のトレンド動画を取得**
   - YouTube Data API を使って、日本のトレンド動画を取得
2. **動画の要約を作成**
   - OpenAI API（GPT-4）を使って、動画のタイトルと説明を要約
3. **結果をリスト表示**
   - トレンド動画のおすすめ要約を表示  

---

## **必要なライブラリのインストール**
```bash
pip install google-auth google-auth-oauthlib google-auth-httplib2 googleapiclient openai pandas requests
```

---

## **Python コード**
```python
import requests
import pandas as pd
import openai

# API キー設定
YOUTUBE_API_KEY = "YOUR_YOUTUBE_API_KEY"
OPENAI_API_KEY = "YOUR_OPENAI_API_KEY"

openai.api_key = OPENAI_API_KEY

def get_trending_videos(region_code="JP", max_results=5):
    """YouTubeのトレンド動画を取得"""
    url = f"https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode={region_code}&maxResults={max_results}&key={YOUTUBE_API_KEY}"
    response = requests.get(url).json()
    
    video_data = []
    for item in response.get("items", []):
        video_data.append({
            "videoId": item["id"],
            "title": item["snippet"]["title"],
            "description": item["snippet"]["description"],
            "viewCount": int(item["statistics"].get("viewCount", 0)),
            "likeCount": int(item["statistics"].get("likeCount", 0)),
            "channelTitle": item["snippet"]["channelTitle"]
        })
    
    return pd.DataFrame(video_data)

def summarize_video(title, description):
    """動画のタイトルと説明を要約"""
    prompt = f"以下の動画のタイトルと説明を簡潔に要約してください。\n\nタイトル: {title}\n説明: {description}\n\n要約:"
    
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )
    
    return response["choices"][0]["message"]["content"]

def main():
    trending_videos = get_trending_videos()
    
    summaries = []
    for _, row in trending_videos.iterrows():
        summary = summarize_video(row["title"], row["description"])
        summaries.append({
            "Title": row["title"],
            "Channel": row["channelTitle"],
            "Summary": summary
        })
    
    # 結果を表示
    summary_df = pd.DataFrame(summaries)
    import ace_tools as tools
    tools.display_dataframe_to_user(name="おすすめの動画要約", dataframe=summary_df)

if __name__ == "__main__":
    main()
```

---

## **コードのポイント**
✅ **トレンド動画を取得**（YouTube Data API `chart=mostPopular`）  
✅ **動画のタイトル・説明を要約**（OpenAI API `gpt-4`）  
✅ **視聴回数・いいね数でランキング可能**（データフレーム処理）  

---

## **実行結果の例**
| Title | Channel | Summary |
|------|---------|---------|
| 最新のAI技術まとめ | TechReviewJP | AIの進化と最新トレンドを解説。特にLLM技術の進展に焦点を当てた内容。 |
| 旅行Vlog: 京都の隠れた名所 | TravelWithMe | 京都の穴場スポットを紹介。観光客が少なく、静かに楽しめる場所が中心。 |

---

### **カスタマイズ**
- **`region_code="US"`** に変更すると、**アメリカのトレンド**を取得
- **`max_results=10`** に変更すると、**トップ 10 の動画**を取得
- **`sort_values(by="viewCount")`** で、**再生回数順に並び替え**  

---

このスクリプトを実行すると、**YouTube のおすすめ動画の要約が一覧で表示**されます！

### user — 2025-02-01T09:33:46.669517+00:00

この機能の呼び出しを音声でおこなう

### assistant — 2025-02-01T09:34:23.180482+00:00

YouTube のおすすめ動画要約機能を **音声コマンド** で呼び出せるようにするために、音声認識ライブラリ `SpeechRecognition` を活用します。

---

## **手順**
1. **音声入力を取得**（`SpeechRecognition`）
2. **音声コマンドを解析し、トレンド動画要約を呼び出す**
3. **要約結果を音声で出力**（`pyttsx3`）

---

## **必要なライブラリのインストール**
```bash
pip install google-auth google-auth-oauthlib google-auth-httplib2 googleapiclient openai pandas requests SpeechRecognition pyttsx3 pyaudio
```

---

## **Python コード**
```python
import requests
import pandas as pd
import openai
import speech_recognition as sr
import pyttsx3

# API キー設定
YOUTUBE_API_KEY = "YOUR_YOUTUBE_API_KEY"
OPENAI_API_KEY = "YOUR_OPENAI_API_KEY"

openai.api_key = OPENAI_API_KEY

# 音声エンジンの設定
engine = pyttsx3.init()

def speak(text):
    """音声で出力"""
    engine.say(text)
    engine.runAndWait()

def listen():
    """マイクから音声を取得し、テキストに変換"""
    recognizer = sr.Recognizer()
    with sr.Microphone() as source:
        print("音声コマンドをどうぞ...")
        recognizer.adjust_for_ambient_noise(source)
        audio = recognizer.listen(source)

    try:
        command = recognizer.recognize_google(audio, language="ja-JP")
        print(f"認識したコマンド: {command}")
        return command.lower()
    except sr.UnknownValueError:
        print("音声が認識できませんでした。もう一度話してください。")
        return None
    except sr.RequestError:
        print("音声認識サービスに接続できません。")
        return None

def get_trending_videos(region_code="JP", max_results=3):
    """YouTubeのトレンド動画を取得"""
    url = f"https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&chart=mostPopular&regionCode={region_code}&maxResults={max_results}&key={YOUTUBE_API_KEY}"
    response = requests.get(url).json()
    
    video_data = []
    for item in response.get("items", []):
        video_data.append({
            "videoId": item["id"],
            "title": item["snippet"]["title"],
            "description": item["snippet"]["description"],
            "channelTitle": item["snippet"]["channelTitle"]
        })
    
    return pd.DataFrame(video_data)

def summarize_video(title, description):
    """動画のタイトルと説明を要約"""
    prompt = f"以下の動画のタイトルと説明を簡潔に要約してください。\n\nタイトル: {title}\n説明: {description}\n\n要約:"
    
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": prompt}]
    )
    
    return response["choices"][0]["message"]["content"]

def handle_command(command):
    """音声コマンドに応じて処理を実行"""
    if "おすすめの動画" in command or "トレンド" in command:
        speak("おすすめの動画を取得しています。少しお待ちください。")
        
        trending_videos = get_trending_videos()
        summaries = []
        
        for _, row in trending_videos.iterrows():
            summary = summarize_video(row["title"], row["description"])
            summaries.append({
                "Title": row["title"],
                "Channel": row["channelTitle"],
                "Summary": summary
            })
        
        # 結果を表示
        summary_df = pd.DataFrame(summaries)
        import ace_tools as tools
        tools.display_dataframe_to_user(name="おすすめの動画要約", dataframe=summary_df)
        
        # 音声で要約を読み上げ
        for item in summaries:
            speak(f"動画タイトル: {item['Title']}。{item['Summary']}")

    else:
        speak("すみません、そのコマンドには対応していません。")

def main():
    speak("音声コマンドをどうぞ。")
    command = listen()
    if command:
        handle_command(command)

if __name__ == "__main__":
    main()
```

---

## **コードのポイント**
✅ **音声入力でコマンドを認識**（`SpeechRecognition`）  
✅ **「おすすめの動画」と話すとトレンド動画を取得**  
✅ **動画のタイトルと説明を要約（GPT-4）**  
✅ **音声で要約を読み上げ（`pyttsx3`）**  

---

## **実行例**
### **音声コマンドを入力**
🎤 **「おすすめの動画を教えて」**

### **スクリプトの動作**
1. **YouTube のトレンド動画を取得**
2. **タイトルと説明を要約**
3. **結果を画面に表示 & 音声で読み上げ**

### **音声出力の例**
🔊 **「動画タイトル: AI の未来。AI の進化と今後の影響について解説。」**  
🔊 **「動画タイトル: 京都の隠れた名所。観光客が少ない静かな穴場スポットを紹介。」**

---

## **カスタマイズ**
🎯 **コマンドを追加**
- **「アメリカのトレンド動画」** → `region_code="US"` に変更
- **「ゲームの動画」** → `category="Gaming"` を YouTube API のパラメータに追加  

💡 **音声で検索も可能**
- `command` に **「Python の動画を探して」** → **検索 API を実装**

---

## **まとめ**
✅ **音声コマンドでトレンド動画要約を取得**  
✅ **音声認識 + AI 要約 + 音声出力を統合**  
✅ **実行するだけで YouTube のおすすめ動画を音声で教えてくれる！**

🎤 **「おすすめの動画を教えて」と話せば、音声で結果を返す** スマートなスクリプトです！
