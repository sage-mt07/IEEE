---
conversation_id: "66f3d6f4-1b74-8007-bdca-052e9698ee2c"
title: "PowerShell ファイルアーカイブ スクリプト"
create_time: 1727256308.252637
update_time: 1727256399.551626
language_guess: "en"
num_messages: 7
part_index: 1
part_count: 1
---

### system — 2024-09-25T09:25:08.252637+00:00

_(empty)_

### user — 2024-09-25T09:25:08.259960+00:00

powershell de sitei folder ikano file wo archive suru
kousin bi wo mite 1 niti izen no monowo taishoutosuru
archive sita fairuha sakujosuru

### assistant — 2024-09-25T09:25:29.881330+00:00

_(empty)_

### assistant — 2024-09-25T09:25:29.881401+00:00

PowerShellで指定フォルダ内の1日以上前に更新されたファイルを対象にアーカイブし、アーカイブ後に削除するスクリプトの例です。以下のコードを参考にしてください。

```powershell
# アーカイブ対象のフォルダ
$sourceFolder = "C:\Path\To\SourceFolder"
# アーカイブ先のフォルダ
$archiveFolder = "C:\Path\To\ArchiveFolder"
# 1日以上前に更新されたファイルを対象とする
$daysAgo = (Get-Date).AddDays(-1)

# フォルダが存在しない場合、アーカイブ先フォルダを作成する
if (!(Test-Path -Path $archiveFolder)) {
    New-Item -ItemType Directory -Path $archiveFolder
}

# 指定フォルダ内の1日以上前に更新されたファイルを取得
Get-ChildItem -Path $sourceFolder -File | Where-Object { $_.LastWriteTime -lt $daysAgo } | ForEach-Object {
    $file = $_
    # ファイルをアーカイブフォルダに移動
    $destination = Join-Path -Path $archiveFolder -ChildPath $file.Name
    Move-Item -Path $file.FullName -Destination $destination

    # アーカイブが成功した場合、元のファイルを削除
    if (Test-Path -Path $destination) {
        Remove-Item -Path $file.FullName
    }
}
```

### 説明:
1. `$sourceFolder`: アーカイブ対象のフォルダのパス。
2. `$archiveFolder`: アーカイブファイルを保存するフォルダのパス。
3. `$daysAgo`: 現在の日付から1日以上前のファイルを対象にするための基準日。
4. `Get-ChildItem`: 対象フォルダ内のファイルを取得。
5. `Where-Object`: ファイルの最終更新日時を確認し、指定日以前のファイルをフィルタリング。
6. `Move-Item`: 対象ファイルをアーカイブフォルダに移動。
7. `Remove-Item`: アーカイブが成功した場合に元のファイルを削除。

これを実行することで、1日以上前に更新されたファイルがアーカイブされ、元のファイルが削除されます。

### user — 2024-09-25T09:26:18.247217+00:00

archive folder ha zip nisuru 
sonoatoni archive folder wo  sakujo

### assistant — 2024-09-25T09:26:38.943710+00:00

指定フォルダ内のファイルをアーカイブし、アーカイブ後にZIPファイルを作成して、元のフォルダとファイルを削除するPowerShellスクリプトを以下に示します。

```powershell
# アーカイブ対象のフォルダ
$sourceFolder = "C:\Path\To\SourceFolder"
# アーカイブ先のフォルダ
$archiveFolder = "C:\Path\To\ArchiveFolder"
# ZIPファイルの保存先
$zipFilePath = "C:\Path\To\Archive.zip"
# 1日以上前に更新されたファイルを対象とする
$daysAgo = (Get-Date).AddDays(-1)

# フォルダが存在しない場合、アーカイブ先フォルダを作成する
if (!(Test-Path -Path $archiveFolder)) {
    New-Item -ItemType Directory -Path $archiveFolder
}

# 指定フォルダ内の1日以上前に更新されたファイルを取得
Get-ChildItem -Path $sourceFolder -File | Where-Object { $_.LastWriteTime -lt $daysAgo } | ForEach-Object {
    $file = $_
    # ファイルをアーカイブフォルダに移動
    $destination = Join-Path -Path $archiveFolder -ChildPath $file.Name
    Move-Item -Path $file.FullName -Destination $destination
}

# アーカイブフォルダをZIPファイルに圧縮
if (Test-Path -Path $archiveFolder) {
    Compress-Archive -Path $archiveFolder -DestinationPath $zipFilePath

    # ZIPが成功した場合、アーカイブフォルダとその中のファイルを削除
    if (Test-Path -Path $zipFilePath) {
        Remove-Item -Path $archiveFolder -Recurse -Force
    }
}

```

### 説明:
1. `$sourceFolder`: アーカイブ対象のフォルダのパス。
2. `$archiveFolder`: 一時的にファイルを移動するアーカイブ用のフォルダ。
3. `$zipFilePath`: 圧縮されたZIPファイルの保存先。
4. `Get-ChildItem` と `Where-Object`: 1日以上前に更新されたファイルをフィルタリング。
5. `Move-Item`: ファイルをアーカイブフォルダに移動。
6. `Compress-Archive`: アーカイブフォルダをZIPファイルに圧縮。
7. `Remove-Item`: 圧縮が成功した場合、元のアーカイブフォルダとファイルを削除。

このスクリプトを実行すると、1日以上前に更新されたファイルがアーカイブフォルダに移動され、ZIPに圧縮された後に元のファイルとアーカイブフォルダが削除されます。
