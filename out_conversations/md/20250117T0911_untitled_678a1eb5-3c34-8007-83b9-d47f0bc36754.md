---
conversation_id: "678a1eb5-3c34-8007-83b9-d47f0bc36754"
title: "セキュリティパッチ管理方法"
create_time: 1737105077.59932
update_time: 1737105514.085717
language_guess: "en"
num_messages: 17
part_index: 1
part_count: 1
---

### system — 2025-01-17T09:11:17.599320+00:00

_(empty)_

### user — 2025-01-17T09:11:17.601292+00:00

以下の前提で適切な方法を提示
・会社で使用しているPCとそれに自宅から接続をおこなうPCがある
・上記PCはWindows１０である
・セキュリティパッチが最新化されていることを確認する
・その最新化は月に１回おこなう
・管理者はすべてのPCのセキュリティパッチが最新化していることを確認する

### tool — 2025-01-17T09:11:27.005426+00:00

**管理方法を探る**

会社のPCと自宅のPCの両方を管理し、最新のセキュリティパッチがインストールされていることを確認する方法を模索している。WUB、WSUS、SCCMなどのツールを活用して、中心化された管理システムを利用するのが良さげだね。

**中立化の工夫**

WSUSやMicrosoft Intuneを活用し、月次のセキュリティパッチを自動更新。会社とリモートPCを管理し、監査で最新パッチを確認する。

### assistant — 2025-01-17T09:11:27.005609+00:00

以下の前提条件に基づき、Windows 10 PCのセキュリティパッチを月に1回最新化し、管理者がすべてのPCの最新化状況を確認できる適切な方法を提案します。

## 1. 中央管理システムの導入

### **Microsoft Endpoint Manager (Intune) の利用**
Microsoft Endpoint Manager（Intune）は、クラウドベースの統合エンドポイント管理ソリューションで、リモートおよび社内のPCを一元管理できます。

- **利点:**
  - クラウドベースであり、リモートPCの管理が容易。
  - 自動更新のスケジューリングが可能。
  - セキュリティポリシーの適用とコンプライアンスの監視が可能。
  - レポート機能により、各PCの更新状況をリアルタイムで確認。

### **Windows Server Update Services (WSUS) の利用**
オンプレミス環境での管理を希望する場合、WSUSを利用して更新プログラムを管理・配信できます。

- **利点:**
  - ネットワーク内のPCに対してセキュリティパッチを集中管理。
  - 更新プログラムの承認・配信スケジュールの設定が可能。
  - 更新状況のレポート機能。

## 2. 更新プログラムのスケジューリング

- **月次更新の設定:**
  - 管理システム上で、セキュリティパッチの配信スケジュールを毎月特定の日に設定。
  - 更新のダウンロードとインストールを自動化し、ユーザーの操作を最小限に抑える。

## 3. PCの登録と管理

- **社内PCとリモートPCの登録:**
  - すべてのWindows 10 PCを選択した管理システム（IntuneまたはWSUS）に登録。
  - リモートPCの場合、VPN接続やインターネット経由で管理システムと通信できるよう設定。

## 4. セキュリティパッチの最新化確認

- **自動レポート生成:**
  - 管理者用のダッシュボードを設定し、各PCの更新状況を一目で確認できるようにする。
  - 定期的にレポートを生成し、最新化されていないPCがあればアラートを発生させる。

- **コンプライアンスの監視:**
  - 更新が適用されていないPCに対して自動的に通知を送信。
  - 必要に応じて、リモートでの更新プログラムの適用や再起動を実施。

## 5. セキュリティとアクセス管理

- **管理者権限の制限:**
  - 更新管理に必要な権限を持つ管理者アカウントを限定。
  - 多要素認証（MFA）を導入し、セキュリティを強化。

- **ログの監査:**
  - 更新プロセスや管理操作のログを定期的に監査し、不正な操作や問題を早期に検出。

## 6. ユーザー教育とサポート

- **更新の重要性の周知:**
  - 社員に対してセキュリティパッチの重要性を説明し、更新の実施を促す。
  
- **サポート体制の整備:**
  - 更新時に問題が発生した場合のサポート窓口を設置。

## 実施手順の概要

1. **管理システムの選定と導入**:
   - Microsoft Endpoint Manager (Intune) または WSUS を選択し、環境に合わせて導入。

2. **PCの登録とポリシー設定**:
   - すべてのWindows 10 PCを管理システムに登録。
   - 月次の更新スケジュールとセキュリティポリシーを設定。

3. **更新の配信と確認**:
   - 設定に基づき、セキュリティパッチを自動的に配信・インストール。
   - 管理者は定期的にダッシュボードやレポートを確認し、最新化状況を把握。

4. **問題対応と改善**:
   - 更新適用に失敗したPCへの対応策を実施。
   - 管理プロセスの定期的な見直しと改善。

## まとめ

Microsoft Endpoint Manager (Intune) や WSUS などの中央管理システムを導入することで、社内およびリモートのWindows 10 PCに対するセキュリティパッチの管理・配信を効率化できます。月次の自動更新設定と管理者による定期的な監視・レポート機能により、すべてのPCが常に最新のセキュリティパッチを適用されていることを確実に確認できます。

### user — 2025-01-17T09:11:49.256161+00:00

Intune,WSUSは使用できない

### tool — 2025-01-17T09:12:10.845669+00:00

**新しい方法を模索中**

IntuneやWSUSが使えない今、Windows Updateを管理するための他の方法を探している。グループポリシーやPowerShellスクリプト、サードパーティの管理ツールなど、さまざまなアプローチを検討中。

**リモートPCの管理方法を模索中**

リモートPCを管理するために、VPNやスクリプトを活用し、PCの更新ステータスを集約する方法を探っている。進行中の計画立案中。

**最新情報をリモートPCに**

各PCに月次で更新スクリプトを実行し、中央サーバーに報告。集約された更新報告を手動で確認し、リモートPCの最新状態を把握している。

**他の方法を模索中**

リモートPCにWindows Updateを自動設定し、ネットワークスキャンやステータス報告で確認中。VPN、WinRM、サードパーティーツール、APIも可能性として検討中。

**更新を管理する方法を探る**

Windows Updateの設定を調整し、PowerShellスクリプトを使用してタスクをスケジュールし、中央の場所にステータスを送る方法を詳しく説明している。

**スクリプトを配布して管理**

起動スクリプトをグループポリシーで配布したり、PowerShellスクリプトを使ってタスクをスケジュールして、報告システムを集約して報告を手動で確認したりする方法を探っている。

### assistant — 2025-01-17T09:12:10.845860+00:00

IntuneやWSUSを使用せずに、会社のWindows 10 PCおよびリモートのWindows 10 PCのセキュリティパッチを月に1回最新化し、管理者がすべてのPCの最新化状況を確認するための方法を以下に提案します。この方法では、**グループポリシー**（Active Directory環境の場合）、**PowerShellスクリプト**、および**タスクスケジューラ**を活用します。

## 全体のアプローチ

1. **Windows Updateの設定を自動化**：各PCが月に1回自動的にセキュリティパッチをダウンロードおよびインストールするように設定します。
2. **更新状況の収集と報告**：更新の実行状況を定期的に収集し、管理者が確認できるようにします。
3. **中央管理と監視**：収集されたデータを一元管理し、未更新のPCを特定します。

以下、具体的な手順を詳述します。

---

## 1. Windows Updateの自動化設定

### A. グループポリシー（Active Directory環境の場合）

1. **グループポリシー管理コンソールを開く**:
   - ドメインコントローラー上で「グループポリシー管理」を開きます。

2. **新しいGPOを作成**:
   - 適用対象のOU（組織単位）に対して新しいGPO（例：`Monthly Windows Update`）を作成します。

3. **ポリシー設定**:
   - 作成したGPOを編集し、以下の設定を行います。

   ```
   コンピュータの構成 → 管理用テンプレート → Windows コンポーネント → Windows Update
   ```

   - **自動更新を構成する**:
     - 「自動更新を構成する」を「有効」に設定し、更新のインストールを自動化します。
     - 更新のスケジュールを「月次」に設定するために、具体的な日時を指定します（例：毎月第1月曜日の深夜）。

   - **再起動のタイミングを設定**:
     - 更新後の再起動を自動化し、業務時間外に行うよう設定します。

4. **GPOの適用**:
   - 設定を保存し、対象のPCにGPOが適用されるようにします。`gpupdate /force` コマンドで即時適用も可能です。

### B. ローカルグループポリシー（ドメイン環境でない場合）

各PCで以下の手順を繰り返します。

1. **ローカルグループポリシーエディタを開く**:
   - `gpedit.msc` を実行。

2. **ポリシー設定**:
   ```
   コンピュータの構成 → 管理用テンプレート → Windows コンポーネント → Windows Update
   ```

   - **自動更新を構成する**を有効にし、月次の更新スケジュールを設定します。
   - 再起動のタイミングも同様に設定します。

---

## 2. 更新状況の収集と報告

### A. PowerShellスクリプトの作成

以下のスクリプトは、Windows Updateの状態を確認し、結果を中央サーバーに報告するものです。

```powershell
# 更新状況を取得
$UpdateSession = New-Object -ComObject Microsoft.Update.Session
$UpdateSearcher = $UpdateSession.CreateUpdateSearcher()
$SearchResult = $UpdateSearcher.Search("IsInstalled=0 and Type='Software' and IsHidden=0")

$PendingUpdates = $SearchResult.Updates.Count

# レポート内容を作成
$Report = @{
    PCName = $env:COMPUTERNAME
    Date = Get-Date -Format "yyyy-MM-dd"
    PendingUpdates = $PendingUpdates
}

# レポートをCSV形式で保存
$ReportPath = "\\CentralServer\UpdateReports\UpdateReport_$($env:COMPUTERNAME)_$(Get-Date -Format 'yyyyMMdd').csv"
$Report | Export-Csv -Path $ReportPath -NoTypeInformation -Append
```

**注意点**:
- `\\CentralServer\UpdateReports\` は、レポートを保存する中央サーバーの共有フォルダです。適切なアクセス権限を設定してください。
- このスクリプトは、未インストールのソフトウェア更新プログラムの数をカウントし、レポートとして保存します。

### B. タスクスケジューラでスクリプトを月次実行

1. **タスクスケジューラを開く**:
   - `taskschd.msc` を実行。

2. **新しいタスクの作成**:
   - 「基本タスクの作成」を選択し、名前（例：`Monthly Update Report`）を付けます。

3. **トリガーの設定**:
   - 「月次」を選択し、実行する月の特定の日（例：毎月1日）と時刻（例：午前2時）を設定します。

4. **操作の設定**:
   - 「プログラムの開始」を選択し、PowerShellを指定。
   - 引数に以下を入力:
     ```
     -ExecutionPolicy Bypass -File "C:\Scripts\UpdateReport.ps1"
     ```

5. **完了**:
   - 設定を確認し、タスクを保存します。

### C. 中央サーバーでのレポートの集約

1. **共有フォルダの設定**:
   - 中央サーバー上に `UpdateReports` フォルダを作成し、各PCが書き込めるように権限を設定します。

2. **定期的な確認**:
   - 管理者はこのフォルダを定期的にチェックし、各PCの`PendingUpdates`数を確認します。
   - `PendingUpdates`が0でない場合、そのPCは更新が完了していないと判断し、対策を講じます。

3. **自動集計（オプション）**:
   - PowerShellやExcelのマクロを使用して、複数のレポートを自動的に集計し、ダッシュボードを作成することも可能です。

---

## 3. 中央管理と監視

### A. ダッシュボードの作成（オプション）

管理者が一目で全PCの更新状況を把握できるように、ExcelやPower BIを使用してダッシュボードを作成します。

1. **データの取り込み**:
   - 共有フォルダ内のCSVファイルを定期的に読み込みます。

2. **集計と可視化**:
   - 各PCの`PendingUpdates`数を集計し、グラフやテーブルで表示します。
   - 更新が必要なPCをハイライト表示します。

### B. 通知システムの導入（オプション）

未更新のPCがある場合に、管理者に自動で通知を送る仕組みを追加します。以下はPowerShellを使用した例です。

```powershell
# 集計スクリプト例
$Reports = Get-ChildItem "\\CentralServer\UpdateReports\" -Filter "*.csv" | Import-Csv
$NonCompliantPCs = $Reports | Where-Object { $_.PendingUpdates -gt 0 }

if ($NonCompliantPCs.Count -gt 0) {
    $Body = "以下のPCで未更新のセキュリティパッチがあります:`n"
    $NonCompliantPCs | ForEach-Object {
        $Body += "PC名: $($_.PCName), 未更新数: $($_.PendingUpdates)`n"
    }

    Send-MailMessage -From "[[REDACTED_EMAIL]]" -To "[[REDACTED_EMAIL]]" -Subject "未更新PCのアラート" -Body $Body -SmtpServer "smtp.yourcompany.com"
}
```

**注意点**:
- `Send-MailMessage` のパラメータは環境に合わせて調整してください。
- このスクリプトをタスクスケジューラで毎月実行することで、未更新PCがある場合にメール通知を受け取れます。

---

## 4. セキュリティとアクセス管理

### A. レポート共有フォルダのセキュリティ

- **アクセス権限の制限**:
  - `UpdateReports`フォルダへの書き込み権限を更新を実行するユーザーまたはシステムアカウントのみに制限します。
  - 管理者のみがフォルダの内容を閲覧できるように設定します。

### B. スクリプトのセキュリティ

- **スクリプトの署名**:
  - PowerShellスクリプトに署名を施し、実行ポリシーを設定することで、信頼できるスクリプトのみが実行されるようにします。

- **実行ポリシーの設定**:
  - `Set-ExecutionPolicy` コマンドレットを使用して、スクリプトの実行を制御します（例：`RemoteSigned` や `AllSigned`）。

### C. 管理者権限の管理

- **限定された管理者アカウント**:
  - 更新管理やレポート収集に使用する管理者アカウントを限定し、強力なパスワードや多要素認証（MFA）を導入します。

---

## 5. ユーザー教育とサポート

### A. 更新の重要性の周知

- **定期的な通知**:
  - 社員に対して、セキュリティパッチの重要性と月次更新のスケジュールを通知します。
  
- **教育資料の提供**:
  - 更新に関するFAQやトラブルシューティングガイドを提供し、ユーザーが自分で基本的な問題を解決できるようにします。

### B. サポート体制の整備

- **サポート窓口の設置**:
  - 更新時に問題が発生した場合に対応できるITサポート窓口を設置します。

- **リモートサポートツールの導入**:
  - リモートデスクトップや他のリモート管理ツールを使用して、問題発生時に迅速に対応します。

---

## まとめ

IntuneやWSUSを使用せずに、グループポリシーとPowerShellスクリプトを組み合わせることで、Windows 10 PCのセキュリティパッチを月に1回自動的に更新し、管理者がその状況を確認するシステムを構築できます。この方法は、以下の利点を提供します：

- **自動化**：更新とレポートのプロセスが自動化され、手動作業を削減。
- **可視性**：中央でレポートを収集し、全PCの更新状況を一元管理。
- **セキュリティ**：適切なアクセス制御とセキュリティ設定により、システム全体の安全性を確保。

このアプローチを実装することで、セキュリティパッチの最新化を確実に行い、全PCが常に最新の状態に保たれるようになります。

### user — 2025-01-17T09:16:21.502405+00:00

Get-HotFixを使用する

### tool — 2025-01-17T09:16:51.489211+00:00

**使用方法を模索中**

IntuneやWSUSを使えない場合、Get-HotFixのPowerShellコマンドレットを活用して、セキュリティパッチの確認や更新スケジュールの管理を提案している。

### assistant — 2025-01-17T09:16:51.489348+00:00

`Get-HotFix` コマンドレットを使用して、Windows 10 PCのセキュリティパッチの適用状況を確認し、月に1回の更新および管理者による監視を自動化する方法を以下に詳述します。この方法では、**PowerShellスクリプト**、**タスクスケジューラ**、および**共有ネットワークフォルダ**を活用します。

## 全体のアプローチ

1. **Windows Updateの自動化**：各PCが月に1回自動的にセキュリティパッチをダウンロードおよびインストールするよう設定します。
2. **更新状況の確認**：`Get-HotFix` を使用して、必要なセキュリティパッチが適用されているか確認します。
3. **レポートの生成と収集**：各PCから更新状況をレポートとして収集し、中央サーバーに集約します。
4. **管理者による監視**：中央サーバー上でレポートを確認し、未更新のPCを特定します。

以下、具体的な手順を詳細に説明します。

---

## 1. Windows Updateの自動化

### A. Windows Updateのスケジュール設定

各PCが月に1回自動的に更新を実行するように、PowerShellスクリプトとタスクスケジューラを設定します。

#### 1. PowerShellスクリプトの作成

以下のスクリプト `MonthlyUpdate.ps1` を各PCに配置します。スクリプトは、Windows Updateを実行し、必要に応じて再起動します。

```powershell
# MonthlyUpdate.ps1

# Windows Updateのモジュールをインポート
Import-Module PSWindowsUpdate

# Windows Updateの実行
Write-Output "[$(Get-Date)] Windows Updateを開始します。"
Install-WindowsUpdate -AcceptAll -AutoReboot -IgnoreReboot | Out-File -FilePath "C:\Scripts\UpdateLog.txt" -Append

Write-Output "[$(Get-Date)] Windows Updateが完了しました。"
```

**注意点**:
- `PSWindowsUpdate` モジュールを使用します。このモジュールがインストールされていない場合は、以下のコマンドでインストールしてください（管理者権限が必要です）。

  ```powershell
  Install-Module -Name PSWindowsUpdate -Force
  ```

#### 2. タスクスケジューラでのスクリプト実行設定

1. **タスクスケジューラを開く**:
   - `taskschd.msc` を実行してタスクスケジューラを開きます。

2. **新しいタスクの作成**:
   - 右側の「タスクの作成」をクリック。

3. **一般タブ**:
   - 名前: `Monthly Windows Update`
   - 「最上位の特権で実行する」にチェックを入れる。
   - 「ユーザーがログオンしているかどうかに関係なく実行する」を選択。

4. **トリガータブ**:
   - 「新規(N)...」をクリック。
   - 「スケジュールの開始」: 毎月
   - 「開始」日時を設定（例：毎月1日 午前2時）
   - 必要に応じてその他の設定を調整。
   - 「OK」をクリック。

5. **操作タブ**:
   - 「新規(N)...」をクリック。
   - 「操作」: プログラムの開始
   - 「プログラム/スクリプト」: `powershell.exe`
   - 「引数の追加」:
     ```plaintext
     -ExecutionPolicy Bypass -File "C:\Scripts\MonthlyUpdate.ps1"
     ```
   - 「OK」をクリック。

6. **条件タブおよび設定タブ**:
   - 必要に応じて電源やネットワーク条件を設定。
   - 例：ラップトップの場合、「電源に接続されている場合のみ実行する」にチェック。

7. **タスクの保存**:
   - 設定を確認し、「OK」をクリック。

---

## 2. 更新状況の確認とレポート生成

### A. 更新状況確認スクリプトの作成

`Get-HotFix` を使用して、特定のセキュリティパッチが適用されているか確認し、レポートを生成します。

以下のスクリプト `CheckUpdates.ps1` を各PCに配置します。

```powershell
# CheckUpdates.ps1

# 必要なセキュリティパッチのリスト（KB番号）
$RequiredKBs = @(
    "KB5003637", # 例: セキュリティパッチ1
    "KB5004237", # 例: セキュリティパッチ2
    # 必要に応じて追加
)

# PC名と日付の取得
$PCName = $env:COMPUTERNAME
$Date = Get-Date -Format "yyyy-MM-dd"

# 適用された更新プログラムの取得
$InstalledKBs = Get-HotFix | Where-Object {$_.HotFixID -match "^KB\d+$"} | Select-Object -ExpandProperty HotFixID

# 未適用の更新プログラムの確認
$MissingKBs = $RequiredKBs | Where-Object {$_ -notin $InstalledKBs}

# レポート内容の作成
$Report = [PSCustomObject]@{
    PCName       = $PCName
    Date         = $Date
    MissingKBs   = ($MissingKBs -join ", ")
}

# レポートをCSV形式で保存
$ReportPath = "\\CentralServer\UpdateReports\UpdateReport_$($PCName)_$($Date).csv"
$Report | Export-Csv -Path $ReportPath -NoTypeInformation -Append
```

**注意点**:
- `$RequiredKBs` 配列に、適用が必要なセキュリティパッチのKB番号を追加します。
- `\\CentralServer\UpdateReports\` は、中央サーバー上の共有フォルダです。適切な共有設定とアクセス権限を設定してください。

### B. タスクスケジューラでのレポート生成スクリプト実行設定

1. **タスクスケジューラを開く**:
   - `taskschd.msc` を実行してタスクスケジューラを開きます。

2. **新しいタスクの作成**:
   - 右側の「タスクの作成」をクリック。

3. **一般タブ**:
   - 名前: `Check Windows Updates`
   - 「最上位の特権で実行する」にチェックを入れる。
   - 「ユーザーがログオンしているかどうかに関係なく実行する」を選択。

4. **トリガータブ**:
   - 「新規(N)...」をクリック。
   - 「スケジュールの開始」: 毎月
   - 「開始」日時を設定（例：毎月1日 午前3時）
   - 「月次」を選択し、適用する月の日を指定。
   - 「OK」をクリック。

5. **操作タブ**:
   - 「新規(N)...」をクリック。
   - 「操作」: プログラムの開始
   - 「プログラム/スクリプト」: `powershell.exe`
   - 「引数の追加」:
     ```plaintext
     -ExecutionPolicy Bypass -File "C:\Scripts\CheckUpdates.ps1"
     ```
   - 「OK」をクリック。

6. **条件タブおよび設定タブ**:
   - 必要に応じて電源やネットワーク条件を設定。
   - 例：ラップトップの場合、「電源に接続されている場合のみ実行する」にチェック。

7. **タスクの保存**:
   - 設定を確認し、「OK」をクリック。

---

## 3. レポートの収集と中央管理

### A. 共有フォルダの設定

1. **中央サーバー上に共有フォルダを作成**:
   - パス例: `\\CentralServer\UpdateReports\`

2. **共有設定**:
   - フォルダの共有設定を行い、各PCがレポートを書き込めるように権限を設定します。
   - **セキュリティ**:
     - 読み取り・書き込み権限を更新確認用のシステムアカウントまたは適切なグループに付与。
     - 管理者のみがレポートを閲覧できるように設定。

### B. 管理者によるレポートの集約

管理者が中央サーバー上の共有フォルダからレポートを集約し、更新状況を確認します。以下の手順で集約を自動化できます。

#### 1. 集約スクリプトの作成

以下のスクリプト `AggregateReports.ps1` を中央サーバー上に配置し、定期的に実行します。

```powershell
# AggregateReports.ps1

$ReportFolder = "\\CentralServer\UpdateReports\"
$AggregateFile = "\\CentralServer\UpdateReports\AggregatedReport.csv"

# すべてのレポートファイルを取得
$ReportFiles = Get-ChildItem -Path $ReportFolder -Filter "UpdateReport_*.csv"

# 集約用のデータフレームを初期化
$AggregatedData = @()

foreach ($File in $ReportFiles) {
    $Data = Import-Csv -Path $File.FullName
    $AggregatedData += $Data
}

# 集約データをCSVにエクスポート
$AggregatedData | Export-Csv -Path $AggregateFile -NoTypeInformation

# 古いレポートファイルの削除（オプション）
# Remove-Item -Path $ReportFiles.FullName
```

#### 2. タスクスケジューラでの集約スクリプト実行設定

1. **タスクスケジューラを開く**:
   - `taskschd.msc` を実行してタスクスケジューラを開きます。

2. **新しいタスクの作成**:
   - 右側の「タスクの作成」をクリック。

3. **一般タブ**:
   - 名前: `Aggregate Update Reports`
   - 「最上位の特権で実行する」にチェックを入れる。
   - 「ユーザーがログオンしているかどうかに関係なく実行する」を選択。

4. **トリガータブ**:
   - 「新規(N)...」をクリック。
   - 「スケジュールの開始」: 毎月
   - 「開始」日時を設定（例：毎月2日 午前1時）
   - 「月次」を選択し、適用する月の日を指定。
   - 「OK」をクリック。

5. **操作タブ**:
   - 「新規(N)...」をクリック。
   - 「操作」: プログラムの開始
   - 「プログラム/スクリプト」: `powershell.exe`
   - 「引数の追加」:
     ```plaintext
     -ExecutionPolicy Bypass -File "C:\Scripts\AggregateReports.ps1"
     ```
   - 「OK」をクリック。

6. **条件タブおよび設定タブ**:
   - 必要に応じて電源やネットワーク条件を設定。

7. **タスクの保存**:
   - 設定を確認し、「OK」をクリック。

---

## 4. 管理者による監視と通知

### A. 集約レポートの確認

管理者は中央サーバー上の `AggregatedReport.csv` を定期的に確認し、`MissingKBs` 列に値があるPCを特定します。

#### 1. Excelでの確認

1. `AggregatedReport.csv` をExcelで開きます。
2. フィルター機能を使用して、`MissingKBs` 列が空でない行を表示します。
3. 未適用のセキュリティパッチがあるPCをリストアップし、対応を検討します。

#### 2. PowerShellを使用した自動通知

以下のスクリプト `NotifyAdmins.ps1` を作成し、未更新のPCが存在する場合にメール通知を送信します。

```powershell
# NotifyAdmins.ps1

$AggregateFile = "\\CentralServer\UpdateReports\AggregatedReport.csv"
$AdminEmail = "[[REDACTED_EMAIL]]"
$FromEmail = "[[REDACTED_EMAIL]]"
$SMTPServer = "smtp.yourcompany.com"

# 集約レポートの読み込み
$Reports = Import-Csv -Path $AggregateFile

# 未更新のPCを抽出
$NonCompliantPCs = $Reports | Where-Object { $_.MissingKBs -ne "" }

if ($NonCompliantPCs.Count -gt 0) {
    $Body = "以下のPCで未更新のセキュリティパッチがあります:`n`n"
    foreach ($pc in $NonCompliantPCs) {
        $Body += "PC名: $($pc.PCName), 未適用のKB: $($pc.MissingKBs)`n"
    }

    Send-MailMessage -From $FromEmail -To $AdminEmail -Subject "未更新PCのアラート" -Body $Body -SmtpServer $SMTPServer
}
```

#### 3. タスクスケジューラでの通知スクリプト実行設定

1. **タスクスケジューラを開く**:
   - `taskschd.msc` を実行してタスクスケジューラを開きます。

2. **新しいタスクの作成**:
   - 右側の「タスクの作成」をクリック。

3. **一般タブ**:
   - 名前: `Notify Admins of Missing Updates`
   - 「最上位の特権で実行する」にチェックを入れる。
   - 「ユーザーがログオンしているかどうかに関係なく実行する」を選択。

4. **トリガータブ**:
   - 「新規(N)...」をクリック。
   - 「スケジュールの開始」: 毎月
   - 「開始」日時を設定（例：毎月2日 午前2時）
   - 「月次」を選択し、適用する月の日を指定。
   - 「OK」をクリック。

5. **操作タブ**:
   - 「新規(N)...」をクリック。
   - 「操作」: プログラムの開始
   - 「プログラム/スクリプト」: `powershell.exe`
   - 「引数の追加」:
     ```plaintext
     -ExecutionPolicy Bypass -File "C:\Scripts\NotifyAdmins.ps1"
     ```
   - 「OK」をクリック。

6. **Conditionsタブおよび設定タブ**:
   - 必要に応じて電源やネットワーク条件を設定。

7. **タスクの保存**:
   - 設定を確認し、「OK」をクリック。

---

## 5. セキュリティとアクセス管理

### A. 共有フォルダのセキュリティ設定

- **アクセス権限の管理**:
  - `UpdateReports` フォルダへのアクセス権限を、レポートを送信するPCおよび管理者のみに制限します。
  - NTFS権限と共有権限を適切に設定し、不正アクセスを防止します。

### B. スクリプトのセキュリティ

- **スクリプトの署名**:
  - PowerShellスクリプトにデジタル署名を施し、信頼できるスクリプトのみが実行されるようにします。
  - 署名されたスクリプトのみを実行するために、実行ポリシーを `AllSigned` または `RemoteSigned` に設定します。

  ```powershell
  Set-ExecutionPolicy RemoteSigned -Scope LocalMachine
  ```

- **スクリプトの保存場所**:
  - スクリプトは管理者のみがアクセスできるディレクトリ（例：`C:\Scripts\`）に保存します。

### C. 管理者権限の管理

- **限定された管理者アカウントの使用**:
  - 更新管理やレポート収集に使用する管理者アカウントを限定し、強力なパスワードおよび多要素認証（MFA）を導入します。

- **定期的な監査**:
  - 管理者アカウントの使用状況を定期的に監査し、不正なアクセスや操作がないか確認します。

---

## 6. ユーザー教育とサポート

### A. 更新の重要性の周知

- **定期的な通知**:
  - 社員に対して、セキュリティパッチの重要性と月次更新のスケジュールを定期的に通知します。

- **教育資料の提供**:
  - 更新に関するFAQやトラブルシューティングガイドを提供し、ユーザーが基本的な問題を自己解決できるようにします。

### B. サポート体制の整備

- **サポート窓口の設置**:
  - 更新時に問題が発生した場合に対応できるITサポート窓口を設置します。

- **リモートサポートツールの導入**:
  - リモートデスクトップや他のリモート管理ツールを使用して、問題発生時に迅速に対応します。

---

## まとめ

`Get-HotFix` を活用したこの方法により、IntuneやWSUSを使用せずに、Windows 10 PCのセキュリティパッチを月に1回自動的に更新し、その適用状況を管理者が確認できる仕組みを構築できます。以下の利点があります：

- **自動化**：更新プロセスとレポート生成が自動化され、手動作業を削減。
- **可視性**：中央でレポートを集約し、全PCの更新状況を一元管理。
- **セキュリティ**：適切なアクセス制御とセキュリティ設定により、システム全体の安全性を確保。
- **柔軟性**：PowerShellスクリプトをカスタマイズすることで、特定の要件に対応可能。

このアプローチを実装することで、すべてのPCが常に最新のセキュリティパッチを適用されていることを確実に確認し、セキュリティリスクを最小限に抑えることができます。

### user — 2025-01-17T09:17:21.330077+00:00

必要なセキュリティパッチのリストはURLからとれないか

### tool — 2025-01-17T09:18:02.465619+00:00

**動的データ取得を模索**

セキュリティパッチのリストを手動で管理する代わりに、パワーシェルスクリプトでMicrosoft Update CatalogやMicrosoft Security Update GuideのAPIを使って動的に必要なパッチを取得できる方法を提案している。

**API活用を検討中**

Microsoft Security Update APIやMicrosoft Graphを使って、必要なセキュリティパッチのリストをプログラム的に取得する方法を探っているところ。これを用いれば、現行のスクリプトの管理がしやすくなるんだ。

**APIの活用を提案**

Microsoft Security Update Guide APIを使って、Windows 10の最新セキュリティパッチを取得し、これをパワーシェルスクリプトに統合する方法を提案している。

**APIの利用促進**

Microsoft Security Update Guide APIを活用してWindows 10のセキュリティパッチを取得し、パワーシェルスクリプトに統合する手順を説明している。

### assistant — 2025-01-17T09:18:02.465743+00:00

セキュリティパッチのリストを手動で管理する代わりに、公式の情報源から自動的に取得する方法を導入することで、最新のセキュリティアップデートを効率的に管理できます。以下では、**Microsoft Security Update Guide API** を利用して必要なセキュリティパッチのリストを動的に取得し、`Get-HotFix` と組み合わせて管理者が更新状況を確認できる仕組みを構築する方法を詳述します。

## 全体のアプローチ

1. **Microsoft Security Update Guide APIの利用**：必要なセキュリティパッチのリストを公式APIから取得。
2. **PowerShellスクリプトの作成**：取得したパッチ情報を基に、各PCの適用状況を確認。
3. **レポートの生成と収集**：更新状況をレポートとして中央サーバーに集約。
4. **管理者による監視と通知**：集約されたレポートを基に未更新のPCを特定し、必要に応じて通知。

以下、各ステップを詳細に説明します。

---

## 1. Microsoft Security Update Guide APIの利用

### A. APIへの登録とアクセス

Microsoft Security Update Guide (MSUSG) は、セキュリティアップデートに関する詳細な情報を提供する公式サービスです。APIを利用することで、プログラムから直接アップデート情報を取得できます。

1. **MSUSG APIの登録**:
   - [Microsoft Security Update Guide API Portal](https://portal.msrc.microsoft.com/en-us/api) にアクセスし、アカウントを作成またはログインします。
   - APIキーの取得が必要です。APIキーは、APIリクエストの認証に使用されます。

2. **APIドキュメントの確認**:
   - APIのエンドポイントやリクエスト方法、レスポンス形式などを確認します。
   - 特に、Windows 10向けのセキュリティ更新プログラムをフィルタリングする方法を理解します。

### B. PowerShellを使用したAPIリクエスト

取得したAPIキーを使用して、PowerShellスクリプトから必要なセキュリティパッチのリストを取得します。

#### サンプルスクリプト: セキュリティパッチの取得

```powershell
# Parameters
$ApiKey = "YOUR_API_KEY_HERE"  # 取得したAPIキーを入力
$BaseUrl = "https://api.msrc.microsoft.com/cvrf/v2.0/document"
$Product = "Windows 10"

# Headers
$Headers = @{
    "Authorization" = "Bearer $ApiKey"
    "Content-Type"  = "application/json"
}

# Query Parameters
$Params = @{
    "product" = $Product
    "classification" = "Security Update"
    "pageSize" = 1000
}

# APIリクエスト
$response = Invoke-RestMethod -Uri $BaseUrl -Method Get -Headers $Headers -Body ($Params | ConvertTo-Json)

# エラーハンドリング
if ($response -eq $null) {
    Write-Error "Failed to retrieve security updates from MSUSG API."
    exit
}

# 必要なKB番号の抽出
$RequiredKBs = @()

foreach ($update in $response.CVEItems) {
    foreach ($ref in $update.References) {
        if ($ref.RefType -eq "KB") {
            $kb = $ref.RefId
            if ($kb -match "^KB\d+$") {
                $RequiredKBs += $kb
            }
        }
    }
}

# 重複の削除
$RequiredKBs = $RequiredKBs | Sort-Object -Unique

# 結果の表示
$RequiredKBs
```

**注意点**:

- `YOUR_API_KEY_HERE` を実際に取得したAPIキーに置き換えてください。
- APIのエンドポイントやパラメータは、MSUSGの最新ドキュメントを確認してください。
- 上記スクリプトは基本的な例です。APIのレスポンス形式に応じて調整が必要な場合があります。

---

## 2. PowerShellスクリプトの作成

取得したセキュリティパッチのリストを基に、各PCに適用されているかを確認するスクリプトを作成します。

### A. セキュリティパッチ取得とチェックの統合

以下のスクリプトは、MSUSG APIからセキュリティパッチを取得し、`Get-HotFix` を使用して各PCの適用状況を確認し、レポートを生成します。

```powershell
# Parameters
$ApiKey = "YOUR_API_KEY_HERE"  # 取得したAPIキーを入力
$BaseUrl = "https://api.msrc.microsoft.com/cvrf/v2.0/document"
$Product = "Windows 10"
$ReportFolder = "\\CentralServer\UpdateReports\"
$Date = Get-Date -Format "yyyy-MM-dd"

# Headers
$Headers = @{
    "Authorization" = "Bearer $ApiKey"
    "Content-Type"  = "application/json"
}

# Query Parameters
$Params = @{
    "product" = $Product
    "classification" = "Security Update"
    "pageSize" = 1000
}

# APIリクエスト
$response = Invoke-RestMethod -Uri $BaseUrl -Method Get -Headers $Headers -Body ($Params | ConvertTo-Json)

# エラーハンドリング
if ($response -eq $null) {
    Write-Error "Failed to retrieve security updates from MSUSG API."
    exit
}

# 必要なKB番号の抽出
$RequiredKBs = @()

foreach ($update in $response.CVEItems) {
    foreach ($ref in $update.References) {
        if ($ref.RefType -eq "KB") {
            $kb = $ref.RefId
            if ($kb -match "^KB\d+$") {
                $RequiredKBs += $kb
            }
        }
    }
}

# 重複の削除
$RequiredKBs = $RequiredKBs | Sort-Object -Unique

# PC情報の取得
$PCName = $env:COMPUTERNAME

# 適用された更新プログラムの取得
$InstalledKBs = Get-HotFix | Where-Object { $_.HotFixID -match "^KB\d+$" } | Select-Object -ExpandProperty HotFixID

# 未適用の更新プログラムの確認
$MissingKBs = $RequiredKBs | Where-Object { $_ -notin $InstalledKBs }

# レポート内容の作成
$Report = [PSCustomObject]@{
    PCName     = $PCName
    Date       = $Date
    MissingKBs = ($MissingKBs -join ", ")
}

# レポートをCSV形式で保存
$ReportPath = Join-Path -Path $ReportFolder -ChildPath "UpdateReport_$($PCName)_$($Date).csv"
$Report | Export-Csv -Path $ReportPath -NoTypeInformation -Append

# ログの出力
if ($MissingKBs.Count -gt 0) {
    Write-Output "[$(Get-Date)] 未適用のセキュリティパッチ: $($MissingKBs -join ', ')"
} else {
    Write-Output "[$(Get-Date)] すべてのセキュリティパッチが適用されています。"
}
```

**説明**:

1. **MSUSG APIからセキュリティパッチを取得**:
   - APIキーと必要なパラメータを使用して、Windows 10向けのセキュリティアップデートを取得します。
   
2. **必要なKB番号の抽出**:
   - レスポンスからKB番号を抽出し、重複を排除します。

3. **適用状況の確認**:
   - `Get-HotFix` を使用して、インストールされているKBを取得。
   - 必要なKBと比較し、未適用のKBを特定します。

4. **レポートの生成**:
   - 未適用のKBがある場合、その情報をレポートとして中央サーバーに保存します。

**注意点**:

- APIキーの管理は厳重に行ってください。スクリプト内にハードコードする場合は、アクセス権限を適切に設定してください。
- レスポンス形式が変わる可能性があるため、APIのアップデート情報を定期的に確認してください。
- `PSWindowsUpdate` モジュールのインストールは不要です。このスクリプトは `Get-HotFix` を使用しています。

---

## 3. レポートの生成と収集

### A. タスクスケジューラでのスクリプト実行設定

1. **タスクスケジューラを開く**:
   - `taskschd.msc` を実行してタスクスケジューラを開きます。

2. **新しいタスクの作成**:
   - 右側の「タスクの作成」をクリック。

3. **一般タブ**:
   - 名前: `Monthly Security Update Check`
   - 「最上位の特権で実行する」にチェックを入れる。
   - 「ユーザーがログオンしているかどうかに関係なく実行する」を選択。

4. **トリガータブ**:
   - 「新規(N)...」をクリック。
   - 「スケジュールの開始」: 毎月
   - 「開始」日時を設定（例：毎月1日 午前2時）
   - 「月次」を選択し、適用する月の日を指定（例：毎月1日）。
   - 「OK」をクリック。

5. **操作タブ**:
   - 「新規(N)...」をクリック。
   - 「操作」: プログラムの開始
   - 「プログラム/スクリプト」: `powershell.exe`
   - 「引数の追加」:
     ```plaintext
     -ExecutionPolicy Bypass -File "C:\Scripts\CheckUpdates.ps1"
     ```
     （`CheckUpdates.ps1` は上記のスクリプトの保存場所）

6. **Conditionsタブおよび設定タブ**:
   - 必要に応じて電源やネットワーク条件を設定。
   - 例：ラップトップの場合、「電源に接続されている場合のみ実行する」にチェック。

7. **タスクの保存**:
   - 設定を確認し、「OK」をクリック。

### B. 共有フォルダの設定

1. **中央サーバー上に共有フォルダを作成**:
   - パス例: `\\CentralServer\UpdateReports\`

2. **共有設定**:
   - フォルダの共有設定を行い、各PCがレポートを書き込めるように権限を設定します。
   - **セキュリティ**:
     - 書き込み権限を更新確認用のシステムアカウントまたは適切なグループに付与。
     - 管理者のみがフォルダの内容を閲覧できるように設定。

---

## 4. 管理者による監視と通知

### A. レポートの集約

管理者は中央サーバー上の共有フォルダからレポートを集約し、全PCの更新状況を確認します。以下の方法で自動集約および通知を行います。

#### 1. 集約スクリプトの作成

```powershell
# AggregateReports.ps1

$ReportFolder = "\\CentralServer\UpdateReports\"
$AggregateFile = "\\CentralServer\UpdateReports\AggregatedReport.csv"

# すべてのレポートファイルを取得
$ReportFiles = Get-ChildItem -Path $ReportFolder -Filter "UpdateReport_*.csv"

# 集約用のデータフレームを初期化
$AggregatedData = @()

foreach ($File in $ReportFiles) {
    $Data = Import-Csv -Path $File.FullName
    $AggregatedData += $Data
}

# 集約データをCSVにエクスポート
$AggregatedData | Export-Csv -Path $AggregateFile -NoTypeInformation

# 古いレポートファイルの削除（オプション）
# Remove-Item -Path $ReportFiles.FullName
```

#### 2. 通知スクリプトの作成

```powershell
# NotifyAdmins.ps1

$AggregateFile = "\\CentralServer\UpdateReports\AggregatedReport.csv"
$AdminEmail = "[[REDACTED_EMAIL]]"
$FromEmail = "[[REDACTED_EMAIL]]"
$SMTPServer = "smtp.yourcompany.com"

# 集約レポートの読み込み
$Reports = Import-Csv -Path $AggregateFile

# 未更新のPCを抽出
$NonCompliantPCs = $Reports | Where-Object { $_.MissingKBs -ne "" }

if ($NonCompliantPCs.Count -gt 0) {
    $Body = "以下のPCで未更新のセキュリティパッチがあります:`n`n"
    foreach ($pc in $NonCompliantPCs) {
        $Body += "PC名: $($pc.PCName), 未適用のKB: $($pc.MissingKBs)`n"
    }

    Send-MailMessage -From $FromEmail -To $AdminEmail -Subject "未更新PCのアラート" -Body $Body -SmtpServer $SMTPServer
}
```

#### 3. 集約および通知タスクのスケジューリング

**集約スクリプトのタスク設定**:

1. **タスクスケジューラを開く**。
2. **新しいタスクの作成**。
3. **一般タブ**:
   - 名前: `Aggregate Update Reports`
   - 「最上位の特権で実行する」にチェック。
   - 「ユーザーがログオンしているかどうかに関係なく実行する」を選択。
4. **トリガータブ**:
   - 「新規(N)...」をクリック。
   - 「スケジュールの開始」: 毎月
   - 「開始」日時を設定（例：毎月2日 午前1時）
   - 「月次」を選択し、適用する月の日を指定。
   - 「OK」をクリック。
5. **操作タブ**:
   - 「新規(N)...」をクリック。
   - 「プログラム/スクリプト」: `powershell.exe`
   - 「引数の追加」:
     ```plaintext
     -ExecutionPolicy Bypass -File "C:\Scripts\AggregateReports.ps1"
     ```
6. **タスクの保存**。

**通知スクリプトのタスク設定**:

1. **タスクスケジューラを開く**。
2. **新しいタスクの作成**。
3. **一般タブ**:
   - 名前: `Notify Admins of Missing Updates`
   - 「最上位の特権で実行する」にチェック。
   - 「ユーザーがログオンしているかどうかに関係なく実行する」を選択。
4. **トリガータブ**:
   - 「新規(N)...」をクリック。
   - 「スケジュールの開始」: 毎月
   - 「開始」日時を設定（例：毎月2日 午前2時）
   - 「月次」を選択し、適用する月の日を指定。
   - 「OK」をクリック。
5. **操作タブ**:
   - 「新規(N)...」をクリック。
   - 「プログラム/スクリプト」: `powershell.exe`
   - 「引数の追加」:
     ```plaintext
     -ExecutionPolicy Bypass -File "C:\Scripts\NotifyAdmins.ps1"
     ```
6. **タスクの保存**。

---

## 5. セキュリティとアクセス管理

### A. 共有フォルダのセキュリティ設定

- **アクセス権限の管理**:
  - `\\CentralServer\UpdateReports\` フォルダへのアクセス権限を、レポートを送信するPCおよび管理者のみに制限します。
  - NTFS権限と共有権限を適切に設定し、不正アクセスを防止します。

### B. スクリプトのセキュリティ

- **スクリプトの署名**:
  - PowerShellスクリプトにデジタル署名を施し、信頼できるスクリプトのみが実行されるようにします。
  
- **実行ポリシーの設定**:
  - `Set-ExecutionPolicy` コマンドレットを使用して、スクリプトの実行を制御します（例：`RemoteSigned` や `AllSigned`）。
    ```powershell
    Set-ExecutionPolicy RemoteSigned -Scope LocalMachine
    ```

- **スクリプトの保存場所**:
  - スクリプトは管理者のみがアクセスできるディレクトリ（例：`C:\Scripts\`）に保存します。

### C. 管理者権限の管理

- **限定された管理者アカウントの使用**:
  - 更新管理やレポート収集に使用する管理者アカウントを限定し、強力なパスワードおよび多要素認証（MFA）を導入します。

- **定期的な監査**:
  - 管理者アカウントの使用状況を定期的に監査し、不正なアクセスや操作がないか確認します。

---

## 6. ユーザー教育とサポート

### A. 更新の重要性の周知

- **定期的な通知**:
  - 社員に対して、セキュリティパッチの重要性と月次更新のスケジュールを定期的に通知します。

- **教育資料の提供**:
  - 更新に関するFAQやトラブルシューティングガイドを提供し、ユーザーが基本的な問題を自己解決できるようにします。

### B. サポート体制の整備

- **サポート窓口の設置**:
  - 更新時に問題が発生した場合に対応できるITサポート窓口を設置します。

- **リモートサポートツールの導入**:
  - リモートデスクトップや他のリモート管理ツールを使用して、問題発生時に迅速に対応します。

---

## まとめ

Microsoft Security Update Guide APIを活用することで、必要なセキュリティパッチのリストを動的かつ自動的に取得し、`Get-HotFix` と組み合わせて各PCの更新状況を効率的に管理できます。このアプローチには以下の利点があります：

- **自動化**：セキュリティパッチのリスト取得と適用状況の確認が自動化され、手動作業を大幅に削減。
- **最新性**：公式APIから最新のセキュリティアップデート情報を取得するため、常に最新の情報に基づいて管理が可能。
- **可視性**：中央サーバーに集約されたレポートを基に、全PCの更新状況を一元管理。
- **セキュリティ**：適切なアクセス制御とセキュリティ設定により、システム全体の安全性を確保。

この仕組みを導入することで、セキュリティパッチの最新化を確実に行い、全PCが常に最新の状態に保たれるようになります。また、スクリプトやAPIの管理を適切に行うことで、運用の柔軟性とセキュリティを高めることができます。

---

**参考リンク**:

- [Microsoft Security Update Guide API Documentation](https://portal.msrc.microsoft.com/en-us/api)
- [PowerShell Invoke-RestMethod Cmdlet](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-restmethod)

---

**注記**: 上記スクリプトや設定は環境に応じて調整が必要です。特にAPIのエンドポイントや認証方法は、Microsoftの最新ドキュメントを参照し、セキュリティポリシーに従って設定してください。

### user — 2025-01-17T09:18:11.602150+00:00

Microsoft Security Update Guide API Portal のURLが古い

### tool — 2025-01-17T09:18:33.280404+00:00

**自動化の導入**

Windows 10のセキュリティパッチ管理を自動化する方法を模索中。PowerShellスクリプトとタスクスケジューラが役立つと感じているんだ。

**最新の情報を探る**

Microsoft Security Update Guide APIの最新のURLを確認するために、公式ドキュメントをチェックしているんだ。もしかしたら、APIのリンクが変更されているかもしれないね。

**リンクの確認**

リンクが古い可能性があるので、正しいURLを提供し、公式ドキュメントの確認を推奨している。

### assistant — 2025-01-17T09:18:33.280533+00:00

申し訳ありません。以前ご案内した「Microsoft Security Update Guide API Portal」のURLが古くなっている可能性があります。最新の情報に基づいて、適切な方法をご案内いたします。

## Microsoft Security Update Guide API の最新情報

### 正しいAPIポータルへのアクセス方法

現在（2023年10月時点）では、Microsoft Security Update Guide（MSUSG）APIは以下の手順でアクセスできます：

1. **Microsoft Security Update Guide 公式サイトへアクセス**:
   - [Microsoft Security Update Guide](https://msrc.microsoft.com/update-guide)

2. **APIドキュメントの確認**:
   - 上記ページに移動後、右上またはページ内に「API」や「Developer Resources」といったセクションがある場合、そこからAPIの詳細ドキュメントにアクセスできます。

3. **APIキーの取得**:
   - APIを利用するには、Microsoftアカウントでサインインし、APIキーを取得する必要があります。通常、ユーザーのダッシュボードや設定ページからAPIキーの生成が可能です。

### 具体的な手順

以下に、MSUSG APIを利用してセキュリティパッチのリストを取得するための最新の手順を示します。

#### 1. Microsoft Security Update Guide API ポータルへのアクセス

最新のAPI情報やドキュメントは、Microsoftの公式サイトを通じて提供されています。以下のURLからアクセスしてください：

- [Microsoft Security Update Guide API Documentation](https://msrc.microsoft.com/update-guide/api)

**注**: 上記URLは変更される可能性があるため、公式サイト内で「API」や「Developer Resources」を検索することをお勧めします。

#### 2. APIキーの取得

1. **サインイン**:
   - Microsoftアカウントで[Microsoft Security Update Guide](https://msrc.microsoft.com/update-guide)にサインインします。

2. **APIアクセスの申請**:
   - ダッシュボードや設定ページから「APIアクセス」セクションを探します。
   - 必要な情報を入力し、APIキーを生成します。

#### 3. PowerShellスクリプトでAPIを利用する

以下は、MSUSG APIを使用して最新のセキュリティパッチ（KB番号）を取得し、`Get-HotFix` と組み合わせて更新状況を確認するPowerShellスクリプトの例です。

```powershell
# Parameters
$ApiKey = "YOUR_API_KEY_HERE"  # 取得したAPIキーを入力
$BaseUrl = "https://api.msrc.microsoft.com/cvrf/v2.0/document"
$Product = "Windows 10"
$ReportFolder = "\\CentralServer\UpdateReports\"
$Date = Get-Date -Format "yyyy-MM-dd"

# Headers
$Headers = @{
    "Authorization" = "Bearer $ApiKey"
    "Content-Type"  = "application/json"
}

# Query Parameters
$Params = @{
    "product" = $Product
    "classification" = "Security Update"
    "pageSize" = 1000
}

# APIリクエスト
$response = Invoke-RestMethod -Uri $BaseUrl -Method Get -Headers $Headers -Body ($Params | ConvertTo-Json)

# エラーハンドリング
if ($response -eq $null) {
    Write-Error "Failed to retrieve security updates from MSUSG API."
    exit
}

# 必要なKB番号の抽出
$RequiredKBs = @()

foreach ($update in $response.CVEItems) {
    foreach ($ref in $update.References) {
        if ($ref.RefType -eq "KB") {
            $kb = $ref.RefId
            if ($kb -match "^KB\d+$") {
                $RequiredKBs += $kb
            }
        }
    }
}

# 重複の削除
$RequiredKBs = $RequiredKBs | Sort-Object -Unique

# PC情報の取得
$PCName = $env:COMPUTERNAME

# 適用された更新プログラムの取得
$InstalledKBs = Get-HotFix | Where-Object { $_.HotFixID -match "^KB\d+$" } | Select-Object -ExpandProperty HotFixID

# 未適用の更新プログラムの確認
$MissingKBs = $RequiredKBs | Where-Object { $_ -notin $InstalledKBs }

# レポート内容の作成
$Report = [PSCustomObject]@{
    PCName     = $PCName
    Date       = $Date
    MissingKBs = ($MissingKBs -join ", ")
}

# レポートをCSV形式で保存
$ReportPath = Join-Path -Path $ReportFolder -ChildPath "UpdateReport_$($PCName)_$($Date).csv"
$Report | Export-Csv -Path $ReportPath -NoTypeInformation -Append

# ログの出力
if ($MissingKBs.Count -gt 0) {
    Write-Output "[$(Get-Date)] 未適用のセキュリティパッチ: $($MissingKBs -join ', ')"
} else {
    Write-Output "[$(Get-Date)] すべてのセキュリティパッチが適用されています。"
}
```

**注意点**:

- `YOUR_API_KEY_HERE` を実際に取得したAPIキーに置き換えてください。
- `https://api.msrc.microsoft.com/cvrf/v2.0/document` は例として示しています。最新のエンドポイントは公式ドキュメントを参照してください。
- APIのレスポンス形式やエンドポイントが変更されている場合があるため、最新のドキュメントを確認してください。
- スクリプト内の`$RequiredKBs`は最新のセキュリティアップデートに基づいて動的に生成されます。

#### 4. スクリプトの自動実行とレポートの収集

1. **スクリプトの配置**:
   - 上記のスクリプトを各PCに配置し、適切なディレクトリ（例：`C:\Scripts\`）に保存します。

2. **タスクスケジューラの設定**:
   - 月に1回、自動的にスクリプトが実行されるようにタスクスケジューラを設定します。
   - 例：毎月1日午前2時にスクリプトを実行。

3. **レポートの集約**:
   - 中央サーバー上の共有フォルダ（例：`\\CentralServer\UpdateReports\`）にレポートが保存されます。
   - 管理者は定期的にこのフォルダを確認し、未適用のセキュリティパッチがあるPCを特定します。

#### 5. 管理者による監視と通知

**集約スクリプト**と**通知スクリプト**を使用して、未更新のPCに対するアラートを自動化します。これらのスクリプトは前述の通りです。

### 参考資料

- [Microsoft Security Update Guide API Documentation](https://msrc.microsoft.com/update-guide/api)  
  ※ 最新のURLやアクセス方法は、公式サイト内で「API」や「Developer Resources」を検索してください。

- [PowerShell Invoke-RestMethod Cmdlet](https://learn.microsoft.com/powershell/module/microsoft.powershell.utility/invoke-restmethod)  
  PowerShellを使用したAPIリクエストの詳細な情報が記載されています。

### 代替方法

もしMicrosoft Security Update Guide APIが利用できない、またはアクセスが困難な場合、以下の代替方法も検討できます：

1. **WSUSやIntune以外のサードパーティ製ツールの利用**:
   - ManageEngine Patch Manager Plus や SolarWinds Patch Manager など、他のパッチ管理ツールを使用してセキュリティパッチの適用状況を管理・監視する。

2. **Microsoft Graph APIの活用**:
   - 一部のセキュリティアップデート情報は、Microsoft Graph APIを通じて取得できる場合があります。最新のドキュメントを確認してください。

3. **定期的な手動チェックの自動化支援**:
   - スクリプトを用いて定期的にWindows Updateを実行し、その結果をログとして収集・分析する方法を強化する。

## まとめ

Microsoft Security Update Guide APIを利用することで、必要なセキュリティパッチのリストを自動的に取得し、各PCの更新状況を効率的に管理できます。最新のAPIポータルやドキュメントへのアクセス方法が変更されている可能性があるため、公式サイトで最新情報を確認することをお勧めします。また、APIの利用が難しい場合は、代替手段として他のパッチ管理ツールの導入も検討してください。

何か不明点や追加のサポートが必要な場合は、お気軽にご連絡ください。
