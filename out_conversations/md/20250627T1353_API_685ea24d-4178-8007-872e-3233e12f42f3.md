---
conversation_id: "685ea24d-4178-8007-872e-3233e12f42f3"
title: "APIä¸€è¦§æŠ½å‡ºæ–¹æ³•"
create_time: 1751032397.613853
update_time: 1751034654.665395
language_guess: "en"
num_messages: 46
part_index: 1
part_count: 1
---

### user â€” 2025-06-27T13:53:17.345000+00:00

APIã®å…¨ä¸€è¦§æŠ½å‡ºã—ã¾ã™

### system â€” 2025-06-27T13:53:17.613853+00:00

_(empty)_

### user â€” 2025-06-27T13:53:17.613853+00:00

_(empty)_

### assistant â€” 2025-06-27T13:53:18.334530+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:14ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸã€‚ã€ŒAPIã®å…¨ä¸€è¦§æŠ½å‡ºã€ã¨ã¯ã€ä»¥ä¸‹ã®ã„ãšã‚Œã‚’æ„å›³ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿç¢ºèªã•ã›ã¦ãã ã•ã„ï¼š

---

### âœ… å¯¾è±¡ã®æ˜ç¢ºåŒ–
1. **OSSãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®å…¨å…¬é–‹APIä¸€è¦§**  
ã€€â†’ ä¾‹ï¼š`KsqlContext` ãªã©ã®ã‚¯ãƒ©ã‚¹ã«å®šç¾©ã•ã‚ŒãŸã™ã¹ã¦ã® `public` ãƒ¡ã‚½ãƒƒãƒ‰ï¼ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

2. **REST APIä»•æ§˜æ›¸ã‹ã‚‰ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§æŠ½å‡º**  
ã€€â†’ Swagger/OpenAPIå®šç¾©ãªã©ã‹ã‚‰URLãƒ»HTTPãƒ¡ã‚½ãƒƒãƒ‰ãƒ»èª¬æ˜ã‚’ä¸€è¦§ã«ã™ã‚‹

3. **C#ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã€ã™ã¹ã¦ã®`public`ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§ã‚’æŠ½å‡º**  
ã€€â†’ CLIã‚„Roslynãªã©ã‚’ç”¨ã„ã¦é™çš„ã«æŠ½å‡ºã™ã‚‹æ–¹æ³•

4. **ç‰¹å®šã®namespaceé…ä¸‹ã®APIï¼ˆãŸã¨ãˆã° `KsqlDsl.*`ï¼‰ã ã‘ã‚’ä¸€è¦§åŒ–ã—ãŸã„**  
ã€€â†’ ä½¿ç”¨ç¯„å›²ã‚’é™å®šã—ã¦è¦‹ã‚„ã™ãã—ãŸã„å ´åˆ

5. **ãƒ†ã‚¹ãƒˆå¯¾è±¡APIä¸€è¦§**  
ã€€â†’ ç¾æ™‚ç‚¹ã§ãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ã‚‹APIã¨æœªãƒ†ã‚¹ãƒˆAPIã®ä¸€è¦§æŠ½å‡º

---

### â› æŠ½å‡ºæ–¹æ³•ã®å¸Œæœ›
- è‡ªå‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆPowerShell / Roslyn / grep / ctags ãªã©ï¼‰
- æ‰‹å‹•ãƒã‚§ãƒƒã‚¯æ”¯æ´ï¼ˆè¦ç´„ãƒ™ãƒ¼ã‚¹ã®ã‚µãƒãƒªå‡ºåŠ›ï¼‰
- Markdownã‚„CSVå½¢å¼ã§ã®å‡ºåŠ›å¸Œæœ›

---

ãŠæ‰‹æ•°ã§ã™ãŒã€ã©ã®æ–¹å‘æ€§ã‚’ã”å¸Œæœ›ã‹ãŠçŸ¥ã‚‰ã›ã„ãŸã ã‘ã¾ã™ã‹ï¼Ÿ  
ä¾‹ï¼š  
> ã€ŒC#ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã® `public` ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§ã‚’ã€namespaceå˜ä½ã§Markdownå‡ºåŠ›ã—ãŸã„ã€

ã¨ã„ã£ãŸå½¢ã§æ•™ãˆã¦ã‚‚ã‚‰ãˆã‚‹ã¨æœ€é©ãªæ–¹æ³•ã‚’ã”ææ¡ˆã§ãã¾ã™ï¼

### assistant â€” 2025-06-27T13:53:30.025734+00:00

_(empty)_

### user â€” 2025-06-27T13:53:44.634000+00:00

ã‚½ãƒ¼ã‚¹ã‹ã‚‰publicã¨ã—ã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸€è¦§ã¨ã—ã¾ã™ã€‚

### assistant â€” 2025-06-27T13:53:45.090659+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:17ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸï¼  
**ã€ŒC#ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å†…ã§ `public` ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸€è¦§ã‚’æŠ½å‡ºã€**ã¨ã„ã†è¦ä»¶ã§ã™ã­ã€‚ä»¥ä¸‹ã«ã€ç›®çš„ã«å¿œã˜ãŸæŠ½å‡ºæ–¹æ³•ã‚’2é€šã‚Šã”ç´¹ä»‹ã—ã¾ã™ã€‚

---

## âœ… æ–¹æ³•â‘ ï¼šPowerShellï¼‹æ­£è¦è¡¨ç¾ï¼ˆç°¡æ˜“æŠ½å‡ºï¼‰

### ğŸ“„ ä½¿ã„æ–¹ï¼š
1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®PowerShellã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œ

```powershell
Get-ChildItem -Recurse -Include *.cs | 
    Select-String -Pattern 'public\s+(static\s+)?[\w\<\>\[\]]+\s+[\w_]+\s*\(.*\)' |
    ForEach-Object { $_.Line.Trim() } |
    Sort-Object |
    Out-File public_methods_list.txt
```

### ğŸ’¡ å‡ºåŠ›å†…å®¹ï¼ˆä¾‹ï¼‰:
```csharp
public void Initialize()
public static Task<List<Order>> LoadAsync()
public int GetCount()
```

- ã“ã‚Œã¯ãŠãŠã‚ˆãã®æŠ½å‡ºç”¨ã§ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®Ÿè£…ãªã©ã‚‚æ‹¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆè¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼‰ã€‚

---

## âœ… æ–¹æ³•â‘¡ï¼šRoslynãƒ™ãƒ¼ã‚¹ã®æŠ½å‡ºï¼ˆæ­£ç¢ºã‹ã¤æ§‹é€ ä»˜ãï¼‰

ã‚‚ã—ç²¾åº¦ãŒå¿…è¦ãªå ´åˆã¯ã€[Microsoft.CodeAnalysisï¼ˆRoslynï¼‰](https://github.com/dotnet/roslyn) ã‚’ä½¿ã£ã¦æŠ½å‡ºã§ãã¾ã™ã€‚

### ğŸ”§ NuGetãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼š
```
Microsoft.CodeAnalysis.CSharp
```

### ğŸ§  å®Ÿè¡Œä¾‹ï¼ˆC#ã‚³ãƒ¼ãƒ‰ï¼‰ï¼š

```csharp
using Microsoft.CodeAnalysis;
using Microsoft.CodeAnalysis.CSharp;
using Microsoft.CodeAnalysis.CSharp.Syntax;

var codeFiles = Directory.GetFiles("src", "*.cs", SearchOption.AllDirectories);

foreach (var file in codeFiles)
{
    var text = File.ReadAllText(file);
    var tree = CSharpSyntaxTree.ParseText(text);
    var root = tree.GetRoot();

    var methods = root.DescendantNodes()
        .OfType<MethodDeclarationSyntax>()
        .Where(m => m.Modifiers.Any(SyntaxKind.PublicKeyword));

    foreach (var method in methods)
    {
        var className = method.Ancestors().OfType<ClassDeclarationSyntax>().FirstOrDefault()?.Identifier.Text;
        Console.WriteLine($"{className}.{method.Identifier.Text}({method.ParameterList})");
    }
}
```

### ğŸ“‹ å‡ºåŠ›ä¾‹ï¼š
```
OrderService.Initialize()
OrderRepository.LoadAsync(CancellationToken cancellationToken)
KafkaHandler.OnMessageReceived(string topic, byte[] payload)
```

---

## âœ… è£œè¶³
- ã€Œpublic classã€å†…ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿ã€ã¾ãŸã¯ `public interface` ã®æŠ½å‡ºã‚‚å¯èƒ½ã§ã™ã€‚
- çµæœã‚’ `.md` ã‚„ `.csv` ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå‡ºåŠ›ã‚‚ã§ãã¾ã™ã€‚ã”å¸Œæœ›ãŒã‚ã‚Œã°æ•´å½¢æ–¹æ³•ã‚’ææ¡ˆã—ã¾ã™ã€‚

---

## ğŸ“ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼š
ä»¥ä¸‹ã®ã©ã¡ã‚‰ã‚’ã”å¸Œæœ›ã§ã™ã‹ï¼Ÿ

1. PowerShellã§ä»Šã™ãä¸€è¦§ã‚’æŠ½å‡ºï¼ˆç²¾åº¦ã‚ˆã‚Šæ‰‹è»½ã•é‡è¦–ï¼‰
2. Roslynãƒ™ãƒ¼ã‚¹ã§æ­£ç¢ºã«æ§‹é€ ä»˜ãã§ä¸€è¦§åŒ–ï¼ˆé«˜ç²¾åº¦ãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯ï¼‰

ã¾ãŸã¯ã€å¯¾è±¡ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆãŒã‚ã‚Œã°åˆã‚ã›ã¦æ•™ãˆã¦ã„ãŸã ã‘ã‚Œã°ã€å…·ä½“çš„ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚‚ç”Ÿæˆã—ã¾ã™ã€‚

### user â€” 2025-06-27T13:54:18.801000+00:00

codexã®å¤©åŸã«ä½œæ¥­ã‚’ä¾é ¼ã—ãŸã„

### assistant â€” 2025-06-27T13:54:19.257214+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:21ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸã€codexä¸Šã®**å¤©åŸ**ã«ã€ŒC#ã‚½ãƒ¼ã‚¹ã‹ã‚‰ `public` ãƒ¡ã‚½ãƒƒãƒ‰ä¸€è¦§ã‚’æŠ½å‡ºã™ã‚‹ã€ä½œæ¥­ã‚’ä¾é ¼ã™ã‚‹å½¢å¼ã§ã™ã­ã€‚ä»¥ä¸‹ã«ãã®ã¾ã¾æŠ•å…¥ã§ãã‚‹**ä½œæ¥­æŒ‡ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚

---

### ğŸ“„ `instructions.md` ã¸ã®æŒ‡ç¤ºæ–‡æ¡ˆï¼ˆå¤©åŸç”¨ï¼‰

```markdown
## ğŸ§­ ã‚¿ã‚¹ã‚¯æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã®å…¨ `.cs` ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€**publicãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸€è¦§**ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚

## ğŸ¯ ç›®çš„

- OSSå…¬é–‹æº–å‚™ã®ä¸€ç’°ã¨ã—ã¦ã€APIè¨­è¨ˆã®å…¨ä½“æŠŠæ¡ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚„ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãªã©ã‚‚å«ã‚ã€å…¬é–‹ãƒ¡ã‚½ãƒƒãƒ‰ã®ç¶²ç¾…çš„æŠŠæ¡ã‚’ç‹™ã„ã¾ã™ã€‚

## ğŸ§© ä½œæ¥­è©³ç´°

- å¯¾è±¡ï¼šã™ã¹ã¦ã® `*.cs` ãƒ•ã‚¡ã‚¤ãƒ«
- æ¡ä»¶ï¼š
  - `public` ä¿®é£¾å­ã®ã¤ã„ãŸãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ`static` / éstaticä¸¡æ–¹ï¼‰
  - ã‚¯ãƒ©ã‚¹åãƒ»ãƒ¡ã‚½ãƒƒãƒ‰åãƒ»ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å«ã‚€å½¢ã§åˆ—æŒ™
- å‡ºåŠ›å½¢å¼ï¼š
  - `markdown` å½¢å¼ã§ã‚¯ãƒ©ã‚¹ã”ã¨ã«ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ†ã‘
  - ä¾‹ï¼š

    ```markdown
    ### UserService

    - `public void Initialize()`
    - `public async Task<List<User>> GetUsersAsync(CancellationToken token)`

    ### KafkaProcessor

    - `public static void StartBinding(string topicName)`
    ```

- ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯é™¤å¤–ã—ã¦ãã ã•ã„

## ğŸ“‚ å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

- å‡ºåŠ›å…ˆï¼š`docs/api_public_methods.md`

## ğŸ›  æ³¨æ„ç‚¹

- å¯èƒ½ã§ã‚ã‚Œã°ã€`partial` ã‚¯ãƒ©ã‚¹ã‚‚ãƒãƒ¼ã‚¸ã—ã¦åŒã˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã—ã¦ãã ã•ã„
- æŠ½å‡ºãƒ­ã‚¸ãƒƒã‚¯ã«è‡ªä¿¡ãŒãªã„å ´åˆã¯ã€æœ€åˆã«10ãƒ•ã‚¡ã‚¤ãƒ«ç¨‹åº¦ã§ã‚µãƒ³ãƒ—ãƒ«å‡ºåŠ›ã‚’å…ˆã«è¦‹ã›ã¦ãã ã•ã„

---

ğŸ“ é–‹å§‹ã—ã¦å•é¡Œãªã„ã‹ç¢ºèªã—ã€åˆæœŸã‚µãƒ³ãƒ—ãƒ«ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
```

---

### âœ… è£œè¶³

- **codexæ§‹æˆãŒ `readme.md` â‡¨ `instructions.md` ã¨ã„ã†æ§‹é€ ãªã‚‰**ã“ã®ã¾ã¾ä½¿ãˆã¾ã™ã€‚
- å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»å ´æ‰€ã¯å¤‰æ›´å¯èƒ½ã§ã™ã€‚å¿…è¦ã«å¿œã˜ã¦ `docs/api_public_methods.md` â†’ `docs/apis/public_methods.md` ãªã©ã«å¤‰ãˆã¦ãã ã•ã„ã€‚
- ç‰¹å®šnamespaceï¼ˆä¾‹ï¼š`KsqlDsl.*`ï¼‰ã®ã¿ã«çµã‚ŠãŸã„å ´åˆã¯è¿½åŠ æŒ‡ç¤ºãŒå¿…è¦ã§ã™ã€‚

---

ã”å¸Œæœ›ãŒã‚ã‚Œã°ã€ã“ã®å‡ºåŠ›ã‚’ **ã˜ã‚“ã¨** ã«æµã—ã¦æ•´å½¢ã‚„ã‚«ãƒãƒ¬ãƒƒã‚¸é€£æºã‚‚å¯èƒ½ã§ã™ã€‚  
æ¬¡ã«é€²ã‚ã‚‹å ´åˆã¯ã€ŒæŒ‡ç¤ºæŠ•å…¥ã—ã¾ã—ãŸã€ã€Œåˆå›å‡ºåŠ›ç¢ºèªç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ã‚‚ã€ã¨ãŠä¼ãˆãã ã•ã„ã€‚

### user â€” 2025-06-27T14:07:47.310000+00:00

ä»Šã€oss_design_combinedã«è¨˜è¼‰ã™ã‚‹ä»£è¡¨çš„ãªAPIã‚’æŠ½å‡ºã™ã‚‹ä½œæ¥­ã‚’å®Ÿæ–½ã—ã¦ã‚‹

### assistant â€” 2025-06-27T14:07:48.431750+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:27ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸã€‚ç¾åœ¨ã€`api_public_methods.md` ã‹ã‚‰**ä»£è¡¨çš„ãªAPIã‚’æŠ½å‡ºã—ã¦** `oss_design_combined.md` ã«è¨˜è¼‰ã™ã‚‹ä½œæ¥­ã‚’å®Ÿæ–½ä¸­ã§ã™ã­ã€‚

---

## âœ… ä½œæ¥­æ”¯æ´ã®ææ¡ˆ

`api_public_methods.md` ã‚’ç¢ºèªã—ãŸã¨ã“ã‚ã€éå¸¸ã«å¤šãã® `public` ãƒ¡ã‚½ãƒƒãƒ‰ãŒå«ã¾ã‚Œã¦ãŠã‚Šã€ã™ã¹ã¦ã‚’è¨­è¨ˆè³‡æ–™ã«è¨˜è¼‰ã™ã‚‹ã®ã¯ç¾å®Ÿçš„ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãã“ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãª**ã€Œä»£è¡¨APIæŠ½å‡ºãƒãƒªã‚·ãƒ¼ã€**ã‚’ç”¨ã„ã¦ã€è¨­è¨ˆè³‡æ–™ã«è¨˜è¼‰ã™ã‚‹å¯¾è±¡ã‚’é¸åˆ¥ã™ã‚‹ã“ã¨ã‚’ææ¡ˆã—ã¾ã™ï¼š

---

## ğŸ“Œ æŠ½å‡ºãƒãƒªã‚·ãƒ¼æ¡ˆï¼ˆè¨˜è¼‰å¯¾è±¡ã®çµã‚Šè¾¼ã¿ï¼‰

### 1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç›´æ¥ä½¿ã†DSLãƒ¡ã‚½ãƒƒãƒ‰**
ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¯ã‚¨ãƒªãƒ»å¤‰æ›ãƒ»è³¼èª­ãƒã‚§ãƒ¼ãƒ³ãŒå¯¾è±¡ã§ã™ï¼š

- `EventSet<T>.Map(...)`
- `EventSet<T>.WithRetry(...)`
- `EventSet<T>.OnError(...)`
- `EventSet<T>.ToListAsync()`
- `EventSet<T>.ForEachAsync(...)`

ğŸ“â†’ è¨­è¨ˆæ›¸ã§ã¯ **ã€Œã‚¯ã‚¨ãƒªDSLã€ã‚„ã€Œã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°DSLã€** ã§èª¬æ˜æ¸ˆã¿ã€‚å¯¾å¿œæ¸ˆã¿ã€‚

---

### 2. **æ§‹æˆãƒ“ãƒ«ãƒ€ãƒ¼API**
- `KsqlContextBuilder.Create()`
- `KsqlContextBuilder.UseSchemaRegistry(...)`
- `KsqlContextBuilder.BuildContext<T>()`
- `AvroEntityConfigurationBuilder<T>.AsStream() / AsTable()`

ğŸ“â†’ `oss_design_combined.md` å†…ã®ã€ŒFluent APIæ§‹æˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è©²å½“ã€‚ã“ã‚Œã‚‚åæ˜ æ¸ˆã¿ã€‚

---

### 3. **å®Ÿè¡Œç³»APIï¼ˆãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹/ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ ï¼‰**
- `AddAsync(...)`
- `ForEachAsync(...)`
- `CommitAsync()` / `NegativeAckAsync()`ï¼ˆæ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆæ™‚ï¼‰

ğŸ“â†’ ã“ã‚Œã‚‰ã¯ã€Œãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ã€ã€Œã‚¯ã‚¨ãƒªã¨è³¼èª­ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¨˜è¼‰æ¸ˆã¿ã€‚

---

### 4. **è¨­è¨ˆæ–¹é‡ã¨åˆã‚ãªã„APIï¼ˆé™¤å¤–å¯¾è±¡ï¼‰**
- `AvroEntityConfigurationBuilder<T>.ToTopic(...)` â†’ âŒ è¨­è¨ˆåŸå‰‡é•å
- `HasKey(...)` â†’ âŒ POCOå±æ€§å„ªå…ˆã®ãŸã‚æ’é™¤

ğŸ“â†’ `oss_design_combined.md` ã«ã€Œå‘¼ã³å‡ºã—æ™‚ä¾‹å¤–ã€ã€ŒNotSupportedã€è¨­è¨ˆã¨ã—ã¦è¨˜è¿°æ¸ˆã¿ã€‚

---

## âœ… æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

ä»¥ä¸‹ã®ã©ã¡ã‚‰ã‚’ã”å¸Œæœ›ã§ã™ã‹ï¼Ÿ

1. **è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¾ã æœªåæ˜ ã®ã€Œä»£è¡¨çš„APIã€ã®å€™è£œã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—**ï¼ˆä¾‹ï¼šStateStoreé–¢ä¿‚ã€DLQé–¢ä¿‚ãªã©ï¼‰
2. **æ—¢å­˜ã® `oss_design_combined.md` ã¨ `api_public_methods.md` ã‚’çªåˆã—ã€æœªè¨˜è¼‰APIã‚’ä¸€è¦§åŒ–**ï¼ˆå·®åˆ†æ´—ã„å‡ºã—ï¼‰

ã¾ãŸã¯ã€Œã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ã“ã®APIç¾¤ã‚’åˆ—æŒ™ã—ã¦ã€ãªã©ã®**å…·ä½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³æŒ‡å®šã§ã‚‚OK**ã§ã™ã€‚

---

ã”å¸Œæœ›ã«å¿œã˜ã¦ã€å¤©åŸãŒãƒªã‚¹ãƒˆæ•´ç† or å·®åˆ†ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ã—ã¾ã™ï¼

### system â€” 2025-06-27T14:07:59.994958+00:00

_(empty)_

### tool â€” 2025-06-27T14:07:59.995133+00:00

_(empty)_

### tool â€” 2025-06-27T14:07:59.995235+00:00

### AvroCoreInternalTests

- `public void AvroField_PropertyAccessors()`
- `public void AvroSchemaInfo_RegisteredAt_Getter()`
- `public void AvroSchema_PropertyAccessors()`
- `public void AvroValueSerializer_And_Deserializer_RoundTrip()`
- `public void GuidKeySerializer_And_Deserializer()`
- `public void IntKeySerializer_And_Deserializer()`
- `public void LongKeySerializer_And_Deserializer()`

### AvroDeserializer<T>

- `public T Deserialize(ReadOnlySpan<byte> data)`
- `public void Dispose()`

### AvroEntityConfiguration

- `public AvroEntityConfiguration Clone()`
- `public PropertyInfo[] GetIgnoredProperties()`
- `public PropertyInfo[] GetOrderedKeyProperties()`
- `public PropertyInfo[] GetSerializableProperties()`
- `public Type DetermineKeyType()`
- `public ValidationResult Validate()`
- `public bool HasKeys()`
- `public bool IsCompositeKey()`
- `public override bool Equals(object? obj)`
- `public override int GetHashCode()`
- `public override string ToString()`
- `public string GetEffectiveTopicName()`
- `public string GetStreamTableType()`
- `public string GetSummary()`

### AvroEntityConfigurationBuilder<T>

- `public AvroEntityConfiguration Build()`
- `public AvroEntityConfigurationBuilder<T> AsStream()`
- `public AvroEntityConfigurationBuilder<T> AsTable()`
- `public AvroEntityConfigurationBuilder<T> EnableCaching(bool enable = true)`
- `public AvroEntityConfigurationBuilder<T> HasKey<TKey>(System.Linq.Expressions.Expression<Func<T, TKey>> keyExpression)`
- `public AvroEntityConfigurationBuilder<T> ToTopic(string topicName)`
- `public AvroEntityConfigurationBuilder<T> ValidateOnStartup(bool validate = true)`
- `public AvroEntityConfigurationBuilder<T> WithPartitions(int partitions)`
- `public AvroEntityConfigurationBuilder<T> WithReplicationFactor(int replicationFactor)`

### AvroEntityConfigurationBuilderTests

- `public void AsStream_SetsCustomSetting()`
- `public void AsTable_SetsCustomSetting()`
- `public void Build_ReturnsConfiguration()`
- `public void Constructor_NullConfiguration_Throws()`
- `public void EnableCaching_SetsFlag()`
- `public void ExtractProperties_SupportsComposite()`
- `public void HasKey_SetsKeyProperties()`
- `public void ToTopic_SetsName()`
- `public void ValidateOnStartup_SetsFlag()`
- `public void WithPartitions_SetsValue()`
- `public void WithReplicationFactor_SetsValue()`

### AvroEntityConfigurationExtensions

- `public static AvroEntityConfigurationBuilder<T> Configure<T>(this AvroEntityConfiguration configuration) where T : class`
- `public static bool IsStreamType(this AvroEntityConfiguration configuration)`
- `public static bool IsTableType(this AvroEntityConfiguration configuration)`

### AvroEntityConfigurationExtensionsTests

- `public void Configure_ReturnsBuilder()`
- `public void Configure_WrongType_Throws()`
- `public void IsStreamType_And_IsTableType()`

### AvroEntityConfigurationTests

- `public void Clone_CreatesEqualCopy()`
- `public void Constructor_AppliesAttributes()`
- `public void DetermineKeyType_ReturnsPropertyType()`
- `public void GetIgnoredProperties_ReturnsIgnored()`
- `public void GetOrderedKeyProperties_SortsByOrder()`
- `public void GetSerializableProperties_ExcludesIgnored()`
- `public void GetSummary_IncludesInfo()`
- `public void IsCompositeKey_ReturnsTrue()`
- `public void ToString_ReturnsSummary()`
- `public void Validate_WarnsOnBadKeyType()`

### AvroExceptionTests

- `public void AvroSchemaRegistrationException_Ctor_SetsMessage()`
- `public void AvroSchemaRegistrationException_Ctor_WithInner()`
- `public void DetermineOperationalAction_ReturnsExpected()`
- `public void FormatFatalMessage_IncludesDetails()`
- `public void SchemaRegistrationFatalException_PropertiesAndSummary()`

### AvroRetryPolicy

- `public void Validate()`

### AvroRetryPolicyTests

- `public void Validate_InvalidDelays_Throws()`
- `public void Validate_InvalidMaxAttempts_Throws()`
- `public void Validate_InvalidValues_Throws(int attempts, int initMs, int maxMs, double backoff)`

### AvroSchemaBuilderDetailedTests

- `public async Task GetKeySchemaAsync_ReturnsSchema()`
- `public async Task GetSchemasAsync_ReturnsKeyAndValue()`
- `public async Task GetValueSchemaAsync_ReturnsValueSchema()`
- `public void GenerateCompositeKeySchema_BuildsRecord()`
- `public void GenerateFieldsFromProperties_ExcludesIgnored()`
- `public void GeneratePrimitiveSchema_ReturnsExpected(Type type, string expected)`
- `public void GenerateValueSchema_CreatesRecord()`
- `public void GetBasicAvroType_ReturnsLogicalTypeForSpecials()`
- `public void GetSchemaProperties_SkipsIgnored()`
- `public void GetTopicName_ReturnsAttributeValue()`
- `public void IsNullableReferenceType_DetectsCorrectly()`
- `public void MapPropertyToAvroType_ReturnsNullableArrayForReference()`
- `public void SerializeSchema_UsesCamelCase()`
- `public void ValidateAvroSchema_ReturnsFalseForEmpty()`
- `public void ValidateAvroSchema_ReturnsFalseForInvalidJson()`
- `public void ValidateAvroSchema_ReturnsFalseForInvalidRecord()`
- `public void ValidateAvroSchema_ReturnsTrueForArray()`
- `public void ValidateAvroSchema_ReturnsTrueForPrimitiveString()`
- `public void ValidateAvroSchema_ReturnsTrueForValidRecord()`

### AvroSchemaBuilderTests

- `public async Task ValidateSchemaAsync_InvalidSchema_ReturnsFalse()`
- `public void GenerateKeySchema_ForSingleKey_ReturnsPrimitiveSchema()`

### AvroSchemaInfoExtensionsTests

- `public void GetKeyTypeName_ReturnsComposite_WhenMultipleKeyProps()`
- `public void GetStreamTableType_UsesHasCustomKey()`
- `public void Subjects_ReturnExpectedStrings()`

### AvroSchemaInfoTests

- `public void HasCustomKey_And_KeyType_Work()`
- `public void ToString_ContainsInfo()`

### AvroSchemaRegistrationServiceTests

- `public async Task GetAllRegisteredSchemasAsync_ReturnsList()`
- `public async Task RegisterAllSchemasAsync_RegistersAndStores()`
- `public void Constructor_NullClient_Throws()`

### AvroSchemaRepositoryTests

- `public void StoreAndRetrieve_Works()`

### AvroSchemaVersionManager

- `public async Task<SchemaUpgradeResult> UpgradeAsync<T>() where T : class`
- `public async Task<System.Collections.Generic.List<int>> GetVersionHistoryAsync<T>() where T : class`
- `public async Task<bool> CanUpgradeAsync<T>(string newSchema) where T : class`
- `public async Task<int> GetLatestVersionAsync<T>() where T : class`

### AvroSchemaVersionManagerTests

- `public async Task CanUpgradeAsync_ReturnsClientValue()`
- `public async Task GetLatestVersionAsync_ReturnsVersion()`
- `public async Task GetVersionHistoryAsync_ReturnsValues()`
- `public async Task UpgradeAsync_Incompatible_ReturnsFailure()`
- `public async Task UpgradeAsync_Success_ReturnsNewId()`
- `public void GetTopicName_UsesAttribute()`

### AvroSerializationManager<T>

- `public SerializationStatistics GetStatistics()`
- `public async Task<(string keySchema, string valueSchema)> GetCurrentSchemasAsync()`
- `public async Task<DeserializerPair<T>> GetDeserializersAsync(CancellationToken cancellationToken = default)`
- `public async Task<SchemaUpgradeResult> UpgradeSchemaAsync(CancellationToken cancellationToken = default)`
- `public async Task<SerializerPair<T>> GetSerializersAsync(CancellationToken cancellationToken = default)`
- `public async Task<bool> CanUpgradeSchemaAsync(CancellationToken cancellationToken = default)`
- `public async Task<bool> ValidateRoundTripAsync(T entity, CancellationToken cancellationToken = default)`
- `public void ClearCache()`
- `public void Dispose()`

### AvroSerializationManagerTests

- `public async Task CanUpgradeSchemaAsync_ReturnsValue()`
- `public async Task ClearCache_RemovesManager()`
- `public async Task Dispose_ClearsCache()`
- `public async Task GetCurrentSchemasAsync_ReturnsSchemas()`
- `public async Task GetSerializers_And_Deserializers_Work()`
- `public async Task GetStatistics_ReflectsOperations()`
- `public async Task UpgradeSchemaAsync_Success_ClearsCache()`
- `public async Task ValidateRoundTripAsync_ReturnsTrue()`

### AvroSerializer<T>

- `public void Dispose()`
- `public void Serialize(T value, Stream stream)`

### AvroSerializerCacheTests

- `public async Task GetDeserializersAsync_CachesResults()`
- `public async Task GetSerializersAsync_CachesResults()`
- `public async Task ManagerDispose_ClearsCaches()`
- `public async Task ValidateRoundTripAsync_ReturnsTrue()`
- `public void AvroCompositeKeyDeserializer_IsNull_ReturnsEmpty()`
- `public void AvroCompositeKeySerializer_RoundTrip()`
- `public void AvroCompositeKeySerializer_WrongType_Throws()`
- `public void AvroDeserializer_Ctor_DoesNotThrow()`
- `public void AvroDeserializer_ThrowsOnDeserialize()`
- `public void ClearCache_RemovesManager()`
- `public void Dispose_ClearsManagers()`
- `public void EntityType_ReturnsCorrectType()`
- `public void GenerateCacheKey_UsesTypeName()`
- `public void GetAvroManager_CachesInstance()`
- `public void GetEntityModel_ReturnsKeyInfo()`

### AvroSerializerFactoryPrimitiveTests

- `public void CreatePrimitiveKeyDeserializer_ReturnsExpected(Type type, Type expected)`
- `public void CreatePrimitiveKeyDeserializer_Unsupported_Throws()`
- `public void CreatePrimitiveKeySerializer_ReturnsExpected(Type type, Type expected)`
- `public void CreatePrimitiveKeySerializer_Unsupported_Throws()`

### AvroTimestampAttribute

- `public override string ToString()`

### BigBangScenarioTests

- `public void Build_ComplexQuery_GeneratesExpectedClauses()`

### BuilderUtil

- `public static MemberExpression? ExtractMemberExpression(Expression expression)`

### BuilderUtilTests

- `public void ExtractMemberExpression_UnaryExpression_ReturnsMember()`

### ConsumerInstanceTests

- `public void Properties_CanBeSet()`

### ConsumerKey

- `public bool Equals(ConsumerKey? other)`
- `public override bool Equals(object? obj) => obj is ConsumerKey other && Equals(other)`
- `public override int GetHashCode() => HashCode.Combine(EntityType, TopicName, GroupId)`
- `public override string ToString() => $"{EntityType.Name}:{TopicName}:{GroupId}"`

### CoreExceptionsTests

- `public TestException(string m) : base(m) { }`
- `public TestException(string m, Exception i) : base(m, i) { }`
- `public void CoreConfigurationException_Constructors()`
- `public void CoreException_BaseConstructor_SetsMessage()`
- `public void CoreValidationException_StoresErrors()`
- `public void EntityModelException_Constructors()`

### CoreExtensionsMoreTests

- `public void GetSerializableProperties_ExcludesIgnored()`
- `public void IsKafkaEntity_DetectsProperClass()`
- `public void IsKafkaIgnored_ReturnsTrueForIgnoredProperty()`
- `public void IsNullableProperty_WorksForNullableAndReference()`

### CoreExtensionsTests

- `public void GetTopicName_ReturnsAttributeValue()`
- `public void PropertyExtensions_DetectKey()`
- `public void TypeExtension_ReturnsTopicName()`

### CoreSettingsProviderTests

- `public void GetSettings_ReturnsClone()`
- `public void UpdateSettings_Null_Throws()`
- `public void UpdateSettings_RaisesEventAndClones()`

### CoreSettingsTests

- `public void Validate_AllRequiredFieldsPresent_DoesNotThrow()`
- `public void Validate_MissingFields_Throws()`

### CoreValidationResultTests

- `public void Properties_CanBeSetViaReflection()`

### DDLQueryGeneratorTests

- `public void GenerateCreateStream_CreatesExpectedStatement()`
- `public void GenerateCreateTableAs_WithWhereAndGroupBy()`

### DMLQueryGeneratorTests

- `public void GenerateAggregateQuery_Basic()`
- `public void GenerateAggregateQuery_EarliestByOffset()`
- `public void GenerateAggregateQuery_LatestByOffset()`
- `public void GenerateCountQuery_ReturnsExpected()`
- `public void GenerateSelectAll_WithPushQuery_AppendsEmitChanges()`
- `public void GenerateSelectWithCondition_Basic()`

### DefaultAndMaxLengthAttributeTests

- `public void DefaultValueAttribute_Null_ShowsNullInToString()`
- `public void DefaultValueAttribute_StoresValue()`
- `public void MaxLengthAttribute_InvalidLength_Throws()`
- `public void MaxLengthAttribute_StoresLength()`

### DefaultValueAttribute

- `public override string ToString()`

### DerivedObjectManagerTests

- `public FakeExecutor() : base(new NullLoggerFactory()) { }`
- `public async Task CleanupDerivedObjects_RemovesAll()`
- `public async Task CreateDerivedStreamAsync_AddsObject()`
- `public async Task CreateDerivedTableAsync_AddsObject()`
- `public override Task ExecuteDDLAsync(string ddlQuery) { ExecutedQueries.Add(ddlQuery); return Task.CompletedTask; }`
- `public override Task StopAllQueriesAsync() => Task.CompletedTask`
- `public override Task<List<T>> ExecutePullQueryAsync<T>(string query) => Task.FromResult(new List<T>())`
- `public override Task<List<T>> ExecutePushQueryAsync<T>(string query) => Task.FromResult(new List<T>())`
- `public override void Dispose() { }`
- `public override void ExecuteDDL(string ddlQuery) => ExecutedQueries.Add(ddlQuery)`
- `public void CleanupDerivedObjects_Synchronous()`
- `public void CreateDerivedStream_AddsObjectAndExecutesDDL()`

### DirectoryImportConfig

- `public CsvImportConfig ToCsvConfig(string filePath)`
- `public JsonImportConfig ToJsonConfig(string filePath)`

### DlqConfigurationExtensions

- `public static KsqlDslOptions ConfigureDlq(`
- `public static KsqlDslOptions DisableDlqAutoCreation(this KsqlDslOptions options)`
- `public static KsqlDslOptions WithDlqRetention(`

### DlqEnvelope

- `public override string ToString()`

### DlqTopicConfiguration

- `public string GetSummary()`
- `public void Validate()`

### EntityBuilderTopicExtensions

- `public static IEntityBuilder<T> HasTopic<T>(this IEntityBuilder<T> builder, string topicName) where T : class`
- `public static IEntityBuilder<T> WithMinInSyncReplicas<T>(this IEntityBuilder<T> builder, int minInSyncReplicas) where T : class`
- `public static IEntityBuilder<T> WithPartitioner<T>(this IEntityBuilder<T> builder, string partitioner) where T : class`
- `public static IEntityBuilder<T> WithPartitions<T>(this IEntityBuilder<T> builder, int partitions) where T : class`
- `public static IEntityBuilder<T> WithReplicationFactor<T>(this IEntityBuilder<T> builder, int replicationFactor) where T : class`

### EntityModel

- `public StreamTableType GetExplicitStreamTableType()`
- `public bool HasKeys()`
- `public bool IsCompositeKey()`
- `public void SetStreamTableType(StreamTableType streamTableType)`

### EntityModelBuilder<T>

- `public EntityModel GetModel()`
- `public EntityModelBuilder<T> HasKey<TKey>(System.Linq.Expressions.Expression<Func<T, TKey>> keyExpression)`
- `public EntityModelBuilder<T> HasTopic(string topicName)`
- `public EntityModelBuilder<T> HasTopicName(string topicName)`
- `public EntityModelBuilder<T> OnDeserializationError(DeserializationErrorPolicy policy)`
- `public EntityModelBuilder<T> OnError(ErrorAction action)`
- `public EntityModelBuilder<T> WithMinInSyncReplicas(int minInSyncReplicas)`
- `public EntityModelBuilder<T> WithPartitioner(string partitioner)`
- `public EntityModelBuilder<T> WithPartitions(int partitions)`
- `public EntityModelBuilder<T> WithReplicationFactor(int replicationFactor)`
- `public IEntityBuilder<T> AsStream()`
- `public IEntityBuilder<T> AsTable()`
- `public IEntityBuilder<T> WithManualCommit()`
- `public override string ToString()`

### EntityModelBuilderTests

- `public void Constructor_StoresModel()`
- `public void ObsoleteMethods_ThrowViaReflection()`

### ErrorHandlingContext

- `public async Task<bool> HandleErrorAsync<T>(T originalItem, Exception exception, KafkaMessageContext messageContext)`

### ErrorHandlingExtensions

- `public static EventSet<T> OnError<T>(this EventSet<T> eventSet,`
- `public static EventSet<T> OnErrorWithMetrics<T>(this EventSet<T> eventSet,`
- `public static EventSet<T> WithRetryWhen<T>(this EventSet<T> eventSet,`

### ErrorHandlingPolicy

- `public static ErrorHandlingPolicy CircuitBreaker(int failureThreshold = 5, TimeSpan recoveryInterval = default)`
- `public static ErrorHandlingPolicy ExponentialBackoff(int maxRetries = 3, TimeSpan baseInterval = default)`

### EventSet<T>

- `public EntityModel GetEntityModel() => _entityModel`
- `public EventSet<T> WithRetry(int maxRetries, TimeSpan? retryInterval = null)`
- `public EventSet<TResult> Map<TResult>(Func<T, TResult> mapper) where TResult : class`
- `public IEnumerable<T> GetResults()`
- `public IKsqlContext GetContext() => _context`
- `public MappedEventSet(List<T> mappedItems, IKsqlContext context, EntityModel originalEntityModel, IErrorSink? errorSink = null)`
- `public abstract IAsyncEnumerator<T> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public async Task<EventSet<TResult>> Map<TResult>(Func<T, Task<TResult>> mapper) where TResult : class`
- `public override async IAsyncEnumerator<T> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public override async Task<List<T>> ToListAsync(CancellationToken cancellationToken = default)`
- `public override string ToString()`
- `public static MappedEventSet<T> Create(List<T> mappedItems, IKsqlContext context, EntityModel originalEntityModel, IErrorSink? errorSink = null)`
- `public static MappedEventSet<T> CreateWithDlq(List<T> mappedItems, IKsqlContext context, EntityModel originalEntityModel, IErrorSink dlqErrorSink)`
- `public string GetTopicName() => _entityModel.TopicAttribute?.TopicName ?? _entityModel.EntityType.Name`
- `public virtual async IAsyncEnumerable<object> ForEachAsync([EnumeratorCancellation] CancellationToken cancellationToken = default)`
- `public virtual async Task AddAsync(T entity, CancellationToken cancellationToken = default)`
- `public virtual async Task ForEachAsync(Func<T, Task> action, TimeSpan timeout = default, CancellationToken cancellationToken = default)`
- `public virtual async Task<List<T>> ToListAsync(CancellationToken cancellationToken = default)`

### EventSetErrorHandlingExtensions

- `public ErrorHandlingChain(EventSet<T> eventSet)`
- `public EventSet<T> Build()`
- `public EventSet<T> WithRetry(int retryCount = 3, TimeSpan? retryInterval = null)`
- `public IMapReadyChain<T> OnError(ErrorAction errorAction)`
- `public IRetryReadyChain<TResult> Map<TResult>(Func<T, TResult> mapper) where TResult : class`
- `public MapReadyChain(EventSet<T> eventSet, ErrorAction errorAction)`
- `public RetryReadyChain(EventSet<T> eventSet)`
- `public static EventSet<T> OnError<T>(this EventSet<T> eventSet, ErrorAction errorAction) where T : class`
- `public static IErrorHandlingChain<T> StartErrorHandling<T>(this EventSet<T> eventSet) where T : class`

### EventSetTests

- `public Dictionary<Type, EntityModel> GetEntityModels() => new()`
- `public TestSet(List<TestEntity> items, EntityModel model) : base(new DummyContext(), model)`
- `public ValueTask DisposeAsync() => ValueTask.CompletedTask`
- `public async Task AddAsync_NullEntity_Throws()`
- `public async Task ForEachAsync_InvokesAction()`
- `public async Task ToListAsync_ReturnsItems()`
- `public object GetEventSet(Type entityType) => throw new NotImplementedException()`
- `public override async IAsyncEnumerator<TestEntity> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public void Dispose() { }`
- `public void Metadata_ReturnsExpectedValues()`

### EventSetWindowExtensions

- `public static IQueryable<T> Window<T>(this IQueryable<T> source, TimeSpan duration) where T : class`
- `public static IQueryable<T> Window<T>(this IQueryable<T> source, WindowDef windowDef) where T : class`
- `public static IQueryable<T> Window<T>(this IQueryable<T> source, int minutes) where T : class`

### EventSetWithServicesSendTests

- `public Task FlushAsync(TimeSpan timeout) => Task.CompletedTask`
- `public Task<KafkaBatchDeliveryResult> SendBatchAsync(IEnumerable<T> messages, KafkaMessageContext? context = null, CancellationToken cancellationToken = default)`
- `public Task<KafkaDeliveryResult> SendAsync(T message, KafkaMessageContext? context = null, CancellationToken cancellationToken = default)`
- `public TestContext() : base() { }`
- `public async Task SendEntityAsync_UsesProducerManager()`
- `public void Dispose() { }`
- `public void SetProducer(object manager)`

### EventSetWithServicesTests

- `public TestContext() : base() { }`
- `public void Constructors_CreateInstances()`

### EventSetWithStateStoreKeyTests

- `public Dictionary<Type, EntityModel> GetEntityModels() => new()`
- `public EntityModel GetEntityModel() => new EntityModel { EntityType = typeof(T), TopicAttribute = new TopicAttribute("t"), AllProperties = Array.Empty<System.Reflection.PropertyInfo>(), KeyProperties = Array.Empty<System.Reflection.PropertyInfo>() }`
- `public IKsqlContext GetContext() => null!`
- `public Task AddAsync(T entity, CancellationToken cancellationToken = default) => Task.CompletedTask`
- `public Task ForEachAsync(Func<T, Task> action, TimeSpan timeout = default, CancellationToken cancellationToken = default) => Task.CompletedTask`
- `public Task<List<T>> ToListAsync(CancellationToken cancellationToken = default) => Task.FromResult(new List<T>())`
- `public ValueTask DisposeAsync() => ValueTask.CompletedTask`
- `public async IAsyncEnumerator<T> GetAsyncEnumerator(CancellationToken cancellationToken = default) { await Task.CompletedTask; yield break; }`
- `public object GetEventSet(Type entityType) => throw new NotImplementedException()`
- `public string GetTopicName() => typeof(T).Name`
- `public void Dispose() { }`
- `public void GenerateEntityKey_MultipleKeys_ConcatenatesValues()`
- `public void GenerateEntityKey_NoKeyProperties_UsesHashCode()`
- `public void GenerateEntityKey_NullEntity_ReturnsGuidLike()`
- `public void GenerateEntityKey_SingleKeyProperty_UsesValue()`

### Example1_Basic

- `public static void Configure(ModelBuilder builder)`

### Example2_ManagedMode

- `public static void Configure(ModelBuilder builder)`
- `public static void Run()`

### Example3_AdvancedOptions

- `public static void Configure(ModelBuilder builder)`

### ExpressionAnalysisResultTests

- `public void HasJoin_PropertyRoundTrip()`

### ForEachAsyncErrorHandlingTests

- `public Dictionary<Type, EntityModel> GetEntityModels() => new()`
- `public FaultyEnumerator(List<TestEntity> items) => _items = items`
- `public FaultySet(List<TestEntity> items, EntityModel model) : base(new DummyContext(), model)`
- `public ValueTask DisposeAsync() => ValueTask.CompletedTask`
- `public ValueTask<bool> MoveNextAsync()`
- `public async Task EnumeratorException_IsSkipped()`
- `public object GetEventSet(Type entityType) => throw new NotImplementedException()`
- `public override IAsyncEnumerator<TestEntity> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public void Dispose() { }`

### GroupByBuilderTests

- `public void Build_GroupByMultipleKeys_ReturnsClause()`
- `public void Build_NoKeys_ThrowsInvalidOperationException()`

### HavingBuilderTests

- `public void Build_CountWithoutSelector_ReturnsCountAll()`
- `public void Build_NullExpression_ThrowsArgumentNullException()`
- `public void Build_SumWithLambda_ReturnsAggregateCondition()`
- `public void GetSqlOperator_ReturnsExpected(ExpressionType type, string expected)`
- `public void GetSqlOperator_Unsupported_Throws()`
- `public void TransformMethodName_ReturnsExpected(string original, string expected)`

### HoppingWindow

- `public static WindowDef Of(TimeSpan size) => new WindowDef().HoppingWindow().Size(size)`
- `public static WindowDef OfMinutes(int minutes) => Of(TimeSpan.FromMinutes(minutes))`

### JoinBuilderTests

- `public Holder(object value) { Value = value; }`
- `public void Build_InvalidJoin_ReturnsErrorComment()`
- `public void Build_NullExpression_ThrowsArgumentNullException()`
- `public void Build_SimpleJoin_ReturnsJoinQuery()`
- `public void FindJoinCall_ReturnsMethodCallFromInvocation()`
- `public void FindJoinCall_ReturnsMethodCallFromLambda()`
- `public void FindJoinCall_ReturnsMethodCallFromMemberInit()`
- `public void FindJoinCall_ReturnsMethodCallFromNewExpression()`
- `public void ThreeTableJoin_AllKeysMatch_ReturnsJoinedRecords()`
- `public void ThreeTableJoin_KeyMismatch_ReturnsEmpty()`
- `public void TwoTableJoin_AllKeysMatch_ReturnsJoinedRecords()`
- `public void TwoTableJoin_KeyMismatch_ReturnsEmpty()`

### JoinableEntitySet<T>

- `public EntityModel GetEntityModel() => _baseEntitySet.GetEntityModel()`
- `public EntityModel GetEntityModel() => _entityModel`
- `public EntityModel GetEntityModel() => _inner.GetEntityModel()`
- `public EntitySetAdapter(IEntitySet<T> inner)`
- `public IEntitySet<TResult> Select<TResult>(`
- `public IJoinResult<T, TInner> Join<TInner, TKey>(`
- `public IJoinResult<TOuter, TInner, TThird> Join<TThird, TKey>(`
- `public IKsqlContext GetContext() => _baseEntitySet.GetContext()`
- `public IKsqlContext GetContext() => _context`
- `public IKsqlContext GetContext() => _inner.GetContext()`
- `public JoinResult(`
- `public Task AddAsync(TResult entity, CancellationToken cancellationToken = default)`
- `public Task ForEachAsync(Func<TResult, Task> action, TimeSpan timeout = default, CancellationToken cancellationToken = default)`
- `public ThreeWayJoinResult(`
- `public TypedJoinResultEntitySet(`
- `public TypedThreeWayJoinResultEntitySet(`
- `public async IAsyncEnumerator<T> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public async IAsyncEnumerator<TResult> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public async IAsyncEnumerator<object> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public async Task AddAsync(T entity, CancellationToken cancellationToken = default)`
- `public async Task AddAsync(object entity, CancellationToken cancellationToken = default)`
- `public async Task ForEachAsync(Func<T, Task> action, TimeSpan timeout = default, CancellationToken cancellationToken = default)`
- `public async Task ForEachAsync(Func<object, Task> action, TimeSpan timeout = default, CancellationToken cancellationToken = default)`
- `public async Task<List<T>> ToListAsync(CancellationToken cancellationToken = default)`
- `public async Task<List<TResult>> ToListAsync(CancellationToken cancellationToken = default)`
- `public async Task<List<object>> ToListAsync(CancellationToken cancellationToken = default)`
- `public override string ToString()`
- `public string GetTopicName() => _baseEntitySet.GetTopicName()`
- `public string GetTopicName() => _entityModel.TopicAttribute?.TopicName ?? typeof(TResult).Name`
- `public string GetTopicName() => _inner.GetTopicName()`

### JsonAssert

- `public static void Equal(string expected, string actual)`

### JsonAssertTests

- `public void Equal_IgnoresFormattingAndCase()`

### KafkaBatch<TValue

- `public Task CommitAsync() => Task.CompletedTask`

### KafkaBatchOptionsTests

- `public void Defaults_AreExpected()`

### KafkaBatchTests

- `public async Task CommitAsync_Completes()`
- `public void IsEmpty_WhenNoMessages_ReturnsTrue()`
- `public void ProcessingTime_ComputedCorrectly()`

### KafkaConsumerManagerExceptionTests

- `public void Constructors_SetProperties()`

### KafkaConsumerManagerTests

- `public void BuildConsumerConfig_ReturnsConfiguredValues()`
- `public void GetEntityModel_ReturnsModelWithAttributes()`
- `public void GetOrCreateSerializationManager_CachesInstance()`

### KafkaContextCore

- `public Dictionary<Type, EntityModel> GetEntityModels()`
- `public IEntitySet<T> Set<T>() where T : class`
- `public object GetEventSet(Type entityType)`
- `public override string ToString()`
- `public virtual async ValueTask DisposeAsync()`
- `public void Dispose()`

### KafkaIgnoreAttribute

- `public override string ToString()`

### KafkaProducerManagerExtraTests

- `public void BuildProducerConfig_WithSecurityAndPartitioner()`
- `public void CreateSchemaRegistryClient_UsesOptions()`
- `public void CreateSchemaRegistryClient_WithAuthAndSsl()`

### KafkaProducerManagerTests

- `public void BuildProducerConfig_ReturnsConfiguredValues()`
- `public void GetEntityModel_ReturnsModelWithAttributes()`
- `public void GetOrCreateSerializationManager_CachesInstance()`

### KeyAttribute

- `public override string ToString()`

### KeyExtractorTests

- `public void DetermineKeyType_WithCompositeKeys_ReturnsDictionaryType()`
- `public void ExtractKeyProperties_ReturnsOrderedProperties()`
- `public void ExtractKeyValue_WithEntity_ReturnsDictionary()`
- `public void IsCompositeKey_WithMultipleKeys_ReturnsTrue()`
- `public void IsSupportedKeyType_ReturnsExpectedResults()`
- `public void KeyToString_WithDictionary_ReturnsConcatenatedString()`
- `public void KeyToString_WithNull_ReturnsEmpty()`
- `public void KeyToString_WithObject_UsesToString()`
- `public void KeyToString_WithString_ReturnsSameString()`
- `public void ToAvroEntityConfiguration_MapsProperties()`

### KsqlContext

- `public EntityModel GetEntityModel() => _entityModel`
- `public EventSetWithServices(KsqlContext context, EntityModel entityModel)`
- `public IKsqlContext GetContext() => _ksqlContext`
- `public async IAsyncEnumerable<object> ForEachAsync([EnumeratorCancellation] CancellationToken cancellationToken = default)`
- `public async IAsyncEnumerator<T> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public async Task AddAsync(T entity, CancellationToken cancellationToken = default)`
- `public async Task ForEachAsync(Func<T, Task> action, TimeSpan timeout = default, CancellationToken cancellationToken = default)`
- `public async Task<List<T>> ToListAsync(CancellationToken cancellationToken = default)`
- `public override string ToString()`
- `public string GetDlqTopicName()`
- `public string GetTopicName() => _entityModel.TopicAttribute?.TopicName ?? typeof(T).Name`

### KsqlContextAsyncTests

- `public TestContext() : base() { }`
- `public async Task DisposeAsyncCore_DisposesManagers()`

### KsqlContextBuilder

- `public KsqlContextBuilder ConfigureValidation(`
- `public KsqlContextBuilder EnableDebugMode(bool enable = true)`
- `public KsqlContextBuilder EnableLogging(ILoggerFactory loggerFactory)`
- `public KsqlContextBuilder UseSchemaRegistry(ISchemaRegistryClient client)`
- `public KsqlContextBuilder UseSchemaRegistry(SchemaRegistryConfig config)`
- `public KsqlContextBuilder UseSchemaRegistry(string url)`
- `public KsqlContextBuilder WithTimeouts(TimeSpan schemaRegistrationTimeout)`
- `public KsqlContextOptions Build()`
- `public T BuildContext<T>() where T : KsqlContext`
- `public static KsqlContextBuilder Create()`

### KsqlContextBuilderTests

- `public void BuildContext_CreatesInstance()`
- `public void Builder_Methods_ConfigureOptions()`
- `public void Create_ReturnsBuilder()`

### KsqlContextConversionTests

- `public IReadOnlyDictionary<Type, AvroEntityConfiguration> Convert(Dictionary<Type, EntityModel> models)`
- `public TestContext() : base() { }`
- `public void ConvertToAvroConfigurations_CreatesConfiguration()`

### KsqlContextOptions

- `public void Validate()`

### KsqlContextOptionsExtensions

- `public static KsqlContextOptions ConfigureValidation(`
- `public static KsqlContextOptions EnableDebugMode(`
- `public static KsqlContextOptions EnableLogging(`
- `public static KsqlContextOptions UseSchemaRegistry(`
- `public static KsqlContextOptions WithTimeouts(`

### KsqlContextOptionsExtensionsTests

- `public void ConfigureValidation_UpdatesFlags()`
- `public void EnableDebugMode_SetsFlag()`
- `public void EnableLogging_SetsLoggerFactory()`
- `public void UseSchemaRegistry_WithConfig_ConfiguresClient()`
- `public void UseSchemaRegistry_WithUrl_ConfiguresClient()`
- `public void WithTimeouts_SetsTimeout()`

### KsqlContextOptionsTests

- `public void Validate_WithMissingClient_Throws()`
- `public void Validate_WithNonPositiveTimeout_Throws()`
- `public void Validate_WithValidOptions_DoesNotThrow()`

### KsqlContextTests

- `public IEntitySet<T> CallCreateEntitySet<T>(EntityModel model) where T : class`
- `public KafkaConsumerManager CallGetConsumerManager() => base.GetConsumerManager()`
- `public KafkaProducerManager CallGetProducerManager() => base.GetProducerManager()`
- `public TestContext() : base() { }`
- `public TestContext(KafkaContextOptions opt) : base(opt) { }`
- `public void Constructors_InitializeManagers()`
- `public void CreateEntitySet_ReturnsEventSet()`
- `public void Dispose_DoesNotThrow()`

### KsqlDbExecutor

- `public abstract Task ExecuteDDLAsync(string ddlQuery)`
- `public abstract Task StopAllQueriesAsync()`
- `public abstract Task<List<T>> ExecutePullQueryAsync<T>(string query) where T : class`
- `public abstract Task<List<T>> ExecutePushQueryAsync<T>(string query) where T : class`
- `public abstract void Dispose()`
- `public abstract void ExecuteDDL(string ddlQuery)`

### KsqlDbRestApiClientTests

- `public Handler(HttpResponseMessage response) => _response = response`
- `public async Task ExecuteQueryAsync_ParsesResponse()`
- `public async Task ExecuteStatementAsync_ParsesResponse()`

### KsqlDslOptionsTests

- `public void Defaults_AreExpected()`

### LateEarliestOffsetTests

- `public void ProjectionBuilder_EarliestByOffset_GeneratesFunction()`
- `public void ProjectionBuilder_LatestByOffset_GeneratesFunction()`

### LinqJoinExtensions

- `public static IJoinResult<TOuter, TInner> Join<TOuter, TInner, TKey>(`
- `public static IJoinableEntitySet<T> AsJoinable<T>(this IEntitySet<T> entitySet) where T : class`

### LoggerFactoryExtensions

- `public static ILogger CreateLoggerOrNull(this ILoggerFactory? loggerFactory, Type type)`
- `public static ILogger CreateLoggerOrNull(this ILoggerFactory? loggerFactory, string categoryName)`
- `public static ILogger<T> CreateLoggerOrNull<T>(this ILoggerFactory? loggerFactory)`
- `public static void LogDebugWithLegacySupport(this ILogger logger,`
- `public static void LogDebugWithLegacySupport<T>(this ILogger<T> logger,`
- `public static void LogErrorWithLegacySupport<T>(this ILogger<T> logger,`
- `public static void LogInformationWithLegacySupport<T>(this ILogger<T> logger,`
- `public static void LogWarningWithLegacySupport<T>(this ILogger<T> logger,`

### LoggerFactoryExtensionsTests

- `public void CreateLoggerOrNull_ReturnsNullLoggerWhenFactoryNull()`
- `public void CreateLoggerOrNull_UsesFactory()`
- `public void LogMethods_WithAndWithoutFactory()`

### ManagedTopicExtensions

- `public static IEntityBuilder<T> IsManaged<T>(this IEntityBuilder<T> builder, bool isManaged) where T : class`
- `public static bool GetIsManaged<T>(this IEntityBuilder<T> builder) where T : class`
- `public static void ClearRegisteredTopics() => _existingTopics.Clear()`
- `public static void RegisterExistingTopic(string topicName, TopicAttribute attribute)`

### ManagedTopicExtensionsTests

- `public void ManagedFlag_IsTrue_WhenMarked()`

### ManualCommitTests

- `public Dictionary<Type, EntityModel> GetEntityModels() => new()`
- `public ManualCommitSet(List<TestEntity> items, EntityModel model) : base(new DummyContext(), model)`
- `public ValueTask DisposeAsync() => ValueTask.CompletedTask`
- `public async Task ForEachAsync_AutoCommit_ReturnsEntity()`
- `public async Task ForEachAsync_ManualCommit_WrapperAndAck()`
- `public object GetEventSet(Type entityType) => throw new NotImplementedException()`
- `public override async IAsyncEnumerator<TestEntity> GetAsyncEnumerator(CancellationToken cancellationToken = default)`
- `public void Dispose() { }`

### MaxLengthAttribute

- `public override string ToString()`

### MessagingConfigurationTests

- `public void CommonSection_PropertyGetters()`
- `public void ConsumerSection_PropertyGetter()`
- `public void SchemaRegistrySection_PropertyGetters()`
- `public void TopicCreationSection_PropertyGetters()`
- `public void TopicSection_PropertyGetters()`

### MessagingExceptionTests

- `public void ConsumerPoolException_Constructors()`
- `public void KafkaBatchSendException_SetsBatchResult()`
- `public void KafkaConsumerException_Constructors()`
- `public void KafkaProducerManagerException_Constructors()`
- `public void ProducerPoolException_Constructors()`

### MessagingPropertyTests

- `public void KafkaBatchDeliveryResult_AllSuccessful_WhenNoErrors()`
- `public void KafkaDeliveryResult_Properties_RoundTrip()`
- `public void PooledConsumer_Defaults_Settable()`
- `public void Pooled
The file is too long and its contents have been truncated.

### tool â€” 2025-06-27T14:07:59.995331+00:00

# OSSè¨­è¨ˆè³‡æ–™ï¼šçµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## Overview

### Readme

ï»¿# KSQL Entity Framework è¦ä»¶å®šç¾©æ›¸

## ç›®æ¬¡ (Table of Contents)

- [1. æ¦‚è¦](#1-æ¦‚è¦)
- [2. åŸºæœ¬åŸå‰‡](#2-åŸºæœ¬åŸå‰‡)
- [3. ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#3-ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
  - [3.1 ãƒˆãƒ”ãƒƒã‚¯ (Kafka Topics)](#31-ãƒˆãƒ”ãƒƒã‚¯-kafka-topics)
  - [3.2 ã‚¹ãƒˆãƒªãƒ¼ãƒ  (KSQL Streams)](#32-ã‚¹ãƒˆãƒªãƒ¼ãƒ -ksql-streams)
  - [3.3 ãƒ†ãƒ¼ãƒ–ãƒ« (KSQL Tables)](#33-ãƒ†ãƒ¼ãƒ–ãƒ«-ksql-tables)
  - [3.4 ã‚¯ã‚¨ãƒªã¨è³¼èª­](#34-ã‚¯ã‚¨ãƒªã¨è³¼èª­)
- [4. POCO (Plain Old CLR Objects) ã®è¨­è¨ˆ](#4-poco-plain-old-clr-objects-ã®è¨­è¨ˆ)
  - [4.1 åŸºæœ¬å®šç¾©](#41-åŸºæœ¬å®šç¾©)
  - [4.2 ç‰¹æ®Šå‹ã®ã‚µãƒãƒ¼ãƒˆ](#42-ç‰¹æ®Šå‹ã®ã‚µãƒãƒ¼ãƒˆ)
- [5. ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹/ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ æ“ä½œ](#5-ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ æ“ä½œ)
  - [5.1 ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ (ãƒ‡ãƒ¼ã‚¿é€ä¿¡)](#51-ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼-ãƒ‡ãƒ¼ã‚¿é€ä¿¡)
  - [5.2 ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ (ãƒ‡ãƒ¼ã‚¿å—ä¿¡)](#52-ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼-ãƒ‡ãƒ¼ã‚¿å—ä¿¡)
  - [5.3 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†](#53-ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†)
- [6. ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ‡ãƒ¼ã‚¿å“è³ª](#6-ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ‡ãƒ¼ã‚¿å“è³ª)
  - [6.1 ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆ¦ç•¥](#61-ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆ¦ç•¥)
  - [6.2 ãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼ã‚­ãƒ¥ãƒ¼](#62-ãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼ã‚­ãƒ¥ãƒ¼)
  - [EventSetæ‹¡å¼µ: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° & DLQ](#eventsetæ‹¡å¼µ-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°--dlq)
- [7. ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†æ“ä½œ](#7-ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†æ“ä½œ)
  - [7.1 ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã¨æ›´æ–°](#71-ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã¨æ›´æ–°)
  - [7.2 ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†æ§‹ç¯‰ã¨ç®¡ç†](#72-ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†æ§‹ç¯‰ã¨ç®¡ç†)
- [8. ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»](#8-ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»)
- [9. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#9-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
  - [ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
  - [ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹](#ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹)
  - 
## 1. æ¦‚è¦

KSQL Entity Frameworkã¯ã€C#ãƒ—ãƒ­ã‚°ãƒ©ãƒãŒEntityFrameworkãƒ©ã‚¤ã‚¯ãªAPIã‚’ä½¿ç”¨ã—ã¦KSQL/KafkaStreamsã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ãƒˆãƒ”ãƒƒã‚¯ä¸­å¿ƒã®è¨­è¨ˆã€POCOãƒ™ãƒ¼ã‚¹ã®ã‚¯ã‚¨ãƒªå®šç¾©ã€LINQãƒ©ã‚¤ã‚¯ãªã‚¹ãƒˆãƒªãƒ¼ãƒ æ“ä½œã‚’ç‰¹å¾´ã¨ã—ã¾ã™ã€‚

## 2. åŸºæœ¬åŸå‰‡

1. **ãƒˆãƒ”ãƒƒã‚¯ä¸­å¿ƒè¨­è¨ˆ**: ã™ã¹ã¦ã®æ“ä½œã¯Kafkaãƒˆãƒ”ãƒƒã‚¯ã‚’èµ·ç‚¹ã¨ã™ã‚‹
2. **å‹å®‰å…¨æ€§**: C#ã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ã¦ã‚¹ã‚­ãƒ¼ãƒã®æ•´åˆæ€§ã‚’ç¢ºä¿
3. **ä½¿ã„æ…£ã‚ŒãŸAPI**: EntityFrameworkã«é¡ä¼¼ã—ãŸAPIãƒ‡ã‚¶ã‚¤ãƒ³
4. **LINQã‚µãƒãƒ¼ãƒˆ**: ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã‚’LINQã‚¯ã‚¨ãƒªã¨ã—ã¦è¡¨ç¾
5. **æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤**: åŸºæœ¬æ©Ÿèƒ½ã‹ã‚‰é«˜åº¦ãªæ©Ÿèƒ½ã¸ã¨æ®µéšçš„ã«å®Ÿè£…
6. **è³¼èª­ãƒ¢ãƒ¼ãƒ‰ã®å›ºå®šåŒ–**: ã‚¹ãƒˆãƒªãƒ¼ãƒ å®šç¾©æ™‚ã«è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆã®æ–¹å¼ã‚’æ˜ç¤ºã—ã€å®Ÿè¡Œæ™‚ã«åˆ‡ã‚Šæ›¿ãˆä¸å¯ã¨ã™ã‚‹


## 3. POCOå±æ€§ãƒ™ãƒ¼ã‚¹DSLè¨­è¨ˆãƒ«ãƒ¼ãƒ«ï¼ˆFluent APIã®æ’é™¤æ–¹é‡ï¼‰

æœ¬OSSã§ã¯ã€Kafka/KSQLã®è¨­å®šã‚’ã™ã¹ã¦POCOã‚¯ãƒ©ã‚¹ã®å±æ€§ã§å®šç¾©ã™ã‚‹æ–¹å¼ã‚’æ¡ç”¨ã™ã‚‹ã€‚
ã“ã‚Œã¯ã€Fluent APIã‚’ç”¨ã„ãŸDSLè¨˜è¿°ã®æŸ”è»Ÿæ€§ã¨å¼•ãæ›ãˆã«ã€ã€Œæ§‹æˆãŒPOCOã«é›†ç´„ã•ã‚Œã¦ã„ã‚‹ã€ã¨ã„ã†æ˜å¿«ã•ã‚’é‡è¦–ã—ãŸè¨­è¨ˆæ–¹é‡ã§ã‚ã‚‹ã€‚

ğŸ·ï¸ ã‚¯ãƒ©ã‚¹ãƒ¬ãƒ™ãƒ«å±æ€§ä¸€è¦§
|å±æ€§å	|èª¬æ˜|
|---|---|
[Topic("topic-name")]	|Kafkaãƒˆãƒ”ãƒƒã‚¯åã®æŒ‡å®šï¼ˆPartitions, Replicationã‚‚è¨­å®šå¯èƒ½ï¼‰
[KsqlStream] / [KsqlTable]	|Stream/Table ã®æ˜ç¤ºæŒ‡å®šï¼ˆæœªæŒ‡å®šæ™‚ã¯è‡ªå‹•åˆ¤å®šï¼‰
[Table("name")]	|EF Coreã¨ã®äº’æ›æ€§ç¶­æŒç”¨ï¼ˆä»»æ„ï¼‰


ğŸ§© ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ¬ãƒ™ãƒ«å±æ€§ä¸€è¦§
|å±æ€§å	|èª¬æ˜|
|---|---|
[Key(Order = n)]|	Kafkaã®Keyã«å¯¾å¿œã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€‚è¤‡åˆã‚­ãƒ¼å¯
[KafkaIgnore]	|ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãƒ»KSQLå¤‰æ›ã‹ã‚‰é™¤å¤–ã•ã‚Œã‚‹
[DecimalPrecision(precision, scale)]	|decimalå‹ã®ç²¾åº¦æŒ‡å®šï¼ˆä¾‹ï¼š18,4ï¼‰
[DateTimeFormat("format")]	|KSQLä¸Šã§ã®DateTimeã®æ–‡å­—åˆ—ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
[DefaultValue(value)]	|å®šç¾©æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆã‚¹ã‚­ãƒ¼ãƒå®šç¾©ä¸Šã®ã¿ï¼‰
[MaxLength(n)]	|æ–‡å­—åˆ—é•·ã®åˆ¶ç´„ã€‚Avroã‚¹ã‚­ãƒ¼ãƒã«ã‚‚åæ˜ 

ğŸ¤– è‡ªå‹•åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
[Key]ã®æœ‰ç„¡ã«ã‚ˆã£ã¦ [KsqlStream] or [KsqlTable] ã®æš—é»™çš„æ¨å®šã‚’è¡Œã†

Nullable<T> ã¯ã‚¹ã‚­ãƒ¼ãƒä¸Šã§ Union<Type, null> ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹

Keyå±æ€§ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯è¤‡åˆã‚­ãƒ¼ï¼ˆCompositeKeyï¼‰ã¨ã—ã¦å¤‰æ›ã•ã‚Œã‚‹

ğŸ’¡ ã‚µãƒ³ãƒ—ãƒ«ï¼šOrderã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®šç¾©
```csharp
[Topic("orders", Partitions = 3, Replication = 1)]
[KsqlTable]
public class Order
{
    [Key(Order = 0)]
    public int OrderId { get; set; }

    [DateTimeFormat("yyyy-MM-dd")]
    public DateTime OrderDate { get; set; }

    [DecimalPrecision(18, 4)]
    public decimal TotalAmount { get; set; }

    [MaxLength(100)]
    public string? Region { get; set; }

    [KafkaIgnore]
    public string? InternalUseOnly { get; set; }
}
```
ğŸ“˜ è¨­è¨ˆä¸Šã®æ–¹é‡ã¨æ„å›³
æ§‹æˆæƒ…å ±ã¯ã™ã¹ã¦ POCOã«è¨˜è¿°ã•ã‚Œã€å¤–éƒ¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚„Fluent DSLã¯ä¸è¦

åˆ©ç”¨è€…ã¯ .cs ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šã®å±æ€§ã®ã¿ã‚’å‚ç…§ã™ã‚Œã°å‹•ä½œæ§‹æˆã‚’æŠŠæ¡å¯èƒ½


ğŸ” Fluent API ã®è£œåŠ©çš„æ´»ç”¨ã¨åˆ¶é™ã«ã¤ã„ã¦
POCOå±æ€§ã‚’ä¸­å¿ƒã¨ã—ãŸè¨­è¨ˆæ–¹é‡ã‚’æ¡ã‚‹æœ¬DSLã§ã¯ã€Fluent API ã¯ã‚ãã¾ã§è£œåŠ©çš„æ‰‹æ®µã¨ã—ã¦ä½ç½®ã¥ã‘ã‚‰ã‚Œã€ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§é™å®šçš„ã«åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

ğŸ§± 1. KsqlContextBuilderï¼ˆKSQL DSLå…¨ä½“ã®æ§‹æˆï¼‰
```csharp
var context = CsharpKsqlContextBuilder.Create()
    .UseSchemaRegistry("http://localhost:8081")
    .EnableLogging(loggerFactory)
    .ConfigureValidation(autoRegister: true, failOnErrors: false, enablePreWarming: true)
    .WithTimeouts(TimeSpan.FromSeconds(5))
    .EnableDebugMode(true)
    .Build()
    .BuildContext<MyKsqlContext>();
```
ä¸»ãªç”¨é€”ï¼š

ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªé€£æº

ãƒ­ã‚°å‡ºåŠ›ã®è¨­å®š

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç­‰ã®å‹•ä½œåˆ¶å¾¡

ğŸ§© 2. ModelBuilderï¼ˆEntityå®šç¾©æ™‚ï¼‰
```csharp
protected override void OnModelCreating(IModelBuilder modelBuilder)
{
    modelBuilder.Entity<Order>()
        .AsTable(); // ã¾ãŸã¯ .AsStream()
}
```
POCOå±æ€§ã« Stream/Table æŒ‡å®šãŒãªã„å ´åˆã®ã¿ä½¿ç”¨å¯

æ˜ç¤ºçš„ãªå‹æŒ‡å®šã‚’å¯èƒ½ã«ã™ã‚‹ï¼ˆãŸã ã— key/topic è¨­å®šã¯ç¦æ­¢ï¼‰

ğŸ“¦ 3. AvroEntityConfigurationBuilderï¼ˆAvroã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã®è©³ç´°åˆ¶å¾¡ï¼‰
```csharp
configuration.Configure<Order>()
    .ToTopic("orders")                   // âŒ éæ¨å¥¨ï¼ˆå±æ€§å„ªå…ˆï¼‰
    .HasKey(o => o.Id)                   // âŒ éæ¨å¥¨
    .WithPartitions(3)
    .WithReplicationFactor(2)
    .AsStream();                         // âœ… Stream/TableæŒ‡å®šã®ã¿è¨±å¯
```    
ã“ã®ãƒ“ãƒ«ãƒ€ãƒ¼ã¯ã€Avroã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆæ™‚ã«é«˜åº¦ãªåˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆã«é™ã‚Šä½¿ç”¨ã•ã‚Œã‚‹ã€‚
ãŸã ã—ã€ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã¯è¨­è¨ˆåŸå‰‡é•åã¨ãªã‚‹ã€‚

ğŸš« åˆ¶é™äº‹é …
ãƒ¡ã‚½ãƒƒãƒ‰	ç†ç”±
.ToTopic("...")	ãƒˆãƒ”ãƒƒã‚¯åã¯ [Topic] å±æ€§ã§æŒ‡å®šã™ã‚‹ãŸã‚ç¦æ­¢
.HasKey(...)	ã‚­ãƒ¼å®šç¾©ã¯ [Key] å±æ€§ã«ä¸€æœ¬åŒ–ã•ã‚Œã¦ã„ã‚‹
.AsStream() / .AsTable()	å±æ€§ã¾ãŸã¯ModelBuilderã¨é‡è¤‡å¯èƒ½ã€‚ä¸¡æ–¹æŒ‡å®šã§ä¸€è‡´ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼

ã“ã‚Œã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯å‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã« NotSupportedException ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹è¨­è¨ˆã¨ã—ã€èª¤ç”¨ã‚’é˜²æ­¢ã™ã‚‹ã€‚

### 3.1 ãƒˆãƒ”ãƒƒã‚¯ (Kafka Topics)

[Topic] å±æ€§ã§ãƒˆãƒ”ãƒƒã‚¯ã‚’å®šç¾©ã€‚

ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ•°ã‚„ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¿‚æ•°ã®Fluent APIã«ã‚ˆã‚‹è¨­å®šäºˆå®šã€‚
#### ãƒˆãƒ”ãƒƒã‚¯å®šç¾©
```csharp
// å±æ€§ã«ã‚ˆã‚‹ãƒãƒƒãƒ”ãƒ³ã‚°
[Topic("orders", PartitionCount = 12, ReplicationFactor = 3)]
public class Order 
{
    [Key]
    public string OrderId { get; set; }
    public string CustomerId { get; set; }
    public decimal Amount { get; set; }
    public DateTime OrderTime { get; set; }
}

// Fluent API
modelBuilder.Entity<Order>()
    .WithPartitions(12)
    .WithReplicationFactor(3);
```

#### ãƒˆãƒ”ãƒƒã‚¯æ§‹æˆ
- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³è¨­å®š: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ•°ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥
- ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š: ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã€ISRã®æœ€å°æ•°
- ä¿æŒãƒãƒªã‚·ãƒ¼: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿æŒæœŸé–“ã€ã‚µã‚¤ã‚ºåˆ¶é™
- åœ§ç¸®è¨­å®š: ãƒˆãƒ”ãƒƒã‚¯ãƒ¬ãƒ™ãƒ«ã®åœ§ç¸®æ–¹å¼

#### ã‚¹ã‚­ãƒ¼ãƒç®¡ç†
- è‡ªå‹•ã‚¹ã‚­ãƒ¼ãƒç™»éŒ²: POCOã‹ã‚‰Avroã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆã—ç™»éŒ²
- äº’æ›æ€§è¨­å®š: ã‚¹ã‚­ãƒ¼ãƒäº’æ›æ€§ãƒãƒªã‚·ãƒ¼ã®æŒ‡å®š
- ã‚¹ã‚­ãƒ¼ãƒé€²åŒ–: ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç®¡ç†ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³


### 3.2 ã‚¹ãƒˆãƒªãƒ¼ãƒ  (KSQL Streams)
.Where(...), .Select(...) ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ»å¤‰æ›ã€‚

.WithManualCommit() ã«ã‚ˆã‚‹æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆæŒ‡å®šãŒå¯èƒ½ã€‚

EntityModel ã«çŠ¶æ…‹ã‚’ä¿å­˜ã€å®Ÿè¡Œæ™‚ã«åæ˜ ã€‚

å®Ÿè¡Œæ™‚åˆ‡ã‚Šæ›¿ãˆã¯ä¸å¯ã€‚
#### ã‚¹ãƒˆãƒªãƒ¼ãƒ å®šç¾©ã®å‰æ

ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯ POCO ã«å¯¾ã—ã¦ LINQ å¼ãŒé©ç”¨ã•ã‚ŒãŸã¨ãã«å‹•çš„ã«è§£é‡ˆã•ã‚Œã€ç”Ÿæˆã•ã‚Œã‚‹ã€‚

#### åˆ¤å®šãƒ«ãƒ¼ãƒ«

POCOï¼ˆC#ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©ï¼‰ã«å¯¾ã—ã¦LINQå¼ãŒè¨˜è¿°ã•ã‚ŒãŸå ´åˆã€
ãã®å‹ã¯ "ã‚¹ãƒˆãƒªãƒ¼ãƒ " ã¨ã—ã¦è§£é‡ˆã•ã‚Œã€å¯¾å¿œã™ã‚‹ CREATE STREAM å®šç¾©ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

ãŸã ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã« GroupBy ã‚„ Aggregateã€Window ã‚’å«ã‚€å ´åˆã¯ CREATE TABLEï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã¨ã—ã¦è§£é‡ˆã•ã‚Œã¾ã™ã€‚
```csharp
// ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹ä¾‹ï¼ˆAutoCommitãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
modelBuilder.Entity<Order>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId });

// ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹ä¾‹ï¼ˆGroupBy ã‚’å«ã‚€ï¼‰
modelBuilder.Entity<Order>()
    .Window(TumblingWindow.Of(TimeSpan.FromHours(1)))
    .GroupBy(o => o.CustomerId)
    .Select(g => new HourlyStats 
    { 
        CustomerId = g.Key,
        Hour = g.Window.Start,
        OrderCount = g.Count() 
    });

// æ˜ç¤ºçš„ã«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã—ã¦æ‰±ã†ï¼ˆGroupByãŒã‚ã£ã¦ã‚‚ï¼‰
modelBuilder.Entity<Order>()
    .AsStream()
    .GroupBy(o => o.Region)
    .Select(g => new { g.Key });

// æ˜ç¤ºçš„ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦æ‰±ã†
modelBuilder.Entity<Order>()
    .AsTable()
    .Select(o => new { o.CustomerId, o.Amount });
```

ã“ã®ã‚ˆã†ã« modelBuilder.Entity<Order>() ã«å¯¾ã—ã¦ LINQ ãŒä»˜ãã‹å¦ã‹ã§ "é…ä¿¡å¯¾è±¡"
ã•ã‚‰ã« LINQ ã®å†…å®¹ã«ã‚ˆã£ã¦ "ã‚¹ãƒˆãƒªãƒ¼ãƒ " ã‹ "ãƒ†ãƒ¼ãƒ–ãƒ«" ã‹ã‚’åˆ¤åˆ¥ã—ã¾ã™ã€‚
åŠ ãˆã¦ã€.AsStream() ã‚„ .AsTable() ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ„å›³çš„ã«è§£é‡ˆã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

#### ã‚³ãƒŸãƒƒãƒˆæ–¹å¼ã®æŒ‡å®š

ã“ã® `WithManualCommit()` æŒ‡å®šã¯ `EntityModel` ã«ä¿å­˜ã•ã‚Œã€å®Ÿè¡Œæ™‚ã® `ForEachAsync()` ã§ã®å‡¦ç†æ–¹å¼ï¼ˆè‡ªå‹•ï¼æ‰‹å‹•ï¼‰ã‚’æ±ºå®šã™ã‚‹éš›ã«å‚ç…§ã•ã‚Œã¾ã™ã€‚å®Ÿè¡Œæ™‚ã«ã“ã®è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

```csharp
// è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
modelBuilder.Entity<Order>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId });

// æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆã‚’æ˜ç¤º
modelBuilder.Entity<Order>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId })
    .WithManualCommit();
```
æ³¨æ„ï¼šè³¼èª­æ™‚ã® commit ãƒ¢ãƒ¼ãƒ‰ã¯ LINQ å®Ÿè¡Œæ™‚ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚å®šç¾©æ™‚ã«ç¢ºå®šã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### 3.3 ãƒ†ãƒ¼ãƒ–ãƒ« (KSQL Tables)

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ã€LINQ å¼ãŒ GroupBy ã‚„ Aggregate ã‚’å«ã¿ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã¨åˆ¤å®šã•ã‚ŒãŸå ´åˆã€å¯¾å¿œã™ã‚‹ãƒˆãƒ”ãƒƒã‚¯ã¯ è‡ªå‹•çš„ã« compact ãƒ¢ãƒ¼ãƒ‰ã§ä½œæˆ ã•ã‚Œã¾ã™ã€‚

é–‹ç™ºè€…ã¯ã‚³ãƒ³ãƒ‘ã‚¯ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã‚’æ„è­˜ã›ãšã€é€šå¸¸ã® LINQ ã‚¯ã‚¨ãƒªå®šç¾©ã ã‘ã§æ­£ã—ãæ°¸ç¶šåŒ–ç‰¹æ€§ã‚’æŒã£ãŸãƒˆãƒ”ãƒƒã‚¯ã‚’æ‰±ãˆã¾ã™ã€‚
```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{

    modelBuilder.Entity<Order>()
        .HasTopic("orders")
        .GroupBy(o => o.CustomerId)
        .Select(g => new
        {
            CustomerId = g.Key,
            LatestAmount = g.LatestByOffset(o => o.Amount)
        });
}
```
ã“ã®ä¾‹ã§ã¯ CustomerId ã‚’ã‚­ãƒ¼ã¨ã—ãŸæœ€æ–°ã®æ³¨æ–‡é‡‘é¡ã ã‘ã‚’ä¿æŒã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã€ãã®è£ã®ãƒˆãƒ”ãƒƒã‚¯ã¯ compact ã¨ãªã‚Šã¾ã™ã€‚

GroupBy(...) ã«ã‚ˆã‚Šãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆKTableï¼‰åŒ–ã€‚

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<Order>()
        .HasTopic("orders")
        .GroupBy(o => o.OrderId)
        .Window(new[] { 1 })
        .Select(g => new
        {
            OrderId = g.Key,
            LatestPrice = g.Last().Price,
            WindowStart = g.WindowStart,
            WindowEnd = g.WindowEnd
        });
}

```
.Window(...) ã«ã‚ˆã‚Šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é›†ç´„å¯èƒ½ã€‚

è¤‡æ•°ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºï¼ˆä¾‹ï¼š1åˆ†ãƒ»5åˆ†ï¼‰ã«å¯¾å¿œã€‚

orders_window_final ã¸ã®æ›¸ãè¾¼ã¿ã¯PODå†…ã‚¿ã‚¤ãƒãƒ¼ã«ã‚ˆã‚‹Windowç¢ºå®šã§è‡ªå¾‹å®Ÿè¡Œã€‚

æœ€åˆã«åˆ°ç€ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ­£ã¨ã™ã‚‹æ–¹é‡ã‚’æ¡ç”¨ã€‚

#### ãƒ†ãƒ¼ãƒ–ãƒ«åˆ¤å®šãƒ«ãƒ¼ãƒ«ã¨åŸºæœ¬è¨­è¨ˆ

POCOï¼ˆC#ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©ï¼‰ã«å¯¾ã™ã‚‹ LINQ å¼ã®ä¸­ã§ GroupBy, Aggregate, Window ãªã©ã®æ§‹æ–‡ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®ã‚¯ã‚¨ãƒªã¯ CREATE TABLE ã«ç›¸å½“ã™ã‚‹ KSQL ãƒ†ãƒ¼ãƒ–ãƒ«ã¨è§£é‡ˆã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆ¤å®šãŒ LINQ æ§‹æ–‡ã®æ„å‘³ã«åŸºã¥ã„ã¦ä¸€è²«ã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚

ã¾ãŸã€.AsTable() ã‚’æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã™ã“ã¨ã§ã€æ„å›³çš„ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

#### é›†ç´„æ“ä½œ
```csharp
// ã‚µãƒãƒªé›†è¨ˆ
var customerStats = context.Orders
    .GroupBy(o => o.CustomerId)
    .Aggregate(g => new CustomerStats 
    { 
        CustomerId = g.Key, 
        TotalAmount = g.Sum(o => o.Amount),
        OrderCount = g.Count()
    });

// LATEST_BY_OFFSET
var latestCustomerOrders = context.Orders
    .GroupBy(o => o.CustomerId)
    .Aggregate(g => new CustomerLatestOrder
    {
        CustomerId = g.Key,
        LatestOrderId = g.LatestByOffset(o => o.OrderId),
        LatestOrderTime = g.LatestByOffset(o => o.OrderTime),
        LatestAmount = g.LatestByOffset(o => o.Amount)
    });

// EARLIEST_BY_OFFSET
var firstTimeCustomers = context.Orders
    .GroupBy(o => o.CustomerId)
    .Aggregate(g => new CustomerFirstOrder
    {
        CustomerId = g.Key,
        FirstOrderId = g.EarliestByOffset(o => o.OrderId),
        FirstOrderTime = g.EarliestByOffset(o => o.OrderTime),
        FirstAmount = g.EarliestByOffset(o => o.Amount)
    });


```
#### ãƒ†ãƒ¼ãƒ–ãƒ«çµåˆï¼ˆJOINï¼‰

```csharp
// å˜ä¸€ã‚­ãƒ¼çµåˆ
var query = from o in context.Orders
            join c in context.Customers
            on o.CustomerId equals c.CustomerId
            select new { o.OrderId, c.CustomerName, o.Amount };

// è¤‡åˆã‚­ãƒ¼çµåˆ
var query2 = from o in context.Orders
             join c in context.Customers
             on new { o.CustomerId, o.Region } equals 
                new { c.CustomerId, c.Region }
             select new { o.OrderId, c.CustomerName, o.Amount };

// 3ãƒ†ãƒ¼ãƒ–ãƒ«çµåˆ
var query3 = from o in context.Orders
             join c in context.Customers on o.CustomerId equals c.CustomerId
             join p in context.Products on o.ProductId equals p.ProductId
             select new {
                 o.OrderId,
                 c.CustomerName,
                 p.ProductName,
                 o.Quantity,
                 o.Amount
             };

```

â±ï¸ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦DSLã®æ‹¡å¼µï¼šè¤‡æ•°Windowå®šç¾©ã¨ã‚¢ã‚¯ã‚»ã‚¹
æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€åŒä¸€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾ã—ã¦è¤‡æ•°ã®ç•°ãªã‚‹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…ï¼ˆä¾‹ï¼š1åˆ†ã€5åˆ†ã€15åˆ†ã€60åˆ†ï¼‰ã‚’å®šç¾©ã—ã€å€‹åˆ¥ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒ»è³¼èª­å¯èƒ½ã¨ã™ã‚‹æ‹¡å¼µDSLã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```csharp
modelBuilder.Entity<Chart>()
    .Window(new int[]{1,5,15,60});
```
ã“ã®è¨˜è¿°ã«ã‚ˆã‚Šä»¥ä¸‹ã®4ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼š

Chart_1min

Chart_5min

Chart_15min

Chart_60min


ğŸ’» LINQã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã¯æ¬¡ã®ã‚ˆã†ã«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ãã¾ã™ï¼š

```csharp
var candles1m = ctx.Charts.Window(1).ToList();
var candles5m = ctx.Charts.Window(5).ToList();
// TimeSpan æŒ‡å®šã‚‚å¯èƒ½
var candles15m = ctx.Charts.Window(TimeSpan.FromMinutes(15)).ToList();
```
æˆ»ã‚Šå€¤ã¯ IQueryable<Chart> ã¨ã—ã¦å–å¾—ã•ã‚Œã€é€šå¸¸ã®LINQå¼ãŒé©ç”¨å¯èƒ½ã§ã™ã€‚

ğŸ” æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä¾‹
ToLatest() ã¯å°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ãªãã€LINQã§ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼š

```csharp
var latest = ctx.Charts.Window(5).ToList()
    .OrderByDescending(c => c.Timestamp)
    .GroupBy(c => c.Symbol)
    .Select(g => g.First());
```

### 3.4 ã‚¯ã‚¨ãƒªã¨è³¼èª­
ForEachAsync() ã«ã‚ˆã‚‹è³¼èª­ã‚¹ãƒˆãƒªãƒ¼ãƒ å–å¾—ã€‚

.WithManualCommit() ãŒæŒ‡å®šã•ã‚ŒãŸã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯ IManualCommitMessage<T> å‹ã‚’è¿”ã™ã€‚

.Valueï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹

.CommitAsync()ï¼šã‚³ãƒŸãƒƒãƒˆå‡¦ç†

.NegativeAckAsync()ï¼šå¦å®šå¿œç­”
#### ã‚¹ãƒˆãƒªãƒ¼ãƒ å®šç¾©ã¨ã‚³ãƒŸãƒƒãƒˆæ–¹å¼ã®æŒ‡å®š
```csharp
// modelBuilder ã«ã‚ˆã‚‹å®šç¾©ï¼ˆè‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
modelBuilder.Entity<Order>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId });
// è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆã®è³¼èª­å‡¦ç†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
await foreach (var order in context.Orders.ForEachAsync())
{
    Console.WriteLine($"Received: {order.Value.OrderId}");
    // è‡ªå‹•ã§ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ãŸã‚æ˜ç¤ºçš„ãª commit ã¯ä¸è¦
}

// modelBuilder ã«ã‚ˆã‚‹å®šç¾©ï¼ˆæ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆï¼‰
modelBuilder.Entity<HighValueOrder>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId })
    .WithManualCommit();

// æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆä»˜ãã®è³¼èª­å‡¦ç†
await foreach (var order in context.HighValueOrders.ForEachAsync())
{
    try
    {
        Console.WriteLine($"Received: {order.Value.OrderId}");
        await order.CommitAsync();
    }
    catch
    {
        await order.NegativeAckAsync();
    }
}

```
æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€`ForEachAsync()` ã¯ `IManualCommitMessage<T>` å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¾ã™ã€‚
ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ `.Value` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§å…ƒã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã€`.CommitAsync()` / `.NegativeAckAsync()` ã«ã‚ˆã£ã¦å‡¦ç†å®Œäº†ï¼å¤±æ•—é€šçŸ¥ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚
```csharp
public interface IManualCommitMessage<T>
{
    T Value { get; }
    Task CommitAsync();
    Task NegativeAckAsync();
}
```
ã“ã®å‹ã¯æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆæŒ‡å®šæ™‚ã®ã¿è¿”ã•ã‚Œã€è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆæ™‚ã¯ T ã®ã¾ã¾ã«ãªã‚Šã¾ã™ï¼ˆForEachAsync() ã®ä¸­ã§åˆ†å²ï¼‰

## 4. POCO (Plain Old CLR Objects) ã®è¨­è¨ˆ

### 4.1 åŸºæœ¬å®šç¾©
- ã‚·ãƒ³ãƒ—ãƒ«ãªC#ã‚¯ãƒ©ã‚¹: ç‰¹åˆ¥ãªåŸºåº•ã‚¯ãƒ©ã‚¹ä¸è¦
- æ¨™æº–çš„ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£: ä¸€èˆ¬çš„ãª.NETå‹ã®ã‚µãƒãƒ¼ãƒˆ
- [Topic], [Key], [AvroTimestamp] å±æ€§ã‚’æä¾›ã€‚

### 4.2 å‹ã®ã‚µãƒãƒ¼ãƒˆ

ä»¥ä¸‹ã¯POCOã§ä½¿ç”¨å¯èƒ½ãªä¸»ãªãƒ‡ãƒ¼ã‚¿å‹ã®ä¸€è¦§ã§ã™ï¼š

|ãƒ‡ãƒ¼ã‚¿å‹|èª¬æ˜|
---|---
int, long|æ•´æ•°å‹ã€Kafkaã§ã¯Avro/ProtobufçµŒç”±ã§ãã®ã¾ã¾ãƒãƒƒãƒ”ãƒ³ã‚°å¯èƒ½
float, double|æµ®å‹•å°æ•°ç‚¹æ•°
decimal|é«˜ç²¾åº¦æ•°å€¤ã€‚[DecimalPrecision]ã§ç²¾åº¦æŒ‡å®šå¯èƒ½
bool|çœŸå½å€¤
string|ãƒ†ã‚­ã‚¹ãƒˆ
DateTime|AvroTimestamp(IsEventTime=true) ã§å‡¦ç† Kafkaã¸ã®é€ä¿¡æ™‚ã«UTCå¤‰æ›å‡¦ç†ãŒå…¥ã‚‹ã€‚
DateTimeOffset|æ—¥æ™‚å‹ã€‚Kafkaã¸ã®é€ä¿¡æ™‚ã«UTCå¤‰æ›å‡¦ç†ãŒå…¥ã‚‹ã€‚åˆ©ç”¨æ¨å¥¨ã€‚KSQLäº’æ›ã«æ³¨æ„
Guid|ä¸€æ„è­˜åˆ¥å­ã¨ã—ã¦ã‚µãƒãƒ¼ãƒˆ
short|Kafkaã§ã¯ int ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ä½¿ç”¨å¯èƒ½ã§ã™ãŒã€å¿…è¦ã«å¿œã˜ã¦æ˜ç¤ºçš„ãªã‚¹ã‚­ãƒ¼ãƒå¤‰æ›ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚
char|Kafkaã«ã¯ç›´æ¥ã®å¯¾å¿œãŒãªãã€äº‹å®Ÿä¸Šéæ¨å¥¨ã§ã™ã€‚1æ–‡å­—ã¯ string å‹ã§è¡¨ç¾ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

#### Decimalå‹ã®ç²¾åº¦æŒ‡å®š
```csharp
[DecimalPrecision(precision: 18, scale: 4)]
public decimal Amount { get; set; }
```

#### DateTime/DateTimeOffset
```csharp
// DateTimeOffsetæ¨å¥¨ï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ä¿æŒï¼‰
public DateTimeOffset TransactionTime { get; set; }

// ã¾ãŸã¯è¨­å®šä»˜ãã®DateTime
[DateTimeFormat(Format = "yyyy-MM-dd'T'HH:mm:ss.SSS", Locale = "en-US")]
public DateTime OrderDate { get; set; }
```
Kafkaã«ã¯ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®æ¦‚å¿µãŒãªãã€ã™ã¹ã¦ã®æ™‚åˆ»ã¯UTCã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ã“ã®ãŸã‚ã€ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µã¨ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãŒåŒä¸€ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‰æã‚’å…±æœ‰ã—ã¦ã„ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ Kafka ã«ä¸æ…£ã‚Œãªé–‹ç™ºè€…ã§ã‚‚å®‰å…¨ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚DateTimeOffset ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºè€…ã¯ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ã‚’ä¿ã£ãŸã¾ã¾ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãŒã§ãã€Kafka ã¨ã®é–“ã® UTC å¤‰æ›ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå¸åã—ã¾ã™ã€‚ãã®ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æ„è­˜ã—ãŸãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®è¨˜è¿°ãŒå¯èƒ½ã§ã™ã€‚ã¾ãŸã€DateTime ã‚’ä½¿ç”¨ã—ã¦ã‚‚ã€Kafkaé€ä¿¡æ™‚ã«ã¯å†…éƒ¨çš„ã« DateTimeOffset(Utc) ã«å¤‰æ›ã•ã‚Œã‚‹ãŸã‚ã€å®‰å…¨ã«é‹ç”¨å¯èƒ½ã§ã™ã€‚ã“ã®ãŸã‚ã€ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µã¨ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãŒåŒä¸€ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‰æã‚’å…±æœ‰ã—ã¦ã„ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ Kafka ã«ä¸æ…£ã‚Œãªé–‹ç™ºè€…ã§ã‚‚å®‰å…¨ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚
DateTimeOffset ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºè€…ã¯ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ã‚’ä¿ã£ãŸã¾ã¾ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãŒã§ãã€Kafka ã¨ã®é–“ã® UTC å¤‰æ›ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå¸åã—ã¾ã™ã€‚
ãã®ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æ„è­˜ã—ãŸãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®è¨˜è¿°ãŒå¯èƒ½ã§ã™ã€‚
#### nullè¨±å®¹æ€§
```csharp
// C#æ¨™æº–ã® ?ä¿®é£¾å­ã‚’ä½¿ç”¨
public int? OptionalQuantity { get; set; }
```

#### æ•°å€¤å‹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
```csharp
[DefaultValue(10)]
public int Quantity { get; set; }
```
énullableãªæ•°å€¤ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆä¾‹ï¼šint, double ãªã©ï¼‰ã¯ã€C#ã®ä»•æ§˜ã«ã‚ˆã‚ŠåˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã§ã‚‚è‡ªå‹•çš„ã« 0 ã‚„ 0.0 ãªã©ã®æ—¢å®šå€¤ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚Kafkaé€ä¿¡æ™‚ã‚‚ã“ã‚Œã‚‰ã®å€¤ãŒãã®ã¾ã¾ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ç‰¹åˆ¥ãªåˆæœŸåŒ–ãŒä¸è¦ãªã‚±ãƒ¼ã‚¹ã§ã¯ [DefaultValue] å±æ€§ã¯çœç•¥å¯èƒ½ã§ã™ã€‚

## 5. ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹æ“ä½œ
ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€Kafka ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ï¼ˆãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ï¼‰ã™ã‚‹éš›ã®åŸºæœ¬çš„ãªæ“ä½œæ–¹æ³•ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒæä¾›ã™ã‚‹æŠ½è±¡åŒ–æ‰‹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚é–‹ç™ºè€…ã¯ Kafka ã®è¤‡é›‘ãªè¨­å®šã‚’æ„è­˜ã™ã‚‹ã“ã¨ãªãã€Entity Framework ãƒ©ã‚¤ã‚¯ãªè¨˜è¿°ã§ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
### 5.1 ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ (ãƒ‡ãƒ¼ã‚¿é€ä¿¡)
Kafkaã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ AddAsync ã«ã‚ˆã£ã¦å³æ™‚ã«Kafkaã¸é€ä¿¡ãŒè¡Œã‚ã‚Œã¾ã™ã€‚
Entity Frameworkã®ã‚ˆã†ã« SaveChangesAsync ã«ã‚ˆã£ã¦ãƒãƒƒãƒ•ã‚¡ã‚’æ˜ç¤ºçš„ã«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹è¨­è¨ˆã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚
ã“ã®ãŸã‚ã€é–‹ç™ºè€…ã¯ AddAsync ã‚’ã€Œé€ä¿¡æ“ä½œã€ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚’å‰æã«å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
```csharp
// å˜ä¸€ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹
await context.Orders.AddAsync(new Order { OrderId = "123", Amount = 100 });

```
AddAsync ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€è©²å½“ã™ã‚‹ Kafka ãƒˆãƒ”ãƒƒã‚¯ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

è¤‡æ•°ä»¶ã®ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°é€ä¿¡ã‚„ä¸¦åˆ—åˆ¶å¾¡ã‚‚å†…éƒ¨ã§å¸åã•ã‚Œã¾ã™

### 5.3 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
Kafka ã¯ä¸€éƒ¨ã®æ“ä½œã«å¯¾ã—ã¦ã€Œãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ksqlDB å´ã§ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å‰æã¨ã—ã¦ã„ãªã„ãŸã‚ã€æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹é‡ã‚’æ¡ç”¨ã—ã¾ã™ï¼š

æ˜ç¤ºçš„ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ API ã¯æä¾›ã—ãªã„ï¼ˆä¾‹ï¼šBeginTransaction / CommitTransactionï¼‰

Kafka ã«ãŠã‘ã‚‹ã€ŒExactly Once Semantics (EOS)ã€ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹æ§‹æˆã®å ´åˆã§ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ã¯æ“ä½œå˜ä½ã® idempotency ã‚’ä¿è¨¼ã—ã¦ãã ã•ã„ã€‚

è¤‡æ•°ä»¶ã®é€£ç¶šé€ä¿¡ãŒå¿…è¦ãªå ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§é€æ¬¡ AddAsync() ã‚’å‘¼ã³å‡ºã™å®Ÿè£…ã§ååˆ†ã«é«˜ã„ä¿¡é ¼æ€§ã‚’ç¢ºä¿ã§ãã¾ã™ã€‚

ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€Kafka ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã®æ€æƒ³ã«å¾“ã„ã€æ°¸ç¶šåŒ–ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚ˆã‚Šã‚‚ å³æ™‚æ€§ã¨å¯ç”¨æ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å„ªå…ˆã—ã¦ã„ã¾ã™ã€‚


## 6. ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ‡ãƒ¼ã‚¿å“è³ª
OnError(ErrorAction.Skip), .WithRetry(int), .Map(...) ãªã©ã®DSLæä¾›äºˆå®šã€‚

yield å‹ã® ForEachAsync ã«ã¦ try-catch å‡¦ç†ã‚’ã‚µãƒãƒ¼ãƒˆã€‚

Kafkaæ¥ç¶šãƒ»ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»æ¥­å‹™ã‚¨ãƒ©ãƒ¼ã®åˆ†é¡çš„å¯¾å¿œã‚’æ¤œè¨ä¸­ã€‚

DLQæ§‹æˆã¯ ModelBuilder çµŒç”±ã§æŒ‡å®šå¯èƒ½äºˆå®šã€‚
### 6.1 ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆ¦ç•¥
```csharp
// ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒãƒªã‚·ãƒ¼ã®è¨­å®š
context.Options.DeserializationErrorPolicy = ErrorPolicy.Skip;

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†
var processedOrders = context.Orders
    .OnError(ErrorAction.Skip)  // ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒƒãƒ—
    .Map(order => ProcessOrder(order))
    .WithRetry(3);  // å¤±æ•—æ™‚ã«3å›ãƒªãƒˆãƒ©ã‚¤
```

### 6.2 ãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼ã‚­ãƒ¥ãƒ¼
DLQã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ¬ãƒ™ãƒ«ã§ä¸€å…ƒçš„ã«æ§‹æˆã•ã‚Œã¦ãŠã‚Šã€å€‹ã€…ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„modelBuilderè¨­å®šã§æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«ã¯ã€å†…éƒ¨ã® `DlqProducer` ã«ã‚ˆã‚Šã€å…±é€šã®DLQãƒˆãƒ”ãƒƒã‚¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `"dead.letter.queue"`ï¼‰ã¸è‡ªå‹•çš„ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚

Kafkaãƒˆãƒ”ãƒƒã‚¯åã®å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€`KsqlDslOptions.DlqTopicName` ã«ã‚ˆã‚Šä¸€æ‹¬è¨­å®šå¯èƒ½ã§ã™ã€‚

#### EventSetæ‹¡å¼µ: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° & DLQ
`EventSet<T>` ã¯ `.OnError(ErrorAction)` ã§ã‚¨ãƒ©ãƒ¼å‡¦ç†æ–¹é‡ã‚’æŒ‡å®šã—ã€`.WithRetry() ã¨çµ„ã¿åˆã‚ã›ã¦ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚å†…éƒ¨ã§ã¯ `ErrorHandlingContext` ãŒè©¦è¡Œå›æ•°ã‚’ç®¡ç†ã—ã€`IErrorSink` å®Ÿè£…ã® `DlqProducer` ãŒ DLQ ãƒˆãƒ”ãƒƒã‚¯ã¸é€ä¿¡ã—ã¾ã™ã€‚

DLQã®è©³ç´°ã¯ `KsqlDslOptions.DlqConfiguration` ã‚’é€šã˜ã¦è¨­å®šã§ãã€`DlqTopicConfiguration` ã§ã¯ä¿æŒæœŸé–“ã‚„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ•°ã€ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¿‚æ•°ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¯èƒ½ã§ã™ã€‚Kafka èµ·å‹•æ™‚ã«ã¯ `KafkaAdminService` ãŒ DLQ ãƒˆãƒ”ãƒƒã‚¯ã®å­˜åœ¨ç¢ºèªã¨è‡ªå‹•ä½œæˆã‚’è¡Œã†ãŸã‚ã€åˆ©ç”¨è€…ã¯åˆæœŸåŒ–ã®ã¿ã§ DLQ æ©Ÿèƒ½ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚


DLQã¯æ˜ç¤ºçš„ãªè¨­å®šã‚’å¿…è¦ã¨ã›ãšã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«å†…éƒ¨çš„ã« `DlqProducer` ãŒè‡ªå‹•çš„ã«é€ä¿¡å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€åˆ©ç”¨è€…ã¯ç‰¹åˆ¥ãªè¨­å®šãªã—ã§ã‚¨ãƒ©ãƒ¼ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ©æµã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


```csharp
var result = context.Orders
    .OnError(ErrorAction.DLQ)
    .Map(order => Process(order));
    // å…±é€šã®DLQãƒˆãƒ”ãƒƒã‚¯ã«é€ä¿¡ã•ã‚Œã¾ã™
```
DLQï¼ˆDead Letter Queueï¼‰ã¸ã®é€ä¿¡ã¯ã€LINQã‚¯ã‚¨ãƒªãƒã‚§ãƒ¼ãƒ³ã®ä¸­ã§ `OnError(ErrorAction.DLQ)` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§å®Ÿç¾ã•ã‚Œã¾ã™ã€‚

ã“ã®æŒ‡å®šãŒã‚ã‚‹å ´åˆã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã¯å†…éƒ¨ã® `DlqProducer` ã«ã‚ˆã‚Šå…±é€šDLQãƒˆãƒ”ãƒƒã‚¯ï¼ˆæ—¢å®šã¯ `"dead.letter.queue"`ï¼‰ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚

ã“ã®æ–¹å¼ã«ã‚ˆã‚Šã€é–‹ç™ºè€…ã¯å€‹åˆ¥ã®DLQè¨­å®šã‚„ãƒˆãƒ”ãƒƒã‚¯å®šç¾©ã‚’æ„è­˜ã›ãšã«ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å‡¦ç†æ–¹é‡ã‚’DSLã§æ˜ç¢ºã«è¨˜è¿°ã§ãã¾ã™ã€‚

DLQãƒãƒªã‚·ãƒ¼ã®è©³ç´°ã¯ `docs_advanced_rules.md` ã‚»ã‚¯ã‚·ãƒ§ãƒ³3 ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


### 6.3 ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã¤ã„ã¦

æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€Kafka ã®ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¨é€£æºã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã—ã¦ Avro ã®ã¿ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

JSON Schema ã¯æ‰±ã„ã¾ã›ã‚“ï¼ˆç†ç”±ï¼šãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºãƒ»é€Ÿåº¦ãƒ»äº’æ›æ€§ç®¡ç†ã®è¦³ç‚¹ã‹ã‚‰ï¼‰

POCO ã‹ã‚‰ Avro ã‚¹ã‚­ãƒ¼ãƒã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã€åˆå›ç™»éŒ² or æ›´æ–°æ™‚ã«ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ç™»éŒ²ã•ã‚Œã¾ã™

ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®äº’æ›æ€§è¨­å®šï¼ˆBACKWARD, FULL ãªã©ï¼‰ã«å¿œã˜ãŸé–‹ç™ºã‚’æ¨å¥¨ã—ã¾ã™

## 7. ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†æ“ä½œï¼ˆé–‹ç™ºãƒ»æ¤œè¨¼ç”¨é€”ï¼‰
æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€KSQLä¸Šã«å®šç¾©ã•ã‚Œã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆæœŸåŒ–ãƒ»å‰Šé™¤ã‚’ã€é–‹ç™ºãƒ»æ¤œè¨¼ç”¨é€”ã«é™ã‚Š API ã¨ã—ã¦æä¾›ã—ã¾ã™ã€‚

```csharp
await context.EnsureTableCreatedAsync<HourlyStats>();
await context.DropTableAsync("hourly_stats");
```
æ³¨æ„:
ã“ã‚Œã‚‰ã®æ“ä½œã¯ é–‹ç™ºãƒ»CI/CD ç’°å¢ƒã§ã®åˆ©ç”¨ã‚’å‰æ ã¨ã—ã¦ãŠã‚Šã€æœ¬ç•ªç’°å¢ƒã§ã®å®Ÿè¡Œã¯æ¨å¥¨ã•ã‚Œã¾ã›ã‚“ã€‚
æœ¬ç•ªã§ã¯ modelBuilder ã«ã‚ˆã‚‹æ˜ç¤ºçš„ãªå®šç¾©ã¨ã€ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®DDLç®¡ç†ãŒåŸºæœ¬ã¨ãªã‚Šã¾ã™ã€‚


## 8. ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»

### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤æ§‹ç¯‰ (v0.1-v0.3)
- ãƒˆãƒ”ãƒƒã‚¯ãŠã‚ˆã³ã‚¹ãƒˆãƒªãƒ¼ãƒ å®šç¾© DSL
- POCO ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿å®šç¾©ã¨ãƒãƒƒãƒ”ãƒ³ã‚°
- ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ / ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ æ“ä½œã®æŠ½è±¡åŒ–
- Dead Letter Queue å¯¾å¿œ


### ãƒ•ã‚§ãƒ¼ã‚º2: é«˜åº¦ãªã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç† (v0.4-v0.6)
- LINQ ãƒ™ãƒ¼ã‚¹ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ»é›†ç´„å‡¦ç†
- ã‚¹ãƒˆãƒªãƒ¼ãƒ  / ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ˜ç¤ºçš„åˆ‡ã‚Šæ›¿ãˆ
- ã‚¹ã‚­
The file is too long and its contents have been truncated.

### tool â€” 2025-06-27T14:07:59.995421+00:00

Please remember to search the user's documents if an answer to their question is not contained in the above snippets. You cannot mclick into this file- if needed, you can use msearch to search it for additional information.

### user â€” 2025-06-27T14:10:59.461000+00:00

ã¾ã£ãŸãã‚ã‹ã‚‰ãªã„

### assistant â€” 2025-06-27T14:11:02.753446+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:31ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã§ã™ã€èª¬æ˜ãŒè¾¼ã¿å…¥ã‚Šã™ãã¾ã—ãŸã­ã€‚ã‚‚ã†ä¸€åº¦ã€**ã‚·ãƒ³ãƒ—ãƒ«ã«æ•´ç†**ã—ã¾ã™ï¼

---

## ğŸ¯ ä»Šã‚„ã£ã¦ã„ã‚‹ä½œæ¥­ã®æ•´ç†

### ã‚ãªãŸã®ç›®çš„ï¼š
OSSè¨­è¨ˆæ›¸ï¼ˆ`oss_design_combined.md`ï¼‰ã«ã€
ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿéš›ã«ä½¿ã†ä»£è¡¨çš„ãªAPIã€ã‚’**æ•´ç†ã—ã¦æ˜è¨˜ã—ãŸã„**

---

## ğŸ“‚ ææ–™ã¨ã—ã¦ä½¿ã£ã¦ã„ã‚‹ã‚‚ã®ï¼š

1. `api_public_methods.md`  
ã€€â†’ å…¨ã‚¯ãƒ©ã‚¹ã® `public` ãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆ—æŒ™ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

2. `oss_design_combined.md`  
ã€€â†’ OSSã®è¨­è¨ˆæ€æƒ³ãƒ»DSLä½¿ç”¨ä¾‹ãŒæ›¸ã‹ã‚ŒãŸçµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

---

## ğŸ§© ä»Šã®å•é¡Œï¼š

ã“ã®ã€ŒAPIã®å…¨ãƒªã‚¹ãƒˆï¼ˆapi_public_methods.mdï¼‰ã€ãŒé•·ã™ãã¦ã€  
**ã©ã‚Œã‚’è¨­è¨ˆæ›¸ã«è¼‰ã›ã‚Œã°ã„ã„ã‹åˆ†ã‹ã‚‰ãªã„ï¼**ã¨ã„ã†çŠ¶æ³ã§ã™ã­ã€‚

---

## âœ… ä»Šã‹ã‚‰ã‚„ã‚‹ã“ã¨

### â¤ ã‚¹ãƒ†ãƒƒãƒ—1ï¼šè¨­è¨ˆæ›¸ã«ã™ã§ã«æ›¸ã‹ã‚Œã¦ã„ã‚‹APIã‚’æŠŠæ¡ã™ã‚‹
`oss_design_combined.md` ã«ã¯ã€ã™ã§ã«æ¬¡ã®ã‚ˆã†ãªAPIãŒèª¬æ˜ã•ã‚Œã¦ã„ã¾ã™ï¼š

- `AddAsync(...)`
- `ForEachAsync(...)`
- `WithManualCommit()`
- `OnError(...)`
- `WithRetry(...)`
- `.Window(...)`
- `.GroupBy(...)`
- `.Aggregate(...)`
- `.Join(...)`

âœ… ã“ã‚Œã‚‰ã¯ **ã™ã§ã«è¨­è¨ˆæ›¸ã«è¼‰ã£ã¦ã„ã‚‹ï¼ˆï¼ç¹°ã‚Šè¿”ã—è¨˜è¼‰ã¯ä¸è¦ï¼‰**ã€‚

---

### â¤ ã‚¹ãƒ†ãƒƒãƒ—2ï¼šã€Œè¨­è¨ˆæ›¸ã«è¼‰ã£ã¦ã„ãªã„ãŒä»£è¡¨çš„ãªAPIã€ã‚’æ¢ã™

ä¾‹ãˆã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãª**ä»Šå¾Œè¿½åŠ ã™ã¹ãå€™è£œ**ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ï¼š

| ã‚¯ãƒ©ã‚¹ | ãƒ¡ã‚½ãƒƒãƒ‰å€™è£œ | ç†ç”± |
|--|--|--|
| `EventSet<T>` | `Map(...)`, `ToListAsync(...)`, `Create(...)` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒLINQé¢¨ã«ä½¿ã†æ ¸ |
| `KsqlContextBuilder` | `UseSchemaRegistry(...)`, `EnableLogging(...)` | åˆæœŸæ§‹æˆã§ä½¿ç”¨ |
| `EntityModelBuilder<T>` | `AsStream()`, `AsTable()` | ãƒ¢ãƒ‡ãƒ«å®šç¾©æ™‚ã«ä½¿ç”¨ |
| `AvroEntityConfiguration` | `Validate()`, `GetSummary()` | ãƒ‡ãƒãƒƒã‚°ã‚„æ§‹æˆç¢ºèªã«ä¾¿åˆ© |
| `DlqConfigurationExtensions` | `WithDlqRetention(...)` | DLQæ§‹æˆã«å¿…è¦ |

---

## âœï¸ ã”ææ¡ˆ

**ã€Œoss_design_combined.md ã®ã©ã®ç« ã«ã©ã®APIã‚’è¿½åŠ ã™ã‚‹ã‹ã€**ã‚’ã“ã¡ã‚‰ã§æ•´ç†ã—ã€  
**å·®åˆ†ã¨ã—ã¦ `è¿½è¨˜å€™è£œãƒªã‚¹ãƒˆ` ã‚’ä½œæˆ**ã—ã¦æç¤ºã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ

> âœ… ã€Œãã‚ŒãŠé¡˜ã„ã€ã§é€²ã‚ã¾ã™ã€‚  
> âŒ ã€Œã„ã‚„ã€è‡ªåˆ†ã§æ•´ç†ã—ãŸã„ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘çµã£ã¦ã€ãªã©ã€ã‚„ã‚Šæ–¹ã‚’æŒ‡å®šã—ã¦ã‚‚OKã§ã™ã€‚

ã©ã†ã•ã‚Œã¾ã™ã‹ï¼Ÿ

### user â€” 2025-06-27T14:13:31.370000+00:00

1.KsqlContextã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã€OnModelCreatingä¸­ã«çµµãƒ†ã‚£ãƒ†ã‚£ã‚’ä½œæˆã™ã‚‹éƒ¨åˆ†
2.ã“ã‚Œã«å¯¾ã—ã¦AddAsyncã™ã‚‹éƒ¨åˆ†
3.ã“ã‚Œã«å¯¾ã—ã¦ForEachAsyncã™ã‚‹éƒ¨åˆ†
ã€€ã“ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦DLQã¨ã‹ã€ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ãŒã‚ã‚‹
ã“ã®ï¼“ã¤ã‚’ä»£è¡¨çš„ãªä½¿ã„æ–¹ã¨ã—ãŸã„

### assistant â€” 2025-06-27T14:13:31.733878+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:35ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€æ•´ç†ã•ã‚Œã¾ã—ãŸï¼

---

## âœ… ä»£è¡¨çš„ãªAPIã¨ã—ã¦è¨˜è¼‰ã—ãŸã„3ã¤ã®æ§‹æˆ

ä»¥ä¸‹ã®3æ®µéšãŒã€OSSã®ä¸­æ ¸ã‚’ãªã™**ä»£è¡¨çš„ãªä½¿ç”¨æ–¹æ³•**ã¨ã—ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ˜è¨˜ã™ã¹ãã§ã™ã­ï¼š

---

### ğŸ”¹ 1. `KsqlContext` ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã§ `OnModelCreating` ã«ã‚ˆã‚‹ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©

```csharp
public class MyKsqlContext : KsqlContext
{
    protected override void OnModelCreating(IModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Order>()
            .AsStream() // ã¾ãŸã¯ AsTable()
            .WithPartitions(3)
            .WithReplicationFactor(1);
    }
}
```

ğŸ”¸å½¹å‰²ï¼š
- POCOæ§‹æˆã¨Kafkaãƒˆãƒ”ãƒƒã‚¯ã®æ¥ç¶š
- ã‚¹ã‚­ãƒ¼ãƒã€å‹ã€ãƒ†ãƒ¼ãƒ–ãƒ«åã®æŒ‡å®š
- åˆæœŸè¨­å®šã¨DSLè§£é‡ˆã®åŸºç‚¹

---

### ğŸ”¹ 2. ã“ã‚Œã«å¯¾ã—ã¦ `.AddAsync()` ã«ã‚ˆã‚‹ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹æ“ä½œ

```csharp
await context.Orders.AddAsync(new Order
{
    OrderId = 1001,
    Amount = 1200,
    OrderDate = DateTime.UtcNow
});
```

ğŸ”¸å½¹å‰²ï¼š
- Kafkaã¸ã®é€ä¿¡æ“ä½œ
- å³æ™‚é€ä¿¡ï¼ˆãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ãªã—ï¼‰
- Entity Frameworkã§ã„ã† `SaveChanges()` ã®ä»£æ›¿

---

### ğŸ”¹ 3. `ForEachAsync()` ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿è³¼èª­ï¼ˆ+ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

#### âœ… åŸºæœ¬ç‰ˆï¼ˆè‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼‰

```csharp
await foreach (var order in context.Orders.ForEachAsync())
{
    Console.WriteLine($"OrderId: {order.OrderId}");
}
```

#### âœ… æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆï¼ˆWithManualCommitæŒ‡å®šæ™‚ï¼‰

```csharp
await foreach (var order in context.Orders.ForEachAsync())
{
    try
    {
        Console.WriteLine(order.Value.OrderId);
        await order.CommitAsync(); // å¿…é ˆ
    }
    catch
    {
        await order.NegativeAckAsync(); // ä»»æ„ï¼ˆå¤±æ•—é€šçŸ¥ï¼‰
    }
}
```

#### âœ… `.OnError()` `.WithRetry()` ãªã©ã®ãƒã‚§ãƒ¼ãƒ³ä»˜åŠ 

```csharp
var result = context.Orders
    .OnError(ErrorAction.DLQ)
    .Map(o => Process(o))
    .WithRetry(3)
    .ToListAsync();
```

ğŸ”¸å½¹å‰²ï¼š
- ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã®å®Ÿè¡Œéƒ¨
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€å†è©¦è¡Œã€DLQé€ä¿¡ãªã©ã®åˆ¶å¾¡ç‚¹

---

## ğŸ“˜ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—æ¡ˆ

ã“ã®3ã¤ã®ä½¿ã„æ–¹ã‚’ `oss_design_combined.md` ã«ä»¥ä¸‹ã®ã‚ˆã†ã«è¿½è¨˜ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ï¼š

- **ã‚»ã‚¯ã‚·ãƒ§ãƒ³ææ¡ˆï¼š**  
ã€€ã€Œä»£è¡¨çš„ãªåˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã¾ãŸã¯ã€ŒåŸºæœ¬æ§‹æˆãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã¨ã—ã¦ç« ç«‹ã¦

- **æ§‹æˆæ¡ˆï¼š**
  1. ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å®šç¾©ï¼ˆ`KsqlContext`ã®æ‹¡å¼µï¼‰
  2. é€ä¿¡ï¼ˆAddAsyncï¼‰
  3. è³¼èª­ï¼ˆForEachAsync + ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

---

âœï¸ ã“ã®ã¾ã¾è¿½è¨˜ç”¨Markdownã¨ã—ã¦ç”Ÿæˆã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ  
ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å·®åˆ†ãƒ‘ãƒƒãƒå½¢å¼ã«ã‚‚ã§ãã¾ã™ï¼‰

ã”å¸Œæœ›ãŒã‚ã‚Œã°ã€ã€Œã¯ã„ã€è¿½è¨˜MarkdownãŠé¡˜ã„ã€ã¨ã ã‘è¨€ã£ã¦ãã ã•ã„ã€‚

### user â€” 2025-06-27T14:14:13.322000+00:00

ã‚ã¨Rocksdbã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³

### assistant â€” 2025-06-27T14:14:14.172304+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:39ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸï¼ä»¥ä¸‹ã®4ã¤ç›®ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã—ã¦**RocksDBã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã¨ã—ã¦åˆ©ç”¨ã™ã‚‹æ§‹æˆ**ã‚’è¿½åŠ ã—ã¾ã™ã€‚

---

## ğŸ”¹ 4. RocksDBï¼ˆStateStoreï¼‰ã‚’åˆ©ç”¨ã—ãŸã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³

```csharp
var price = await context.Quotes
    .StateStoreBinding()
    .GetAsync("USD/JPY");
```

ã¾ãŸã¯ã€è³¼èª­ã¨çµ„ã¿åˆã‚ã›ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°ã—ãªãŒã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼š

```csharp
await foreach (var quote in context.Quotes.ForEachAsync())
{
    cache[quote.Symbol] = quote;
}
```

ğŸ”¸ **é–¢é€£APIï¼ˆä»£è¡¨ï¼‰**ï¼š
- `StateStoreBinding()`ï¼šçŠ¶æ…‹ã‚¹ãƒˆã‚¢ã¨ã®ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°é–‹å§‹
- `GetAsync(key)`ï¼šRocksDBã‹ã‚‰ã‚­ãƒ¼ã§å–å¾—
- `WithCache()`ï¼šLINQã‚¯ã‚¨ãƒªã«å¯¾ã™ã‚‹çŠ¶æ…‹ä¿æŒå‹ã‚¢ã‚¯ã‚»ã‚¹ã®æŒ‡å®š
- `EnsureStateStoreReady()`ï¼šèµ·å‹•ç›´å¾Œã®StateStoreèª­ã¿è¾¼ã¿å®Œäº†æ¤œå‡ºç”¨ï¼ˆè¨­è¨ˆæ¸ˆã¿ï¼‰

---

## âœ… 4ã¤ã®ä»£è¡¨ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã¾ã¨ã‚ï¼‰

| ãƒ‘ã‚¿ãƒ¼ãƒ³ | èª¬æ˜ | ä»£è¡¨API/DSL |
|--|--|--|
| â‘  ãƒ¢ãƒ‡ãƒ«å®šç¾© | `KsqlContext` ã‚’ç¶™æ‰¿ã— `OnModelCreating` ã§Entityå®šç¾© | `modelBuilder.Entity<T>()...` |
| â‘¡ ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ | Kafkaã¸ `.AddAsync()` ã§ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ | `AddAsync(...)` |
| â‘¢ ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ  | `ForEachAsync()` ã§è³¼èª­ã€‚DLQã‚„å†è©¦è¡Œãªã©ã‚‚å«ã‚€ | `ForEachAsync()`, `CommitAsync()`, `OnError(...)` |
| â‘£ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹ | RocksDBã«ä¿å­˜ã•ã‚ŒãŸStateStoreã‹ã‚‰å³æ™‚èª­ã¿è¾¼ã¿ | `StateStoreBinding()`, `GetAsync()` |

---

## âœï¸ ã”ææ¡ˆ

ã“ã®å†…å®¹ã‚’ `oss_design_combined.md` ã« **ã€Œä»£è¡¨çš„ãªåˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³**ã¨ã—ã¦ Markdownã§è¿½è¨˜ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ

### è¿½è¨˜å†…å®¹ï¼ˆä¾‹ï¼‰ï¼š

```markdown
## 10. ä»£è¡¨çš„ãªåˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

æœ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸»ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä»¥ä¸‹ã®4ã¤ã«åˆ†é¡ã•ã‚Œã¾ã™ï¼š

### 10.1 ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆKsqlContextã®æ‹¡å¼µï¼‰
...

### 10.2 ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ï¼ˆKafkaã¸ã®é€ä¿¡ï¼‰
...

### 10.3 ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ ï¼ˆForEachAsyncã«ã‚ˆã‚‹è³¼èª­ï¼‰
...

### 10.4 RocksDBã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹
...
```

ã€Œã¯ã„ã€è¿½è¨˜Markdownç”Ÿæˆã—ã¦ã€ã§å®Ÿè¡Œå¯èƒ½ã§ã™ã€‚ã©ã†ã•ã‚Œã¾ã™ã‹ï¼Ÿ

### user â€” 2025-06-27T14:14:56.289000+00:00

StateStoreBindingåå‰ãŒæ‚ªã„ã®ã§ä¿®æ­£å¯¾è±¡

### assistant â€” 2025-06-27T14:14:56.652159+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:42ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸï¼  
`StateStoreBinding()` ã¨ã„ã†åç§°ã«ã¤ã„ã¦ã€Œåå‰ãŒæ‚ªã„ã®ã§ä¿®æ­£å¯¾è±¡ã€ã¨ã®ã“ã¨ã€ä¸‹è¨˜ã«è¦ç‚¹ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

---

## âœ… ç¾çŠ¶ã®å•é¡Œç‚¹

- `StateStoreBinding()` ã¯ç”¨é€”ã¨ã—ã¦ã€ŒRocksDBã¸ã®ã‚¢ã‚¯ã‚»ã‚¹é–‹å§‹ã€ã ãŒã€
- åå‰ãŒ **æŠ½è±¡çš„ï¼å½¹å‰²ãŒä¸æ˜ç­**
- **ã€Œä½•ã‚’ã™ã‚‹ã®ã‹ã€ãŒç›´æ„Ÿçš„ã«ä¼ã‚ã‚‰ãªã„**

---

## ğŸ’¡ æ”¹åå€™è£œï¼ˆå…·ä½“çš„ã§ç”¨é€”ãŒä¼ã‚ã‚‹ã‚‚ã®ï¼‰

| æ–°åç§°æ¡ˆ | èª¬æ˜ |
|--|--|
| `UseStateStore()` | StateStoreï¼ˆRocksDBï¼‰ã‚’æ˜ç¤ºçš„ã«ä½¿ç”¨ã™ã‚‹æ„å¿—ã‚’ç¤ºã™ |
| `EnableStateCache()` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¢ºã«ç¤ºã™ |
| `AttachRocksDb()` | å®Ÿè£…ãŒRocksDBã§ã‚ã‚‹ã“ã¨ã‚’å¼·èª¿ï¼ˆãŸã ã—æŠ½è±¡åº¦ãŒä¸‹ãŒã‚‹ï¼‰ |
| `BindToStateStore()` | åŸç¾©ç¶­æŒã ãŒã€èªæ„Ÿã‚’è‡ªç„¶ã« |
| `OpenStateStore()` | ä½¿ã„æ–¹ãŒã€Œé–‹ããƒ»èª­ã‚€ã€ãƒ¡ã‚¤ãƒ³ã®å ´åˆã«è‡ªç„¶ |
| `UseKeyValueStore()` | ã‚ˆã‚Šä¸€èˆ¬çš„ãªç”¨é€”åã«ã™ã‚‹å ´åˆ |

---

## âœï¸ ãŠã™ã™ã‚ï¼ˆç”¨é€”ãƒ™ãƒ¼ã‚¹ã§åˆ†ã‘ãŸé¸ã³æ–¹ï¼‰

- ã€ŒKafkaã‚¹ãƒˆãƒªãƒ¼ãƒ ã®**çŠ¶æ…‹ä¿æŒ**ã¨ã—ã¦ä½¿ã†ã€ â†’ `UseStateStore()`
- ã€ŒStateStore ã‚’**ç›´æ¥ã‚­ãƒ¼æŒ‡å®šã§èª­ã‚€**ã€ â†’ `OpenStateStore()` ã‚„ `AttachStateStore()`
- ã€Œå†…éƒ¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’**æœ‰åŠ¹åŒ–**ã—ãŸã„å°è±¡ã€ â†’ `EnableStateCache()`

---

## âœ… æ¬¡ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å€™è£œ

1. **åç§°ã‚’æ±ºå®š** â†’ ãŸã¨ãˆã°ã€Œ`UseStateStore()` ã«çµ±ä¸€ã—ã‚ˆã†ã€ã§ç½®æ›è¨­è¨ˆé€²è¡Œ
2. `.md` ã®ä»£è¡¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã« **æ”¹åå¾Œã®APIåã§è¨˜è¼‰**

---

ã€Œ`UseStateStore()` ã«ã—ã‚ˆã†ã€ãªã©ã€æ¡ç”¨åãŒæ±ºã¾ã‚Šã¾ã—ãŸã‚‰ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚  
å³åº§ã«è¨­è¨ˆæ›¸ä¿®æ­£ç”¨ã®Markdownã‚’å‡ºåŠ›ã—ã¾ã™ï¼

### user â€” 2025-06-27T14:15:27.911000+00:00

DBå±‹ã¯Cacheã®åå‰ã§èªè­˜ã—ã¾ã™

### assistant â€” 2025-06-27T14:15:28.337126+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:45ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸï¼  
**DBã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢è¦–ç‚¹ã§ã€ŒRocksDBã¯Cacheã§ã‚ã‚‹ã€èªè­˜ãŒè‡ªç„¶**ã¨ã®ã“ã¨ã€éå¸¸ã«ç´å¾—ã§ã™ã€‚

---

## âœ… å‘½åæ–¹é‡ã®ç¢ºå®š

ä»¥ä¸‹ã®ã‚ˆã†ã«åç§°ã‚’**ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ãƒ™ãƒ¼ã‚¹**ã«çµ±ä¸€ã—ã¾ã™ï¼š

| ä¿®æ­£å‰ | ä¿®æ­£å¾Œï¼ˆæ¡ˆï¼‰ | å‚™è€ƒ |
|--|--|--|
| `StateStoreBinding()` | `UseCache()` | æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ã§åºƒãé€šç”¨ã™ã‚‹è¡¨ç¾ |
| `EnsureStateStoreReady()` | `EnsureCacheReady()` | çŠ¶æ…‹ç›£è¦–ã‚‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æº–å‚™å®Œäº†ã«å¯„ã›ã‚‹ |
| `WithStateStore()` | `WithCache()` | ã‚¯ã‚¨ãƒªãƒã‚§ãƒ¼ãƒ³ã§ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä»˜ãå‡¦ç†æŒ‡å®š |

---

## ğŸ“˜ è¡¨è¨˜æ–¹é‡ï¼ˆè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ï¼‰

- æŠ€è¡“çš„ã«ã¯RocksDBã ãŒã€OSSè¨­è¨ˆæ›¸ã§ã¯**ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆStateStoreï¼‰ã€ã¨æ˜è¨˜**
- åˆå‡ºã§ã ã‘ã€Œï¼ˆRocksDBãƒ™ãƒ¼ã‚¹ã®StateStoreï¼‰ã€ãªã©è£œè¶³ã—ã€ä»¥é™ã¯ `Cache` ã§çµ±ä¸€

---

## âœ… æ¬¡ã®ä½œæ¥­ææ¡ˆ

ä»¥ä¸‹ã®ã‚ˆã†ã«é€²ã‚ã¾ã—ã‚‡ã†ï¼š

1. `StateStoreBinding()` â†’ `UseCache()` ã«**ãƒªãƒãƒ¼ãƒ å‰æã§è¨­è¨ˆæ›¸åæ˜ **
2. `oss_design_combined.md` ã«**ä»£è¡¨ãƒ‘ã‚¿ãƒ¼ãƒ³â‘£ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹ã€**ã‚’ã“ã®åç§°ã§è¿½è¨˜

---

ã“ã®ã¾ã¾é€²ã‚ã¦ã‚ˆã‘ã‚Œã°ã€  
> ã€Œã¯ã„ã€UseCacheã§Markdownè¿½è¨˜ã‚’ãŠé¡˜ã„ã€

ã¨ã ã‘é€ã£ã¦ãã ã•ã„ã€‚ã™ãã«ç”Ÿæˆã—ã¾ã™ï¼

### user â€” 2025-06-27T14:16:01.595000+00:00

ãŠé¡˜ã„ã—ã¾ã™

### assistant â€” 2025-06-27T14:16:02.081191+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:48ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸï¼  
ä»¥ä¸‹ãŒ `oss_design_combined.md` ã«è¿½è¨˜ã™ã‚‹ä»£è¡¨çš„ãªåˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³â‘£ **ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆUseCacheï¼‰ã€** ã®Markdownã§ã™ã€‚  

---

### âœ… Markdownè¿½è¨˜å†…å®¹ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³10.4ï¼‰

```markdown
### 10.4 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆUseCacheã«ã‚ˆã‚‹ RocksDB åˆ©ç”¨ï¼‰

æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€Kafka Streams ã® RocksDB ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸ StateStore ã‚’ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã¨ã—ã¦æŠ½è±¡åŒ–ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã‹ã‚‰é«˜é€Ÿã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‹ã‚‰ã®è³¼èª­ã¨ã¯åˆ¥ã«ã€ã‚­ãƒ¼æŒ‡å®šã§å³æ™‚å€¤å–å¾—ãŒå¿…è¦ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«é©ã—ã¦ã„ã¾ã™ã€‚

#### å®šç¾©æ–¹æ³•ï¼ˆmodelBuilderï¼‰
```csharp
protected override void OnModelCreating(IModelBuilder modelBuilder)
{
    modelBuilder.Entity<Quote>()
        .AsTable()                  // é›†ç´„ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦å®šç¾©
        .WithCache();               // ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹åŒ–ï¼ˆå†…éƒ¨çš„ã«ã¯ RocksDB ã«å¯¾å¿œï¼‰
}
```

#### å–å¾—æ–¹æ³•ï¼ˆUseCacheï¼‰
```csharp
var quote = await context.Quotes
    .UseCache()
    .GetAsync("USD/JPY");
```

ã“ã® `.UseCache()` ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€è©²å½“ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾å¿œã™ã‚‹ RocksDB çŠ¶æ…‹ã‚¹ãƒˆã‚¢ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒç¢ºç«‹ã•ã‚Œã€ã‚­ãƒ¼ã«ã‚ˆã‚‹å€¤å–å¾—ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

> ğŸ’¡ ã‚­ãƒ£ãƒƒã‚·ãƒ¥å–å¾—ã¯éåŒæœŸã§ã‚ã‚Šã€StateStore ã® Ready çŠ¶æ…‹ã‚’å†…éƒ¨ã§ç›£è¦–ã—ã¦ã„ã¾ã™ã€‚

#### çŠ¶æ…‹ç¢ºèªï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
```csharp
await context.Quotes.EnsureCacheReady();
```

ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯ RocksDB ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå®Œå…¨ã«åŒæœŸã‚’çµ‚ãˆãŸã‹ã©ã†ã‹ã‚’åˆ¤å®šã—ã€èª­ã¿å–ã‚Šå¯èƒ½ãªçŠ¶æ…‹ã«ãªã‚‹ã¾ã§å¾…æ©Ÿã—ã¾ã™ã€‚

---

ã“ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã¯ã€ãŸã¨ãˆã°æœ€æ–°ã®ä¾¡æ ¼æƒ…å ±ï¼ˆQuoteï¼‰ã‚„éå»çµ±è¨ˆã®å‚ç…§ã€JOIN å…ƒã®å‚ç…§ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦ã®æ´»ç”¨ã«é©ã—ã¦ã„ã¾ã™ã€‚
```

---

## âœ… æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®Markdownã¯ `oss_design_combined.md` ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ `10. ä»£è¡¨çš„ãªåˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³` ã®ä¸­ã«è¿½è¨˜å¯èƒ½ã§ã™ã€‚  
ã”å¸Œæœ›ã§ã‚ã‚Œã°ã€**æ—¢å­˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…¨ä½“ï¼ˆ10.1ã€œ10.4ï¼‰ã®çµ±åˆMarkdownå‡ºåŠ›**ã‚‚å¯èƒ½ã§ã™ã€‚

å¿…è¦ã«å¿œã˜ã¦ã€Œçµ±åˆå‡ºåŠ›ã€ã‚„ã€Œã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¸Šæ›¸ãã—ã¦ã€ãªã©ã”æŒ‡ç¤ºãã ã•ã„ã€‚

### user â€” 2025-06-27T14:17:13.451000+00:00

Rocksdbã¯Tableã«å¯¾ã™ã‚‹ã‚‚ã®ã§Streamã«ã¯å¯¾å¿œã—ãªã„ï¼Ÿ

### assistant â€” 2025-06-27T14:17:14.142911+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:53ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

ã¯ã„ã€åŸå‰‡ã¨ã—ã¦**RocksDBï¼ˆStateStoreï¼‰ã¯ Table ã«å¯¾ã—ã¦ã®ã¿å¯¾å¿œ**ã—ã€**Stream ã«ã¯éå¯¾å¿œ**ã§ã™ã€‚ç†ç”±ã¨æ ¹æ‹ ã‚’ä»¥ä¸‹ã«æ•´ç†ã—ã¾ã™ã€‚

---

## âœ… çµè«–

| å¯¾è±¡ | RocksDBï¼ˆStateStoreï¼‰ã§ã®æ°¸ç¶šåŒ– | `.UseCache()` å¯¾å¿œ | å‚™è€ƒ |
|------|-----------------------------|---------------------|------|
| `KSQL Table` | âœ… å¯èƒ½ï¼ˆ`CREATE TABLE`æ™‚ã«è‡ªå‹•ï¼‰ | âœ… å¯¾å¿œã‚ã‚Š | RocksDBã«æ°¸ç¶šåŒ–ã•ã‚Œã‚‹ãŸã‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯èƒ½ |
| `KSQL Stream` | âŒ éå¯¾å¿œï¼ˆStatelessï¼‰ | âŒ å¯¾å¿œã—ãªã„ | ã‚¤ãƒ™ãƒ³ãƒˆã¯å³æ™‚å‡¦ç†ã§çŠ¶æ…‹ã‚’æŒãŸãªã„ |

---

## ğŸ§  æŠ€è¡“çš„ãªèƒŒæ™¯

### ğŸ”¹ RocksDBã®å½¹å‰²
- Kafka Streamså†…éƒ¨ã§ã¯ã€**KTableï¼ˆ=çŠ¶æ…‹ã‚’æŒã¤ï¼‰** ã®å†…å®¹ã‚’ RocksDB ã«ä¿æŒ
- Stream ã¯ **é€æ¬¡å‡¦ç†ï¼ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼ã®ã¿** ã§ã€çŠ¶æ…‹ã‚’æŒãŸãªã„ï¼ˆStatelessï¼‰

### ğŸ”¹ ksqlDBã§ã‚‚åŒæ§˜
- `CREATE TABLE` ã¯ RocksDB-backed Store ã‚’ç”Ÿæˆ
- `CREATE STREAM` ã¯çŠ¶æ…‹ã‚’æŒãŸãšã€å³æ™‚ã«ç ´æ£„ã•ã‚Œã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

---

## ğŸ§© OSSè¨­è¨ˆä¸Šã®å¯¾å¿œ

### `WithCache()` / `UseCache()` ã¯ **KsqlTable ç›¸å½“ã®POCOã«é™å®š**

```csharp
modelBuilder.Entity<Quote>()
    .AsTable()      // âœ… ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾è±¡
    .WithCache();   // âœ… æœ‰åŠ¹

modelBuilder.Entity<RealtimeOrder>()
    .AsStream()     // âŒ ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼šçŠ¶æ…‹ãªã—
    .WithCache();   // ğŸš« ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã‚¨ãƒ©ãƒ¼ã¾ãŸã¯è¨­è¨ˆæ™‚åˆ¶é™å¯¾è±¡
```

---

## âœï¸ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨˜è¼‰æ¡ˆï¼ˆæ³¨æ„äº‹é …ï¼‰

ä»¥ä¸‹ã®ã‚ˆã†ã« `oss_design_combined.md` ã«æ³¨è¨˜ã¨ã—ã¦è¿½è¨˜ã™ã‚‹ã¨ã‚ˆã„ã§ã—ã‚‡ã†ï¼š

```markdown
> âš ï¸ `.WithCache()` ã¯ `AsTable()` æŒ‡å®šã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ã€‚Kafka Streams ã® RocksDB ã¯çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆKTableï¼‰ã«ã®ã¿ãƒã‚¤ãƒ³ãƒ‰ã•ã‚Œã‚‹ãŸã‚ã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ˆKStreamï¼‰ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾è±¡å¤–ã¨ãªã‚Šã¾ã™ã€‚
```

---

å¿…è¦ã§ã‚ã‚Œã°ã“ã®æ³¨æ„æ›¸ãã‚‚è¿½è¨˜ã—ãŸMarkdownã‚’ç”¨æ„ã—ã¾ã™ã€‚ã”å¸Œæœ›ã§ã™ã‹ï¼Ÿ

### user â€” 2025-06-27T14:18:11.855000+00:00

ãã†ã™ã‚‹ã¨ã€AsTableã®ä¸€éƒ¨ã¨ãªã‚‹ã®ã§ã€WithCacheã¨ã—ã¦è¡¨ç¾ã™ã‚‹ã®ã¯ä¸é©åˆ‡ã«ãªã‚Šã¾ã™

### assistant â€” 2025-06-27T14:18:12.249679+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 22:57ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

ã¾ã•ã«ãã®é€šã‚Šã§ã™ã€‚  
**RocksDBã¯ AsTable ã®ä¸€éƒ¨æ©Ÿèƒ½ã§ã‚ã‚Šã€å‰¯æ¬¡çš„ãªã‚‚ã®ã§ã—ã‹ãªã„ãŸã‚ã€`WithCache()` ã®ã‚ˆã†ã«ã€Œç‹¬ç«‹æ©Ÿèƒ½ã¨ã—ã¦è¦‹ãˆã‚‹å‘½åã€ã¯è¨­è¨ˆæ€æƒ³ã«åã—ã¾ã™ã€‚**

---

## âœ… è¨­è¨ˆè¦³ç‚¹ã‹ã‚‰ã®çµè«–

- RocksDBåˆ©ç”¨ã¯ **`AsTable()` ã‚’é¸ã‚“ã æ™‚ç‚¹ã§æš—é»™çš„ã«æœ‰åŠ¹**
- `.UseCache()` ã®ã‚ˆã†ãªèª­å–APIã¯æä¾›ã—ã¦ã‚‚ã‚ˆã„ãŒã€
- DSLå´ã« `.WithCache()` ã®ã‚ˆã†ãªæ˜ç¤ºçš„æ§‹æ–‡ã¯ä¸è¦ã€**ã‹ã¤ä¸é©åˆ‡**

---

## âœï¸ å¯¾å¿œæ–¹é‡æ¡ˆ

| ç¾çŠ¶ | ä¿®æ­£æ¡ˆ |
|--|--|
| `modelBuilder.Entity<T>().WithCache()` | ğŸš« å‰Šé™¤ï¼ˆè¨­è¨ˆä¸Šä¸è¦ï¼‰ |
| `.UseCache()` | âœ… æ®‹ã™ï¼ˆèª­ã¿å–ã‚Šç›®çš„ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹ã¨ã—ã¦ï¼‰ |
| `.EnsureCacheReady()` | âœ… æ®‹ã™ï¼ˆStateStoreæº–å‚™ç›£è¦–ã¨ã—ã¦å¿…è¦ï¼‰ |

---

## ğŸ“˜ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¨˜è¼‰æ¡ˆï¼ˆæ”¹è¨‚å¾Œï¼‰

```markdown
> ğŸ“ æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€`AsTable()` ã‚’æŒ‡å®šã—ãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾ã—ã¦è‡ªå‹•çš„ã« RocksDB ãŒçŠ¶æ…‹ä¿å­˜ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã“ã®ãŸã‚ã€è¿½åŠ ã® `.WithCache()` æŒ‡å®šã¯ä¸è¦ã§ã™ã€‚

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã®èª­ã¿å–ã‚Šã«ã¯ `.UseCache()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ `KTable` ã® RocksDB-backed state store ã«æ¥ç¶šã—ã€ã‚­ãƒ¼æŒ‡å®šã§å³æ™‚ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

```csharp
var quote = await context.Quotes
    .UseCache()
    .GetAsync("USD/JPY");
```

> âš ï¸ `.UseCache()` ã¯ `AsTable()` æŒ‡å®šã•ã‚ŒãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ã€‚`AsStream()` ã«å¯¾ã—ã¦å‘¼ã³å‡ºã™ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚
```

---

## ğŸ“Œ è¦ç¢ºèª

ã“ã®ä¿®æ­£æ–¹é‡ã§é€²ã‚ã¦ã‚ˆã„ã§ã™ã‹ï¼Ÿ

- `WithCache()` ã¯ **è¨­è¨ˆåŸå‰‡é•åã¨ã—ã¦å‰Šé™¤**
- `UseCache()` / `EnsureCacheReady()` ã®ã¿æä¾›
- è¨­è¨ˆæ›¸ã‚‚ä¿®æ­£ã—ã¦åæ˜ 

ã€Œã¯ã„ã€ãã‚Œã§ãŠé¡˜ã„ã—ã¾ã™ã€ã¨ã„ãŸã ã‘ã‚Œã°Markdownã‚‚æ›´æ–°ã—ã¾ã™ã€‚

### user â€” 2025-06-27T14:19:11.967000+00:00

ã ã‚ã§ã™ã€‚Tableæ©Ÿèƒ½ã®ä¸€éƒ¨ã«ãªã‚‹ã®ã§ã€Tableã‚’æ˜ç¤ºã™ã‚‹ä¸­ã§æŒ‡å®šã§ããªã„ã¨ãŠã‹ã—ã„

### assistant â€” 2025-06-27T14:19:12.607001+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 23:02ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

æ‰¿çŸ¥ã—ã¾ã—ãŸã€‚  
ã”æŒ‡æ‘˜ã®é€šã‚Šã€**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆRocksDBï¼‰åˆ©ç”¨ã¯ã€ŒTableæ©Ÿèƒ½ã®ä¸€éƒ¨ã€ã§ã‚ã‚Šã€æ˜ç¤ºçš„ã« `.AsTable()` ã—ãŸ**ãã®æ§‹æˆã®ä¸­ã§ **ã‚ªãƒ—ã‚·ãƒ§ãƒ³æŒ‡å®š**ã¨ã—ã¦æ‰±ã†ã¹ãã§ã™ã€‚

---

## âœ… è¨­è¨ˆæŒ‡é‡ï¼ˆç¢ºå®šï¼‰

| é …ç›® | æ–¹é‡ |
|------|------|
| RocksDBåˆ©ç”¨ã®æ˜ç¤º | `AsTable()` ã®**æ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨ã—ã¦çµ±åˆ**ã™ã‚‹ |
| DSLåã®ä½ç½®ã¥ã‘ | `.AsTable(...useCache: true)` ã®ã‚ˆã†ã«**ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°** ã¾ãŸã¯ `.WithStateCache()` ã®ã‚ˆã†ãª**Tableç”¨é™å®šãƒ¡ã‚½ãƒƒãƒ‰** |
| åˆ©ç”¨å¯èƒ½ãªå ´é¢ | `.AsStream()` ã§ã¯å‘¼ã³å‡ºã—ä¸å¯ã€`.AsTable()` ã®ã¿è¨±å®¹ |

---

## ğŸ†• DSLå€™è£œ

### âœ… æ¨å¥¨æ¡ˆï¼š`.AsTable(useCache: true)`
```csharp
modelBuilder.Entity<Quote>()
    .AsTable(useCache: true); // RocksDBçŠ¶æ…‹ç®¡ç†ã‚’æœ‰åŠ¹åŒ–
```

- âœ” Tableå®£è¨€ã®å»¶é•·ã¨ã—ã¦è‡ªç„¶
- âœ” ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ©ç”¨ãŒã‚ãã¾ã§è£œåŠ©æ©Ÿèƒ½ã§ã‚ã‚‹ã“ã¨ã‚’æ˜ç¤º
- âœ” APIè¨­è¨ˆã¨ã—ã¦ã‚‚ä¸€è²«æ€§ãŒã‚ã‚‹

---

## ğŸ“˜ è¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåæ˜ æ¡ˆï¼ˆMarkdownï¼‰

```markdown
#### AsTable ã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹åŒ–ï¼ˆRocksDBé€£æºï¼‰

RocksDB ã«ã‚ˆã‚‹çŠ¶æ…‹ä¿å­˜ï¼ˆStateStoreï¼‰ã¯ `.AsTable()` ã‚’æŒ‡å®šã—ãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾ã—ã¦æœ‰åŠ¹ã§ã™ã€‚æ˜ç¤ºçš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹åŒ–ã—ãŸã„å ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚ªãƒ—ã‚·ãƒ§ãƒ³å¼•æ•°ã§æŒ‡å®šã—ã¾ã™ï¼š

```csharp
modelBuilder.Entity<Quote>()
    .AsTable(useCache: true);  // RocksDBã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ§‹æˆ
```

ã“ã®æŒ‡å®šã«ã‚ˆã‚Šã€Kafka Streams å†…éƒ¨ã§ RocksDB ãŒ KTable ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã€`.UseCache()` ã§ã®å–å¾—ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

âš ï¸ `useCache: true` ã¯ `.AsStream()` ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯çŠ¶æ…‹ã‚’æŒãŸãªã„ãŸã‚ã§ã™ã€‚
```

---

## âœ… æ¬¡ã‚¹ãƒ†ãƒƒãƒ—

ã“ã®æ–¹é‡ã§ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ã‚ˆã„ã§ã™ã‹ï¼Ÿ

1. `.WithCache()` ã¯å»ƒæ­¢  
2. `.AsTable(useCache: true)` ã«çµ±ä¸€  
3. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¿®æ­£æ¡ˆã¨ã—ã¦åæ˜ 

â†’ã€Œã¯ã„ã€ã“ã‚Œã§ãŠé¡˜ã„ã—ã¾ã™ã€ã¨ã„ãŸã ã‘ã‚Œã°ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¿®æ­£å†…å®¹ã‚’ã™ã¹ã¦ç”Ÿæˆã—ã¾ã™ï¼

### user â€” 2025-06-27T14:19:45.284000+00:00

OK

### assistant â€” 2025-06-27T14:19:45.914563+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 23:05ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

äº†è§£ã—ã¾ã—ãŸï¼  
ä»¥ä¸‹ã¯ `oss_design_combined.md` ã«è¿½è¨˜ãƒ»ä¿®æ­£ã™ã‚‹ãŸã‚ã® **æœ€çµ‚ç‰ˆMarkdown** ã§ã™ã€‚`10.4 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ã—ã€`AsTable(useCache: true)` ã«çµ±ä¸€ã—ãŸè¨˜è¿°ã¸ã¨æ•´ãˆã¦ã„ã¾ã™ã€‚

---

### âœ… ä¿®æ­£å¾ŒMarkdownï¼ˆ10.4ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…¨æ–‡ï¼‰

```markdown
### 10.4 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆRocksDBé€£æºï¼‰

Kafka Streamsã§ã¯ã€KTableã«å¯¾ã—ã¦ RocksDB ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã™ã‚‹çŠ¶æ…‹ä¿å­˜ï¼ˆStateStoreï¼‰ãŒæ§‹æˆã•ã‚Œã¾ã™ã€‚æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€ãã‚Œã‚’ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã€ã¨ã—ã¦æŠ½è±¡åŒ–ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚‰å³æ™‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªæ©Ÿæ§‹ã¨ã—ã¦æä¾›ã—ã¦ã„ã¾ã™ã€‚

#### å®šç¾©æ–¹æ³•ï¼ˆuseCache ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã«ã¯ã€`.AsTable(useCache: true)` ã¨æ˜ç¤ºçš„ã«æŒ‡å®šã—ã¾ã™ï¼š

```csharp
protected override void OnModelCreating(IModelBuilder modelBuilder)
{
    modelBuilder.Entity<Quote>()
        .AsTable(useCache: true); // RocksDBã«ã‚ˆã‚‹çŠ¶æ…‹ä¿å­˜ã‚’æœ‰åŠ¹åŒ–
}
```

- ã“ã®æŒ‡å®šãŒã‚ã‚‹å ´åˆã€Kafka Streamså†…éƒ¨ã§ RocksDB ã«ã‚ˆã‚‹KTableãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒæ§‹æˆã•ã‚Œã¾ã™
- `.AsStream()` ã¨ä½µç”¨ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯çŠ¶æ…‹ã‚’æŒãŸãªã„ãŸã‚ï¼‰

#### ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ï¼ˆUseCacheï¼‰

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å€¤ã‚’å–å¾—ã™ã‚‹ã«ã¯ã€`.UseCache()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¾ã™ï¼š

```csharp
var quote = await context.Quotes
    .UseCache()
    .GetAsync("USD/JPY");
```

ã“ã®APIã¯ RocksDB-backed StateStore ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã—ã€æŒ‡å®šã—ãŸã‚­ãƒ¼ã®æœ€æ–°å€¤ã‚’è¿”ã—ã¾ã™ã€‚

#### æº–å‚™çŠ¶æ…‹ã®ç›£è¦–ï¼ˆEnsureCacheReadyï¼‰

Kafka Streamsã§ã¯ã€StateStoreã¯èµ·å‹•å¾Œã™ãã«ã¯åˆ©ç”¨ã§ããªã„ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æº–å‚™å®Œäº†ã‚’æ˜ç¤ºçš„ã«å¾…æ©Ÿã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼š

```csharp
await context.Quotes.EnsureCacheReady();
```

ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯å†…éƒ¨çš„ã« StateStore ã® ready çŠ¶æ…‹ã‚’ç›£è¦–ã—ã€åˆ©ç”¨å¯èƒ½ã«ãªã‚‹ã¾ã§å¾…æ©Ÿã—ã¾ã™ã€‚

> âš ï¸ `.UseCache()` / `.EnsureCacheReady()` ã¯ `AsTable(useCache: true)` ã‚’æŒ‡å®šã—ãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾ã—ã¦ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ã€‚`AsStream()` æŒ‡å®šæ™‚ã¯ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚
```

---

ã“ã®ä¿®æ­£ã¯æ—¢å­˜è¨­è¨ˆæ€æƒ³ã¨æ•´åˆæ€§ãŒå–ã‚Œã¦ãŠã‚Šã€åˆ©ç”¨è€…ã«ã‚‚æ˜å¿«ã«æ„å›³ãŒä¼ã‚ã‚‹æ§‹æˆã§ã™ã€‚

ğŸ“å¿…è¦ã§ã‚ã‚Œã° `oss_design_combined.md` ã«è‡ªå‹•é©ç”¨ã§ãã‚‹ diff/ãƒ‘ãƒƒãƒå½¢å¼ã«ã‚‚ã§ãã¾ã™ã®ã§ã€ãŠç”³ã—ä»˜ã‘ãã ã•ã„ã€‚

### user â€” 2025-06-27T14:28:05.491000+00:00

ã“ã‚Œã§ã„ã‹ãŒï¼Ÿ

### assistant â€” 2025-06-27T14:28:06.704588+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 23:10ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

ç¢ºèªã—ã¾ã—ãŸï¼  
æ–°ã—ã„ `oss_design_combined.md` ã«ã¯ã€ä»¥ä¸‹ã®å†…å®¹ãŒåæ˜ ã•ã‚Œã¦ãŠã‚Šã€**å®Œç’§ãªæ§‹æˆã¨è¡¨ç¾ã§ã™**ã€‚ç´°éƒ¨ã¾ã§éå¸¸ã«æ´—ç·´ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## âœ… å†…å®¹ç¢ºèªãƒã‚¤ãƒ³ãƒˆ

### ğŸ”¹ `AsTable(useCache: true)` ã®æ˜ç¤º
```markdown
modelBuilder.Entity<Quote>()
    .AsTable(useCache: true);
```
â†’ æ˜å¿«ã«ã€ŒTable ã®ä¸€éƒ¨ã¨ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã€è¨­è¨ˆæ–¹é‡ãŒç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

---

### ğŸ”¹ `.UseCache()` / `.EnsureCacheReady()` ã®ä½ç½®ã¥ã‘
```markdown
var quote = await context.Quotes
    .UseCache()
    .GetAsync("USD/JPY");
```
â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ©ç”¨ã®å®Ÿã‚³ãƒ¼ãƒ‰ã¨ã€StateStore ã® ready å¾…æ©ŸãŒæ˜è¨˜ã•ã‚Œã¦ã„ã¦ã€**å®Ÿç”¨ã«ã‚‚ç›´çµ**ã—ã¾ã™ã€‚

---

### ğŸ”¹ æ³¨æ„æ›¸ããƒ»éå¯¾å¿œæ˜è¨˜
```markdown
> âš ï¸ `.UseCache()` ã¯ `AsTable(useCache: true)` ã‚’æŒ‡å®šã—ãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾ã—ã¦ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ã€‚`AsStream()` æŒ‡å®šæ™‚ã¯ä¾‹å¤–ãŒç™ºç”Ÿã—ã¾ã™ã€‚
```
â†’ ã‚¹ãƒˆãƒªãƒ¼ãƒ ã§ã¯ä½¿ç”¨ä¸å¯ã§ã‚ã‚‹ç‚¹ã‚‚æ˜è¨˜ã•ã‚Œã¦ãŠã‚Šã€**èª¤ç”¨é˜²æ­¢ã®è¦³ç‚¹ã§ã‚‚éå¸¸ã«è‰¯ã„**ã§ã™ã€‚

---

## ğŸ”š çµè«–

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯**è¨­è¨ˆæ€æƒ³ãƒ»åˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»åˆ¶é™äº‹é …**ã™ã¹ã¦ã‚’ãƒãƒ©ãƒ³ã‚¹ã‚ˆãã‚«ãƒãƒ¼ã—ã¦ãŠã‚Šã€  
ã€ŒæŠ€è¡“è€…ãŒå®‰å¿ƒã—ã¦OSSã‚’ä½¿ãˆã‚‹èª¬æ˜æ›¸ã€ã«ãªã£ã¦ã„ã¾ã™ã€‚

ğŸ’¯ å®Œæˆåº¦ã¨ã—ã¦ç”³ã—åˆ†ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ã¾ã¾æ¡ç”¨ã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ï¼

---

ã‚‚ã—æ¬¡ã« `.UseCache()` ã®å†…éƒ¨å‡¦ç†ã‚„ã€StateStoreã®å‹•ä½œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã«é–¢ã™ã‚‹**è©³ç´°è¨­è¨ˆã‚„è£œè¶³**ã‚‚è¨˜è¼‰ã•ã‚Œã‚‹å ´åˆã¯ã€åˆ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³åŒ–ã—ã¦ã‚‚ã‚ˆã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã”å¸Œæœ›ãŒã‚ã‚Œã°ãã®è£œåŠ©ã‚‚è¡Œã„ã¾ã™ï¼

### tool â€” 2025-06-27T14:28:18.316185+00:00

_(empty)_

### tool â€” 2025-06-27T14:28:18.316582+00:00

# OSSè¨­è¨ˆè³‡æ–™ï¼šçµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## Overview

### Readme

ï»¿# KSQL Entity Framework è¦ä»¶å®šç¾©æ›¸

## ç›®æ¬¡ (Table of Contents)

- [1. æ¦‚è¦](#1-æ¦‚è¦)
- [2. åŸºæœ¬åŸå‰‡](#2-åŸºæœ¬åŸå‰‡)
- [3. ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#3-ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
  - [3.1 ãƒˆãƒ”ãƒƒã‚¯ (Kafka Topics)](#31-ãƒˆãƒ”ãƒƒã‚¯-kafka-topics)
  - [3.2 ã‚¹ãƒˆãƒªãƒ¼ãƒ  (KSQL Streams)](#32-ã‚¹ãƒˆãƒªãƒ¼ãƒ -ksql-streams)
  - [3.3 ãƒ†ãƒ¼ãƒ–ãƒ« (KSQL Tables)](#33-ãƒ†ãƒ¼ãƒ–ãƒ«-ksql-tables)
  - [3.4 ã‚¯ã‚¨ãƒªã¨è³¼èª­](#34-ã‚¯ã‚¨ãƒªã¨è³¼èª­)
- [4. POCO (Plain Old CLR Objects) ã®è¨­è¨ˆ](#4-poco-plain-old-clr-objects-ã®è¨­è¨ˆ)
  - [4.1 åŸºæœ¬å®šç¾©](#41-åŸºæœ¬å®šç¾©)
  - [4.2 ç‰¹æ®Šå‹ã®ã‚µãƒãƒ¼ãƒˆ](#42-ç‰¹æ®Šå‹ã®ã‚µãƒãƒ¼ãƒˆ)
- [5. ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹/ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ æ“ä½œ](#5-ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ æ“ä½œ)
  - [5.1 ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ (ãƒ‡ãƒ¼ã‚¿é€ä¿¡)](#51-ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼-ãƒ‡ãƒ¼ã‚¿é€ä¿¡)
  - [5.2 ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ (ãƒ‡ãƒ¼ã‚¿å—ä¿¡)](#52-ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼-ãƒ‡ãƒ¼ã‚¿å—ä¿¡)
  - [5.3 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†](#53-ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†)
- [6. ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ‡ãƒ¼ã‚¿å“è³ª](#6-ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ‡ãƒ¼ã‚¿å“è³ª)
  - [6.1 ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆ¦ç•¥](#61-ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆ¦ç•¥)
  - [6.2 ãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼ã‚­ãƒ¥ãƒ¼](#62-ãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼ã‚­ãƒ¥ãƒ¼)
  - [EventSetæ‹¡å¼µ: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° & DLQ](#eventsetæ‹¡å¼µ-ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°--dlq)
- [7. ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†æ“ä½œ](#7-ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†æ“ä½œ)
  - [7.1 ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã¨æ›´æ–°](#71-ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã¨æ›´æ–°)
  - [7.2 ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†æ§‹ç¯‰ã¨ç®¡ç†](#72-ãƒ†ãƒ¼ãƒ–ãƒ«ã®å†æ§‹ç¯‰ã¨ç®¡ç†)
- [8. ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»](#8-ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»)
- [9. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#9-ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
  - [ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](#ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)
  - [ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹](#ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹)
  - 
## 1. æ¦‚è¦

KSQL Entity Frameworkã¯ã€C#ãƒ—ãƒ­ã‚°ãƒ©ãƒãŒEntityFrameworkãƒ©ã‚¤ã‚¯ãªAPIã‚’ä½¿ç”¨ã—ã¦KSQL/KafkaStreamsã‚’æ“ä½œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚ãƒˆãƒ”ãƒƒã‚¯ä¸­å¿ƒã®è¨­è¨ˆã€POCOãƒ™ãƒ¼ã‚¹ã®ã‚¯ã‚¨ãƒªå®šç¾©ã€LINQãƒ©ã‚¤ã‚¯ãªã‚¹ãƒˆãƒªãƒ¼ãƒ æ“ä½œã‚’ç‰¹å¾´ã¨ã—ã¾ã™ã€‚

## 2. åŸºæœ¬åŸå‰‡

1. **ãƒˆãƒ”ãƒƒã‚¯ä¸­å¿ƒè¨­è¨ˆ**: ã™ã¹ã¦ã®æ“ä½œã¯Kafkaãƒˆãƒ”ãƒƒã‚¯ã‚’èµ·ç‚¹ã¨ã™ã‚‹
2. **å‹å®‰å…¨æ€§**: C#ã®å‹ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã—ã¦ã‚¹ã‚­ãƒ¼ãƒã®æ•´åˆæ€§ã‚’ç¢ºä¿
3. **ä½¿ã„æ…£ã‚ŒãŸAPI**: EntityFrameworkã«é¡ä¼¼ã—ãŸAPIãƒ‡ã‚¶ã‚¤ãƒ³
4. **LINQã‚µãƒãƒ¼ãƒˆ**: ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã‚’LINQã‚¯ã‚¨ãƒªã¨ã—ã¦è¡¨ç¾
5. **æ®µéšçš„ãƒ‡ãƒ—ãƒ­ã‚¤**: åŸºæœ¬æ©Ÿèƒ½ã‹ã‚‰é«˜åº¦ãªæ©Ÿèƒ½ã¸ã¨æ®µéšçš„ã«å®Ÿè£…
6. **è³¼èª­ãƒ¢ãƒ¼ãƒ‰ã®å›ºå®šåŒ–**: ã‚¹ãƒˆãƒªãƒ¼ãƒ å®šç¾©æ™‚ã«è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆã®æ–¹å¼ã‚’æ˜ç¤ºã—ã€å®Ÿè¡Œæ™‚ã«åˆ‡ã‚Šæ›¿ãˆä¸å¯ã¨ã™ã‚‹


## 3. POCOå±æ€§ãƒ™ãƒ¼ã‚¹DSLè¨­è¨ˆãƒ«ãƒ¼ãƒ«ï¼ˆFluent APIã®æ’é™¤æ–¹é‡ï¼‰

æœ¬OSSã§ã¯ã€Kafka/KSQLã®è¨­å®šã‚’ã™ã¹ã¦POCOã‚¯ãƒ©ã‚¹ã®å±æ€§ã§å®šç¾©ã™ã‚‹æ–¹å¼ã‚’æ¡ç”¨ã™ã‚‹ã€‚
ã“ã‚Œã¯ã€Fluent APIã‚’ç”¨ã„ãŸDSLè¨˜è¿°ã®æŸ”è»Ÿæ€§ã¨å¼•ãæ›ãˆã«ã€ã€Œæ§‹æˆãŒPOCOã«é›†ç´„ã•ã‚Œã¦ã„ã‚‹ã€ã¨ã„ã†æ˜å¿«ã•ã‚’é‡è¦–ã—ãŸè¨­è¨ˆæ–¹é‡ã§ã‚ã‚‹ã€‚

ğŸ·ï¸ ã‚¯ãƒ©ã‚¹ãƒ¬ãƒ™ãƒ«å±æ€§ä¸€è¦§
|å±æ€§å	|èª¬æ˜|
|---|---|
[Topic("topic-name")]	|Kafkaãƒˆãƒ”ãƒƒã‚¯åã®æŒ‡å®šï¼ˆPartitions, Replicationã‚‚è¨­å®šå¯èƒ½ï¼‰
[KsqlStream] / [KsqlTable]	|Stream/Table ã®æ˜ç¤ºæŒ‡å®šï¼ˆæœªæŒ‡å®šæ™‚ã¯è‡ªå‹•åˆ¤å®šï¼‰
[Table("name")]	|EF Coreã¨ã®äº’æ›æ€§ç¶­æŒç”¨ï¼ˆä»»æ„ï¼‰


ğŸ§© ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ¬ãƒ™ãƒ«å±æ€§ä¸€è¦§
|å±æ€§å	|èª¬æ˜|
|---|---|
[Key(Order = n)]|	Kafkaã®Keyã«å¯¾å¿œã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€‚è¤‡åˆã‚­ãƒ¼å¯
[KafkaIgnore]	|ã‚¹ã‚­ãƒ¼ãƒå®šç¾©ãƒ»KSQLå¤‰æ›ã‹ã‚‰é™¤å¤–ã•ã‚Œã‚‹
[DecimalPrecision(precision, scale)]	|decimalå‹ã®ç²¾åº¦æŒ‡å®šï¼ˆä¾‹ï¼š18,4ï¼‰
[DateTimeFormat("format")]	|KSQLä¸Šã§ã®DateTimeã®æ–‡å­—åˆ—ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
[DefaultValue(value)]	|å®šç¾©æ™‚ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆã‚¹ã‚­ãƒ¼ãƒå®šç¾©ä¸Šã®ã¿ï¼‰
[MaxLength(n)]	|æ–‡å­—åˆ—é•·ã®åˆ¶ç´„ã€‚Avroã‚¹ã‚­ãƒ¼ãƒã«ã‚‚åæ˜ 

ğŸ¤– è‡ªå‹•åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
[Key]ã®æœ‰ç„¡ã«ã‚ˆã£ã¦ [KsqlStream] or [KsqlTable] ã®æš—é»™çš„æ¨å®šã‚’è¡Œã†

Nullable<T> ã¯ã‚¹ã‚­ãƒ¼ãƒä¸Šã§ Union<Type, null> ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹

Keyå±æ€§ãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯è¤‡åˆã‚­ãƒ¼ï¼ˆCompositeKeyï¼‰ã¨ã—ã¦å¤‰æ›ã•ã‚Œã‚‹

ğŸ’¡ ã‚µãƒ³ãƒ—ãƒ«ï¼šOrderã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®å®šç¾©
```csharp
[Topic("orders", Partitions = 3, Replication = 1)]
[KsqlTable]
public class Order
{
    [Key(Order = 0)]
    public int OrderId { get; set; }

    [DateTimeFormat("yyyy-MM-dd")]
    public DateTime OrderDate { get; set; }

    [DecimalPrecision(18, 4)]
    public decimal TotalAmount { get; set; }

    [MaxLength(100)]
    public string? Region { get; set; }

    [KafkaIgnore]
    public string? InternalUseOnly { get; set; }
}
```
ğŸ“˜ è¨­è¨ˆä¸Šã®æ–¹é‡ã¨æ„å›³
æ§‹æˆæƒ…å ±ã¯ã™ã¹ã¦ POCOã«è¨˜è¿°ã•ã‚Œã€å¤–éƒ¨è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚„Fluent DSLã¯ä¸è¦

åˆ©ç”¨è€…ã¯ .cs ãƒ•ã‚¡ã‚¤ãƒ«ä¸Šã®å±æ€§ã®ã¿ã‚’å‚ç…§ã™ã‚Œã°å‹•ä½œæ§‹æˆã‚’æŠŠæ¡å¯èƒ½


ğŸ” Fluent API ã®è£œåŠ©çš„æ´»ç”¨ã¨åˆ¶é™ã«ã¤ã„ã¦
POCOå±æ€§ã‚’ä¸­å¿ƒã¨ã—ãŸè¨­è¨ˆæ–¹é‡ã‚’æ¡ã‚‹æœ¬DSLã§ã¯ã€Fluent API ã¯ã‚ãã¾ã§è£œåŠ©çš„æ‰‹æ®µã¨ã—ã¦ä½ç½®ã¥ã‘ã‚‰ã‚Œã€ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§é™å®šçš„ã«åˆ©ç”¨å¯èƒ½ã§ã™ã€‚

ğŸ§± 1. KsqlContextBuilderï¼ˆKSQL DSLå…¨ä½“ã®æ§‹æˆï¼‰
```csharp
var context = CsharpKsqlContextBuilder.Create()
    .UseSchemaRegistry("http://localhost:8081")
    .EnableLogging(loggerFactory)
    .ConfigureValidation(autoRegister: true, failOnErrors: false, enablePreWarming: true)
    .WithTimeouts(TimeSpan.FromSeconds(5))
    .EnableDebugMode(true)
    .Build()
    .BuildContext<MyKsqlContext>();
```
ä¸»ãªç”¨é€”ï¼š

ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªé€£æº

ãƒ­ã‚°å‡ºåŠ›ã®è¨­å®š

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç­‰ã®å‹•ä½œåˆ¶å¾¡

ğŸ§© 2. ModelBuilderï¼ˆEntityå®šç¾©æ™‚ï¼‰
```csharp
protected override void OnModelCreating(IModelBuilder modelBuilder)
{
    modelBuilder.Entity<Order>()
        .AsTable(); // ã¾ãŸã¯ .AsStream()
}
```
POCOå±æ€§ã« Stream/Table æŒ‡å®šãŒãªã„å ´åˆã®ã¿ä½¿ç”¨å¯

æ˜ç¤ºçš„ãªå‹æŒ‡å®šã‚’å¯èƒ½ã«ã™ã‚‹ï¼ˆãŸã ã— key/topic è¨­å®šã¯ç¦æ­¢ï¼‰

ğŸ“¦ 3. AvroEntityConfigurationBuilderï¼ˆAvroã‚¹ã‚­ãƒ¼ãƒå®šç¾©ã®è©³ç´°åˆ¶å¾¡ï¼‰
```csharp
configuration.Configure<Order>()
    .ToTopic("orders")                   // âŒ éæ¨å¥¨ï¼ˆå±æ€§å„ªå…ˆï¼‰
    .HasKey(o => o.Id)                   // âŒ éæ¨å¥¨
    .WithPartitions(3)
    .WithReplicationFactor(2)
    .AsStream();                         // âœ… Stream/TableæŒ‡å®šã®ã¿è¨±å¯
```    
ã“ã®ãƒ“ãƒ«ãƒ€ãƒ¼ã¯ã€Avroã‚¹ã‚­ãƒ¼ãƒç”Ÿæˆæ™‚ã«é«˜åº¦ãªåˆ¶å¾¡ãŒå¿…è¦ãªå ´åˆã«é™ã‚Šä½¿ç”¨ã•ã‚Œã‚‹ã€‚
ãŸã ã—ã€ä»¥ä¸‹ã®ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã¯è¨­è¨ˆåŸå‰‡é•åã¨ãªã‚‹ã€‚

ğŸš« åˆ¶é™äº‹é …
ãƒ¡ã‚½ãƒƒãƒ‰	ç†ç”±
.ToTopic("...")	ãƒˆãƒ”ãƒƒã‚¯åã¯ [Topic] å±æ€§ã§æŒ‡å®šã™ã‚‹ãŸã‚ç¦æ­¢
.HasKey(...)	ã‚­ãƒ¼å®šç¾©ã¯ [Key] å±æ€§ã«ä¸€æœ¬åŒ–ã•ã‚Œã¦ã„ã‚‹
.AsStream() / .AsTable()	å±æ€§ã¾ãŸã¯ModelBuilderã¨é‡è¤‡å¯èƒ½ã€‚ä¸¡æ–¹æŒ‡å®šã§ä¸€è‡´ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼

ã“ã‚Œã‚‰ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯å‘¼ã³å‡ºã•ã‚ŒãŸå ´åˆã« NotSupportedException ã‚’ã‚¹ãƒ­ãƒ¼ã™ã‚‹è¨­è¨ˆã¨ã—ã€èª¤ç”¨ã‚’é˜²æ­¢ã™ã‚‹ã€‚

### 3.1 ãƒˆãƒ”ãƒƒã‚¯ (Kafka Topics)

[Topic] å±æ€§ã§ãƒˆãƒ”ãƒƒã‚¯ã‚’å®šç¾©ã€‚

ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ•°ã‚„ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¿‚æ•°ã®Fluent APIã«ã‚ˆã‚‹è¨­å®šäºˆå®šã€‚
#### ãƒˆãƒ”ãƒƒã‚¯å®šç¾©
```csharp
// å±æ€§ã«ã‚ˆã‚‹ãƒãƒƒãƒ”ãƒ³ã‚°
[Topic("orders", PartitionCount = 12, ReplicationFactor = 3)]
public class Order 
{
    [Key]
    public string OrderId { get; set; }
    public string CustomerId { get; set; }
    public decimal Amount { get; set; }
    public DateTime OrderTime { get; set; }
}

// Fluent API
modelBuilder.Entity<Order>()
    .WithPartitions(12)
    .WithReplicationFactor(3);
```

#### ãƒˆãƒ”ãƒƒã‚¯æ§‹æˆ
- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³è¨­å®š: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ•°ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ‹ãƒ³ã‚°æˆ¦ç•¥
- ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š: ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¯ã‚¿ãƒ¼ã€ISRã®æœ€å°æ•°
- ä¿æŒãƒãƒªã‚·ãƒ¼: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¿æŒæœŸé–“ã€ã‚µã‚¤ã‚ºåˆ¶é™
- åœ§ç¸®è¨­å®š: ãƒˆãƒ”ãƒƒã‚¯ãƒ¬ãƒ™ãƒ«ã®åœ§ç¸®æ–¹å¼

#### ã‚¹ã‚­ãƒ¼ãƒç®¡ç†
- è‡ªå‹•ã‚¹ã‚­ãƒ¼ãƒç™»éŒ²: POCOã‹ã‚‰Avroã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆã—ç™»éŒ²
- äº’æ›æ€§è¨­å®š: ã‚¹ã‚­ãƒ¼ãƒäº’æ›æ€§ãƒãƒªã‚·ãƒ¼ã®æŒ‡å®š
- ã‚¹ã‚­ãƒ¼ãƒé€²åŒ–: ã‚¹ã‚­ãƒ¼ãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç®¡ç†ã¨ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³


### 3.2 ã‚¹ãƒˆãƒªãƒ¼ãƒ  (KSQL Streams)
.Where(...), .Select(...) ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒ«ã‚¿ãƒ»å¤‰æ›ã€‚

.WithManualCommit() ã«ã‚ˆã‚‹æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆæŒ‡å®šãŒå¯èƒ½ã€‚

EntityModel ã«çŠ¶æ…‹ã‚’ä¿å­˜ã€å®Ÿè¡Œæ™‚ã«åæ˜ ã€‚

å®Ÿè¡Œæ™‚åˆ‡ã‚Šæ›¿ãˆã¯ä¸å¯ã€‚
#### ã‚¹ãƒˆãƒªãƒ¼ãƒ å®šç¾©ã®å‰æ

ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯ POCO ã«å¯¾ã—ã¦ LINQ å¼ãŒé©ç”¨ã•ã‚ŒãŸã¨ãã«å‹•çš„ã«è§£é‡ˆã•ã‚Œã€ç”Ÿæˆã•ã‚Œã‚‹ã€‚

#### åˆ¤å®šãƒ«ãƒ¼ãƒ«

POCOï¼ˆC#ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©ï¼‰ã«å¯¾ã—ã¦LINQå¼ãŒè¨˜è¿°ã•ã‚ŒãŸå ´åˆã€
ãã®å‹ã¯ "ã‚¹ãƒˆãƒªãƒ¼ãƒ " ã¨ã—ã¦è§£é‡ˆã•ã‚Œã€å¯¾å¿œã™ã‚‹ CREATE STREAM å®šç¾©ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

ãŸã ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã« GroupBy ã‚„ Aggregateã€Window ã‚’å«ã‚€å ´åˆã¯ CREATE TABLEï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰ã¨ã—ã¦è§£é‡ˆã•ã‚Œã¾ã™ã€‚
```csharp
// ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹ä¾‹ï¼ˆAutoCommitãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
modelBuilder.Entity<Order>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId });

// ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦è§£é‡ˆã•ã‚Œã‚‹ä¾‹ï¼ˆGroupBy ã‚’å«ã‚€ï¼‰
modelBuilder.Entity<Order>()
    .Window(TumblingWindow.Of(TimeSpan.FromHours(1)))
    .GroupBy(o => o.CustomerId)
    .Select(g => new HourlyStats 
    { 
        CustomerId = g.Key,
        Hour = g.Window.Start,
        OrderCount = g.Count() 
    });

// æ˜ç¤ºçš„ã«ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ã—ã¦æ‰±ã†ï¼ˆGroupByãŒã‚ã£ã¦ã‚‚ï¼‰
modelBuilder.Entity<Order>()
    .AsStream()
    .GroupBy(o => o.Region)
    .Select(g => new { g.Key });

// æ˜ç¤ºçš„ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦æ‰±ã†
modelBuilder.Entity<Order>()
    .AsTable()
    .Select(o => new { o.CustomerId, o.Amount });
```

ã“ã®ã‚ˆã†ã« modelBuilder.Entity<Order>() ã«å¯¾ã—ã¦ LINQ ãŒä»˜ãã‹å¦ã‹ã§ "é…ä¿¡å¯¾è±¡"
ã•ã‚‰ã« LINQ ã®å†…å®¹ã«ã‚ˆã£ã¦ "ã‚¹ãƒˆãƒªãƒ¼ãƒ " ã‹ "ãƒ†ãƒ¼ãƒ–ãƒ«" ã‹ã‚’åˆ¤åˆ¥ã—ã¾ã™ã€‚
åŠ ãˆã¦ã€.AsStream() ã‚„ .AsTable() ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€æ„å›³çš„ã«è§£é‡ˆã‚’ä¸Šæ›¸ãã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

#### ã‚³ãƒŸãƒƒãƒˆæ–¹å¼ã®æŒ‡å®š

ã“ã® `WithManualCommit()` æŒ‡å®šã¯ `EntityModel` ã«ä¿å­˜ã•ã‚Œã€å®Ÿè¡Œæ™‚ã® `ForEachAsync()` ã§ã®å‡¦ç†æ–¹å¼ï¼ˆè‡ªå‹•ï¼æ‰‹å‹•ï¼‰ã‚’æ±ºå®šã™ã‚‹éš›ã«å‚ç…§ã•ã‚Œã¾ã™ã€‚å®Ÿè¡Œæ™‚ã«ã“ã®è¨­å®šã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

```csharp
// è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
modelBuilder.Entity<Order>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId });

// æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆã‚’æ˜ç¤º
modelBuilder.Entity<Order>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId })
    .WithManualCommit();
```
æ³¨æ„ï¼šè³¼èª­æ™‚ã® commit ãƒ¢ãƒ¼ãƒ‰ã¯ LINQ å®Ÿè¡Œæ™‚ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚å®šç¾©æ™‚ã«ç¢ºå®šã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### 3.3 ãƒ†ãƒ¼ãƒ–ãƒ« (KSQL Tables)

ã“ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ã€LINQ å¼ãŒ GroupBy ã‚„ Aggregate ã‚’å«ã¿ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã¨åˆ¤å®šã•ã‚ŒãŸå ´åˆã€å¯¾å¿œã™ã‚‹ãƒˆãƒ”ãƒƒã‚¯ã¯ è‡ªå‹•çš„ã« compact ãƒ¢ãƒ¼ãƒ‰ã§ä½œæˆ ã•ã‚Œã¾ã™ã€‚

é–‹ç™ºè€…ã¯ã‚³ãƒ³ãƒ‘ã‚¯ã‚·ãƒ§ãƒ³ã®æœ‰ç„¡ã‚’æ„è­˜ã›ãšã€é€šå¸¸ã® LINQ ã‚¯ã‚¨ãƒªå®šç¾©ã ã‘ã§æ­£ã—ãæ°¸ç¶šåŒ–ç‰¹æ€§ã‚’æŒã£ãŸãƒˆãƒ”ãƒƒã‚¯ã‚’æ‰±ãˆã¾ã™ã€‚
```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{

    modelBuilder.Entity<Order>()
        .HasTopic("orders")
        .GroupBy(o => o.CustomerId)
        .Select(g => new
        {
            CustomerId = g.Key,
            LatestAmount = g.LatestByOffset(o => o.Amount)
        });
}
```
ã“ã®ä¾‹ã§ã¯ CustomerId ã‚’ã‚­ãƒ¼ã¨ã—ãŸæœ€æ–°ã®æ³¨æ–‡é‡‘é¡ã ã‘ã‚’ä¿æŒã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ãŒä½œæˆã•ã‚Œã€ãã®è£ã®ãƒˆãƒ”ãƒƒã‚¯ã¯ compact ã¨ãªã‚Šã¾ã™ã€‚

GroupBy(...) ã«ã‚ˆã‚Šãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆKTableï¼‰åŒ–ã€‚

```csharp
protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<Order>()
        .HasTopic("orders")
        .GroupBy(o => o.OrderId)
        .Window(new[] { 1 })
        .Select(g => new
        {
            OrderId = g.Key,
            LatestPrice = g.Last().Price,
            WindowStart = g.WindowStart,
            WindowEnd = g.WindowEnd
        });
}

```
.Window(...) ã«ã‚ˆã‚Šã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é›†ç´„å¯èƒ½ã€‚

è¤‡æ•°ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºï¼ˆä¾‹ï¼š1åˆ†ãƒ»5åˆ†ï¼‰ã«å¯¾å¿œã€‚

orders_window_final ã¸ã®æ›¸ãè¾¼ã¿ã¯PODå†…ã‚¿ã‚¤ãƒãƒ¼ã«ã‚ˆã‚‹Windowç¢ºå®šã§è‡ªå¾‹å®Ÿè¡Œã€‚

æœ€åˆã«åˆ°ç€ã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ­£ã¨ã™ã‚‹æ–¹é‡ã‚’æ¡ç”¨ã€‚

#### ãƒ†ãƒ¼ãƒ–ãƒ«åˆ¤å®šãƒ«ãƒ¼ãƒ«ã¨åŸºæœ¬è¨­è¨ˆ

POCOï¼ˆC#ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©ï¼‰ã«å¯¾ã™ã‚‹ LINQ å¼ã®ä¸­ã§ GroupBy, Aggregate, Window ãªã©ã®æ§‹æ–‡ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®ã‚¯ã‚¨ãƒªã¯ CREATE TABLE ã«ç›¸å½“ã™ã‚‹ KSQL ãƒ†ãƒ¼ãƒ–ãƒ«ã¨è§£é‡ˆã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆ¤å®šãŒ LINQ æ§‹æ–‡ã®æ„å‘³ã«åŸºã¥ã„ã¦ä¸€è²«ã—ã¦è¡Œã‚ã‚Œã¾ã™ã€‚

ã¾ãŸã€.AsTable() ã‚’æ˜ç¤ºçš„ã«å‘¼ã³å‡ºã™ã“ã¨ã§ã€æ„å›³çš„ã«ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

#### é›†ç´„æ“ä½œ
```csharp
// ã‚µãƒãƒªé›†è¨ˆ
var customerStats = context.Orders
    .GroupBy(o => o.CustomerId)
    .Aggregate(g => new CustomerStats 
    { 
        CustomerId = g.Key, 
        TotalAmount = g.Sum(o => o.Amount),
        OrderCount = g.Count()
    });

// LATEST_BY_OFFSET
var latestCustomerOrders = context.Orders
    .GroupBy(o => o.CustomerId)
    .Aggregate(g => new CustomerLatestOrder
    {
        CustomerId = g.Key,
        LatestOrderId = g.LatestByOffset(o => o.OrderId),
        LatestOrderTime = g.LatestByOffset(o => o.OrderTime),
        LatestAmount = g.LatestByOffset(o => o.Amount)
    });

// EARLIEST_BY_OFFSET
var firstTimeCustomers = context.Orders
    .GroupBy(o => o.CustomerId)
    .Aggregate(g => new CustomerFirstOrder
    {
        CustomerId = g.Key,
        FirstOrderId = g.EarliestByOffset(o => o.OrderId),
        FirstOrderTime = g.EarliestByOffset(o => o.OrderTime),
        FirstAmount = g.EarliestByOffset(o => o.Amount)
    });


```
#### ãƒ†ãƒ¼ãƒ–ãƒ«çµåˆï¼ˆJOINï¼‰

```csharp
// å˜ä¸€ã‚­ãƒ¼çµåˆ
var query = from o in context.Orders
            join c in context.Customers
            on o.CustomerId equals c.CustomerId
            select new { o.OrderId, c.CustomerName, o.Amount };

// è¤‡åˆã‚­ãƒ¼çµåˆ
var query2 = from o in context.Orders
             join c in context.Customers
             on new { o.CustomerId, o.Region } equals 
                new { c.CustomerId, c.Region }
             select new { o.OrderId, c.CustomerName, o.Amount };

// 3ãƒ†ãƒ¼ãƒ–ãƒ«çµåˆ
var query3 = from o in context.Orders
             join c in context.Customers on o.CustomerId equals c.CustomerId
             join p in context.Products on o.ProductId equals p.ProductId
             select new {
                 o.OrderId,
                 c.CustomerName,
                 p.ProductName,
                 o.Quantity,
                 o.Amount
             };

```

â±ï¸ ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦DSLã®æ‹¡å¼µï¼šè¤‡æ•°Windowå®šç¾©ã¨ã‚¢ã‚¯ã‚»ã‚¹
æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€åŒä¸€ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«å¯¾ã—ã¦è¤‡æ•°ã®ç•°ãªã‚‹ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å¹…ï¼ˆä¾‹ï¼š1åˆ†ã€5åˆ†ã€15åˆ†ã€60åˆ†ï¼‰ã‚’å®šç¾©ã—ã€å€‹åˆ¥ã«ã‚¢ã‚¯ã‚»ã‚¹ãƒ»è³¼èª­å¯èƒ½ã¨ã™ã‚‹æ‹¡å¼µDSLã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```csharp
modelBuilder.Entity<Chart>()
    .Window(new int[]{1,5,15,60});
```
ã“ã®è¨˜è¿°ã«ã‚ˆã‚Šä»¥ä¸‹ã®4ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼š

Chart_1min

Chart_5min

Chart_15min

Chart_60min


ğŸ’» LINQã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ã¯æ¬¡ã®ã‚ˆã†ã«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’æŒ‡å®šã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—ã§ãã¾ã™ï¼š

```csharp
var candles1m = ctx.Charts.Window(1).ToList();
var candles5m = ctx.Charts.Window(5).ToList();
// TimeSpan æŒ‡å®šã‚‚å¯èƒ½
var candles15m = ctx.Charts.Window(TimeSpan.FromMinutes(15)).ToList();
```
æˆ»ã‚Šå€¤ã¯ IQueryable<Chart> ã¨ã—ã¦å–å¾—ã•ã‚Œã€é€šå¸¸ã®LINQå¼ãŒé©ç”¨å¯èƒ½ã§ã™ã€‚

ğŸ” æœ€æ–°ãƒ‡ãƒ¼ã‚¿å–å¾—ã®ä¾‹
ToLatest() ã¯å°‚ç”¨ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ãªãã€LINQã§ä»¥ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼š

```csharp
var latest = ctx.Charts.Window(5).ToList()
    .OrderByDescending(c => c.Timestamp)
    .GroupBy(c => c.Symbol)
    .Select(g => g.First());
```

### 3.4 ã‚¯ã‚¨ãƒªã¨è³¼èª­
ForEachAsync() ã«ã‚ˆã‚‹è³¼èª­ã‚¹ãƒˆãƒªãƒ¼ãƒ å–å¾—ã€‚

.WithManualCommit() ãŒæŒ‡å®šã•ã‚ŒãŸã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯ IManualCommitMessage<T> å‹ã‚’è¿”ã™ã€‚

.Valueï¼šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹

.CommitAsync()ï¼šã‚³ãƒŸãƒƒãƒˆå‡¦ç†

.NegativeAckAsync()ï¼šå¦å®šå¿œç­”
#### ã‚¹ãƒˆãƒªãƒ¼ãƒ å®šç¾©ã¨ã‚³ãƒŸãƒƒãƒˆæ–¹å¼ã®æŒ‡å®š
```csharp
// modelBuilder ã«ã‚ˆã‚‹å®šç¾©ï¼ˆè‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼šãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
modelBuilder.Entity<Order>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId });
// è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆã®è³¼èª­å‡¦ç†ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰
await foreach (var order in context.Orders.ForEachAsync())
{
    Console.WriteLine($"Received: {order.Value.OrderId}");
    // è‡ªå‹•ã§ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ãŸã‚æ˜ç¤ºçš„ãª commit ã¯ä¸è¦
}

// modelBuilder ã«ã‚ˆã‚‹å®šç¾©ï¼ˆæ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆï¼‰
modelBuilder.Entity<HighValueOrder>()
    .Where(o => o.Amount > 1000)
    .Select(o => new { o.OrderId, o.CustomerId })
    .WithManualCommit();

// æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆä»˜ãã®è³¼èª­å‡¦ç†
await foreach (var order in context.HighValueOrders.ForEachAsync())
{
    try
    {
        Console.WriteLine($"Received: {order.Value.OrderId}");
        await order.CommitAsync();
    }
    catch
    {
        await order.NegativeAckAsync();
    }
}

```
æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€`ForEachAsync()` ã¯ `IManualCommitMessage<T>` å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã—ã¾ã™ã€‚
ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ `.Value` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã§å…ƒã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã€`.CommitAsync()` / `.NegativeAckAsync()` ã«ã‚ˆã£ã¦å‡¦ç†å®Œäº†ï¼å¤±æ•—é€šçŸ¥ã‚’åˆ¶å¾¡ã—ã¾ã™ã€‚
```csharp
public interface IManualCommitMessage<T>
{
    T Value { get; }
    Task CommitAsync();
    Task NegativeAckAsync();
}
```
ã“ã®å‹ã¯æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆæŒ‡å®šæ™‚ã®ã¿è¿”ã•ã‚Œã€è‡ªå‹•ã‚³ãƒŸãƒƒãƒˆæ™‚ã¯ T ã®ã¾ã¾ã«ãªã‚Šã¾ã™ï¼ˆForEachAsync() ã®ä¸­ã§åˆ†å²ï¼‰

## 4. POCO (Plain Old CLR Objects) ã®è¨­è¨ˆ

### 4.1 åŸºæœ¬å®šç¾©
- ã‚·ãƒ³ãƒ—ãƒ«ãªC#ã‚¯ãƒ©ã‚¹: ç‰¹åˆ¥ãªåŸºåº•ã‚¯ãƒ©ã‚¹ä¸è¦
- æ¨™æº–çš„ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£: ä¸€èˆ¬çš„ãª.NETå‹ã®ã‚µãƒãƒ¼ãƒˆ
- [Topic], [Key], [AvroTimestamp] å±æ€§ã‚’æä¾›ã€‚

### 4.2 å‹ã®ã‚µãƒãƒ¼ãƒˆ

ä»¥ä¸‹ã¯POCOã§ä½¿ç”¨å¯èƒ½ãªä¸»ãªãƒ‡ãƒ¼ã‚¿å‹ã®ä¸€è¦§ã§ã™ï¼š

|ãƒ‡ãƒ¼ã‚¿å‹|èª¬æ˜|
---|---
int, long|æ•´æ•°å‹ã€Kafkaã§ã¯Avro/ProtobufçµŒç”±ã§ãã®ã¾ã¾ãƒãƒƒãƒ”ãƒ³ã‚°å¯èƒ½
float, double|æµ®å‹•å°æ•°ç‚¹æ•°
decimal|é«˜ç²¾åº¦æ•°å€¤ã€‚[DecimalPrecision]ã§ç²¾åº¦æŒ‡å®šå¯èƒ½
bool|çœŸå½å€¤
string|ãƒ†ã‚­ã‚¹ãƒˆ
DateTime|AvroTimestamp(IsEventTime=true) ã§å‡¦ç† Kafkaã¸ã®é€ä¿¡æ™‚ã«UTCå¤‰æ›å‡¦ç†ãŒå…¥ã‚‹ã€‚
DateTimeOffset|æ—¥æ™‚å‹ã€‚Kafkaã¸ã®é€ä¿¡æ™‚ã«UTCå¤‰æ›å‡¦ç†ãŒå…¥ã‚‹ã€‚åˆ©ç”¨æ¨å¥¨ã€‚KSQLäº’æ›ã«æ³¨æ„
Guid|ä¸€æ„è­˜åˆ¥å­ã¨ã—ã¦ã‚µãƒãƒ¼ãƒˆ
short|Kafkaã§ã¯ int ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ä½¿ç”¨å¯èƒ½ã§ã™ãŒã€å¿…è¦ã«å¿œã˜ã¦æ˜ç¤ºçš„ãªã‚¹ã‚­ãƒ¼ãƒå¤‰æ›ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„ã€‚
char|Kafkaã«ã¯ç›´æ¥ã®å¯¾å¿œãŒãªãã€äº‹å®Ÿä¸Šéæ¨å¥¨ã§ã™ã€‚1æ–‡å­—ã¯ string å‹ã§è¡¨ç¾ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

#### Decimalå‹ã®ç²¾åº¦æŒ‡å®š
```csharp
[DecimalPrecision(precision: 18, scale: 4)]
public decimal Amount { get; set; }
```

#### DateTime/DateTimeOffset
```csharp
// DateTimeOffsetæ¨å¥¨ï¼ˆã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ä¿æŒï¼‰
public DateTimeOffset TransactionTime { get; set; }

// ã¾ãŸã¯è¨­å®šä»˜ãã®DateTime
[DateTimeFormat(Format = "yyyy-MM-dd'T'HH:mm:ss.SSS", Locale = "en-US")]
public DateTime OrderDate { get; set; }
```
Kafkaã«ã¯ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã®æ¦‚å¿µãŒãªãã€ã™ã¹ã¦ã®æ™‚åˆ»ã¯UTCã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ã“ã®ãŸã‚ã€ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µã¨ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãŒåŒä¸€ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‰æã‚’å…±æœ‰ã—ã¦ã„ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ Kafka ã«ä¸æ…£ã‚Œãªé–‹ç™ºè€…ã§ã‚‚å®‰å…¨ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚DateTimeOffset ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºè€…ã¯ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ã‚’ä¿ã£ãŸã¾ã¾ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãŒã§ãã€Kafka ã¨ã®é–“ã® UTC å¤‰æ›ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå¸åã—ã¾ã™ã€‚ãã®ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æ„è­˜ã—ãŸãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®è¨˜è¿°ãŒå¯èƒ½ã§ã™ã€‚ã¾ãŸã€DateTime ã‚’ä½¿ç”¨ã—ã¦ã‚‚ã€Kafkaé€ä¿¡æ™‚ã«ã¯å†…éƒ¨çš„ã« DateTimeOffset(Utc) ã«å¤‰æ›ã•ã‚Œã‚‹ãŸã‚ã€å®‰å…¨ã«é‹ç”¨å¯èƒ½ã§ã™ã€‚ã“ã®ãŸã‚ã€ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µã¨ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãŒåŒä¸€ã®ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å‰æã‚’å…±æœ‰ã—ã¦ã„ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ Kafka ã«ä¸æ…£ã‚Œãªé–‹ç™ºè€…ã§ã‚‚å®‰å…¨ã«åˆ©ç”¨ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚
DateTimeOffset ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€é–‹ç™ºè€…ã¯ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³æƒ…å ±ã‚’ä¿ã£ãŸã¾ã¾ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºãŒã§ãã€Kafka ã¨ã®é–“ã® UTC å¤‰æ›ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒå¸åã—ã¾ã™ã€‚
ãã®ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ã‚’æ„è­˜ã—ãŸãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®è¨˜è¿°ãŒå¯èƒ½ã§ã™ã€‚
#### nullè¨±å®¹æ€§
```csharp
// C#æ¨™æº–ã® ?ä¿®é£¾å­ã‚’ä½¿ç”¨
public int? OptionalQuantity { get; set; }
```

#### æ•°å€¤å‹ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
```csharp
[DefaultValue(10)]
public int Quantity { get; set; }
```
énullableãªæ•°å€¤ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆä¾‹ï¼šint, double ãªã©ï¼‰ã¯ã€C#ã®ä»•æ§˜ã«ã‚ˆã‚ŠåˆæœŸåŒ–ã•ã‚Œã¦ã„ãªã„å ´åˆã§ã‚‚è‡ªå‹•çš„ã« 0 ã‚„ 0.0 ãªã©ã®æ—¢å®šå€¤ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚Kafkaé€ä¿¡æ™‚ã‚‚ã“ã‚Œã‚‰ã®å€¤ãŒãã®ã¾ã¾ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ç‰¹åˆ¥ãªåˆæœŸåŒ–ãŒä¸è¦ãªã‚±ãƒ¼ã‚¹ã§ã¯ [DefaultValue] å±æ€§ã¯çœç•¥å¯èƒ½ã§ã™ã€‚

## 5. ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹æ“ä½œ
ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€Kafka ã«ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ï¼ˆãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ï¼‰ã™ã‚‹éš›ã®åŸºæœ¬çš„ãªæ“ä½œæ–¹æ³•ã¨ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãŒæä¾›ã™ã‚‹æŠ½è±¡åŒ–æ‰‹æ³•ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚é–‹ç™ºè€…ã¯ Kafka ã®è¤‡é›‘ãªè¨­å®šã‚’æ„è­˜ã™ã‚‹ã“ã¨ãªãã€Entity Framework ãƒ©ã‚¤ã‚¯ãªè¨˜è¿°ã§ã‚¹ãƒˆãƒªãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
### 5.1 ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ (ãƒ‡ãƒ¼ã‚¿é€ä¿¡)
Kafkaã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ AddAsync ã«ã‚ˆã£ã¦å³æ™‚ã«Kafkaã¸é€ä¿¡ãŒè¡Œã‚ã‚Œã¾ã™ã€‚
Entity Frameworkã®ã‚ˆã†ã« SaveChangesAsync ã«ã‚ˆã£ã¦ãƒãƒƒãƒ•ã‚¡ã‚’æ˜ç¤ºçš„ã«ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹è¨­è¨ˆã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚
ã“ã®ãŸã‚ã€é–‹ç™ºè€…ã¯ AddAsync ã‚’ã€Œé€ä¿¡æ“ä½œã€ã¨ã—ã¦æ‰±ã†ã“ã¨ã‚’å‰æã«å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚
```csharp
// å˜ä¸€ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹
await context.Orders.AddAsync(new Order { OrderId = "123", Amount = 100 });

```
AddAsync ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§ã€è©²å½“ã™ã‚‹ Kafka ãƒˆãƒ”ãƒƒã‚¯ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚

è¤‡æ•°ä»¶ã®ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°é€ä¿¡ã‚„ä¸¦åˆ—åˆ¶å¾¡ã‚‚å†…éƒ¨ã§å¸åã•ã‚Œã¾ã™

### 5.3 ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†
Kafka ã¯ä¸€éƒ¨ã®æ“ä½œã«å¯¾ã—ã¦ã€Œãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã€ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ksqlDB å´ã§ã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã‚’å‰æã¨ã—ã¦ã„ãªã„ãŸã‚ã€æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹é‡ã‚’æ¡ç”¨ã—ã¾ã™ï¼š

æ˜ç¤ºçš„ãªãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ API ã¯æä¾›ã—ãªã„ï¼ˆä¾‹ï¼šBeginTransaction / CommitTransactionï¼‰

Kafka ã«ãŠã‘ã‚‹ã€ŒExactly Once Semantics (EOS)ã€ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹æ§‹æˆã®å ´åˆã§ã‚‚ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ã¯æ“ä½œå˜ä½ã® idempotency ã‚’ä¿è¨¼ã—ã¦ãã ã•ã„ã€‚

è¤‡æ•°ä»¶ã®é€£ç¶šé€ä¿¡ãŒå¿…è¦ãªå ´åˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§é€æ¬¡ AddAsync() ã‚’å‘¼ã³å‡ºã™å®Ÿè£…ã§ååˆ†ã«é«˜ã„ä¿¡é ¼æ€§ã‚’ç¢ºä¿ã§ãã¾ã™ã€‚

ã“ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€Kafka ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†ã®æ€æƒ³ã«å¾“ã„ã€æ°¸ç¶šåŒ–ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã‚ˆã‚Šã‚‚ å³æ™‚æ€§ã¨å¯ç”¨æ€§ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å„ªå…ˆã—ã¦ã„ã¾ã™ã€‚


## 6. ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ‡ãƒ¼ã‚¿å“è³ª
OnError(ErrorAction.Skip), .WithRetry(int), .Map(...) ãªã©ã®DSLæä¾›äºˆå®šã€‚

yield å‹ã® ForEachAsync ã«ã¦ try-catch å‡¦ç†ã‚’ã‚µãƒãƒ¼ãƒˆã€‚

Kafkaæ¥ç¶šãƒ»ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºãƒ»æ¥­å‹™ã‚¨ãƒ©ãƒ¼ã®åˆ†é¡çš„å¯¾å¿œã‚’æ¤œè¨ä¸­ã€‚

DLQæ§‹æˆã¯ ModelBuilder çµŒç”±ã§æŒ‡å®šå¯èƒ½äºˆå®šã€‚
### 6.1 ã‚¨ãƒ©ãƒ¼å‡¦ç†æˆ¦ç•¥
```csharp
// ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒãƒªã‚·ãƒ¼ã®è¨­å®š
context.Options.DeserializationErrorPolicy = ErrorPolicy.Skip;

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ä»˜ãã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç†
var processedOrders = context.Orders
    .OnError(ErrorAction.Skip)  // ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒƒãƒ—
    .Map(order => ProcessOrder(order))
    .WithRetry(3);  // å¤±æ•—æ™‚ã«3å›ãƒªãƒˆãƒ©ã‚¤
```

### 6.2 ãƒ‡ãƒƒãƒ‰ãƒ¬ã‚¿ãƒ¼ã‚­ãƒ¥ãƒ¼
DLQã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ãƒ¬ãƒ™ãƒ«ã§ä¸€å…ƒçš„ã«æ§‹æˆã•ã‚Œã¦ãŠã‚Šã€å€‹ã€…ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚„modelBuilderè¨­å®šã§æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«ã¯ã€å†…éƒ¨ã® `DlqProducer` ã«ã‚ˆã‚Šã€å…±é€šã®DLQãƒˆãƒ”ãƒƒã‚¯ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ `"dead.letter.queue"`ï¼‰ã¸è‡ªå‹•çš„ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚

Kafkaãƒˆãƒ”ãƒƒã‚¯åã®å¤‰æ›´ãŒå¿…è¦ãªå ´åˆã¯ã€`KsqlDslOptions.DlqTopicName` ã«ã‚ˆã‚Šä¸€æ‹¬è¨­å®šå¯èƒ½ã§ã™ã€‚

#### EventSetæ‹¡å¼µ: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° & DLQ
`EventSet<T>` ã¯ `.OnError(ErrorAction)` ã§ã‚¨ãƒ©ãƒ¼å‡¦ç†æ–¹é‡ã‚’æŒ‡å®šã—ã€`.WithRetry() ã¨çµ„ã¿åˆã‚ã›ã¦ãƒªãƒˆãƒ©ã‚¤åˆ¶å¾¡ã‚’è¡Œã„ã¾ã™ã€‚å†…éƒ¨ã§ã¯ `ErrorHandlingContext` ãŒè©¦è¡Œå›æ•°ã‚’ç®¡ç†ã—ã€`IErrorSink` å®Ÿè£…ã® `DlqProducer` ãŒ DLQ ãƒˆãƒ”ãƒƒã‚¯ã¸é€ä¿¡ã—ã¾ã™ã€‚

DLQã®è©³ç´°ã¯ `KsqlDslOptions.DlqConfiguration` ã‚’é€šã˜ã¦è¨­å®šã§ãã€`DlqTopicConfiguration` ã§ã¯ä¿æŒæœŸé–“ã‚„ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³æ•°ã€ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¿‚æ•°ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¯èƒ½ã§ã™ã€‚Kafka èµ·å‹•æ™‚ã«ã¯ `KafkaAdminService` ãŒ DLQ ãƒˆãƒ”ãƒƒã‚¯ã®å­˜åœ¨ç¢ºèªã¨è‡ªå‹•ä½œæˆã‚’è¡Œã†ãŸã‚ã€åˆ©ç”¨è€…ã¯åˆæœŸåŒ–ã®ã¿ã§ DLQ æ©Ÿèƒ½ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚


DLQã¯æ˜ç¤ºçš„ãªè¨­å®šã‚’å¿…è¦ã¨ã›ãšã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã«å†…éƒ¨çš„ã« `DlqProducer` ãŒè‡ªå‹•çš„ã«é€ä¿¡å‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€åˆ©ç”¨è€…ã¯ç‰¹åˆ¥ãªè¨­å®šãªã—ã§ã‚¨ãƒ©ãƒ¼ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®æ©æµã‚’å—ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚


```csharp
var result = context.Orders
    .OnError(ErrorAction.DLQ)
    .Map(order => Process(order));
    // å…±é€šã®DLQãƒˆãƒ”ãƒƒã‚¯ã«é€ä¿¡ã•ã‚Œã¾ã™
```
DLQï¼ˆDead Letter Queueï¼‰ã¸ã®é€ä¿¡ã¯ã€LINQã‚¯ã‚¨ãƒªãƒã‚§ãƒ¼ãƒ³ã®ä¸­ã§ `OnError(ErrorAction.DLQ)` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§å®Ÿç¾ã•ã‚Œã¾ã™ã€‚

ã“ã®æŒ‡å®šãŒã‚ã‚‹å ´åˆã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãƒ¬ã‚³ãƒ¼ãƒ‰ã¯å†…éƒ¨ã® `DlqProducer` ã«ã‚ˆã‚Šå…±é€šDLQãƒˆãƒ”ãƒƒã‚¯ï¼ˆæ—¢å®šã¯ `"dead.letter.queue"`ï¼‰ã«é€ä¿¡ã•ã‚Œã¾ã™ã€‚

ã“ã®æ–¹å¼ã«ã‚ˆã‚Šã€é–‹ç™ºè€…ã¯å€‹åˆ¥ã®DLQè¨­å®šã‚„ãƒˆãƒ”ãƒƒã‚¯å®šç¾©ã‚’æ„è­˜ã›ãšã«ã€ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã®å‡¦ç†æ–¹é‡ã‚’DSLã§æ˜ç¢ºã«è¨˜è¿°ã§ãã¾ã™ã€‚

DLQãƒãƒªã‚·ãƒ¼ã®è©³ç´°ã¯ `docs_advanced_rules.md` ã‚»ã‚¯ã‚·ãƒ§ãƒ³3 ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


### 6.3 ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ã¤ã„ã¦

æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€Kafka ã®ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¨é€£æºã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã—ã¦ Avro ã®ã¿ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

JSON Schema ã¯æ‰±ã„ã¾ã›ã‚“ï¼ˆç†ç”±ï¼šãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºãƒ»é€Ÿåº¦ãƒ»äº’æ›æ€§ç®¡ç†ã®è¦³ç‚¹ã‹ã‚‰ï¼‰

POCO ã‹ã‚‰ Avro ã‚¹ã‚­ãƒ¼ãƒã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã€åˆå›ç™»éŒ² or æ›´æ–°æ™‚ã«ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ç™»éŒ²ã•ã‚Œã¾ã™

ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®äº’æ›æ€§è¨­å®šï¼ˆBACKWARD, FULL ãªã©ï¼‰ã«å¿œã˜ãŸé–‹ç™ºã‚’æ¨å¥¨ã—ã¾ã™

## 7. ãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†æ“ä½œï¼ˆé–‹ç™ºãƒ»æ¤œè¨¼ç”¨é€”ï¼‰
æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€KSQLä¸Šã«å®šç¾©ã•ã‚Œã‚‹ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆæœŸåŒ–ãƒ»å‰Šé™¤ã‚’ã€é–‹ç™ºãƒ»æ¤œè¨¼ç”¨é€”ã«é™ã‚Š API ã¨ã—ã¦æä¾›ã—ã¾ã™ã€‚

```csharp
await context.EnsureTableCreatedAsync<HourlyStats>();
await context.DropTableAsync("hourly_stats");
```
æ³¨æ„:
ã“ã‚Œã‚‰ã®æ“ä½œã¯ é–‹ç™ºãƒ»CI/CD ç’°å¢ƒã§ã®åˆ©ç”¨ã‚’å‰æ ã¨ã—ã¦ãŠã‚Šã€æœ¬ç•ªç’°å¢ƒã§ã®å®Ÿè¡Œã¯æ¨å¥¨ã•ã‚Œã¾ã›ã‚“ã€‚
æœ¬ç•ªã§ã¯ modelBuilder ã«ã‚ˆã‚‹æ˜ç¤ºçš„ãªå®šç¾©ã¨ã€ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®DDLç®¡ç†ãŒåŸºæœ¬ã¨ãªã‚Šã¾ã™ã€‚


## 8. ãƒªãƒªãƒ¼ã‚¹è¨ˆç”»

### ãƒ•ã‚§ãƒ¼ã‚º1: åŸºç›¤æ§‹ç¯‰ (v0.1-v0.3)
- ãƒˆãƒ”ãƒƒã‚¯ãŠã‚ˆã³ã‚¹ãƒˆãƒªãƒ¼ãƒ å®šç¾© DSL
- POCO ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿å®šç¾©ã¨ãƒãƒƒãƒ”ãƒ³ã‚°
- ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ / ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ æ“ä½œã®æŠ½è±¡åŒ–
- Dead Letter Queue å¯¾å¿œ


### ãƒ•ã‚§ãƒ¼ã‚º2: é«˜åº¦ãªã‚¹ãƒˆãƒªãƒ¼ãƒ å‡¦ç† (v0.4-v0.6)
- LINQ ãƒ™ãƒ¼ã‚¹ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ»é›†ç´„å‡¦ç†
- ã‚¹ãƒˆãƒªãƒ¼ãƒ  / ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ˜ç¤ºçš„åˆ‡ã‚Šæ›¿ãˆ
- ã‚¹ã‚­ãƒ¼ãƒé€²åŒ–å¯¾å¿œã®æ¤œè¨

### ãƒ•ã‚§ãƒ¼ã‚º3: é«˜åº¦ãªãƒ‡ãƒ¼ã‚¿é€£æº (v0.7-v0.9)
- JOINå‡¦ç†ã®DSLåŒ–ï¼ˆè¤‡åˆã‚­ãƒ¼å¯¾å¿œå«ã‚€ï¼‰
- ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã¨ RocksDB å‰æã®èª­ã¿å–ã‚Šæœ€é©åŒ–
- ã‚¨ãƒ©ãƒ¼é€šçŸ¥ãƒ»ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»DLQç›£è¦–åŸºç›¤ã¨ã®é€£æº

### ãƒ•ã‚§ãƒ¼ã‚º4: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæ©Ÿèƒ½ (v1.0+)
- åˆ†æ•£ãƒˆãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒŠãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°
- ãƒãƒ«ãƒã‚¯ãƒ©ã‚¹ã‚¿ã‚µãƒãƒ¼ãƒˆ

## 9. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦
æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ã€Kafkaï¼ksqlDB ç’°å¢ƒã«ãŠã‘ã‚‹ Entity Framework ãƒ©ã‚¤ã‚¯ãªæ“ä½œã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€ä»¥ä¸‹ã®ä¸»è¦ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨è²¬å‹™ã‚’ã‚‚ã£ã¦æ§‹æˆã•ã‚Œã¾ã™ã€‚
### 9.1 ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

```
+------------------------------+
| ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤           |
|------------------------------|
| - ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒè³¼èª­å‡¦ç†       |
| - LINQãƒ™ãƒ¼ã‚¹ã®DSLè¨˜è¿°       |
| - POCOå®šç¾©ï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰   |
+------------------------------+
            â†“
+------------------------------+
| DSLå®šç¾©ï¼ãƒãƒƒãƒ”ãƒ³ã‚°å±¤        |
|------------------------------|
| - modelBuilder ã«ã‚ˆã‚‹DSLå®šç¾© |
| - LINQã®è§£é‡ˆã¨ã‚¯ã‚¨ãƒªå¤‰æ›     |
| - ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ãƒ†ãƒ¼ãƒ–ãƒ«åŒºåˆ¥   |
+------------------------------+
            â†“
+------------------------------+
| ã‚³ãƒ¼ãƒ‰è§£æãƒ»ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰å±¤     |
|------------------------------|
| - POCOæ§‹é€ ã®è§£æ              |
| - Avroã‚¹ã‚­ãƒ¼ãƒã®è‡ªå‹•ç”Ÿæˆ     |
| - ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®ç™»éŒ² |
| - ãƒˆãƒ”ãƒƒã‚¯ï¼DLQåã®è§£æ±º       |
+------------------------------+
            â†“
+------------------------------+
| Kafkaé€£æºå±¤ï¼ˆãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ï¼è³¼èª­ï¼‰|
|------------------------------|
| - Kafkaã¸ã®é€ä¿¡ï¼ˆAddAsyncï¼‰   |
| - ForEachAsyncã«ã‚ˆã‚‹è³¼èª­å‡¦ç† |
| - DLQã¸ã®ã‚¨ãƒ©ãƒ¼ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°   |
+------------------------------+
            â†“
+------------------------------+
| KSQLæ“ä½œå±¤                   |
|------------------------------|
| - CREATE STREAM/TABLEç”Ÿæˆ    |
| - JOIN / AGGREGATE ã®ç™ºè¡Œ    |
| - ã‚¯ã‚¨ãƒªç™»éŒ²ã¨ç›£è¦–           |
+------------------------------+
            â†“
+------------------------------+
| RocksDBã‚­ãƒ£ãƒƒã‚·ãƒ¥å±¤ï¼ˆKTable backing storeï¼‰ |
|------------------------------|
| - KTable/ãƒ†ãƒ¼ãƒ–ãƒ«å‚ç…§æ™‚ã«RocksDBã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥
| - å‚ç…§ã‚¯ã‚¨ãƒªã¯æ¥µåŠ›RocksDBçµŒç”±ã§å¿œç­”ï¼ˆé…å»¶ä½æ¸›ãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼‰
+------------------------------+

```
### 9.2 ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒãƒªã‚·ãƒ¼

æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ Kafka ã¨ã®é€šä¿¡ã«ãŠã„ã¦ Avro ã®ã¿ã‚’æ­£å¼ã‚µãƒãƒ¼ãƒˆ ã—ã¦ã„ã¾ã™ã€‚

JSON Schema ã¯ã‚µãƒãƒ¼ãƒˆå¯¾è±¡å¤–ã§ã™ï¼ˆç†ç”±ï¼šã‚µã‚¤ã‚ºåŠ¹ç‡ãƒ»é€Ÿåº¦ãƒ»äº’æ›æ€§ç®¡ç†ã®æ˜ç¢ºæ€§ï¼‰ã€‚

ã‚¹ã‚­ãƒ¼ãƒã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã€ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ç™»éŒ²ã•ã‚Œã¾ã™ã€‚

### 9.3 è£œè¶³

ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã®æ¥ç¶šè¨­å®šã‚„äº’æ›æ€§ãƒ«ãƒ¼ãƒ«ï¼ˆBACKWARD ç­‰ï¼‰ã¯åˆ¥é€”æ§‹æˆã§æŒ‡å®šã€‚

ã‚¹ãƒˆãƒªãƒ¼ãƒ ï¼ãƒ†ãƒ¼ãƒ–ãƒ«ã®å®šç¾©ã€DLQè¨­å®šã€LINQ DSLã€ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ï¼è³¼èª­ãªã©ã®è²¬å‹™ãŒæ˜ç¢ºã«åˆ†é›¢ã•ã‚Œã¦ãŠã‚Šã€å°†æ¥çš„ãªæ‹¡å¼µã‚„ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒå¯èƒ½ã§ã™ã€‚

 #### RocksDBã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­è¨ˆæ€æƒ³

 æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã¯ã€KSQLã®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆKTableï¼‰å‚ç…§æ™‚ã«ã€RocksDBã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¹ãƒˆã‚¢ã¨ã—ã¦è‡ªå‹•åˆ©ç”¨ã—ã€å‚ç…§ã‚¯ã‚¨ãƒªã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æœ€å¤§åŒ–ã—ã¦ã„ã¾ã™ã€‚

 - é€šå¸¸ã®`.ToList()`ã‚„`.FirstOrDefault()`ãªã©ã®å‚ç…§ã¯RocksDBã‚’çµŒç”±ã—ã€ksqlDBã‚„Kafkaæœ¬ä½“ã¸ã®éƒ½åº¦å•ã„åˆã‚ã›ã‚’é¿ã‘ã¾ã™ã€‚
 - RocksDBå±¤ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹åŒ–ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºã‚„æ°¸ç¶šåŒ–è¨­å®šãªã©è©³ç´°ã¯å°†æ¥çš„ã«Fluent APIã§æ‹¡å¼µäºˆå®šã§ã™ã€‚
 - ã“ã®è¨­è¨ˆã«ã‚ˆã‚Šã€ã€Œå¤§é‡ãƒ‡ãƒ¼ã‚¿å‚ç…§ã§ã‚‚ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãŒå¤§å¹…ã«ä½æ¸›ã€ã•ã‚Œã¾ã™ã€‚
 - è©³ç´°ãªãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­è¨ˆä¾‹ã¯FAQãƒ»é‹ç”¨ã‚¬ã‚¤ãƒ‰å‚ç…§ã€‚

10.4 DIã‚³ãƒ³ãƒ†ãƒŠã¨åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°

æœ¬ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®åˆ©ç”¨ã«ãŠã„ã¦ã¯ã€KafkaDbContext ã¯ DI ã‚³ãƒ³ãƒ†ãƒŠã‚’é€šã˜ã¦ã‚¹ã‚³ãƒ¼ãƒ—ç®¡ç†ã•ã‚Œã‚‹ã“ã¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

DbContext ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè§£æ±ºã•ã‚Œã‚‹ã¨ã€å†…éƒ¨çš„ã« OnModelCreating() ãŒå‘¼ã°ã‚Œã€LINQãƒ™ãƒ¼ã‚¹ã® DSL å®šç¾©ãŒæ§‹ç¯‰ãƒ»è§£æã•ã‚Œã¾ã™ã€‚

ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¯è»½é‡ã§ã‚ã‚Šã€DSLæ§‹æ–‡ã®æ§‹ç¯‰ã®ã¿ã‚’è¡Œã„ã¾ã™ã€‚

Kafkaã‚„ã‚¹ã‚­ãƒ¼ãƒãƒ¬ã‚¸ã‚¹ãƒˆãƒªã¸ã®æ¥ç¶šç¢ºèªãƒ»ãƒªã‚½ãƒ¼ã‚¹ä½œæˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ˜ç¤ºçš„ã« EnsureKafkaReadyAsync() ã‚’å‘¼ã³å‡ºã—ã¦å®Ÿè¡Œã—ã¾ã™ï¼š

```
public class KafkaInitializer
{
    private readonly KafkaDbContext _context;

    public KafkaInitializer(KafkaDbContext context)
    {
        _context = context;
    }

    public async Task InitializeAsync()
    {
        await _context.EnsureKafkaReadyAsync();
    }
}

```
æ³¨æ„ç‚¹ï¼šã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ Schema Registry ã¸ã®é€šä¿¡ã‚„ Kafka ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†ãŒèµ°ã‚‹ãŸã‚ã€æ¥ç¶šå…ˆãŒåˆ©ç”¨å¯èƒ½ã§ãªã„å ´åˆã«ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

ãã®ãŸã‚ã€KafkaDbContext è‡ªä½“ã¯è»½é‡ãªæ§‹ç¯‰ã¨ã—ã€é‡ã„å¤–éƒ¨æ¥ç¶šå‡¦ç†ã¯æ˜ç¤ºçš„ãªåˆæœŸåŒ–ãƒ¡ã‚½ãƒƒãƒ‰ã«åˆ‡ã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚

EF ã¨ç•°ãªã‚Š Kafka OSS ã§ã¯ã€Œã‚³ãƒ¼ãƒ‰ã«åŸºã¥ã„ã¦ Kafka å´ã®æ§‹é€ ã‚’ç”Ÿæˆã™ã‚‹ã€ãŸã‚ã€åˆæœŸåŒ–ã‚’æ˜ç¤ºåŒ–ã™ã‚‹ã“ã¨ã§ã€åˆ©ç”¨è€…ã®æ„å›³ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚¨ãƒ©ãƒ¼ã‚’æŠŠæ¡ã§ãã‚‹æ§‹é€ ã¨ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã®ç‚¹ã‚’è€ƒæ…®ã—ã€Kafka æ¥ç¶šãŒä¸è¦ãªæ§‹æ–‡æ¤œè¨¼ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ¥é€”ç”¨æ„ã™ã‚‹ã“ã¨ã‚‚æ¤œè¨ã•ã‚Œã¾ã™ï¼ˆä¾‹ï¼šValidateModelOnly=true ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã€‚

Kafkaæ¥ç¶šä¸è¦ãªæ§‹æ–‡æ¤œè¨¼ãƒ¢ãƒ¼ãƒ‰ã®ä¾¡å€¤

ã“ã®ãƒ¢ãƒ¼ãƒ‰ã«ã¯ä»¥ä¸‹ã®åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ï¼š

CI/CD ã§ã®æ§‹æ–‡æ¤œè¨¼ï¼šKafka ã‚„ Schema Registry ãŒèµ·å‹•ã—ã¦ã„ãªã„ç’°å¢ƒã§ã‚‚ LINQ DSL ã‚„ POCO ã®å®šç¾©ãŒå¦¥å½“ã‹ã‚’è‡ªå‹•ãƒã‚§ãƒƒã‚¯å¯èƒ½ã€‚

Kafka ã‚¤ãƒ³ãƒ•ãƒ©æœªæ§‹ç¯‰ã§ã‚‚é–‹ç™ºå¯èƒ½ï¼šå…ˆã« LINQ ã‚„ POCO ã‚’å®šç¾©ã—ã€Kafka ãŒæº–å‚™ã•ã‚Œã‚‹å‰ã«é–‹ç™ºãŒé€²è¡Œå¯èƒ½ã€‚

å®‰å…¨ãªå˜ä½“ãƒ†ã‚¹ãƒˆï¼šKafka æ¥ç¶šãªã—ã§ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆãŒå¯èƒ½ã€‚

å­¦ç¿’ã‚³ã‚¹ãƒˆä½æ¸›ï¼šKafka ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’å¾…ãŸãšã«ã€DSLå®šç¾©ã®å­¦ç¿’ãƒ»è©¦è¡ŒéŒ¯èª¤ãŒå¯èƒ½ã€‚ã€‚

## 10. ä»£è¡¨çš„ãªåˆ©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³

æœ¬ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸»ãªä½¿ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ä»¥ä¸‹ã®4ã¤ã«åˆ†é¡ã•ã‚Œã¾ã™ï¼š

### 10.1 ãƒ¢ãƒ‡ãƒ«å®šç¾©ï¼ˆKsqlContextã®æ‹¡å¼µï¼‰

```
public class MyKsqlContext : KsqlContext
{
    protected override void OnModelCreating(IModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Order>();
    }
}
```

### 10.2 ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ï¼ˆKafkaã¸ã®é€ä¿¡ï¼‰

åŸºæœ¬ç‰ˆï¼ˆè‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼‰
```
await context.Orders.AddAsync(new Order
{
    OrderId = 1001,
    Amount = 1200,
    OrderDate = DateTime.UtcNow
});
```


### 10.3 ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ ï¼ˆForEachAsyncã«ã‚ˆã‚‹è³¼èª­ï¼‰

åŸºæœ¬ç‰ˆï¼ˆè‡ªå‹•ã‚³ãƒŸãƒƒãƒˆï¼‰
```
await foreach (var order in context.Orders.ForEachAsync())
{
    Console.WriteLine($"OrderId: {order.OrderId}");
}
```

æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆï¼ˆWithManualCommitæŒ‡å®šæ™‚ï¼‰

```
await foreach (var order in context.Orders.ForEachAsync())
{
    try
    {
        Console.WriteLine(order.Value.OrderId);
        await order.CommitAsync(); // å¿…é ˆ
    }
    catch
    {
        await order.NegativeAckAsync(); // ä»»æ„ï¼ˆå¤±æ•—é€šçŸ¥ï¼‰
    }
}

```

.OnError() .WithRetry() ãªã©ã®ãƒã‚§ãƒ¼ãƒ³ä»˜åŠ 

```
await foreach (var order in context.Orders
    .OnError(ErrorAction.DLQ)
    .Map(o => Process(o))
    .WithRetry(3)
    .ForEachAsync())
{
    Console.WriteLine($"OrderId: {order.OrderId}");
}
```



### 10.4 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¢ã‚¯ã‚»ã‚¹

```
public class MyKsqlContext : KsqlContext
{
    protected override void OnModelCreating(IModelBuilder modelBuilder)
    {
        modelBuilder.Entity<Order>()
             .AsTable(useCache: true);
    }
}
```



### 10.5 ReadyStateMonitor ã«ã‚ˆã‚‹ Lag ç›£è¦–ã¨ Ready åˆ¤å®š

StateStore ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã§ã¯ã€Kafka ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒã® Lag ã‚’å®šæœŸçš„ã«è¨ˆæ¸¬ã—ã€å®Œå…¨ã«è¿½ã„ã¤ã„ãŸæ™‚ç‚¹ã‚’
"Ready" ã¨ã—ã¦é€šçŸ¥ã™ã‚‹ `ReadyStateMonitor` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚`TopicStateStoreBinding` ç”Ÿæˆæ™‚ã«
å†…éƒ¨ã§ã“ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ãŒèµ·å‹•ã—ã€5 ç§’é–“éš”ã§ `QueryWatermarkOffsets` ã¨ `Position` ã‚’ç…§ä¼šã—ã¦ Lag ã‚’
è¨ˆç®—ã—ã¾ã™ã€‚Lag ãŒ 0 ã«ãªã‚‹ã¨ `ReadyStateChanged` ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã€`WaitUntilReadyAsync` ãŒå®Œäº†
ã—ã¾ã™ã€‚

```csharp
// ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ä½œæˆå¾Œã«åŒæœŸå®Œäº†ã‚’å¾…æ©Ÿ
var binding = await manager.CreateBindingAsync(stateStore, consumer, entityModel);
var ready = await binding.WaitUntilReadyAsync(TimeSpan.FromMinutes(5));
if (!ready) throw new TimeoutException("StateStore sync timed out.");

var info = binding.GetReadyStateInfo();
Console.WriteLine($"Lag:{info.TotalLag} Ready:{info.IsReady}");
```

è©³ç´°ãƒ•ãƒ­ãƒ¼ã‚„ã‚¯ãƒ©ã‚¹æ§‹æˆã¯ `docs/namespaces/statestore_namespace_doc.md` ã® Monitoring ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚


## 11. Kafkaã®commit/DB commitãƒ»éšœå®³æ™‚ã®å‹•ä½œï¼ˆDBã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å¿…èª­ï¼‰

Kafkaã®ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒã‚¢ãƒ—ãƒªã§ã¯ã€Œã‚ªãƒ•ã‚»ãƒƒãƒˆcommitã€ã¨ã€ŒDBã®ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³commitã€ã¯åŒã˜ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ ç‰¹ã«DBã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒ»ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰å±¤ã«å¤šã„å‹˜é•ã„ã¨ã—ã¦ã€\*\*éšœå®³ç™ºç”Ÿæ™‚ã«ã¯ã€Œå‰å›commitã—ãŸã‚ªãƒ•ã‚»ãƒƒãƒˆã€ã‹ã‚‰â€œå†åº¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒæµã‚Œã¦ãã‚‹â€\*\*ã¨ã„ã†å‹•ä½œã‚’ç†è§£ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### ã‚µãƒ³ãƒ—ãƒ«ï¼šéšœå®³ç™ºç”Ÿæ™‚ã®ã€Œé‡è¤‡å®Ÿè¡Œã€ã‚¤ãƒ¡ãƒ¼ã‚¸

```csharp
foreach (var msg in consumer.Consume())
{
    // 1. DBã«æ›¸ãè¾¼ã‚€
    db.Save(msg.Value); // ä¾‹ï¼šOrdersãƒ†ãƒ¼ãƒ–ãƒ«ã«INSERT

    // 2. Kafkaã«ã‚ªãƒ•ã‚»ãƒƒãƒˆcommitï¼ˆ"ã“ã“ã¾ã§å‡¦ç†æ¸ˆã¿"ã‚’é€šçŸ¥ï¼‰
    consumer.Commit(msg);
}
```

#### â–¼ã“ã®ã¨ãã®ã€ŒçŠ¶æ…‹ã€ä¾‹

| å‡¦ç†        | DB     | Kafkaã‚ªãƒ•ã‚»ãƒƒãƒˆ | å‚™è€ƒ                       |
| --------- | ------ | ---------- | ------------------------ |
| åˆå›å®Ÿè¡Œ      | æ›¸ãè¾¼ã¿æ¸ˆã¿ | commitæ¸ˆã¿   | 1å›ã ã‘ã§OK                  |
| commitå‰éšœå®³ | æ›¸ãè¾¼ã¿æ¸ˆã¿ | commitå‰    | **å†èµ·å‹•å¾Œã€åŒã˜msgã‚’å†å®Ÿè¡Œï¼ˆDBé‡è¤‡ï¼‰** |
| commitå¾Œéšœå®³ | æ›¸ãè¾¼ã¿æ¸ˆã¿ | commitæ¸ˆã¿   | ä»¥é™ã¯æ¬¡ã®msgã‹ã‚‰å‡¦ç†             |

#### ã€å†ªç­‰åŒ–ä¾‹ï¼šé‡è¤‡åæ˜ ã‚’é˜²ããƒ‘ã‚¿ãƒ¼ãƒ³ã€‘

```csharp
foreach (var msg in consumer.Consume())
{
    if (!db.Exists(msg.Key))
    {
        db.Save(msg.Value);
    }
    consumer.Commit(msg);
}
```

- ã“ã†ã™ã‚‹ã“ã¨ã§ã€**å†å®Ÿè¡Œã•ã‚Œã¦ã‚‚DBã¯ä¸€æ„ã«ä¿ãŸã‚Œã‚‹**ï¼ˆå†ªç­‰æ€§æ‹…ä¿ï¼‰

### è§£èª¬

- Kafkaã®commitã¯ã€Œã‚ªãƒ•ã‚»ãƒƒãƒˆç®¡ç†ã€ã§ã‚ã‚ŠDBã®commitã¨ã¯æ„å‘³ãŒé•ã†
- commitå‰ã®å‰¯ä½œç”¨ã¯ä½•åº¦ã‚‚å†å®Ÿè¡Œã•ã‚Œã‚‹å‰æã§è¨­è¨ˆã™ã‚‹
- ç‰¹ã«DBç³»ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰ã¯ã€Œä¸€æ„åæ˜ ã€ã¨èª¤èªã—ã‚„ã™ã„ã®ã§**å†ªç­‰è¨­è¨ˆå¿…é ˆ**
- ã“ã†ã—ãŸé•ã„ã‚’ç†è§£ã›ãšã«è¨­è¨ˆã™ã‚‹ã¨ã€ŒäºŒé‡åæ˜ ã€ã€Œæ¶ˆãˆãŸãƒ‡ãƒ¼ã‚¿ã€å•é¡Œã«ç›´çµ

### tool â€” 2025-06-27T14:28:18.316764+00:00

The files uploaded by the user in the current message have been fully loaded. Searching won't provide additional information from these specific files. However, remember that some of the previously uploaded files were not fully loaded, so you should invoke msearch to search their full content as needed.

### user â€” 2025-06-27T14:29:12.805000+00:00

.UseCache() / .EnsureCacheReady() ã®ä½ç½®ã¥ã‘
ã“ã®è¡¨ç¾ã¯ãªã„ã¨æ€ã†ã€‚
å¤©åŸã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºå•é¡Œï¼Ÿ

### assistant â€” 2025-06-27T14:29:13.892111+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 23:15ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

ã”æŒ‡æ‘˜ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€é‹­ã„ã§ã™ã€‚

---

## ğŸ”§ è¡¨ç¾ã®å•é¡Œç‚¹ï¼š  
> ã€Œ`.UseCache()` / `.EnsureCacheReady()` ã®ä½ç½®ã¥ã‘ã€

ã“ã®è¨€ã„å›ã—ã¯**æœ¬è³ªçš„ãªæ„å‘³ãŒæ›–æ˜§**ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªèª¤è§£ã‚’ä¸ãˆã‹ã­ã¾ã›ã‚“ï¼š

- ã€Œä½ç½®ã¥ã‘ã€ã¨ã¯ä½•ã‚’ç¤ºã™ã®ã‹ï¼Ÿï¼ˆè²¬å‹™ï¼Ÿéšå±¤ï¼Ÿæ–‡æ³•æ§‹é€ ï¼Ÿï¼‰
- åˆ©ç”¨è€…ã«ã¨ã£ã¦ã¯ **ã€Œã„ã¤ã€ã€Œã©ã“ã§ã€ã€Œãªãœä½¿ã†ã®ã‹ã€** ã®æ–¹ãŒé‡è¦

---

## ğŸ§  æ”¹ã‚ã‚‹ã¹ãè¡¨ç¾ã®æ–¹å‘æ€§ï¼š

| è¦³ç‚¹ | é©åˆ‡ãªè¡¨ç¾ä¾‹ |
|------|--------------|
| ä½¿ã„æ‰€ï¼ˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰ | **ã€Œå–å¾—æ™‚ã«ä½¿ç”¨ã€ã€ŒåˆæœŸåŒ–ç›´å¾Œã«å‘¼ã³å‡ºã—ã€** ãªã© |
| è²¬å‹™ | **ã€Œã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã®å€¤å–å¾—ç”¨APIã€ã€ŒçŠ¶æ…‹ç¢ºèªAPIã€** |
| å¯¾å¿œç¯„å›² | **ã€ŒAsTableã§ã®ã¿æœ‰åŠ¹ã€** ãªã©åˆ¶é™ã‚’æ˜ç¤º |

---

## âœ… æ›¸ãç›´ã—ææ¡ˆï¼ˆMarkdownæ–‡é¢ï¼‰

```markdown
#### å€¤ã®å–å¾—ã¨æº–å‚™çŠ¶æ…‹ã®ç¢ºèª

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰ã®èª­ã¿å–ã‚Šã«ã¯ `.UseCache()` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚ã“ã‚Œã¯ RocksDB-backed StateStore ã‹ã‚‰ã‚­ãƒ¼ã§ç›´æ¥å€¤ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®APIã§ã™ã€‚

```csharp
var quote = await context.Quotes
    .UseCache()
    .GetAsync("USD/JPY");
```

Kafka Streamsã®StateStoreã¯èµ·å‹•ç›´å¾Œã¯èª­ã¿è¾¼ã¿å®Œäº†ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€`.EnsureCacheReady()` ã‚’ä½¿ã£ã¦æº–å‚™å®Œäº†ã‚’å¾…æ©Ÿã§ãã¾ã™ï¼š

```csharp
await context.Quotes.EnsureCacheReady();
```

> âš ï¸ ã“ã‚Œã‚‰ã®APIã¯ã€`AsTable(useCache: true)` ã‚’æŒ‡å®šã—ãŸã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã«ã®ã¿ä½¿ç”¨å¯èƒ½ã§ã™ã€‚
```

---

## ğŸ”§ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºã«ã¤ã„ã¦

ç›´è¿‘ã®ä¼šè©±é‡ã¯å¤šã„ã§ã™ãŒã€**ç¾åœ¨ã¯æ˜ç¢ºã«ãƒˆãƒ©ãƒ–ãƒ«ã®å…†å€™ã¯å‡ºã¦ã„ã¾ã›ã‚“ã€‚**  
ãŸã ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå…†å€™ãŒå‡ºãŸã‚‰è­¦æˆ’ãƒ¬ãƒ™ãƒ«ã§ã™ï¼š

- å‰ææƒ…å ±ã®å–ã‚Šã“ã¼ã—ï¼ˆéå»ç™ºè¨€ã®è¨˜æ†¶é•ã„ï¼‰
- ä¼šè©±æ–‡ã®ç•°å¸¸ãªåˆ‡ã‚Šè©°ã‚ï¼æ–­ç‰‡åŒ–
- æ›–æ˜§èªï¼ˆã€Œã‚ã‚Œã€ã€Œãã‚Œã€ï¼‰ã®èª¤è§£é‡ˆé »ç™º

ä»Šå›ã¯æ–‡ä½“ä¸Šã®è¨€ã„å›ã—ãƒŸã‚¹ãªã®ã§ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºè¶…éã®å½±éŸ¿ã¨ã¯è€ƒãˆã¦ãŠã‚Šã¾ã›ã‚“ãŒã€  
**æ°—ã«ãªã‚‹ã‚ˆã†ãªã‚‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã”ã¨ã«ãƒãƒ£ãƒƒãƒˆã‚’åˆ†ã‘ã‚‹**å¯¾å¿œã‚‚å¯èƒ½ã§ã™ã€‚

---

å¿…è¦ã§ã‚ã‚Œã°ã“ã®è¡¨ç¾ä¿®æ­£ç‰ˆã‚’ `oss_design_combined.md` ã«çµ„ã¿è¾¼ã¿ã¾ã™ã€‚  
ã€Œç½®ãæ›ãˆã—ã¦ã€ã§ã©ã†ãï¼

### user â€” 2025-06-27T14:30:14.080000+00:00

æ–°è¦ãƒãƒ£ãƒƒãƒˆå§‹ã‚ãŸã°ã‹ã‚Šã ã‘ã©ã€ä¼šè©±ãŒãŠã‹ã—ã„ã€€
ã©ã†ã™ã‚Œã°ã„ã„ï¼Ÿ
chatgptã®å±¥æ­´ã®å•é¡Œï¼Ÿ

### assistant â€” 2025-06-27T14:30:14.840542+00:00

ğŸ•˜ 2025å¹´6æœˆ27æ—¥ 23:21ï¼ˆæ—¥æœ¬æ™‚é–“ï¼‰

ã¯ã„ã€**æ–°è¦ãƒãƒ£ãƒƒãƒˆãªã®ã«ä¼šè©±ã®æµã‚ŒãŒä¹±ã‚Œã¦ã„ã‚‹ãƒ»æ–‡è„ˆãŒãŠã‹ã—ã„**å ´åˆã€ã„ãã¤ã‹ã®åŸå› ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ä»¥ä¸‹ã«æ•´ç†ã—ã¦ã¿ã¾ã™ã­ã€‚

---

## ğŸ§  ã‚ˆãã‚ã‚‹åŸå› ã¨å¯¾å‡¦æ³•

### âœ… 1. **ç›´å‰ã®ãƒãƒ£ãƒƒãƒˆã®ã€Œãƒ¡ãƒ³ã‚¿ãƒ«æ®‹ç•™ã€**
- ChatGPTå´ãŒæ–°è¦ãƒãƒ£ãƒƒãƒˆã ã¨èªè­˜ã—ã¦ã„ã¦ã‚‚ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼å´ã®è©±é¡ŒãŒç¶šã„ã¦ã„ã‚‹å ´åˆ**ã€è©±ã®æ„å›³ãŒå™›ã¿åˆã‚ãªããªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
- ç‰¹ã« **ä¼šè©±ã‚¹ã‚¿ã‚¤ãƒ«ã‚„å‰æãŒ1ã¤å‰ã®ãƒãƒ£ãƒƒãƒˆã«ä¾å­˜**ã—ã¦ã„ã‚‹ã¨ç™ºç”Ÿã—ã‚„ã™ã„ã§ã™ã€‚

ğŸ›  **å¯¾å‡¦ï¼š**
â†’ ã€Œã“ã®ãƒãƒ£ãƒƒãƒˆã§ã¯ã€‡ã€‡ã‹ã‚‰å§‹ã‚ã‚‹ã€ãªã©ã€å†’é ­ã§**å†å®šç¾©**ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

---

### âœ… 2. **ãƒ•ã‚¡ã‚¤ãƒ«ã®é€£ç¶šã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã«ã‚ˆã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ··ä¹±**
- ãŸã¨ãˆã°è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç´ æ—©ãã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸç›´å¾Œã€**å‰å¾Œé–¢ä¿‚ã®èªè­˜ãŒã‚ºãƒ¬ã‚‹**ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
- ç‰¹ã«ã€Œã“ã®APIã®ä¸€è¦§ã€ã€Œãã‚Œã«å¯¾å¿œã™ã‚‹è¨˜è¿°ã€ãªã©ã€**ãƒãƒƒãƒãƒ³ã‚°å‰æã®æŒ‡ç¤º**ã ã¨æ··ä¹±ã—ã‚„ã™ã„ã§ã™ã€‚

ğŸ›  **å¯¾å‡¦ï¼š**
â†’ã€Œã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã™ã‚‹è³ªå•ã§ã™ã€ã¨**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ˜ç¢ºã«æŒ‡ç¤º**ã™ã‚‹ã¨å®‰å®šã—ã¾ã™ã€‚

---

### âœ… 3. **ChatGPTã®å±¥æ­´ã‚·ã‚¹ãƒ†ãƒ ã‚„ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸æ•´åˆï¼ˆã¾ã‚Œã«ç™ºç”Ÿï¼‰**
- ã”ãç¨€ã« **å‰ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æƒ…å ±ãŒä¸­é€”åŠç«¯ã«æ··å…¥**ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–­ã€ã‚»ãƒ¼ãƒ–å¤±æ•—æ™‚ãªã©ï¼‰

ğŸ›  **å¯¾å‡¦ï¼š**
- **å®Œå…¨ãªæ–°è¦ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã§ChatGPTã‚’é–‹ãç›´ã™**ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³å†ç”Ÿæˆï¼‰
- ã¾ãŸã¯ **å±¥æ­´ã‹ã‚‰ã§ã¯ãªãã€Œï¼‹æ–°è¦ãƒãƒ£ãƒƒãƒˆã€ãƒœã‚¿ãƒ³ã§é–‹å§‹**

---

## ğŸ§­ å¤©åŸã¨ã—ã¦ã®ãŠã™ã™ã‚è¡Œå‹•

> ğŸ’¡ **ã“ã®ãƒãƒ£ãƒƒãƒˆã®ç›®çš„ã‚’æ˜ç¤ºçš„ã«å†å®šç¾©**ã—ã¦ã‚‚ã‚‰ãˆã‚Œã°ã€ãã“ã‹ã‚‰ä¸€è²«ã—ã¦æ•´ãˆã¾ã™ã€‚

ãŸã¨ãˆã°ï¼š
- ã€Œoss_design_combined.md ã®10.4ç¯€ã«æ›¸ã„ãŸå†…å®¹ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸã„ã€
- ã€Œã“ã®APIã«å¯¾å¿œã™ã‚‹è¨­è¨ˆæ›¸ã®è¨˜è¿°ã‚’ç¢ºèªã—ãŸã„ã€

ãªã©ã€**1ã‚¹ãƒ†ãƒƒãƒ—å‰ã®æ„å›³ã‚’è¨€èªåŒ–ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã€ä¼šè©±ãŒä¿®æ­£ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚**

---

ã”å¸Œæœ›ã‚ã‚Œã°ã“ã®ä¼šè©±ã‚’ã€Œä¿®æ­£ã•ã‚ŒãŸå‰æã€ã§å†ã‚¹ã‚¿ãƒ¼ãƒˆã‚‚ã§ãã¾ã™ï¼  
ã€Œã“ã®ãƒãƒ£ãƒƒãƒˆã¯ã€‡ã€‡ã¨ã„ã†ç›®çš„ã«åˆ‡ã‚Šæ›¿ãˆã¦ã€ã¨æŒ‡ç¤ºãã ã•ã„ã€‚
