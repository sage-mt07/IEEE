---
conversation_id: "6723426b-18f4-8007-9660-003b2660c51d"
title: "QUICKFIXN 接続エラー取得方法"
create_time: 1730364011.243021
update_time: 1730364174.329782
language_guess: "en"
num_messages: 9
part_index: 1
part_count: 1
---

### system — 2024-10-31T08:40:11.243021+00:00

_(empty)_

### user — 2024-10-31T08:40:11.247244+00:00

QUICKFIXNを使用している相手サーバへの接続エラーを取得する方法

### assistant — 2024-10-31T08:40:31.349084+00:00

_(empty)_

### assistant — 2024-10-31T08:40:31.349215+00:00

QUICKFIX/Nで相手サーバへの接続エラーを取得するには、通常、セッション設定やログの設定を活用します。以下の手順で接続エラーの取得や調査が可能です。

1. **ログレベルの設定**:
   `quickfix.properties`や`config.cfg`などの設定ファイルで、ログレベルを詳細に設定できます。`FileLogPath`などの設定でログの保存場所を指定し、接続エラーに関する情報をファイルに記録します。

2. **イベントリスナーの利用**:
   `SessionID`と関連付けてイベントハンドラ（例: `OnLogon`, `OnLogout`, `OnMessage` など）を実装し、接続エラー発生時の処理を設定できます。例えば、`OnLogout`イベント内でログアウトや接続エラーが発生した際に通知を行うことで、エラーをリアルタイムにキャッチできます。

3. **エラーハンドリング**:
   `Log`クラスやカスタムログ機能を使って、例外やエラーのメッセージをキャッチすることが可能です。特に、`quickfix.SocketInitiator`や`quickfix.SocketAcceptor`に関連するエラー情報を収集することで、接続が確立できない場合の原因を特定しやすくなります。

4. **例外処理の実装**:
   接続エラーに関する例外（例えば、`IOException`, `SessionNotFound`など）をキャッチし、ログに記録するか、アラートを発生させることで、接続に関する詳細なエラーメッセージを把握できます。

QUICKFIX/Nのログ設定とハンドリング機能を組み合わせて、接続エラーの発生を迅速に検知し、対処することが可能です。

### user — 2024-10-31T08:41:42.243254+00:00

接続先がいなくともOnCreateは呼ばれるのでは

### assistant — 2024-10-31T08:41:55.076717+00:00

はい、その通りです。`OnCreate`は、接続先の有無にかかわらずセッションが作成されるタイミングで呼び出されます。そのため、接続先サーバが応答していない、もしくは接続に失敗している場合でも、`OnCreate`は呼ばれます。

実際に接続が成功したかどうかは、`OnLogon`イベントで確認できます。`OnLogon`はサーバと正常に接続が確立され、ログインプロセスが成功した際にのみ呼ばれるため、これを利用すると接続の成否を確実に把握できます。

接続失敗の場合は、`OnLogout`が呼ばれることもあります。ログインが確立されないままタイムアウトや接続エラーが発生した際に`OnLogout`が発生する場合もあるため、`OnLogon`および`OnLogout`の両方を監視すると、接続状況をより正確にモニタリングできます。

### user — 2024-10-31T08:42:41.025534+00:00

OnCreateからOnLogonの時間差でエラー判断するのか

### assistant — 2024-10-31T08:42:53.492437+00:00

はい、`OnCreate`から`OnLogon`までの時間差を利用してエラーを判断する方法も一つのアプローチです。具体的には、以下のような手順で接続エラーを判定できます。

1. **タイムアウトを設定する**:
   `OnCreate`が呼ばれた後、一定の時間内に`OnLogon`が呼ばれなければ接続エラーと判断します。このために、例えば`System.Timers.Timer`などを使用して、`OnCreate`からの経過時間を監視できます。

2. **時間内にOnLogonが呼ばれなかった場合の処理**:
   タイマーがタイムアウトした際に、接続が確立されなかったと判断し、エラーログを出力する、再接続を試みる、または通知を行う処理を実行します。

3. **OnLogonが呼ばれた際の処理**:
   `OnLogon`が呼ばれたら、タイマーを停止して接続が成功したことを確認します。こうすることで、実際に接続が確立されたことを把握できます。

この方法は、例えばサーバ側がダウンしている、またはネットワーク障害で接続できないなどのケースで役立ちます。
