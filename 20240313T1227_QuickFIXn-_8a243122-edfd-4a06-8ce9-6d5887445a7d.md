---
conversation_id: "8a243122-edfd-4a06-8ce9-6d5887445a7d"
title: "QuickFIX/n メモリストア"
create_time: 1710332877.424788
update_time: 1710416568.780158
language_guess: "en"
num_messages: 8
part_index: 1
part_count: 1
---

### system — 2024-03-13T12:27:57.424788+00:00

_(empty)_

### user — 2024-03-13T12:27:57.425400+00:00

C#でquickfixnを使用しsession情報をfilestoreではなく、memorystoreにする方法

### assistant — 2024-03-13T12:28:46.734440+00:00

QuickFIX/nは、金融取引メッセージングプロトコルであるFIX(Financial Information eXchange)の.NET実装です。QuickFIX/nはセッション状態を管理するために、デフォルトでFileStoreを使用しますが、メモリ上でセッション情報を保持するMemoryStoreを使用することも可能です。

MemoryStoreを使用するには、QuickFIX/nの設定ファイルで`FileStorePath`の代わりに`UseMemoryStore`を`Y`に設定します。以下にその設定の一例を示します。

```
[DEFAULT]
ConnectionType=initiator
ReconnectInterval=2
FileLogPath=log
StartTime=00:00:00
EndTime=00:00:00
HeartBtInt=30
SocketConnectHost=127.0.0.1
SocketConnectPort=5001
UseMemoryStore=Y
```

ここでは、`UseMemoryStore`を`Y`に設定することで、QuickFIX/nがMemoryStoreを使用してセッション状態をメモリ上に保持するよう指示しています。`FileStorePath`の設定は不要です。

プログラム的にMemoryStoreを使用するには、セッション設定を構築する際にMemoryStoreFactoryを指定する必要があります。以下はC#での実装例です。

```csharp
var settings = new SessionSettings("yourConfigFilePath");
var application = new YourApplication(); // Your FIX application implementation
var messageStoreFactory = new MemoryStoreFactory();
var logFactory = new FileLogFactory(settings);
var messageFactory = new DefaultMessageFactory();

var initiator = new SocketInitiator(application, messageStoreFactory, settings, logFactory, messageFactory);

initiator.Start();
```

ここで、`MemoryStoreFactory`はセッションの状態をメモリ上で管理するために使用されます。`FileLogFactory`はログ出力にファイルを使用しますが、セッション情報の保持には`MemoryStoreFactory`が使用されます。

以上の設定やコード例を参考に、QuickFIX/nでMemoryStoreを使用するように設定してください。

### user — 2024-03-14T11:40:26.952145+00:00

接続が切れた場合の再接続は自動で行う設定

### assistant — 2024-03-14T11:41:06.346857+00:00

QuickFIX/nでは、接続が切れた場合に自動で再接続を試みる設定が可能です。これを実現するためには、設定ファイルで`ReconnectInterval`パラメータを設定します。このパラメータは接続が失われた後、再接続を試みるまでの時間間隔（秒）を指定します。

例えば、5秒ごとに再接続を試みるように設定するには、設定ファイルに以下のように記述します：

```
[DEFAULT]
ReconnectInterval=5
```

この設定は、セッションが切断された後、5秒ごとに再接続を試みるようにQuickFIX/nに指示します。

再接続の動作は、`SocketInitiator`や`SocketAcceptor`での接続タイプ（initiatorまたはacceptor）によって自動で管理されます。initiator設定の場合、QuickFIX/nは指定された`ReconnectInterval`の間隔でサーバーへの再接続を試みます。

また、再接続の試みは無限に続きますが、アプリケーションの要件に応じて、特定の条件下で再接続の試みを停止するロジックを実装することも可能です。しかし、QuickFIX/n自体の設定を通じて再接続の試みを制限する直接的な方法は提供されていません。

以上の設定を適用することで、接続が失われた場合にQuickFIX/nが自動で再接続を試みるようになります。

### user — 2024-03-14T11:41:47.683909+00:00

Logout後に自動でログインする設定

### assistant — 2024-03-14T11:42:48.692699+00:00

QuickFIX/nにおいて、ログアウト後に自動でログインする機能を設定する直接的な方法はありません。これは、FIXプロトコルのセッション管理において、ログアウトは通常、セッションの終了を意味し、自動再ログインの挙動はプロトコルレベルで想定されていないためです。

ただし、アプリケーション側で再接続ロジックを実装することで、この要件を満たすことが可能です。以下に、接続が切断された際（ログアウトを含む）に自動で再接続を試みる簡単な実装例を示します。

### ステップ 1: カスタムアプリケーションクラスの実装

QuickFIX/nでは、`IApplication`インターフェイスを実装したアプリケーションクラスを通じて、FIXメッセージの処理やセッションイベントのハンドリングを行います。ここで、`OnLogout`メソッドをオーバーライドして、ログアウトイベントが発生した際の再接続処理を追加します。

```csharp
public class MyApplication : QuickFix.IApplication
{
    // 他の必要なメソッドの実装...

    public override void OnLogout(SessionID sessionID)
    {
        // ログアウトイベント時の処理
        // 必要に応じて再接続のロジックをここに実装
    }

    // 再接続を試みるメソッド
    public void TryReconnect(SessionID sessionID)
    {
        // ここで再接続ロジックを実装
    }
}
```

### ステップ 2: 再接続のロジック実装

再接続の実際のロジックはアプリケーションの要件によって異なりますが、一般的には一定時間待機した後にセッションを再開する方法が考えられます。これを実現するには、例えばタイマーや別のスレッドを使用して、指定された時間が経過した後にセッションのログインプロセスを開始します。

```csharp
public void TryReconnect(SessionID sessionID)
{
    // 再接続のための待機時間 (例: 5秒)
    int waitTimeInSeconds = 5;
    System.Threading.Thread.Sleep(waitTimeInSeconds * 1000);

    // 指定されたセッションIDでログインプロセスを開始
    Session.LookupSession(sessionID).Logon();
}
```

### 注意点

- この方法は、セッションが意図的にログアウトされた場合、または接続が切断された場合に再接続を試みます。
- FIXサーバー側のポリシーと合わせて、自動再接続の試みが適切かどうかを検討する必要があります。サーバーによっては、短時間に何度も再接続を試みることが制限されている場合があります。

上記の実装例を参考に、自動でログインするロジックをカスタマイズしてみてください。
