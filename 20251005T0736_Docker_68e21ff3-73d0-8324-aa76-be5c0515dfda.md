---
conversation_id: "68e21ff3-73d0-8324-aa76-be5c0515dfda"
title: "Dockerエラー回避方法"
create_time: 1759649788.051271
update_time: 1759650415.423249
language_guess: "en"
num_messages: 14
part_index: 1
part_count: 1
---

### assistant — 2025-10-05T07:36:27.908771+00:00

_(empty)_

### assistant — 2025-10-05T07:36:27.919288+00:00

このエラー：

```
Error response from daemon: error while creating mount source path '/run/desktop/mnt/host/c/dev/ex2/experimental': mkdir /run/desktop/mnt/host/c: file exists
```

は、**Docker Desktop for Windows** の内部マウントパス生成処理が競合している（`/run/desktop/mnt/host/c` が「ディレクトリでなくファイル扱い」になっている）ことが原因です。  
つまり、**Docker がホスト側パスをマウントしようとしたが、すでに `/run/desktop/mnt/host/c` に同名のファイルが存在して作成できなかった**という状況です。

---

### 🔧 回避・修復方法（順に試す）

#### ✅ 方法1：Docker Desktopの再起動
いちばん簡単で効果が高い手順です。

1. すべてのコンテナを停止：
   ```bash
   docker compose down
   ```
2. Docker Desktop を完全終了 → 再起動。
3. 再度実行：
   ```bash
   docker compose up -d
   ```

多くの場合これで `/run/desktop/mnt/host/*` の仮想パスが再生成され、エラーが消えます。

---

#### ✅ 方法2：該当ファイルを削除して再マウント
Docker が内部で保持しているマウントキャッシュが壊れている場合に有効です。

1. PowerShell（管理者権限）で Docker VM にシェルアクセス：
   ```bash
   docker run -it --privileged --pid=host justincormack/nsenter1
   ```
2. 中で `/run/desktop/mnt/host/c` の状態を確認：
   ```bash
   ls -l /run/desktop/mnt/host/
   ```
3. `c` がファイル（`-rw-r--r--`など）であれば削除：
   ```bash
   rm /run/desktop/mnt/host/c
   mkdir /run/desktop/mnt/host/c
   exit
   ```
4. その後、再度 `docker compose up -d`。

---

#### ✅ 方法3：ボリューム・ネットワークを一度リセット
特定の Compose ネットワークやボリュームが残留している可能性もあります。

```bash
docker compose down -v
docker volume prune -f
docker network prune -f
```
その後再度 `docker compose up -d`。

---

#### ✅ 方法4：WSLの再起動（Windows環境限定）
WSLのマウント階層が不整合になっているケースも多いです。

```bash
wsl --shutdown
```
→ Docker Desktop再起動  
→ `docker compose up -d`

---

### 💡補足
この不具合は **Docker Desktop 4.28〜4.33系** で時々報告されています。  
再起動や WSL の再マウントでほぼ確実に直ります。  
再発防止としては、Docker Desktop の **設定 → Resources → File Sharing** に明示的に `C:\dev` を登録しておくと安定します。

---

🕓 **送信時刻：[[REDACTED_PHONE]]:58（日本時間）**

### system — 2025-10-05T07:36:28.051271+00:00

_(empty)_

### system — 2025-10-05T07:36:28.051271+00:00

_(empty)_

### system — 2025-10-05T07:36:28.123884+00:00

_(empty)_

### user — 2025-10-05T07:36:30.432000+00:00

C:\dev\ex2\experimental\physicalTests>docker compose up -d
[+] Running 7/8
 ✔ Network physicaltests_default            Created                                                                0.0s
 ✔ Volume "physicaltests_kafka_data"        Created                                                                0.0s
 ✔ Container physicaltests-zookeeper-1      Started                                                                0.8s
 ✔ Container physicaltests-kafka-1          Healthy                                                               12.5s
 ✔ Container schema-registry                Started                                                                1.2s
 ✔ Container physicaltests-ksqldb-server-1  Healthy                                                               26.8s
 ✔ Container physicaltests-ksqldb-cli-1     Started                                                               27.0s
 - Container physicaltests-runner-1         Starting                                                              27.0s
Error response from daemon: error while creating mount source path '/run/desktop/mnt/host/c/dev/ex2/experimental': mkdir /run/desktop/mnt/host/c: file exists
これの回避

### user — 2025-10-05T07:36:42.502400+00:00

_(empty)_

### user — 2025-10-05T07:38:44.740000+00:00

sh-5.2# ls -l /run/desktop/mnt/host/
ls: cannot access '/run/desktop/mnt/host/c': Input/output error
total 0
d????????? ? ?    ?      ?            ? c
drwxrwxrwt 4 root root 100 Oct  1 13:38 wsl
drwxrwxrwt 6 root root 280 Oct  1 13:38 wslg

### assistant — 2025-10-05T07:38:45.347061+00:00

司令、`/run/desktop/mnt/host/c` が **I/Oエラーで壊れた（9p/ファイル共有の不整合）** 状態です。安全に直す＆当面の回避の両方を書きます。

# まずは修復（最短手順）
1) 物理テスト環境を落とす
```powershell
docker compose down
```

2) **Docker Desktop を完全終了**（タスクトレイ→Quit Docker Desktop）

3) **WSL を全停止**
```powershell
wsl --shutdown
```

4) Docker Desktop を起動し直す  
起動後の健全性チェック：
```bash
docker run --rm alpine sh -lc "ls -ld /run/desktop/mnt/host/c"
```
→ `drwxr-xr-x` のように **通常のディレクトリ表示**になればOK。  
その後、
```powershell
docker compose up -d
```

> これで直らない場合は、ファイル共有の再交渉が必要です。

5) 共有フォルダの付け直し（再交渉）
- Docker Desktop → **Settings → Resources → File Sharing**  
  - いったん `C:\`（または該当パス）を**外す**→**Apply & Restart**  
  - 次に **`C:\dev` など必要最小限のフォルダだけ再追加**→**Apply & Restart**
- もう一度 `docker compose up -d`

# それでも直らない場合（深めの対処）
- **ネットワーク/ボリュームの掃除**
  ```bash
  docker compose down -v
  docker volume prune -f
  docker network prune -f
  ```
  → 再度 `docker compose up -d`

- **Dockerのファクトリーリセット**（最終手段）
  - Docker Desktop → **Troubleshoot → Reset to factory defaults**  
    ※ 画像/ボリューム等が消えるので注意（必要なら `docker save` でバックアップ）

# 当面の回避策（同事象の再発を避けつつ進める）
A) **相対パスの bind を使う**（Windows 絶対パス解決バグの回避）
```yaml
# docker-compose.yml（例）
services:
  runner:
    volumes:
      - type: bind
        source: .
        target: /work
```
PowerShell から `C:\dev\ex2\experimental\physicalTests>` で実行すれば `.` がそのフォルダに解決され、  
Docker 側の `/run/desktop/...` 生成を安定させられます。  
（※ もし `${PWD}` を使うなら、PowerShell では文字列化されるよう `"${PWD}"` と明示してください）

B) **WSL配下にプロジェクトを移して実行**
- 例：`\\wsl$\Ubuntu\home\<you>\ex2\experimental\physicalTests` に置き、Ubuntu シェルで `docker compose up -d`  
  → Windows⇄WSL の共有を通らず安定（9p/DrvFSを避けられる）

C) **named volume でコードを載せる**（bind を使わない）
```bash
docker volume create phys_code
docker run --rm -v phys_code:/work -v "$PWD":/src alpine sh -lc 'cp -a /src/. /work'
```
compose 側は `- phys_code:/work`（named volume）に変更。  
ホスト共有を使わないので `/run/desktop/...` に依存しません。

---

困ったら「今の compose の `volumes:` 設定」を貼ってください。最小変更で安定化する書き換えを一緒にやります。

——  
送信日時（日本時間）: [[REDACTED_PHONE]]:**（JST）**

### system — 2025-10-05T07:38:46.563175+00:00

_(empty)_

### system — 2025-10-05T07:38:46.569845+00:00

_(empty)_

### assistant — 2025-10-05T07:38:46.686546+00:00

_(empty)_

### assistant — 2025-10-05T07:39:11.288307+00:00

_(empty)_
