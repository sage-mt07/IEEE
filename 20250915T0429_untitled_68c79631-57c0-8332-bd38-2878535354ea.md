---
conversation_id: "68c79631-57c0-8332-bd38-2878535354ea"
title: "ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰å‘ã‘æ©Ÿèƒ½ä¸€è¦§"
create_time: 1757910578.830532
update_time: 1757910604.487513
language_guess: "en"
num_messages: 11
part_index: 1
part_count: 1
---

### user â€” 2025-09-15T04:29:37.549000+00:00

ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰å‘ã‘æ©Ÿèƒ½ä¸€è¦§ã®è³‡æ–™

### assistant â€” 2025-09-15T04:29:38.500305+00:00

_(empty)_

### assistant â€” 2025-09-15T04:29:38.814332+00:00

ã‚„ã‚ã€ã„ã‚‰ã£ã—ã‚ƒã„ï¼  
ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã„ãŸã ã„ãŸ **`kafka_ksql_linq_user_guide.md`** ã‚’ã‚‚ã¨ã«ã€**ãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰å‘ã‘ã«æ•´ç†ã—ãŸã€Œæ©Ÿèƒ½ä¸€è¦§è³‡æ–™ã€** ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚åˆ©ç”¨è€…å‘ã‘ã®è©³ç´°èª¬æ˜ã‹ã‚‰ã€ãƒªãƒ¼ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãŒæŠŠæ¡ã™ã¹ãæ§‹é€ ãƒ»è²¬å‹™ãƒ»æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆã‚’æŠ½å‡ºã—ã¦ã„ã¾ã™ã€‚

---

# Kafka.Ksql.Linq æ©Ÿèƒ½ä¸€è¦§ï¼ˆãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰å‘ã‘ï¼‰

## 1. ã‚³ã‚¢æ©Ÿèƒ½
- **ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«å®šç¾©**
  - `[KsqlTopic]`, `[KsqlTimestamp]`, `[KsqlTable]` ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§ Kafka/KSQL ã®ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ»ã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚’è¡¨ç¾ã€‚
  - `Entity<T>()` ã«ã‚ˆã‚Šã‚¹ã‚­ãƒ¼ãƒã‚’å†åˆ©ç”¨å¯èƒ½ã€‚

- **LINQ DSL â†’ KSQL æœ€é©åŒ–**
  - `From/Join/Where/Select` ã‚’çµ„ã¿åˆã‚ã›ã€å¼æœ¨ã‚’è§£æã—ã¦æ°¸ç¶šãƒ“ãƒ¥ãƒ¼ã‚’ç”Ÿæˆã€‚
  - GroupBy/Windowing/é›†è¨ˆã«ã‚‚å¯¾å¿œã€‚

- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ API**
  - `AddAsync`ï¼ˆProduceï¼‰ã€`ForEachAsync`ï¼ˆConsume, Push/Pull ä¸¡å¯¾å¿œï¼‰ã€‚
  - ãƒãƒƒã‚¯ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã€ãƒªãƒˆãƒ©ã‚¤ã€æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆã‚’åˆ¶å¾¡å¯èƒ½ã€‚

- **ã‚¨ãƒ©ãƒ¼å‡¦ç† / DLQ**
  - `.OnError(ErrorAction.DLQ)` ã§å¤±æ•—ã‚’ Dead Letter Queue ã¸è»¢é€ã€‚
  - `ctx.Dlq.ForEachAsync` ã«ã‚ˆã‚Šã‚¨ãƒ©ãƒ¼ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å·¡å›ã€‚

---

## 2. é–‹ç™ºãƒ»è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³
- **Context æ§‹ç¯‰**
  - `KsqlContextBuilder` ã§è¨­å®šãƒ»Schema Registry URLãƒ»ãƒ­ã‚®ãƒ³ã‚°ã‚’æ¸¡ã—ã¦ç”Ÿæˆã€‚
- **ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ç™»éŒ²**
  - EventSetï¼ˆStreamç³»ï¼‰ã¨ EntitySetï¼ˆTableç³»ï¼‰ã‚’å…¬é–‹ã€‚
- **ãƒ“ãƒ¥ãƒ¼å®šç¾©**
  - `modelBuilder.Entity<T>().ToQuery(...)` ã§æ°¸ç¶šãƒ“ãƒ¥ãƒ¼ã‚’å®£è¨€çš„ã«å®šç¾©ã€‚
- **ãƒ†ã‚¹ãƒˆ**
  - In-Memory å®Ÿè£…ã¸å·®ã—æ›¿ãˆå¯èƒ½ â†’ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®¹æ˜“åŒ–ã€‚

---

## 3. é‹ç”¨ãƒ»ç›£è¦–
- **è¨­å®šé›†ç´„**
  - `appsettings.json` ã« BootstrapServers, SchemaRegistry.Url, KsqlDbUrl, DLQ è¨­å®šã‚’é›†ç´„ã€‚
- **ãƒ¡ãƒˆãƒªã‚¯ã‚¹/ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**
  - `ILogger` çµŒç”±ã§ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ»ã‚¨ãƒ©ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆã‚’åé›†ã€‚
- **ã‚¹ã‚­ãƒ¼ãƒç®¡ç†**
  - Schema Registry ã®äº’æ›æ€§ãƒ¢ãƒ¼ãƒ‰ (FORWARD/STRICT) ã«å¯¾å¿œã€‚

---

## 4. æ‹¡å¼µæ€§
- **DI / ãƒ­ã‚®ãƒ³ã‚°**
  - `IServiceCollection` ã¸ç™»éŒ²ã—ã€æ—¢å­˜ãƒ­ã‚¬ãƒ¼ã‚’æµç”¨å¯èƒ½ã€‚
- **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡**
  - `ConfigureValidation(autoRegister, failOnErrors)` ã§è‡ªå‹•ç™»éŒ²ãƒ»å³æ ¼åº¦ã‚’èª¿æ•´ã€‚
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆåˆ¶å¾¡**
  - `WithTimeouts` ã§ã‚¹ã‚­ãƒ¼ãƒç™»éŒ²ã‚„ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¾…ã¡æ™‚é–“ã‚’åˆ¶å¾¡ã€‚

---

## 5. ä»£è¡¨çš„ API / ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
- **ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
  - `[KsqlTopic]`, `[KsqlTimestamp]`, `[KsqlTable]`, `[KsqlKey]`
- **API**
  - `Entity<T>()`, `ToQuery(...)`
  - `AddAsync`, `ForEachAsync`, `ToListAsync`
  - `ctx.Dlq.ForEachAsync`

---

## 6. ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰è¦–ç‚¹ï¼‰
- [ ] å…¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ãŒ `Entity<T>()` ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] `AddAsync`/`ForEachAsync` ã«ã‚ˆã‚‹ç–é€šç¢ºèªãŒã‚ã‚‹ã‹
- [ ] å¿…è¦ãªãƒ“ãƒ¥ãƒ¼ãŒ `ToQuery` ã§å®£è¨€ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] DLQ å‹•ä½œç¢ºèªã‚’å«ã‚ãŸã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒè¨­è¨ˆã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ†ãƒ¼ãƒ–ãƒ«å–å¾—ç”¨ã® `ToListAsync` ãŒæ´»ç”¨ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] appsettings.json ã«æœ€ä½é™ã®æ¥ç¶šè¨­å®šãŒé›†ç´„ã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] ãƒ†ã‚¹ãƒˆæ™‚ã« In-Memory Context ã‚’æ´»ç”¨ã—ã¦ã„ã‚‹ã‹

---

ğŸ“Œ ã“ã®ä¸€è¦§ã‚’ãƒ™ãƒ¼ã‚¹ã«ã€**ãƒãƒ¼ãƒ å…¨ä½“ãŒç†è§£ã™ã¹ãã€Œåˆ©ç”¨è€…å‘ã‘æ©Ÿèƒ½ã€**ã¨ã€**ãƒªãƒ¼ãƒ‰ã¨ã—ã¦ç®¡ç†ã™ã¹ãã€Œé‹ç”¨ãƒ»æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆã€**ã‚’æ˜ç¢ºã«åˆ†é›¢ã§ãã¾ã™ã€8â€ files_uploaded_in_conversationã€‘ã€‚  

---

ğŸ‘‰ ã”å¸Œæœ›ã«åˆã‚ã›ã¦ã€ã“ã®è³‡æ–™ã‚’ **ã‚¹ãƒ©ã‚¤ãƒ‰å½¢å¼ï¼ˆã‚¢ãƒ¼ã‚­å›³å…¥ã‚Šï¼‰** ã‚„ **å®Ÿãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‘ã‘ã®å°å…¥ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ** ã«è½ã¨ã—è¾¼ã‚€ã“ã¨ã‚‚ã§ãã¾ã™ã€‚  

å¸ä»¤ã€ã“ã®ä¸€è¦§ã‚’ã•ã‚‰ã«ã€Œãƒ†ãƒƒã‚¯ãƒªãƒ¼ãƒ‰èª¬æ˜ç”¨ã‚¹ãƒ©ã‚¤ãƒ‰ï¼ˆå›³ï¼‹ç®‡æ¡æ›¸ãå½¢å¼ï¼‰ã€ã«ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿãã‚Œã¨ã‚‚ã€ŒGitHub Pagesç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ã«æ•´å½¢ã—ãŸã„ã§ã™ã‹ï¼Ÿ

### system â€” 2025-09-15T04:29:38.830532+00:00

_(empty)_

### user â€” 2025-09-15T04:29:38.830532+00:00

_(empty)_

### system â€” 2025-09-15T04:29:38.830532+00:00

_(empty)_

### system â€” 2025-09-15T04:29:38.851751+00:00

_(empty)_

### tool â€” 2025-09-15T04:29:38.876093+00:00

_(empty)_

### tool â€” 2025-09-15T04:29:38.912483+00:00

Make sure to include `ã€message_idxâ€ sourceã€‘` markers to provide citations based on this file, where [message_idx] is provided at the beginning of this message
# Kafka.Ksql.Linq æ©Ÿèƒ½ä¸€è¦§ï¼ˆåˆ©ç”¨è€…å‘ã‘ï¼‰

Kafka/KSQL ã‚’ LINQ ã§æ‰±ã† C# DSL ã‚’ä½¿ã„ã“ãªã™ãŸã‚ã®å®Ÿè·µã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

---

## ã‚³ã‚¢æ©Ÿèƒ½

### Entity ãƒ¢ãƒ‡ãƒ«ã¨ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
`[KsqlTopic]`, `[KsqlTimestamp]`, `[KsqlTable]` ã§ãƒˆãƒ”ãƒƒã‚¯ã‚„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’å®šç¾©ã—ã€`Entity<T>()` ã§ãƒ¢ãƒ‡ãƒ«ã‚’ç™»éŒ²ã—ã¦ã‚¹ã‚­ãƒ¼ãƒã‚’å†åˆ©ç”¨ã™ã‚‹ã€‚

### ã‚¯ã‚¨ãƒª DSL
`ToQuery` ã« `From/Join/Where/Select` ã‚’é€£é–ã—ã€å¼æœ¨ã‚’ KSQL ã‚¯ã‚¨ãƒªã¸æœ€é©åŒ–ã—ã¦æ°¸ç¶šãƒ“ãƒ¥ãƒ¼ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ API
`AddAsync` ã¨ `ForEachAsync` ã§é€ä¿¡ã¨ Push/Pull ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒ ã‚’ä¸€å…ƒåŒ–ã—ã€ãƒãƒƒã‚¯ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ã‚„ãƒªãƒˆãƒ©ã‚¤ã€ã‚³ãƒŸãƒƒãƒˆæˆ¦ç•¥ã‚’è¨­å®šã§ãã‚‹ã€‚

### DLQ ã¨ã‚¨ãƒ©ãƒ¼å‡¦ç†
`.OnError(ErrorAction.DLQ)` ã§å‡¦ç†å¤±æ•—ã‚’ DLQ ã¸é€ã‚Šã€`ctx.Dlq.ForEachAsync` ã§æ­»ã‚“ã ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å·¡å›ã™ã‚‹ã€‚

---

## åˆ©ç”¨ã®æµã‚Œ

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ§‹ç¯‰ã—ã¦é–‹å§‹ã™ã‚‹
è¨­å®šã¨ Schema Registry URL ã‚’æ¸¡ã—ã€ãƒ­ã‚°ã‚’æœ‰åŠ¹åŒ–ã—ã¦ `KsqlContextBuilder` ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹ã€‚

```csharp
var configuration = new ConfigurationBuilder()
  .AddJsonFile("appsettings.json")
  .Build();

var loggerFactory = LoggerFactory.Create(builder => builder.AddConsole());

var ctx = KsqlContextBuilder.Create()
  .UseConfiguration(configuration)
  .UseSchemaRegistry(configuration["KsqlDsl:SchemaRegistry:Url"]!)
  .EnableLogging(loggerFactory)
  .BuildContext<MyAppContext>();
```

### ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å®šç¾©ã—ã¦ç™»éŒ²ã™ã‚‹
`[KsqlTopic]` ã¨ `[KsqlTimestamp]` ã‚’ä»˜ä¸ã—ã€`EventSet<T>` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å…¬é–‹ã—ã¦ãƒ¢ãƒ‡ãƒ«ç™»éŒ²ã™ã‚‹ã€‚

```csharp
[KsqlTopic("basic-produce-consume")]
public class BasicMessage
{
  public int Id { get; set; }
  [KsqlTimestamp] public DateTime CreatedAt { get; set; }
  public string Text { get; set; } = string.Empty;
}

[KsqlTable("hourly-counts")]
public class HourlyCount
{
  [KsqlKey] public int Hour { get; set; }
  public long Count { get; set; }
}

public class MyAppContext : KsqlContext
{
  // è¤‡æ•°ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å…¬é–‹å¯èƒ½
  public EventSet<BasicMessage> BasicMessages { get; set; } = null!;
  public EventSet<AnotherEntity> AnotherEntities { get; set; } = null!;
  public EntitySet<OrderSummary> OrderSummaries { get; set; } = null!;
  public EntitySet<HourlyCount> HourlyCounts { get; set; } = null!;
}
```

ã“ã®ãƒ¢ãƒ‡ãƒ«ã«å¯¾å¿œã™ã‚‹ KSQL DDL ã¯æ¬¡ã®ã¨ãŠã‚Šã€‚

```sql
CREATE STREAM BASICMESSAGE (
  Id INT KEY,
  CreatedAt TIMESTAMP,
  Text VARCHAR
) WITH (
  KAFKA_TOPIC='basic-produce-consume',
  KEY_FORMAT='AVRO',
  VALUE_FORMAT='AVRO',
  VALUE_AVRO_SCHEMA_FULL_NAME='your.app.BasicMessage',
  TIMESTAMP='CreatedAt'
);

CREATE TABLE HOURLYCOUNT (
  HOUR INT PRIMARY KEY,
  COUNT BIGINT
) WITH (
  KAFKA_TOPIC='hourly-counts',
  KEY_FORMAT='AVRO',
  VALUE_FORMAT='AVRO',
  VALUE_AVRO_SCHEMA_FULL_NAME='your.app.HourlyCount'
);
```

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€å—ä¿¡ã™ã‚‹
`AddAsync` ã§é€ä¿¡ã—ã€`ForEachAsync` ã§å—ä¿¡ã‚’ç¢ºèªã™ã‚‹ã€‚

```csharp
// é€ä¿¡
await ctx.BasicMessages.AddAsync(new BasicMessage
{
  Id = Random.Shared.Next(),
  CreatedAt = DateTime.UtcNow,
  Text = "Basic Flow"
});

// å—ä¿¡
await ctx.BasicMessages.ForEachAsync(async m =>
{
  Console.WriteLine($"Consumed: {m.Text}");
  await Task.CompletedTask;
});
```

ãƒ˜ãƒƒãƒ€ãƒ¼ã‚„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ‰±ã†ä¾‹ã€‚`autoCommit: false` ã§æ‰‹å‹•ã‚³ãƒŸãƒƒãƒˆã«åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã€‚

```csharp
var headers = new Dictionary<string, string> { ["source"] = "api" };
using var cts = new CancellationTokenSource(TimeSpan.FromSeconds(5));

await ctx.BasicMessages.AddAsync(
  new BasicMessage { Id = 1, CreatedAt = DateTime.UtcNow, Text = "With header" },
  headers,
  cts.Token);

await ctx.BasicMessages.ForEachAsync(
  (m, h, meta) =>
  {
    Console.WriteLine($"{meta.Topic}:{meta.Offset} => {h["source"]}");
    ctx.BasicMessages.Commit(m);
    return Task.CompletedTask;
  },
  timeout: TimeSpan.FromSeconds(10),
  autoCommit: false);
```

### ãƒ“ãƒ¥ãƒ¼ã‚’å®šç¾©ã—ã¦ã‚¯ã‚¨ãƒªã™ã‚‹
`ToQuery` ã« `From/Join/Where/Select` ã‚’é€£é–ã•ã›ã€æ°¸ç¶šãƒ“ãƒ¥ãƒ¼ã‚’å®šç¾©ã™ã‚‹ã€‚

```csharp
modelBuilder.Entity<OrderSummary>().ToQuery(q => q
  .From<Order>()
  .Join<Customer>((o, c) => o.CustomerId == c.Id)
  .Where((o, c) => c.IsActive)
  .Select((o, c) => new OrderSummary
  {
    OrderId = o.Id,
    CustomerName = c.Name
  }));

// ã‚¯ã‚¨ãƒªå®Ÿè¡Œ
var summaries = await ctx.OrderSummaries.ToListAsync();
```

ã“ã®ã‚¯ã‚¨ãƒªã¯æ¬¡ã® KSQL ã«å¤‰æ›ã•ã‚Œã‚‹ã€‚

```sql
CREATE TABLE ORDERSUMMARY AS
  SELECT
    O.ID AS ORDERID,
    C.NAME AS CUSTOMERNAME
  FROM ORDER O
  JOIN CUSTOMER C
    ON O.CUSTOMERID = C.ID
  WHERE C.ISACTIVE = TRUE;
```

ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã¨é›†è¨ˆã‚’çµ„ã¿åˆã‚ã›ãŸä¾‹ã€‚

```csharp
modelBuilder.Entity<HourlyCount>().ToQuery(q => q
  .From<BasicMessage>()
  .Tumbling(m => m.CreatedAt, new Windows { Hours = new[] { 1 } })
  .GroupBy(m => m.CreatedAt.Hour)
  .Select(g => new HourlyCount { Hour = g.Key, Count = g.Count() }));

var counts = await ctx.HourlyCounts.ToListAsync();
```

ã“ã®ã‚¯ã‚¨ãƒªã¯æ¬¡ã® KSQL ã«å¤‰æ›ã•ã‚Œã‚‹ã€‚

```sql
CREATE TABLE HOURLYCOUNT AS
  SELECT
    EXTRACT(HOUR FROM CreatedAt) AS HOUR,
    COUNT(*) AS COUNT
  FROM BASICMESSAGE
  WINDOW TUMBLING (SIZE 1 HOUR)
  GROUP BY EXTRACT(HOUR FROM CreatedAt);
```

### å¤±æ•—ã‚’ DLQ ã§è¿½è·¡ã™ã‚‹
`.OnError(ErrorAction.DLQ)` ä»˜ã `ForEachAsync` ã¯å‡¦ç†ä¸­ã®ä¾‹å¤–ã‚’ DLQ ã«è»¢é€ã—ã€DLQ ã‚¹ãƒˆãƒªãƒ¼ãƒ ã¯ `ctx.Dlq.ForEachAsync` ã§å·¡å›ã§ãã‚‹ã€‚

```csharp
await ctx.BasicMessages
  .OnError(ErrorAction.DLQ)
  .ForEachAsync(m => throw new Exception("fail"));

await ctx.Dlq.ForEachAsync(r =>
{
  Console.WriteLine(r.RawText);
  return Task.CompletedTask;
});
```

### ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä¸€è¦§å–å¾—ã™ã‚‹
`ToListAsync` ã§ãƒ†ãƒ¼ãƒ–ãƒ«å†…å®¹ã‚’èª­ã¿å–ã‚Šã€çµæœã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰æä¾›ã•ã‚Œã‚‹ã€‚

```csharp
var counts = await ctx.HourlyCounts.ToListAsync();
foreach (var c in counts)
  Console.WriteLine($"{c.Hour}: {c.Count}");
```

## æ‹¡å¼µãƒã‚¤ãƒ³ãƒˆ

### DI ã¨ãƒ­ã‚®ãƒ³ã‚°ã‚’å·®ã—æ›¿ãˆã‚‹
`IServiceCollection` ã«ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç™»éŒ²ã—ã€æ—¢å­˜ãƒ­ã‚¬ãƒ¼ã‚’æµç”¨ã™ã‚‹ã€‚

```csharp
var services = new ServiceCollection();
services.AddSingleton(sp =>
  KsqlContextBuilder.Create()
    .UseConfiguration(sp.GetRequiredService<IConfiguration>())
    .EnableLogging(sp.GetRequiredService<ILoggerFactory>())
    .BuildContext<MyAppContext>());
```

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚’èª¿æ•´ã™ã‚‹
ã‚¹ã‚­ãƒ¼ãƒç™»éŒ²ã‚„æ¤œè¨¼ã®æŒ™å‹•ã‚’ `ConfigureValidation` ã¨ `WithTimeouts` ã§åˆ¶å¾¡ã™ã‚‹ã€‚

```csharp
var ctx = KsqlContextBuilder.Create()
  .UseConfiguration(configuration)
  .ConfigureValidation(autoRegister: false, failOnErrors: true)
  .WithTimeouts(TimeSpan.FromSeconds(30))
  .BuildContext<MyAppContext>();
```

## é‹ç”¨ãƒ»ç›£è¦–
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `BootstrapServers`ãƒ»`SchemaRegistry.Url`ãƒ»`KsqlDbUrl`ãƒ»DLQ è¨­å®šã‚’ `appsettings.json` ã«é›†ç´„ã™ã‚‹ã€‚
- **ãƒ¡ãƒˆãƒªã‚¯ã‚¹/ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µã‚„ã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒã®ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã¨ã‚¨ãƒ©ãƒ¼ã‚«ã‚¦ãƒ³ãƒˆã‚’ `ILogger` çµŒç”±ã§åé›†ã™ã‚‹ã€‚
- **ã‚¹ã‚­ãƒ¼ãƒç®¡ç†**: Schema Registry ã®äº’æ›æ€§ãƒ¢ãƒ¼ãƒ‰ (FORWARD/STRICT) ã‚’è¨­å®šã—ã€äº’æ›æ€§ã‚’æ¤œè¨¼ã™ã‚‹ã€‚
- **ãƒ†ã‚¹ãƒˆ**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ In-Memory å®Ÿè£…ã«å·®ã—æ›¿ãˆã€ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å®¹æ˜“ã«ã™ã‚‹ã€‚

---

## ä»£è¡¨çš„ãªã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨ API
- `[KsqlTopic]` / `[KsqlTimestamp]` / `[KsqlTable]`
- `Entity<T>()`, `ToQuery(...)`, `AddAsync`, `ForEachAsync`, `ToListAsync`, `ctx.Dlq.ForEachAsync`

---

## æœ€å°æ§‹æˆä¾‹ (appsettings.json)
`BootstrapServers`ãƒ»`SchemaRegistry.Url`ãƒ»`KsqlDbUrl` ã‚’æœ€ä½é™è¨˜è¿°ã™ã‚‹ã€‚

```json
{
  "KsqlDsl": {
    "Common": { "BootstrapServers": "localhost:9092", "ClientId": "app" },
    "SchemaRegistry": { "Url": "http://localhost:8085" },
    "KsqlDbUrl": "http://localhost:8088",
    "DlqTopicName": "dead-letter-queue",
    "DeserializationErrorPolicy": "DLQ"
  }
}
```

ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã”ã¨ã® Producer/Consumer/Topic è¨­å®šã¯ `Streams` ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ä¸Šæ›¸ãã§ãã‚‹ã€‚

```json
{
  "KsqlDsl": {
    "Streams": {
      "basic-produce-consume": {
        "Producer": { "Acks": "All" },
        "Consumer": { "GroupId": "custom-group" },
        "Creation": { "NumPartitions": 3 }
      }
    }
  }
}
```

---

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ `Entity<T>()` ã§ç™»éŒ²ã—ãŸ
- [ ] `AddAsync` ã¨ `ForEachAsync` ã§é€å—ä¿¡ã‚’ç¢ºèªã—ãŸ
- [ ] å¿…è¦ãªãƒ“ãƒ¥ãƒ¼ã‚’ `ToQuery` ã§å®šç¾©ã—ãŸ
- [ ] å¤±æ•—æ™‚ã¯ `ctx.Dlq.ForEachAsync` ã§ DLQ ã‚’ç¢ºèªã—ãŸ
- [ ] ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ `ToListAsync` ã§ä¸€è¦§å–å¾—ã—ãŸ

### tool â€” 2025-09-15T04:29:38.945102+00:00

All the files uploaded by the user have been fully loaded. Searching won't provide additional information.
