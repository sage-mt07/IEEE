---
conversation_id: "5762a1de-b66a-41d4-a539-98338b9f21de"
title: "Deploy Blazor to Azure"
create_time: 1722927499.604615
update_time: 1722927855.071166
language_guess: "en"
num_messages: 16
part_index: 1
part_count: 1
---

### system — 2024-08-06T06:58:19.604615+00:00

_(empty)_

### user — 2024-08-06T06:58:19.607280+00:00

添付ファイルのソースをAzure App Serviceni

### assistant — 2024-08-06T06:58:23.111502+00:00

_(empty)_

### assistant — 2024-08-06T06:58:23.111566+00:00

To deploy your Blazor application to Azure App Service, follow these steps:

1. **Unzip the File**: Extract the contents of the uploaded zip file to a local directory.

2. **Create an Azure App Service**:
   - Go to the [Azure Portal](https://portal.azure.com/).
   - Click on "Create a resource" and then select "App Service".
   - Fill in the necessary details (such as subscription, resource group, name, publish, runtime stack, operating system, region, etc.).
   - Click "Review + create" and then "Create".

3. **Configure Azure

### user — 2024-08-06T06:58:59.206520+00:00

添付ファイルのソースをApp Serviceにデプロイし、PostManからApiを呼ぶための設定と手順

### assistant — 2024-08-06T06:59:23.671849+00:00

To deploy your Blazor application to Azure App Service and configure it for API calls using Postman, follow these steps:

### 1. Extract the Source Files
First, extract the contents of the uploaded zip file (`BlazorApp12.zip`) to a local directory.

### 2. Create an Azure App Service
1. **Create an App Service**:
   - Go to the [Azure Portal](https://portal.azure.com/).
   - Click on "Create a resource" and select "App Service".
   - Fill in the necessary details (such as subscription, resource group, name, publish, runtime stack, operating system, region, etc.).
   - Click "Review + create" and then "Create".

2. **Create an App Service Plan**:
   - If you do not have an existing App Service Plan, you will be prompted to create one.
   - Select the pricing tier that fits your needs.

### 3. Publish the Blazor Application
1. **Open the Solution in Visual Studio**:
   - Open the extracted Blazor application solution (`BlazorApp12.sln`) in Visual Studio.

2. **Publish the Application**:
   - Right-click on the project in Solution Explorer and select "Publish".
   - Choose "Azure" as the target and then select "Azure App Service (Windows)".
   - Select the existing App Service you created earlier.
   - Click "Next" and then "Finish".

3. **Build and Deploy**:
   - Click "Publish" to build and deploy your Blazor application to Azure App Service.

### 4. Configure API for Postman
To configure your API to be called from Postman, follow these steps:

1. **Update CORS Settings** (if necessary):
   - Go to your App Service in the Azure Portal.
   - Under "Settings", click on "CORS".
   - Add `*` to allow all origins or specify the origins you want to allow.

2. **Retrieve the App Service URL**:
   - In the Azure Portal, navigate to your App Service.
   - Copy the URL from the Overview section (e.g., `https://your-app-name.azurewebsites.net`).

### 5. Test the API with Postman
1. **Open Postman**:
   - Download and install [Postman](https://www.postman.com/downloads/) if you haven't already.

2. **Create a New Request**:
   - Open Postman and click on "New" to create a new request.
   - Select "Request" and click "Create".

3. **Set Up the Request**:
   - Set the request method (e.g., GET, POST, PUT, DELETE) depending on your API.
   - Enter the URL of your deployed API (e.g., `https://your-app-name.azurewebsites.net/api/your-endpoint`).
   - If your API requires headers (e.g., Authorization), click on the "Headers" tab and add the required headers.
   - If your API requires a request body (e.g., for POST requests), click on the "Body" tab and add the necessary JSON or form data.

4. **Send the Request**:
   - Click "Send" to send the request to your API.
   - Review the response to ensure that the API is working as expected.

### Example
Assuming your API endpoint is `https://your-app-name.azurewebsites.net/api/values` and it supports a GET request:

1. Open Postman and create a new GET request.
2. Enter `https://your-app-name.azurewebsites.net/api/values` in the URL field.
3. Click "Send".
4. Check the response to see the data returned by your API.

If you encounter any issues during deployment or configuration, please provide more details about the errors or problems you're facing, and I'll be happy to assist you further.

### user — 2024-08-06T07:00:05.243324+00:00

添付ファイルのソースはentra idを利用した認証を行っている

### assistant — 2024-08-06T07:00:36.180376+00:00

The user is utilizing Entra ID for authentication in their source code.

### tool — 2024-08-06T07:00:36.180482+00:00

Model set context updated.

### assistant — 2024-08-06T07:00:36.180554+00:00

To deploy your Blazor application with Entra ID (formerly known as Azure AD) authentication to Azure App Service and configure it for API calls using Postman, follow these steps:

### 1. Extract the Source Files
First, extract the contents of the uploaded zip file (`BlazorApp12.zip`) to a local directory.

### 2. Create an Azure App Service
1. **Create an App Service**:
   - Go to the [Azure Portal](https://portal.azure.com/).
   - Click on "Create a resource" and select "App Service".
   - Fill in the necessary details (such as subscription, resource group, name, publish, runtime stack, operating system, region, etc.).
   - Click "Review + create" and then "Create".

2. **Create an App Service Plan**:
   - If you do not have an existing App Service Plan, you will be prompted to create one.
   - Select the pricing tier that fits your needs.

### 3. Configure Entra ID Authentication for the App Service
1. **Register the App in Entra ID**:
   - Go to the Azure AD (Entra ID) section in the Azure Portal.
   - Click on "App registrations" and then "New registration".
   - Enter a name for your application and set the redirect URI to `https://<your-app-name>.azurewebsites.net/signin-oidc`.
   - Note the **Application (client) ID** and **Directory (tenant) ID**.

2. **Configure Authentication**:
   - In the Azure AD application registration, go to "Authentication".
   - Add a platform configuration for "Web".
   - Set the redirect URI to `https://<your-app-name>.azurewebsites.net/signin-oidc`.
   - Check the ID tokens checkbox.

3. **Set API Permissions**:
   - Go to "API permissions" and add permissions required for your API.
   - Ensure you have the necessary delegated permissions.

4. **Expose an API** (if necessary):
   - In the Azure AD application registration, go to "Expose an API".
   - Add a scope for your API if needed.

### 4. Update the Blazor Application Configuration
1. **Update `appsettings.json`**:
   - Ensure your `appsettings.json` contains the correct Azure AD settings. Example:

   ```json
   {
     "AzureAd": {
       "Instance": "https://login.microsoftonline.com/",
       "Domain": "yourdomain.onmicrosoft.com",
       "TenantId": "your-tenant-id",
       "ClientId": "your-client-id",
       "CallbackPath": "/signin-oidc",
       "Scopes": "api://your-client-id/access_as_user"
     },
     "Logging": {
       "LogLevel": {
         "Default": "Information",
         "Microsoft.AspNetCore": "Warning"
       }
     },
     "AllowedHosts": "*"
   }
   ```

### 5. Publish the Blazor Application
1. **Open the Solution in Visual Studio**:
   - Open the extracted Blazor application solution (`BlazorApp12.sln`) in Visual Studio.

2. **Publish the Application**:
   - Right-click on the project in Solution Explorer and select "Publish".
   - Choose "Azure" as the target and then select "Azure App Service (Windows)".
   - Select the existing App Service you created earlier.
   - Click "Next" and then "Finish".

3. **Build and Deploy**:
   - Click "Publish" to build and deploy your Blazor application to Azure App Service.

### 6. Test the API with Postman
1. **Open Postman**:
   - Download and install [Postman](https://www.postman.com/downloads/) if you haven't already.

2. **Get an Access Token**:
   - You will need an access token to call your API. Follow these steps to get an access token:
     - In Postman, create a new request.
     - Go to the "Authorization" tab.
     - Select "OAuth 2.0" as the type.
     - Click on "Get New Access Token".
     - Fill in the details:
       - **Token Name**: Any name
       - **Grant Type**: Authorization Code
       - **Callback URL**: `https://oauth.pstmn.io/v1/callback`
       - **Auth URL**: `https://login.microsoftonline.com/your-tenant-id/oauth2/v2.0/authorize`
       - **Access Token URL**: `https://login.microsoftonline.com/your-tenant-id/oauth2/v2.0/token`
       - **Client ID**: Your Azure AD application's client ID
       - **Client Secret**: Your Azure AD application's client secret (if applicable)
       - **Scope**: `api://your-client-id/access_as_user`
       - **State**: Any state value
     - Click "Request Token".

3. **Call Your API**:
   - Once you have the token, copy it.
   - Create a new request in Postman.
   - Set the request method (e.g., GET, POST, PUT, DELETE) depending on your API.
   - Enter the URL of your deployed API (e.g., `https://your-app-name.azurewebsites.net/api/your-endpoint`).
   - Go to the "Authorization" tab and select "Bearer Token".
   - Paste the token you copied earlier.
   - Click "Send" to send the request to your API.
   - Review the response to ensure that the API is working as expected.

If you encounter any issues during deployment or configuration, please provide more details about the errors or problems you're facing, and I'll be happy to assist you further.

### user — 2024-08-06T07:01:50.255474+00:00

PostManアクセス用のprincipalを別途用意するものとする

### assistant — 2024-08-06T07:02:15.624909+00:00

_(empty)_

### assistant — 2024-08-06T07:02:15.624991+00:00

To set up a separate principal for Postman access, you'll need to create a new app registration in Azure AD specifically for Postman and configure it to request tokens for your API. Follow these steps:

### 1. Create a New App Registration for Postman
1. **Register a New Application**:
   - Go to the [Azure Portal](https://portal.azure.com/).
   - Navigate to "Azure Active Directory" > "App registrations".
   - Click on "New registration".
   - Enter a name for your application, such as "PostmanClient".
   - Set the redirect URI to `https://oauth.pstmn.io/v1/callback`.
   - Click "Register".

2. **Note the Application (client) ID** and **Directory (tenant) ID**:
   - You'll need these for configuring Postman.

### 2. Configure API Permissions for the New App Registration
1. **Add API Permissions**:
   - Go to the new app registration ("PostmanClient").
   - Select "API permissions" > "Add a permission".
   - Choose "APIs my organization uses" and search for the API app registration you set up earlier (the one your Blazor app uses).
   - Select the API and add the delegated permissions required to access your API (e.g., `api://your-api-client-id/access_as_user`).

2. **Grant Admin Consent**:
   - After adding the permissions, click "Grant admin consent for [Your Organization]".

### 3. Generate a Client Secret for Postman
1. **Create a Client Secret**:
   - In the "PostmanClient" app registration, go to "Certificates & secrets".
   - Click on "New client secret".
   - Add a description and set an expiry period.
   - Click "Add" and note the secret value (you won't be able to see it again).

### 4. Configure Postman to Use the New App Registration
1. **Open Postman**:
   - Open Postman and create a new request.

2. **Set Up OAuth 2.0 Authorization**:
   - Go to the "Authorization" tab.
   - Select "OAuth 2.0" as the type.
   - Click "Get New Access Token".

3. **Fill in the Token Request Details**:
   - **Token Name**: Any name (e.g., "Postman Access Token")
   - **Grant Type**: Authorization Code
   - **Callback URL**: `https://oauth.pstmn.io/v1/callback`
   - **Auth URL**: `https://login.microsoftonline.com/your-tenant-id/oauth2/v2.0/authorize`
   - **Access Token URL**: `https://login.microsoftonline.com/your-tenant-id/oauth2/v2.0/token`
   - **Client ID**: Your "PostmanClient" app registration's client ID
   - **Client Secret**: The client secret you created for "PostmanClient"
   - **Scope**: `api://your-api-client-id/access_as_user`
   - **State**: Any state value

4. **Request the Token**:
   - Click "Request Token".
   - A new window will open for you to log in with your Azure AD credentials.
   - Once authenticated, you'll receive an access token.

5. **Use the Token to Call Your API**:
   - Copy the token.
   - Create a new request in Postman.
   - Set the request method (e.g., GET, POST, PUT, DELETE) depending on your API.
   - Enter the URL of your deployed API (e.g., `https://your-app-name.azurewebsites.net/api/your-endpoint`).
   - Go to the "Authorization" tab and select "Bearer Token".
   - Paste the token you copied earlier.
   - Click "Send" to send the request to your API.
   - Review the response to ensure that the API is working as expected.

### Summary
By following these steps, you have:
1. Created a separate app registration for Postman.
2. Configured API permissions and client secrets for the new app registration.
3. Set up Postman to use OAuth 2.0 to get an access token.
4. Called your API using the access token from Postman.

If you encounter any issues during this process, please provide details about the errors or problems you're facing, and I'll be happy to assist you further.

### user — 2024-08-06T07:03:46.882902+00:00

PostmanClientがAPIにアクセスを行う設定はあるのか

### assistant — 2024-08-06T07:04:14.658218+00:00

To ensure that the `PostmanClient` app registration can access the API, you need to configure both the `PostmanClient` and the API app registrations correctly. Here’s how you can ensure that `PostmanClient` can access the API:

### Step 1: Configure the API App Registration
1. **Expose an API**:
   - Go to the Azure Portal.
   - Navigate to "Azure Active Directory" > "App registrations".
   - Select your API app registration (the one your Blazor app uses).
   - Go to "Expose an API".
   - If not already present, add an application ID URI (e.g., `api://your-api-client-id`).

2. **Add a Scope**:
   - In the "Expose an API" section, click "Add a scope".
   - Add a new scope (e.g., `access_as_user`).
   - Provide the necessary details (name, consent display name, description, etc.).
   - Ensure the scope is enabled.

### Step 2: Configure the PostmanClient App Registration
1. **Add API Permissions**:
   - Go to the Azure Portal.
   - Navigate to "Azure Active Directory" > "App registrations".
   - Select your `PostmanClient` app registration.
   - Go to "API permissions" > "Add a permission".
   - Choose "My APIs" and select your API app registration.
   - Add the delegated permission you created (e.g., `api://your-api-client-id/access_as_user`).

2. **Grant Admin Consent**:
   - After adding the permission, click "Grant admin consent for [Your Organization]".

### Step 3: Generate a Client Secret for PostmanClient
1. **Create a Client Secret**:
   - In the `PostmanClient` app registration, go to "Certificates & secrets".
   - Click on "New client secret".
   - Add a description and set an expiry period.
   - Click "Add" and note the secret value (you won't be able to see it again).

### Step 4: Configure Postman to Use the New App Registration
1. **Open Postman**:
   - Open Postman and create a new request.

2. **Set Up OAuth 2.0 Authorization**:
   - Go to the "Authorization" tab.
   - Select "OAuth 2.0" as the type.
   - Click "Get New Access Token".

3. **Fill in the Token Request Details**:
   - **Token Name**: Any name (e.g., "Postman Access Token")
   - **Grant Type**: Authorization Code
   - **Callback URL**: `https://oauth.pstmn.io/v1/callback`
   - **Auth URL**: `https://login.microsoftonline.com/your-tenant-id/oauth2/v2.0/authorize`
   - **Access Token URL**: `https://login.microsoftonline.com/your-tenant-id/oauth2/v2.0/token`
   - **Client ID**: Your "PostmanClient" app registration's client ID
   - **Client Secret**: The client secret you created for "PostmanClient"
   - **Scope**: `api://your-api-client-id/access_as_user`
   - **State**: Any state value

4. **Request the Token**:
   - Click "Request Token".
   - A new window will open for you to log in with your Azure AD credentials.
   - Once authenticated, you'll receive an access token.

5. **Use the Token to Call Your API**:
   - Copy the token.
   - Create a new request in Postman.
   - Set the request method (e.g., GET, POST, PUT, DELETE) depending on your API.
   - Enter the URL of your deployed API (e.g., `https://your-app-name.azurewebsites.net/api/your-endpoint`).
   - Go to the "Authorization" tab and select "Bearer Token".
   - Paste the token you copied earlier.
   - Click "Send" to send the request to your API.
   - Review the response to ensure that the API is working as expected.

### Summary
By following these steps, you ensure that:
1. The API app registration has the necessary scopes exposed.
2. The `PostmanClient` app registration has the appropriate permissions to access those scopes.
3. Postman is configured to use OAuth 2.0 to get an access token for the API.

If you encounter any issues during this process, please provide details about the errors or problems you're facing, and I'll be happy to assist you further.
