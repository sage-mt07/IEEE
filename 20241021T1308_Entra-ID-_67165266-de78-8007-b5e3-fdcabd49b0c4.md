---
conversation_id: "67165266-de78-8007-b5e3-fdcabd49b0c4"
title: "Entra ID 続き"
create_time: 1729516135.628496
update_time: 1729517546.588605
language_guess: "en"
num_messages: 33
part_index: 1
part_count: 1
---

### system — 2024-10-21T13:08:55.628496+00:00

_(empty)_

### user — 2024-10-21T13:08:55.631757+00:00

さっきのEntraIDの続き

### assistant — 2024-10-21T13:08:57.404833+00:00

_(empty)_

### assistant — 2024-10-21T13:08:57.404929+00:00

Entra IDについての続きですね。どのトピックについて話を進めたいですか？例えば、Blazor WebAssemblyの認証や、APIの制限についてなど、具体的な内容を教えてください。

### user — 2024-10-21T13:09:29.050107+00:00

EntraIDを使用するAPIの同時実行が秒間50となる原因429は発生していない

### assistant — 2024-10-21T13:09:45.747930+00:00

エラーレスポンスが `HTTP 429` ではなく、Entra ID 認証を使用している API の同時実行が秒間50回に制限されている状況ですね。この場合、考えられる原因として以下が挙げられます：

1. **API のスロットル設定**:
   - API の設定や Entra ID 側での制限ではなく、API やバックエンドサービス自体にスロットリングやレート制限が設定されている可能性があります。これにより、同時実行リクエストが制限されているかもしれません。

2. **バックエンドリソースの制約**:
   - API が接続しているデータベースや他のリソースが、同時に処理できるリクエスト数に制限を設けている可能性があります。この場合、リクエストの数が増えたときに、リソース側で処理の速度が低下し、それが制限のように見えるかもしれません。

3. **クライアントの設定**:
   - クライアント側での HttpClient や、接続プールの設定が同時実行数を制限している可能性もあります。たとえば、接続プールのサイズやタイムアウトの設定により、制限が発生していることがあります。

4. **Entra ID のトークン発行の制約**:
   - Entra ID が発行するアクセストークンのレートに関する制限が影響している可能性も考えられます。認証トークンの生成や有効期限が多数のリクエストに影響を与えている場合、トークンのリフレッシュや有効期限管理に関連する処理が負荷になることがあります。

429エラーが発生していないことから、これらの問題はEntra ID自体の直接的な制限というよりは、APIや環境側の設定や制約による可能性が高いです。もし詳しいログや具体的なシナリオがあれば、それに基づいてさらに詳細に調査できます。

### user — 2024-10-21T13:10:21.164842+00:00

HttpClientの場合、同時上限はどうなっているのか
EntraIDはhttp2を使用するのではないのか

### assistant — 2024-10-21T13:10:39.754894+00:00

The user is inquiring about the concurrency limits of HttpClient and whether Entra ID uses HTTP/2.

### tool — 2024-10-21T13:10:39.755004+00:00

Model set context updated.

### assistant — 2024-10-21T13:10:39.755071+00:00

`HttpClient` の場合、同時リクエストの上限は以下の要素に依存します：

1. **接続プールの制限**:
   - デフォルトで、`HttpClient` は同一のホストに対して一定の接続数のプールを使用します。これは .NET のバージョンや設定によりますが、例えば .NET Core 2.1 以降では `DefaultHttpClientFactory` を使用して、デフォルトの `HttpClient` は `HttpClientHandler` の `MaxConnectionsPerServer` プロパティによって制限されます。デフォルトは 2 から 10 などであり、明示的に設定しない限り、ホストあたりの同時接続数に影響します。

2. **HTTP/2 の使用**:
   - `HttpClient` は HTTP/2 に対応しており、HTTP/2 では一つのコネクションで複数のストリーム（リクエスト）を処理できるため、HTTP/1.1 に比べて効率的な同時リクエスト処理が可能です。HTTP/2 を使用する場合、`MaxConnectionsPerServer` の設定が異なる動作をする場合がありますが、バックエンドサーバー側の制限やスループットにも依存します。

3. **Entra ID の通信プロトコル**:
   - Entra ID（以前の Azure AD）は、認証やトークンのやり取りの際に HTTP/2 をサポートしています。HTTP/2 はより高速な通信を実現し、低レイテンシーでのトークン発行や認証処理に貢献します。ただし、`HttpClient` を使う場合、`HttpRequestMessage.Version` を `HttpVersion.Version20` に設定することで、HTTP/2 を明示的に利用することができます。

例えば、以下のように HTTP/2 を明示することが可能です：

```csharp
var client = new HttpClient();
var request = new HttpRequestMessage(HttpMethod.Get, "https://example.com")
{
    Version = HttpVersion.Version20
};
var response = await client.SendAsync(request);
```

したがって、`HttpClient` の同時接続の上限を管理するには、`MaxConnectionsPerServer` の設定を調整し、HTTP/2 のメリットを活かして一つのコネクションで複数のリクエストを効率的に処理することが推奨されます。

### user — 2024-10-21T13:11:36.015815+00:00

jmeterからentraidへのリクエスト自体が50の制限をうけている
jmeterはazure load testingから実行している

### assistant — 2024-10-21T13:11:57.897433+00:00

_(empty)_

### assistant — 2024-10-21T13:11:57.897584+00:00

The user is running JMeter tests from Azure Load Testing, and the requests to Entra ID are subject to a limit of 50 simultaneous executions.

### tool — 2024-10-21T13:11:57.897652+00:00

Model set context updated.

### assistant — 2024-10-21T13:11:57.897714+00:00

JMeterからAzure Load Testingを通じてEntra IDにリクエストを送る際に、50の同時実行制限がかかっているという状況ですね。この制限がかかる原因について考えられる点をいくつか挙げます：

1. **Entra ID のレート制限**:
   - Entra ID（以前の Azure AD）には、API に対するレート制限が設けられています。これはトークンの取得や認証リクエストなど、各種の API コールに適用される場合があります。特に、トークンの発行に関連するエンドポイント（`/token` エンドポイントなど）に対して、同時に大量のリクエストを送るとスロットリングされる可能性があります。

2. **Azure Load Testing の設定**:
   - Azure Load Testing 側の設定や制限が影響している可能性があります。例えば、負荷テストのための最大リクエスト数が制限されている場合、それがEntra IDに対するリクエストにも影響しているかもしれません。設定を確認し、リクエストの並列性やスループットに制限がないか確認すると良いでしょう。

3. **JMeter の設定**:
   - JMeter のスレッド数や、実行中のリクエストが適切にスケールされているかどうかも確認が必要です。例えば、同時に実行されるスレッド数や Ramp-up 時間の設定が、Entra ID のレート制限を超えないように調整することが考えられます。

4. **トークンキャッシュの利用**:
   - 大量のリクエストごとに新しいトークンを取得するのではなく、可能であればトークンキャッシュを利用して、取得したトークンを複数のリクエストで再利用することで、Entra ID へのリクエスト回数を減らすことができます。

この制限に対処するためには、負荷テストの設定や、トークン取得の頻度、トークンキャッシュの利用などを調整し、Entra ID のレート制限に合わせた最適な設定を行うことが重要です。また、詳細なエラーメッセージやログを確認することで、制限の具体的な原因を特定する手助けになるかもしれません。

### user — 2024-10-21T13:19:12.012488+00:00

jmeterの同時接続数設定はあるのか

### assistant — 2024-10-21T13:19:37.828883+00:00

_(empty)_

### assistant — 2024-10-21T13:19:37.828998+00:00

はい、JMeterでは同時接続数を設定するためのオプションがいくつかあります。具体的には、以下の設定によってJMeterの同時接続数を制御できます。

### 1. **Thread Group (スレッドグループ) の設定**
   - **Number of Threads (Users)**:  
     これは、JMeterが同時に実行するユーザー（スレッド）の数を設定します。たとえば、この値を `50` に設定すると、50ユーザー分の同時リクエストが送られます。
   - **Ramp-Up Period**:  
     この設定は、全スレッドが何秒間で起動するかを指定します。例えば、50スレッドで `Ramp-Up Period` が `10秒` であれば、毎秒5ユーザーが起動します。これにより、リクエストの急激な増加を防ぐことができます。

### 2. **HTTP Connection Configuration**
   - JMeterでは、`HTTP Request Defaults` や `HTTP Request` 設定で接続のパラメータを変更できます。特に以下の点を調整できます：
     - **`Keep-Alive` の設定**:  
       デフォルトでは、HTTP接続を維持するための `Keep-Alive` が有効になっています。これにより、同じ接続を再利用することで、接続オーバーヘッドを削減できますが、負荷分散の動作が変わることがあります。
     - **`Timeouts`**:  
       `Connection Timeout` や `Response Timeout` を設定して、リクエストのタイムアウト時間を指定します。これによって、応答が遅い場合に接続が無制限に保持されるのを防ぐことができます。

### 3. **プールされた接続の数** (`HTTPClient4`)
   - `jmeter.properties` ファイルで以下のプロパティを設定することで、JMeterが使うHTTP接続プールの設定を変更できます。
     - `httpclient4.max_connections_per_host`:  
       各ホストに対する最大接続数を指定します。
     - `httpclient4.max_total_connections`:  
       全体の最大接続数を設定します。

   これらの設定を適切に調整することで、JMeterが同時に送信するリクエスト数や、各ホストへの接続数を制御できます。

### 例: スレッドグループ設定
```bash
Number of Threads (Users): 50
Ramp-Up Period: 10 seconds
Loop Count: 1
```

この設定では、50の同時リクエストが10秒間でスムーズに増加し、一度リクエストを送った後に終了します。

JMeterの同時接続数は、これらの設定を通じて制御できるため、負荷テストを実施する際にはこれらを適切に調整して、Entra IDや他のシステムの制限に合ったテストを行うことが重要です。

### user — 2024-10-21T13:20:24.633154+00:00

Azure load testingでhttpclient4.max_connections_per_hostを設定する方法

### assistant — 2024-10-21T13:20:51.769155+00:00

Azure Load Testingで`httpclient4.max_connections_per_host`を設定するには、JMeterのプロパティファイルをカスタマイズする方法を使用します。以下の手順で、`httpclient4.max_connections_per_host`をAzure Load TestingのJMeterスクリプトに適用できます。

### 手順

1. **ローカルでプロパティファイルを用意**:
   - JMeterの`jmeter.properties`ファイルを作成または編集し、次の設定を追加します：
     ```properties
     httpclient4.max_connections_per_host=50
     ```
     ここで`50`は、ホストごとの最大接続数です。適宜調整してください。

2. **JMeterスクリプトをAzure Load Testingにアップロード**:
   - Azure Load Testingでは、カスタムのプロパティファイルをテストと一緒にアップロードすることができます。以下のファイルを準備します：
     - JMeterのテスト計画（`.jmx`ファイル）
     - カスタマイズした`jmeter.properties`ファイル

3. **Azure Load Testing にプロパティファイルを指定**:
   - Azure Load Testing ポータルにアクセスし、新しいテストを作成します。
   - テストの設定画面で、JMeterスクリプトをアップロードする際に、`jmeter.properties`ファイルも一緒にアップロードします。

4. **カスタムプロパティファイルの使用設定**:
   - JMeterスクリプトを実行する際に、アップロードしたプロパティファイルを適用するように設定します。
   - Azure Load Testing では、JMeter のプロパティファイルがデフォルトで適用されるため、アップロードしたファイルが自動的に読み込まれます。

5. **コマンドラインオプションの使用** (オプション):
   - 必要に応じて、`jmeter`コマンドの引数としてプロパティを指定する方法もあります。例えば、次のように設定できます：
     ```bash
     -Jhttpclient4.max_connections_per_host=50
     ```
   - この設定をAzure Load TestingのJMeterコマンド実行時に適用する方法については、Azureのカスタム設定オプションを使用します。

### 注意点
- Azure Load Testingで使用するプロパティは、テスト環境全体に影響を与えるため、テスト計画に対する影響を事前にローカル環境で確認すると良いでしょう。
- `httpclient4.max_connections_per_host`の値は、Entra IDやAPIサーバーの制限を超えないように適切に設定してください。

これにより、Azure Load Testingを使用して、JMeterの`httpclient4.max_connections_per_host`を設定し、特定のホストに対する最大同時接続数を調整できます。

### user — 2024-10-21T13:21:02.139828+00:00

未設定の場合のデフォルト値は

### assistant — 2024-10-21T13:21:07.470275+00:00

JMeterで`httpclient4.max_connections_per_host`を設定しなかった場合のデフォルト値は、**2**です。つまり、各ホストに対して最大2つの同時接続が許可されます。

このデフォルト値は負荷テストを行う際には制限となることが多いため、負荷テストの規模に応じて適切に値を増やすことが推奨されます。

### user — 2024-10-21T13:26:03.315691+00:00

Azure　Load Testingの結果画面に同時数が50で止まる

### assistant — 2024-10-21T13:26:37.130925+00:00

Azure Load Testingの結果画面で同時接続数が50で止まってしまう場合、以下の点を確認して調整してみると、問題の特定や解決に役立つかもしれません：

### 1. **Entra IDやAPIのレート制限**:
   - Entra ID自体が50リクエスト/秒などの制限を設けている可能性があります。特に、APIのトークン取得や認証エンドポイントへのアクセスが多いと、サービス側の制限によってスロットルされている場合があります。
   - AzureのAPI制限やレート制限に関するログを確認し、Entra IDからスロットリングの通知が来ていないか確認してください。

### 2. **Azure Load Testingの制限**:
   - Azure Load Testingの設定において、スレッドグループやJMeterスレッド数（同時実行ユーザー数）に対する制限が適用されていないかを確認します。以下の設定項目を見直してみてください：
     - スレッド数やRamp-up時間が意図通り設定されているか。
     - 必要であれば、JMeterのスレッド数を増やすなど、テストシナリオを見直します。

### 3. **負荷テスト時のスレッド制限**:
   - JMeterのプロパティファイルやテストシナリオで、意図せず`httpclient4.max_connections_per_host`や他のリソース制限が設定されている場合があります。これを確認し、`httpclient4.max_connections_per_host`の値を増やすなどの設定変更を試みると、改善されることがあります。

### 4. **バックエンドの制限**:
   - Entra IDを使うバックエンドAPIの性能やスケーリング設定も確認が必要です。たとえば、App ServiceやAPI Managementの設定で、バックエンドが処理できるリクエスト数が50に制限されている場合、その設定を見直すことで解決するかもしれません。

### 5. **Azure Load Testingのログとメトリクスの確認**:
   - Azure Load Testingではテスト実行中にメトリクスやログを確認することができます。これにより、特定のリソースにボトルネックがないかや、スロットリングされている部分がないかを詳しく確認できます。CPU、メモリ、ネットワークの使用率やエラーログなどを参照して、原因を特定してください。

### 6. **スロットリングポリシーの調整**:
   - Entra IDやAzure AD B2Cのスロットリングポリシーをカスタマイズできる場合があります。管理ポータルやサポートを通じて、スロットリングのポリシーについて確認し、調整が可能かどうかを検討してください。

もし、これらの対策を試しても改善が見られない場合、Azureのサポートに問い合わせることで、さらに詳細なトラブルシューティングを行うことが可能です。

### user — 2024-10-21T13:27:16.284423+00:00

Entra IDのスロットリングポリシー編集方法

### assistant — 2024-10-21T13:27:57.618530+00:00

Entra ID（旧Azure AD）のスロットリングポリシーは、ユーザー側で直接編集や調整を行うことはできません。Entra IDには、Microsoft側で定められたデフォルトのスロットリング（レート制限）ポリシーが適用されており、これはAzure ADのAPIやエンドポイントへのリクエスト数が急増した場合に、自動的に適用されます。

ただし、以下の方法やベストプラクティスを通じて、スロットリングの影響を軽減することが可能です。

### スロットリングへの対処方法

1. **リトライロジックの実装**:
   - `HTTP 429 Too Many Requests`のレスポンスが返された場合には、バックオフ（待機）期間を設けたリトライロジックを実装することが推奨されます。
   - 例えば、指数バックオフのアルゴリズムを使用して、リトライ間隔を徐々に増やしながらリクエストを再試行します。これにより、スロットリングによる影響を緩和できます。

2. **リクエストのスプレッド**:
   - 大量のリクエストを短時間で送信しないように、リクエストを一定の時間間隔で分散させることで、スロットリングの影響を受けにくくできます。
   - 特に、トークンの発行や認証リクエストなどが集中しないように、適切なタイミングでのキャッシュやリクエストの分散化を行うことが重要です。

3. **キャッシュを活用したトークン再利用**:
   - 認証トークンの有効期限を活用し、キャッシュを用いてトークンを再利用することで、同じユーザーが頻繁にトークンを取得するのを防ぎます。
   - Azure ADのトークンには有効期限があるため、その範囲内で同じトークンを再利用することで、トークン取得リクエストの頻度を減らせます。

4. **アプリケーションのスケーリング**:
   - アプリケーションが負荷を分散して処理できるようにスケーリングを行い、複数のインスタンスを使って負荷を軽減します。これにより、単一のインスタンスがリクエストを処理しすぎることを防ぐことができます。
   - Azure API ManagementやAzure Front Doorなどを使い、リクエストの分散やキャッシュを有効活用するのも有効です。

5. **Azure サポートへの問い合わせ**:
   - 特定のシナリオでスロットリングが大きな障害となっている場合、Azureのサポートに問い合わせて、スロットリングの緩和措置が取れるかどうかを確認することができます。これには、特定のケースでの制限の見直しや、スロットリングの考え方についての説明を求めることが含まれます。

### スロットリングの制限を調整できない理由
- Entra IDのスロットリングポリシーは、サービスの健全性を維持するためにMicrosoft側で統一的に管理されています。これにより、過度な負荷がAzureのインフラ全体に与える影響を防ぐことを目的としています。そのため、直接的にこのポリシーを変更する設定オプションは提供されていません。

### 参考情報の確認
- 詳細なスロットリングポリシーや、スロットリングに関する推奨事項については、Microsoftの公式ドキュメント（[Microsoft Entra API Limits](https://learn.microsoft.com/en-us/azure/active-directory/develop/active-directory-service-limits-maximum-values)）を確認するのが良いです。ここには、リクエスト数の上限やスロットリングの動作についての情報が掲載されています。

スロットリングを回避するためには、これらのベストプラクティスを活用し、システム全体の設計を最適化することが重要です。

### user — 2024-10-21T13:28:31.796901+00:00

Azure Load Testingにスレッド数250を設定したjmxファイルを配置したが50の制限がある

### assistant — 2024-10-21T13:29:10.258910+00:00

Azure Load TestingでJMeterのスレッド数を250に設定したJMXファイルを使用しても、50の制限がかかっている場合、次のような要因が考えられます。

### 1. **Entra IDのリクエスト制限**:
   - Entra IDやAzure ADに対するAPIリクエストには、Microsoft側で設定されたレートリミットが適用されている可能性があります。この場合、リクエスト数が50を超えると、リクエストが制限されて処理されないか、遅延が発生している可能性があります。
   - `HTTP 429`エラーが発生していないとのことですが、AzureのAPI内部でレートリミットが発動している場合でも、スロットリングがかかるケースがあります。

### 2. **JMeterのクライアント制限**:
   - JMeterのスレッド数を増やしても、Entra IDのエンドポイントへのアクセスが50の制限を受けている場合、JMeter自体がスロットリングされる可能性があります。これは、エンドポイント側でスロットリングされているため、JMeterのスレッド数を増やしても効果が限定的です。

### 3. **Azure Load Testingのインスタンス制限**:
   - Azure Load Testingを利用する際、負荷をかけるインスタンス数や並列度に対してAzure側の設定で制限がかかっている可能性があります。例えば、Azure側で特定のSKU（プラン）やリソースグループに対する制限があり、負荷をかける際にリソースが制限されている場合です。
   - Azureポータルで、リソースの使用状況や制限を確認して、Azure Load Testingで使用しているプランやリソースグループに制限がかかっていないか確認してください。

### 4. **ネットワークの制約やスロットリングの発生**:
   - JMeterがAzure Load Testingを介してEntra IDにアクセスしている際、ネットワークの帯域幅やレイテンシによって、リクエストが50程度に制限されることがあります。ネットワークのボトルネックが発生している場合、実際のスレッド数に影響が出る可能性があります。

### 5. **スレッドグループの設定確認**:
   - スレッドグループの設定において、スレッド数（同時ユーザー数）やランプアップ時間が適切に設定されていることを確認します。設定が意図通りになっているか、またJMeterの実行時にエラーが発生していないかも確認してください。

### 解決策の検討
- **Entra IDのAPI使用状況の確認**: Entra IDの使用状況をAzureポータルや監視ツールを通じて確認し、スロットリングが発生しているかどうかを確認します。
- **Azureサポートへの問い合わせ**: Azure Load Testingの設定やEntra IDへのリクエスト制限について、詳細な情報が必要な場合は、Azureサポートに問い合わせて、具体的な制限や設定変更が可能か確認することをお勧めします。
- **JMeterのリトライ設定**: 必要に応じて、JMeterのリトライ設定を調整することで、制限に引っかかったリクエストが再試行されるようにすることも検討してください。

このようにして、Entra IDへのアクセスに関する制限がどこで発生しているのかを特定することが、制限を突破するための第一歩です。

### user — 2024-10-21T13:29:28.492341+00:00

Entra IDの使用状況をAzureポータルや監視ツールを通じて確認し、スロットリングが発生しているかどうかを確認する方法

### assistant — 2024-10-21T13:30:02.265145+00:00

Entra ID（旧Azure AD）の使用状況をAzureポータルや監視ツールで確認し、スロットリングが発生しているかどうかを調査するためには、以下の手順を実行することで状況を把握できます。

### 1. **Azureポータルで監査ログを確認する**
   - **監査ログの表示**:
     1. Azureポータルにサインインします。
     2. 左側のメニューから「Azure Active Directory」を選択します。
     3. 「監査ログ」または「サインインログ」を選択します。
     4. ここで、認証リクエストやトークン要求の詳細なログを確認することができます。
     5. `HTTP 429` や「リクエスト制限」に関するエラーが発生している場合は、これらのログに記録されている可能性があります。

   - **フィルターの設定**:
     - 「サインインログ」や「監査ログ」で、特定のアプリケーション（Entra IDを使用するアプリケーション）のログにフィルターをかけると、どのリクエストが影響を受けているかを特定しやすくなります。

### 2. **Microsoft Entra Insightsを利用する**
   - Entra Insightsを活用することで、Entra ID関連の使用状況やエラー情報を集約して確認することができます。
     1. 「Microsoft Entra ID」または「Azure Active Directory」にアクセスし、「Insights」を選択します。
     2. トークンの発行状況やAPIへのリクエスト数、エラーレートなどの指標を確認します。
     3. スロットリングが発生している場合、`Rate Limit Exceeded` といったメトリックが表示されることがあります。

### 3. **Azure Monitorでカスタムログを設定する**
   - Azure Monitorを使用して、Entra IDのAPI使用状況を監視するカスタムログを設定できます。
     1. Azureポータルで「Azure Monitor」を開きます。
     2. 「ログ」メニューから「クエリ」を作成し、ログアナリティクスワークスペースに接続します。
     3. 以下のようなKustoクエリを実行して、APIリクエストの状況やエラーを確認します。
        ```kusto
        AuditLogs
        | where ActivityDisplayName == "Token Issued" or ActivityDisplayName == "UserLogin" 
        | summarize count() by ActivityDisplayName, bin(TimeGenerated, 1h)
        ```
     4. このクエリにより、トークンの発行やログインリクエストの数を時系列で確認できます。リクエストが急激に増加した時間帯にエラーが発生しているかを調査できます。

### 4. **Application Insightsでログを分析する**
   - Entra IDを使用するアプリケーションにApplication Insightsを導入している場合、Application Insightsを使ってリクエストの詳細を分析できます。
     1. Application InsightsリソースをAzureポータルで開きます。
     2. 「失敗」タブや「トレース」タブから、リクエストの失敗数やエラーレスポンス（HTTP 429など）を確認します。
     3. エラーが多い時間帯や頻度が高いリクエストについて、より詳細な情報を得られます。

### 5. **ログアラートの設定**
   - 特定のリクエストエラーが一定数以上発生した場合に通知を受け取るように、アラートルールを設定することもできます。
     1. 「Azure Monitor」の「アラート」セクションに移動し、新しいアラートルールを作成します。
     2. 「条件」にエラーログや監査ログを指定し、`Rate Limit` や `429` エラーが一定数以上発生したときにアラートを送信するように設定します。

### 6. **Microsoft Graph APIを利用する**
   - Microsoft Graph APIを使って、Entra IDの使用状況に関するデータを取得することもできます。
     1. `GET https://graph.microsoft.com/v1.0/reports/getSharePointSiteUsageStorage`などのAPIエンドポイントを使って、Entra IDやそのリソースの使用状況を取得します。
     2. レート制限が発生した場合は、レスポンスヘッダーに`Retry-After`や`RateLimit-Limit`といった情報が含まれることがあります。

これらの方法を組み合わせて、Entra IDの使用状況やスロットリングの発生を監視し、制限に関連する問題を特定することができます。特に、監査ログとサインインログの確認は、スロットリングの原因を特定するうえで非常に有効です。

### user — 2024-10-21T13:31:51.153006+00:00

このような制限を受けた利用者は私以外にいるのか

### assistant — 2024-10-21T13:32:25.594691+00:00

Entra ID（旧Azure AD）のAPI制限やスロットリングの影響を受けるユーザーは、特定の条件に該当する利用者に対して一般的に発生するもので、あなただけではありません。以下のような理由から、他の多くのユーザーや企業も同様の制限を経験することがあります。

### 1. **共通のレートリミットポリシー**
   - Microsoftは、Entra IDのAPIに対して、全てのテナントや利用者に共通のレートリミットポリシーを適用しています。このポリシーは、過剰なリクエストを防ぎ、サービスの安定性と公平な利用を確保するために存在します。そのため、多くの利用者が一定以上のリクエストを短期間に送信すると、制限に達してスロットリングされることがあります。

### 2. **エンタープライズ環境での負荷**
   - 特に企業や大規模な組織では、多数のユーザーが同時に認証やトークンの取得を行うため、エンドポイントへのリクエスト数が急増する場合があります。こうした場合には、組織全体がスロットリングの影響を受けることがあり、Azure ADを使用する多くの企業が同様の問題に直面しています。

### 3. **開発者コミュニティやフォーラムでの報告**
   - 開発者コミュニティやMicrosoftの公式フォーラム（Microsoft Q&A、Stack Overflowなど）には、Entra IDのスロットリングについての報告や質問が多く投稿されています。多くの開発者が、「特定のAPIリクエスト数を超えるとスロットリングされる」「負荷テスト中に制限に達する」といった類似の問題を経験しています。
   - これらのフォーラムを確認することで、他のユーザーが同じ問題にどのように対処しているのか、またMicrosoftからの公式なアドバイスやガイダンスを確認することができます。

### 4. **Microsoftのドキュメントでの説明**
   - Microsoftの公式ドキュメントでも、APIのレートリミットやスロットリングについて言及されています。ここでは、認証リクエストやトークン取得の際に適用される制限値と、それらを緩和するための方法（リトライロジックの実装やキャッシュの使用など）が説明されています。
   - これらのドキュメントは、Entra IDの利用者全体に向けて書かれているため、特定の組織やユーザーに対してのみ適用されているわけではなく、全ての利用者が同様の制限を受ける可能性があります。

### 5. **Microsoftからの公式サポート事例**
   - Microsoftサポートに問い合わせると、同じような問題を抱える利用者が他にもいるかどうかについて確認することができます。サポートを通じて、類似の事例や、他のユーザーがどのように問題を解決したのかについての情報を得ることができるかもしれません。

したがって、Entra IDのレート制限やスロットリングに関連する問題は、特定のユーザーだけでなく、APIを使用する多くのユーザーに共通して発生し得るものです。制限に対応するためのベストプラクティスを参考にしつつ、問題が継続する場合にはMicrosoftのサポートに相談することが推奨されます。
