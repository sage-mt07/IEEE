---
conversation_id: "68b23f23-a1b0-8329-8bed-d190275719bd"
title: "vscode codexエラー対処法"
create_time: 1756512053.837288
update_time: 1756542382.437956
language_guess: "en"
num_messages: 17
part_index: 1
part_count: 1
---

### user — 2025-08-30T00:00:53.509000+00:00

vscodeのcodex cliがstream disconnected before completion: Your input exceeds the context window of this model. Please adjust your input and try again.
を出すようになった
対応方法教えて

### system — 2025-08-30T00:00:53.578460+00:00

_(empty)_

### system — 2025-08-30T00:00:53.837288+00:00

_(empty)_

### system — 2025-08-30T00:00:53.837288+00:00

_(empty)_

### user — 2025-08-30T00:00:53.837288+00:00

_(empty)_

### system — 2025-08-30T00:00:53.837288+00:00

_(empty)_

### assistant — 2025-08-30T00:00:54.372838+00:00

_(empty)_

### assistant — 2025-08-30T00:00:55.571038+00:00

_(empty)_

### assistant — 2025-08-30T00:01:11.854635+00:00

やあ、いらっしゃい！  
そのエラーは「送る側（あなたの入力＋会話履歴＋自動添付のファイル等）が、そのモデルのコンテキスト上限を超えたので、サーバがストリームを閉じた」という意味です。手早く直す順に対処をまとめました。

### まずは即効薬（5分でできる）
1) **新規セッションに切り替え**  
   直前までの長い履歴が効いていることが多いです。VS Code 側で“新しいチャット/新しい会話”にするか、CLI なら「履歴を送らない」モードがあれば有効化。

2) **自動コンテキスト注入を止める／絞る**  
   拡張やCLIの設定に「開いているエディタ内容を含める」「ワークスペースのファイルを自動添付」「直近Nメッセージを常に送る」などがあれば**オフ**、または**最小**に。

3) **質問を最小化（必要箇所だけ）**  
   2000行のファイル全体ではなく、**該当関数の抜粋＋行番号**だけ送る。差分相談なら `git diff --unified=0` の**差分だけ**を貼る。

4) **max_tokens を小さく**  
   生成上限（max_tokens）を下げると、**プロンプトに使える余白**が増えます（「プロンプト＋出力」合計が上限）。

### もう一歩（恒久対処）
5) **モデルを長コンテキスト版に変更**  
   利用可能なら、より大きいコンテキストのモデルに切替。

6) **長い会話は要約を“固定前提”に置換**  
   いったんAIに**300–600トークンの要約**を作らせて、それ以降は**要約だけ**を前置きに使う。元の長文は送らない。

7) **資料は“参照させる”設計に**  
   仕様書やログを丸ごと貼らず、**要点＋ファイルパス＋アンカー（行番号や見出し）**だけ渡す。必要になった箇所だけ後から抜粋。

8) **ログ・JSONは圧縮ルールを決める**  
   - JSONは**キー最小＋失敗ケース1件のみ**  
   - ログは**エラー発生前後30行**  
   - バイナリ／巨大表は**列見出し＋数行だけ**

9) **大きな依頼は分割**  
   「設計レビュー→ユニットテスト→リファクタ提案」のように**フェーズごと**に投げる。1ターンの入出力を小さく。

10) **CLI/拡張を最新化**  
   古いバージョンだと、エラー文言が同じでも挙動が不安定な場合があります。アップデート＆再起動。

### すぐ使える“最小プロンプト”テンプレ
```
# 前提（300字以内）
- {課題の一文要約}
- 参照: {repo相対パス}:{行番号範囲}

# 対象抜粋
{該当関数 or 差分だけ}

# 依頼
- 目的: {例: Null参照例外の原因特定}
- 制約: コード変更は3行以内 / 互換性維持
- 出力形式: 箇条書き→修正パッチ
```

### よくある落とし穴
- **「自分は短く書いたつもり」でも、背後で**  
  - システムプロンプト  
  - 会話履歴  
  - 自動添付のファイル/タブ  
  が合算され、上限超えになることが多いです。まずは**自動添付の無効化**と**新規セッション**から。

---

必要なら、いま投げている具体プロンプトをここに貼ってくれれば、**どこを削ると効果的か**を一発で詰めます。  

—送信: [[REDACTED_PHONE]]:01 (JST)

### assistant — 2025-08-30T00:01:18.685737+00:00

_(empty)_

### assistant — 2025-08-30T00:01:18.875469+00:00

_(empty)_

### system — 2025-08-30T00:06:13.362789+00:00

_(empty)_

### user — 2025-08-30T00:06:13.483000+00:00

新規チャットで解決した

### assistant — 2025-08-30T00:06:15.162207+00:00

_(empty)_

### assistant — 2025-08-30T00:06:21.240577+00:00

よかった！新規チャットで履歴がリセットされて、コンテキストの空きが確保できたのが効いてます 🙌

再発を減らすためのクイック設定だけ置いておきます（必要なものだけ採用でOK）:
- 開いているファイルの**自動添付をOFF**（または上限サイズを小さく）。
- **会話履歴の送信数を絞る**（直近3–5メッセージなど）。
- 相談は**必要部分の抜粋や`git diff`だけ**を送る（ログは前後30行）。
- 使えるなら**長コンテキストのモデルへ切替**／**max_tokensを少し下げる**。

“最小プロンプト”の型（短くて強い）  
- 前提：一文要約（300字以内）  
- 対象：該当関数 or 差分のみ（行番号付き）  
- 依頼：目的・制約・出力形式（例：箇条書き→パッチ）  

また詰まったら、その時のプロンプトを見せてくれれば**どこを削ると効くか**すぐに絞ります！

—送信: [[REDACTED_PHONE]]:06 (JST)

### assistant — 2025-08-30T00:06:24.497334+00:00

_(empty)_
